# å¤šæœåŠ¡ç¼–æ’å®è·µ

> ä½¿ç”¨ Docker Compose ç¼–æ’å¤šæœåŠ¡åº”ç”¨çš„å®è·µæ¡ˆä¾‹

---

## ğŸ“‹ ç›®å½•

- [Web åº”ç”¨ + æ•°æ®åº“](#web-åº”ç”¨--æ•°æ®åº“)
- [å¾®æœåŠ¡æ¶æ„ç¼–æ’](#å¾®æœåŠ¡æ¶æ„ç¼–æ’)
- [å‰åç«¯åˆ†ç¦»é¡¹ç›®](#å‰åç«¯åˆ†ç¦»é¡¹ç›®)
- [æœåŠ¡ä¾èµ–ç®¡ç†](#æœåŠ¡ä¾èµ–ç®¡ç†)
- [æœåŠ¡æ‰©å±•ï¼ˆscaleï¼‰](#æœåŠ¡æ‰©å±•scale)

---

## Web åº”ç”¨ + æ•°æ®åº“

### åŸºæœ¬é…ç½®

```yaml
version: '3.8'

services:
  web:
    build: .
    ports:
      - "8080:80"
    depends_on:
      - db
    environment:
      - DATABASE_URL=postgres://db:5432/mydb

  db:
    image: postgres:13
    environment:
      - POSTGRES_PASSWORD=password
      - POSTGRES_DB=mydb
    volumes:
      - db-data:/var/lib/postgresql/data

volumes:
  db-data:
```

### å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

---

## å¾®æœåŠ¡æ¶æ„ç¼–æ’

### å¾®æœåŠ¡é…ç½®

```yaml
version: '3.8'

services:
  api-gateway:
    image: nginx:latest
    ports:
      - "80:80"
    depends_on:
      - api
      - auth
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf

  api:
    build: ./api
    environment:
      - DATABASE_URL=postgres://db:5432/mydb
      - REDIS_URL=redis://redis:6379
    depends_on:
      - db
      - redis

  auth:
    build: ./auth
    environment:
      - DATABASE_URL=postgres://db:5432/mydb
    depends_on:
      - db

  db:
    image: postgres:13
    environment:
      - POSTGRES_PASSWORD=password
    volumes:
      - db-data:/var/lib/postgresql/data

  redis:
    image: redis:latest

networks:
  default:
    name: microservices-network

volumes:
  db-data:
```

---

## å‰åç«¯åˆ†ç¦»é¡¹ç›®

### é…ç½®ç¤ºä¾‹

```yaml
version: '3.8'

services:
  frontend:
    build: ./frontend
    ports:
      - "3000:80"
    depends_on:
      - backend
    environment:
      - API_URL=http://backend:8080

  backend:
    build: ./backend
    ports:
      - "8080:8080"
    depends_on:
      - db
    environment:
      - DATABASE_URL=postgres://db:5432/mydb

  db:
    image: postgres:13
    environment:
      - POSTGRES_PASSWORD=password
    volumes:
      - db-data:/var/lib/postgresql/data

volumes:
  db-data:
```

---

## æœåŠ¡ä¾èµ–ç®¡ç†

### depends_on

```yaml
services:
  web:
    image: nginx:latest
    depends_on:
      - db
      - cache

  db:
    image: postgres:13

  cache:
    image: redis:latest
```

### å¥åº·æ£€æŸ¥ä¾èµ–

```yaml
services:
  web:
    image: nginx:latest
    depends_on:
      db:
        condition: service_healthy

  db:
    image: postgres:13
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 10s
      timeout: 5s
      retries: 5
```

---

## æœåŠ¡æ‰©å±•ï¼ˆscaleï¼‰

### æ‰©å±•æœåŠ¡

```bash
# æ‰©å±• web æœåŠ¡åˆ° 3 ä¸ªå®ä¾‹
docker-compose up -d --scale web=3

# æ‰©å±•å¤šä¸ªæœåŠ¡
docker-compose up -d --scale web=3 --scale api=2
```

### è´Ÿè½½å‡è¡¡é…ç½®

```yaml
version: '3.8'

services:
  nginx:
    image: nginx:latest
    ports:
      - "80:80"
    depends_on:
      - web
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf

  web:
    build: .
    # å¤šä¸ªå®ä¾‹ä¼šè‡ªåŠ¨è´Ÿè½½å‡è¡¡
```

---

## å®Œæ•´å®è·µæ¡ˆä¾‹

### LAMP æ ˆ

```yaml
version: '3.8'

services:
  web:
    image: php:8.0-apache
    ports:
      - "8080:80"
    volumes:
      - ./app:/var/www/html
    depends_on:
      - db

  db:
    image: mysql:8.0
    environment:
      - MYSQL_ROOT_PASSWORD=rootpassword
      - MYSQL_DATABASE=mydb
    volumes:
      - db-data:/var/lib/mysql

volumes:
  db-data:
```

### MEAN æ ˆ

```yaml
version: '3.8'

services:
  frontend:
    build: ./frontend
    ports:
      - "3000:80"
    depends_on:
      - api

  api:
    build: ./api
    ports:
      - "8080:3000"
    depends_on:
      - db
    environment:
      - DATABASE_URL=mongodb://db:27017/mydb

  db:
    image: mongo:5.0
    volumes:
      - db-data:/data/db

volumes:
  db-data:
```

---

## ğŸ“š å‚è€ƒèµ„æº

- [Docker Compose å®˜æ–¹æ–‡æ¡£](https://docs.docker.com/compose/)
- [Docker Compose ç¤ºä¾‹](https://docs.docker.com/compose/samples/)

---

[[!MOC-Docker|è¿”å› Docker çŸ¥è¯†ä½“ç³»]]

#Docker #DockerCompose #å¤šæœåŠ¡ç¼–æ’
