# å®¹å™¨è¿è¡Œæ¨¡å¼

> Docker å®¹å™¨çš„å‰å°ã€åå°ã€äº¤äº’å¼ç­‰è¿è¡Œæ¨¡å¼

---

## ğŸ“‹ ç›®å½•

- [å‰å°è¿è¡Œ](#å‰å°è¿è¡Œ)
- [åå°è¿è¡Œ](#åå°è¿è¡Œ)
- [äº¤äº’å¼è¿è¡Œ](#äº¤äº’å¼è¿è¡Œ)
- [åˆ†ç¦»æ¨¡å¼](#åˆ†ç¦»æ¨¡å¼)
- [è‡ªåŠ¨é‡å¯ç­–ç•¥](#è‡ªåŠ¨é‡å¯ç­–ç•¥)
- [è¿è¡Œæ¨¡å¼é€‰æ‹©](#è¿è¡Œæ¨¡å¼é€‰æ‹©)

---

## å‰å°è¿è¡Œ

### é»˜è®¤æ¨¡å¼

å®¹å™¨é»˜è®¤åœ¨å‰å°è¿è¡Œï¼Œè¾“å‡ºç›´æ¥æ˜¾ç¤ºåœ¨ç»ˆç«¯ã€‚

```bash
# å‰å°è¿è¡Œå®¹å™¨
docker run nginx:latest

# å‰å°è¿è¡Œå¹¶æ‰§è¡Œå‘½ä»¤
docker run ubuntu:20.04 echo "Hello Docker"
```

### ç‰¹ç‚¹

- è¾“å‡ºç›´æ¥æ˜¾ç¤ºåœ¨ç»ˆç«¯
- å®¹å™¨åœæ­¢åï¼Œå‘½ä»¤ç»“æŸ
- é€‚åˆä¸€æ¬¡æ€§ä»»åŠ¡å’Œè°ƒè¯•

---

## åå°è¿è¡Œ

### åˆ†ç¦»æ¨¡å¼ (-d)

ä½¿ç”¨ `-d` å‚æ•°è®©å®¹å™¨åœ¨åå°è¿è¡Œï¼ˆdetached modeï¼‰ã€‚

```bash
# åå°è¿è¡Œå®¹å™¨
docker run -d nginx:latest

# åå°è¿è¡Œå¹¶æŒ‡å®šåç§°
docker run -d --name my-nginx nginx:latest

# åå°è¿è¡Œå¹¶æ˜ å°„ç«¯å£
docker run -d -p 8080:80 nginx:latest
```

### ç‰¹ç‚¹

- å®¹å™¨åœ¨åå°è¿è¡Œ
- ä¸å ç”¨ç»ˆç«¯
- é€‚åˆé•¿æœŸè¿è¡Œçš„æœåŠ¡

### æŸ¥çœ‹åå°å®¹å™¨

```bash
# æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨
docker ps

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs my-nginx

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker logs -f my-nginx
```

---

## äº¤äº’å¼è¿è¡Œ

### äº¤äº’å¼æ¨¡å¼ (-it)

ä½¿ç”¨ `-it` å‚æ•°åˆ›å»ºäº¤äº’å¼å®¹å™¨ã€‚

```bash
# äº¤äº’å¼è¿è¡Œå®¹å™¨
docker run -it ubuntu:20.04 /bin/bash

# äº¤äº’å¼è¿è¡Œå¹¶æŒ‡å®šå·¥ä½œç›®å½•
docker run -it -w /app ubuntu:20.04 /bin/bash

# äº¤äº’å¼è¿è¡Œå¹¶æŒ‚è½½ç›®å½•
docker run -it -v $(pwd):/app ubuntu:20.04 /bin/bash
```

### å‚æ•°è¯´æ˜

- `-i`ï¼šä¿æŒ STDIN æ‰“å¼€ï¼Œå³ä½¿æ²¡æœ‰é™„åŠ 
- `-t`ï¼šåˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯ï¼ˆpseudo-TTYï¼‰

### é€€å‡ºäº¤äº’å¼å®¹å™¨

```bash
# é€€å‡ºå¹¶åœæ­¢å®¹å™¨
exit
# æˆ– Ctrl+D

# é€€å‡ºä½†ä¸åœæ­¢å®¹å™¨
Ctrl+P, Ctrl+Q
```

---

## åˆ†ç¦»æ¨¡å¼

### docker attach

é™„åŠ åˆ°è¿è¡Œä¸­çš„å®¹å™¨ã€‚

```bash
# å¯åŠ¨åå°å®¹å™¨
docker run -d --name my-container ubuntu:20.04 sleep 3600

# é™„åŠ åˆ°å®¹å™¨
docker attach my-container

# é€€å‡ºè€Œä¸åœæ­¢å®¹å™¨
Ctrl+P, Ctrl+Q
```

### docker exec vs docker attach

| ç‰¹æ€§ | docker exec | docker attach |
|------|------------|---------------|
| åˆ›å»ºæ–°è¿›ç¨‹ | æ˜¯ | å¦ |
| é™„åŠ åˆ°ä¸»è¿›ç¨‹ | å¦ | æ˜¯ |
| é€€å‡ºå½±å“å®¹å™¨ | å¦ | æ˜¯ï¼ˆä¸»è¿›ç¨‹é€€å‡ºæ—¶ï¼‰ |
| æ¨èä½¿ç”¨ | âœ… | âš ï¸ |

---

## è‡ªåŠ¨é‡å¯ç­–ç•¥

### --restart å‚æ•°

è®¾ç½®å®¹å™¨çš„é‡å¯ç­–ç•¥ã€‚

```bash
# ä¸è‡ªåŠ¨é‡å¯ï¼ˆé»˜è®¤ï¼‰
docker run --restart=no nginx:latest

# æ€»æ˜¯é‡å¯
docker run --restart=always nginx:latest

# å¤±è´¥æ—¶é‡å¯ï¼ˆéé›¶é€€å‡ºç ï¼‰
docker run --restart=on-failure nginx:latest

# å¤±è´¥æ—¶é‡å¯ï¼Œæœ€å¤šé‡è¯• N æ¬¡
docker run --restart=on-failure:5 nginx:latest

# é™¤éæ‰‹åŠ¨åœæ­¢ï¼Œå¦åˆ™æ€»æ˜¯é‡å¯
docker run --restart=unless-stopped nginx:latest
```

### é‡å¯ç­–ç•¥è¯´æ˜

- **no**ï¼šä¸è‡ªåŠ¨é‡å¯ï¼ˆé»˜è®¤ï¼‰
- **always**ï¼šæ€»æ˜¯é‡å¯ï¼Œæ— è®ºé€€å‡ºçŠ¶æ€
- **on-failure**ï¼šåªåœ¨éé›¶é€€å‡ºç æ—¶é‡å¯
- **on-failure:N**ï¼šå¤±è´¥æ—¶é‡å¯ï¼Œæœ€å¤šé‡è¯• N æ¬¡
- **unless-stopped**ï¼šé™¤éæ‰‹åŠ¨åœæ­¢ï¼Œå¦åˆ™æ€»æ˜¯é‡å¯

### æ›´æ–°é‡å¯ç­–ç•¥

```bash
# æ›´æ–°è¿è¡Œä¸­å®¹å™¨çš„é‡å¯ç­–ç•¥
docker update --restart=always my-container

# æ›´æ–°å¤šä¸ªå®¹å™¨
docker update --restart=always container1 container2
```

---

## è¿è¡Œæ¨¡å¼é€‰æ‹©

### é€‰æ‹©æŒ‡å—

| åœºæ™¯ | æ¨èæ¨¡å¼ | å‘½ä»¤ç¤ºä¾‹ |
|------|---------|---------|
| Web æœåŠ¡ | åå°è¿è¡Œ | `docker run -d -p 80:80 nginx` |
| æ•°æ®åº“ | åå°è¿è¡Œ + è‡ªåŠ¨é‡å¯ | `docker run -d --restart=always postgres` |
| ä¸€æ¬¡æ€§ä»»åŠ¡ | å‰å°è¿è¡Œ | `docker run ubuntu echo "hello"` |
| è°ƒè¯•å®¹å™¨ | äº¤äº’å¼è¿è¡Œ | `docker run -it ubuntu /bin/bash` |
| å¼€å‘ç¯å¢ƒ | äº¤äº’å¼ + æŒ‚è½½ | `docker run -it -v $(pwd):/app node:16` |

### å¸¸è§ç»„åˆ

#### Web æœåŠ¡

```bash
docker run -d \
  --name web \
  --restart=always \
  -p 8080:80 \
  nginx:latest
```

#### æ•°æ®åº“æœåŠ¡

```bash
docker run -d \
  --name db \
  --restart=always \
  -e POSTGRES_PASSWORD=password \
  -v db-data:/var/lib/postgresql/data \
  postgres:13
```

#### å¼€å‘ç¯å¢ƒ

```bash
docker run -it \
  --name dev \
  -v $(pwd):/workspace \
  -w /workspace \
  node:16 \
  /bin/bash
```

#### å®šæ—¶ä»»åŠ¡

```bash
docker run -d \
  --name cron-job \
  --restart=on-failure:3 \
  myapp:latest \
  /app/run-cron.sh
```

---

## å®¹å™¨çŠ¶æ€ç®¡ç†

### æš‚åœå’Œæ¢å¤

```bash
# æš‚åœå®¹å™¨
docker pause my-container

# æ¢å¤å®¹å™¨
docker unpause my-container

# æŸ¥çœ‹æš‚åœçš„å®¹å™¨
docker ps -a -f "status=paused"
```

### ç­‰å¾…å®¹å™¨åœæ­¢

```bash
# ç­‰å¾…å®¹å™¨åœæ­¢
docker wait my-container

# ç­‰å¾…å¹¶è·å–é€€å‡ºç 
EXIT_CODE=$(docker wait my-container)
echo "Container exited with code: $EXIT_CODE"
```

---

## å®ç”¨æŠ€å·§

### åå°è¿è¡Œå¹¶æŸ¥çœ‹æ—¥å¿—

```bash
# å¯åŠ¨åå°å®¹å™¨
docker run -d --name my-app myapp:latest

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker logs -f my-app
```

### äº¤äº’å¼è°ƒè¯•

```bash
# å¯åŠ¨åå°å®¹å™¨
docker run -d --name my-app myapp:latest

# è¿›å…¥å®¹å™¨è°ƒè¯•
docker exec -it my-app /bin/bash
```

### ä¸€æ¬¡æ€§ä»»åŠ¡

```bash
# è¿è¡Œåè‡ªåŠ¨åˆ é™¤
docker run --rm ubuntu:20.04 echo "Hello"

# è¿è¡Œåè‡ªåŠ¨åˆ é™¤ï¼ˆå³ä½¿å¤±è´¥ï¼‰
docker run --rm ubuntu:20.04 false || true
```

---

## ğŸ“š å‚è€ƒèµ„æº

- [Docker å®˜æ–¹æ–‡æ¡£ - docker run](https://docs.docker.com/engine/reference/commandline/run/)
- [Docker å®˜æ–¹æ–‡æ¡£ - å®¹å™¨é‡å¯ç­–ç•¥](https://docs.docker.com/config/containers/start-containers-automatically/)

---

[[!MOC-Docker|è¿”å› Docker çŸ¥è¯†ä½“ç³»]]

#Docker #å®¹å™¨ #è¿è¡Œæ¨¡å¼
