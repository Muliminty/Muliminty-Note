# å®¹å™¨èµ„æºé™åˆ¶

> Docker å®¹å™¨çš„ CPUã€å†…å­˜ã€ç£ç›˜ I/O ç­‰èµ„æºé™åˆ¶

---

## ğŸ“‹ ç›®å½•

- [CPU é™åˆ¶](#cpu-é™åˆ¶)
- [å†…å­˜é™åˆ¶](#å†…å­˜é™åˆ¶)
- [ç£ç›˜ I/O é™åˆ¶](#ç£ç›˜-io-é™åˆ¶)
- [èµ„æºç›‘æ§](#èµ„æºç›‘æ§)
- [èµ„æºé…é¢ç®¡ç†](#èµ„æºé…é¢ç®¡ç†)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## CPU é™åˆ¶

### --cpus

é™åˆ¶å®¹å™¨ä½¿ç”¨çš„ CPU æ•°é‡ã€‚

```bash
# é™åˆ¶ä½¿ç”¨ 1 ä¸ª CPU
docker run --cpus="1.0" nginx:latest

# é™åˆ¶ä½¿ç”¨ 0.5 ä¸ª CPU
docker run --cpus="0.5" nginx:latest

# é™åˆ¶ä½¿ç”¨ 2.5 ä¸ª CPU
docker run --cpus="2.5" nginx:latest
```

### --cpu-shares

è®¾ç½® CPU æƒé‡ï¼ˆç›¸å¯¹ä¼˜å…ˆçº§ï¼‰ã€‚

```bash
# è®¾ç½® CPU æƒé‡ï¼ˆé»˜è®¤ 1024ï¼‰
docker run --cpu-shares=512 nginx:latest

# é«˜ä¼˜å…ˆçº§å®¹å™¨
docker run --cpu-shares=2048 nginx:latest
```

### --cpuset-cpus

é™åˆ¶å®¹å™¨ä½¿ç”¨ç‰¹å®šçš„ CPU æ ¸å¿ƒã€‚

```bash
# ä½¿ç”¨ CPU 0 å’Œ 1
docker run --cpuset-cpus="0,1" nginx:latest

# ä½¿ç”¨ CPU 0-3
docker run --cpuset-cpus="0-3" nginx:latest
```

### --cpu-period å’Œ --cpu-quota

ç²¾ç¡®æ§åˆ¶ CPU ä½¿ç”¨æ—¶é—´ã€‚

```bash
# é™åˆ¶ä½¿ç”¨ 50% CPU
docker run --cpu-period=100000 --cpu-quota=50000 nginx:latest
```

---

## å†…å­˜é™åˆ¶

### -m / --memory

é™åˆ¶å®¹å™¨ä½¿ç”¨çš„å†…å­˜ã€‚

```bash
# é™åˆ¶ä½¿ç”¨ 512MB å†…å­˜
docker run -m 512m nginx:latest

# é™åˆ¶ä½¿ç”¨ 1GB å†…å­˜
docker run -m 1g nginx:latest

# é™åˆ¶ä½¿ç”¨ 2GB å†…å­˜
docker run --memory="2g" nginx:latest
```

### --memory-swap

é™åˆ¶å†…å­˜å’Œäº¤æ¢ç©ºé—´çš„æ€»å’Œã€‚

```bash
# å†…å­˜ 512MBï¼Œäº¤æ¢ç©ºé—´ 1GBï¼ˆæ€»è®¡ 1.5GBï¼‰
docker run -m 512m --memory-swap=1g nginx:latest

# ç¦ç”¨äº¤æ¢ç©ºé—´
docker run -m 512m --memory-swap=512m nginx:latest

# ä¸é™åˆ¶äº¤æ¢ç©ºé—´ï¼ˆå±é™©ï¼‰
docker run -m 512m --memory-swap=-1 nginx:latest
```

### --oom-kill-disable

ç¦ç”¨ OOM Killerï¼ˆä¸æ¨èï¼‰ã€‚

```bash
# ç¦ç”¨ OOM Killer
docker run -m 512m --oom-kill-disable nginx:latest
```

---

## ç£ç›˜ I/O é™åˆ¶

### --device-read-bps

é™åˆ¶è®¾å¤‡çš„è¯»å–é€Ÿåº¦ã€‚

```bash
# é™åˆ¶è¯»å–é€Ÿåº¦ä¸º 1MB/s
docker run --device-read-bps /dev/sda:1mb nginx:latest
```

### --device-write-bps

é™åˆ¶è®¾å¤‡çš„å†™å…¥é€Ÿåº¦ã€‚

```bash
# é™åˆ¶å†™å…¥é€Ÿåº¦ä¸º 1MB/s
docker run --device-write-bps /dev/sda:1mb nginx:latest
```

### --device-read-iops

é™åˆ¶è®¾å¤‡çš„è¯»å– IOPSã€‚

```bash
# é™åˆ¶è¯»å– IOPS ä¸º 1000
docker run --device-read-iops /dev/sda:1000 nginx:latest
```

### --device-write-iops

é™åˆ¶è®¾å¤‡çš„å†™å…¥ IOPSã€‚

```bash
# é™åˆ¶å†™å…¥ IOPS ä¸º 1000
docker run --device-write-iops /dev/sda:1000 nginx:latest
```

---

## èµ„æºç›‘æ§

### docker stats

å®æ—¶æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µã€‚

```bash
# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨çš„èµ„æºä½¿ç”¨
docker stats

# æŸ¥çœ‹æŒ‡å®šå®¹å™¨
docker stats my-container

# åªæ˜¾ç¤ºä¸€æ¬¡ï¼ˆä¸æŒç»­æ›´æ–°ï¼‰
docker stats --no-stream

# æŒ‰æ ¼å¼è¾“å‡º
docker stats --format "table {{.Container}}\t{{.CPUPerc}}\t{{.MemUsage}}"
```

### docker inspect

æŸ¥çœ‹å®¹å™¨çš„èµ„æºé™åˆ¶é…ç½®ã€‚

```bash
# æŸ¥çœ‹ CPU é™åˆ¶
docker inspect -f '{{.HostConfig.CpuShares}}' my-container
docker inspect -f '{{.HostConfig.NanoCpus}}' my-container

# æŸ¥çœ‹å†…å­˜é™åˆ¶
docker inspect -f '{{.HostConfig.Memory}}' my-container
docker inspect -f '{{.HostConfig.MemorySwap}}' my-container
```

---

## èµ„æºé…é¢ç®¡ç†

### æ›´æ–°èµ„æºé™åˆ¶

```bash
# æ›´æ–° CPU é™åˆ¶
docker update --cpus="2.0" my-container

# æ›´æ–°å†…å­˜é™åˆ¶
docker update --memory="1g" my-container

# æ›´æ–°å¤šä¸ªé™åˆ¶
docker update --cpus="2.0" --memory="1g" my-container
```

### Docker Compose ä¸­çš„èµ„æºé™åˆ¶

```yaml
version: '3.8'
services:
  web:
    image: nginx:latest
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M
        reservations:
          cpus: '0.5'
          memory: 256M
```

---

## æœ€ä½³å®è·µ

### 1. åˆç†è®¾ç½®èµ„æºé™åˆ¶

```bash
# æ ¹æ®åº”ç”¨éœ€æ±‚è®¾ç½®
docker run -d \
  --name web \
  --cpus="1.0" \
  --memory="512m" \
  nginx:latest
```

### 2. ç›‘æ§èµ„æºä½¿ç”¨

```bash
# å®šæœŸæ£€æŸ¥èµ„æºä½¿ç”¨æƒ…å†µ
docker stats --no-stream
```

### 3. é¢„ç•™èµ„æº

```bash
# ä¸ºç³»ç»Ÿé¢„ç•™èµ„æº
# ä¸è¦å°†æ‰€æœ‰ CPU/å†…å­˜åˆ†é…ç»™å®¹å™¨
```

### 4. ä½¿ç”¨èµ„æºé™åˆ¶é˜²æ­¢èµ„æºè€—å°½

```bash
# é˜²æ­¢å•ä¸ªå®¹å™¨å ç”¨è¿‡å¤šèµ„æº
docker run --cpus="2.0" --memory="1g" myapp:latest
```

---

## å¸¸è§é—®é¢˜

### 1. å®¹å™¨è¢« OOM Killer æ€æ­»

**é—®é¢˜**ï¼šå®¹å™¨å†…å­˜ä½¿ç”¨è¶…è¿‡é™åˆ¶ã€‚

**è§£å†³**ï¼š
- å¢åŠ å†…å­˜é™åˆ¶
- ä¼˜åŒ–åº”ç”¨å†…å­˜ä½¿ç”¨
- æ£€æŸ¥å†…å­˜æ³„æ¼

### 2. CPU ä½¿ç”¨ç‡è¿‡é«˜

**é—®é¢˜**ï¼šå®¹å™¨å ç”¨è¿‡å¤š CPUã€‚

**è§£å†³**ï¼š
- è®¾ç½® CPU é™åˆ¶
- ä¼˜åŒ–åº”ç”¨æ€§èƒ½
- ä½¿ç”¨ CPU æƒé‡åˆ†é…ä¼˜å…ˆçº§

### 3. ç£ç›˜ I/O è¿‡é«˜

**é—®é¢˜**ï¼šå®¹å™¨ç£ç›˜ I/O è¿‡é«˜ã€‚

**è§£å†³**ï¼š
- è®¾ç½®ç£ç›˜ I/O é™åˆ¶
- ä¼˜åŒ–åº”ç”¨ I/O æ“ä½œ
- ä½¿ç”¨ SSD å­˜å‚¨

---

## ğŸ“š å‚è€ƒèµ„æº

- [Docker å®˜æ–¹æ–‡æ¡£ - èµ„æºé™åˆ¶](https://docs.docker.com/config/containers/resource_constraints/)
- [Docker å®˜æ–¹æ–‡æ¡£ - docker stats](https://docs.docker.com/engine/reference/commandline/stats/)

---

[[!MOC-Docker|è¿”å› Docker çŸ¥è¯†ä½“ç³»]]

#Docker #å®¹å™¨ #èµ„æºé™åˆ¶
