# å®¹å™¨æ•°æ®ç®¡ç†

> Docker å®¹å™¨çš„æ•°æ®å·ã€ç»‘å®šæŒ‚è½½ç­‰æ•°æ®ç®¡ç†æ–¹å¼

---

## ğŸ“‹ ç›®å½•

- [æ•°æ®å·ï¼ˆVolumeï¼‰](#æ•°æ®å·volume)
- [ç»‘å®šæŒ‚è½½ï¼ˆBind Mountï¼‰](#ç»‘å®šæŒ‚è½½bind-mount)
- [ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿï¼ˆtmpfsï¼‰](#ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿtmpfs)
- [æ•°æ®æŒä¹…åŒ–ç­–ç•¥](#æ•°æ®æŒä¹…åŒ–ç­–ç•¥)
- [æ•°æ®å¤‡ä»½ä¸æ¢å¤](#æ•°æ®å¤‡ä»½ä¸æ¢å¤)

---

## æ•°æ®å·ï¼ˆVolumeï¼‰

### ä»€ä¹ˆæ˜¯æ•°æ®å·

æ•°æ®å·æ˜¯ Docker ç®¡ç†çš„æŒä¹…åŒ–å­˜å‚¨ï¼Œç‹¬ç«‹äºå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸã€‚

### åˆ›å»ºæ•°æ®å·

```bash
# åˆ›å»ºæ•°æ®å·
docker volume create my-volume

# åˆ›å»ºæ•°æ®å·å¹¶æŒ‡å®šé©±åŠ¨
docker volume create --driver local my-volume

# åˆ›å»ºæ•°æ®å·å¹¶æŒ‡å®šé€‰é¡¹
docker volume create \
  --driver local \
  --opt type=none \
  --opt device=/path/to/data \
  --opt o=bind \
  my-volume
```

### ä½¿ç”¨æ•°æ®å·

```bash
# ä½¿ç”¨æ•°æ®å·
docker run -d -v my-volume:/data nginx:latest

# ä½¿ç”¨åŒ¿åæ•°æ®å·
docker run -d -v /data nginx:latest

# ä½¿ç”¨å‘½åæ•°æ®å·
docker run -d --mount source=my-volume,target=/data nginx:latest
```

### ç®¡ç†æ•°æ®å·

```bash
# åˆ—å‡ºæ‰€æœ‰æ•°æ®å·
docker volume ls

# æŸ¥çœ‹æ•°æ®å·è¯¦ç»†ä¿¡æ¯
docker volume inspect my-volume

# åˆ é™¤æ•°æ®å·
docker volume rm my-volume

# åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„æ•°æ®å·
docker volume prune
```

---

## ç»‘å®šæŒ‚è½½ï¼ˆBind Mountï¼‰

### ä»€ä¹ˆæ˜¯ç»‘å®šæŒ‚è½½

ç»‘å®šæŒ‚è½½å°†å®¿ä¸»æœºçš„ç›®å½•æˆ–æ–‡ä»¶ç›´æ¥æŒ‚è½½åˆ°å®¹å™¨ä¸­ã€‚

### ä½¿ç”¨ç»‘å®šæŒ‚è½½

```bash
# ç»‘å®šæŒ‚è½½ç›®å½•
docker run -d -v /host/path:/container/path nginx:latest

# ç»‘å®šæŒ‚è½½æ–‡ä»¶
docker run -d -v /host/file:/container/file:ro nginx:latest

# ä½¿ç”¨ --mount è¯­æ³•
docker run -d \
  --mount type=bind,source=/host/path,target=/container/path \
  nginx:latest
```

### æŒ‚è½½é€‰é¡¹

```bash
# åªè¯»æŒ‚è½½
docker run -d -v /host/path:/container/path:ro nginx:latest

# è¯»å†™æŒ‚è½½ï¼ˆé»˜è®¤ï¼‰
docker run -d -v /host/path:/container/path:rw nginx:latest

# ä½¿ç”¨ --mount è¯­æ³•
docker run -d \
  --mount type=bind,source=/host/path,target=/container/path,readonly \
  nginx:latest
```

---

## ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿï¼ˆtmpfsï¼‰

### ä»€ä¹ˆæ˜¯ tmpfs

tmpfs æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿï¼Œå®¹å™¨åœæ­¢åæ•°æ®ä¼šä¸¢å¤±ã€‚

### ä½¿ç”¨ tmpfs

```bash
# ä½¿ç”¨ tmpfs
docker run -d --tmpfs /tmp nginx:latest

# æŒ‡å®š tmpfs å¤§å°
docker run -d --tmpfs /tmp:rw,noexec,nosuid,size=100m nginx:latest

# ä½¿ç”¨ --mount è¯­æ³•
docker run -d \
  --mount type=tmpfs,destination=/tmp,tmpfs-size=100m \
  nginx:latest
```

### tmpfs é€‰é¡¹

- `rw`ï¼šè¯»å†™ï¼ˆé»˜è®¤ï¼‰
- `ro`ï¼šåªè¯»
- `noexec`ï¼šç¦æ­¢æ‰§è¡Œ
- `nosuid`ï¼šç¦æ­¢ setuid
- `size`ï¼šå¤§å°é™åˆ¶

---

## æ•°æ®æŒä¹…åŒ–ç­–ç•¥

### æ•°æ®å· vs ç»‘å®šæŒ‚è½½

| ç‰¹æ€§ | æ•°æ®å· | ç»‘å®šæŒ‚è½½ |
|------|--------|----------|
| ç®¡ç†æ–¹å¼ | Docker ç®¡ç† | ç”¨æˆ·ç®¡ç† |
| ä½ç½® | Docker å­˜å‚¨ç›®å½• | ç”¨æˆ·æŒ‡å®š |
| å¯ç§»æ¤æ€§ | é«˜ | ä½ |
| æ€§èƒ½ | å¥½ | å–å†³äºå®¿ä¸»æœº |
| é€‚ç”¨åœºæ™¯ | ç”Ÿäº§ç¯å¢ƒ | å¼€å‘ç¯å¢ƒ |

### é€‰æ‹©å»ºè®®

- **ç”Ÿäº§ç¯å¢ƒ**ï¼šä½¿ç”¨æ•°æ®å·
- **å¼€å‘ç¯å¢ƒ**ï¼šä½¿ç”¨ç»‘å®šæŒ‚è½½
- **ä¸´æ—¶æ•°æ®**ï¼šä½¿ç”¨ tmpfs

---

## æ•°æ®å¤‡ä»½ä¸æ¢å¤

### å¤‡ä»½æ•°æ®å·

```bash
# å¤‡ä»½æ•°æ®å·
docker run --rm \
  -v my-volume:/data \
  -v $(pwd):/backup \
  ubuntu:20.04 \
  tar czf /backup/backup.tar.gz /data
```

### æ¢å¤æ•°æ®å·

```bash
# æ¢å¤æ•°æ®å·
docker run --rm \
  -v my-volume:/data \
  -v $(pwd):/backup \
  ubuntu:20.04 \
  tar xzf /backup/backup.tar.gz -C /
```

### è¿ç§»æ•°æ®å·

```bash
# å¯¼å‡ºæ•°æ®å·
docker run --rm \
  -v my-volume:/data \
  ubuntu:20.04 \
  tar czf - /data > backup.tar.gz

# å¯¼å…¥æ•°æ®å·
docker run --rm \
  -v my-volume:/data \
  -i ubuntu:20.04 \
  tar xzf - -C /data < backup.tar.gz
```

---

## å®ç”¨ç¤ºä¾‹

### æ•°æ®åº“æ•°æ®æŒä¹…åŒ–

```bash
# MySQL æ•°æ®æŒä¹…åŒ–
docker run -d \
  --name mysql \
  -v mysql-data:/var/lib/mysql \
  -e MYSQL_ROOT_PASSWORD=password \
  mysql:8.0
```

### åº”ç”¨é…ç½®æŒ‚è½½

```bash
# æŒ‚è½½é…ç½®æ–‡ä»¶
docker run -d \
  --name nginx \
  -v $(pwd)/nginx.conf:/etc/nginx/nginx.conf:ro \
  nginx:latest
```

### å¼€å‘ç¯å¢ƒæŒ‚è½½

```bash
# æŒ‚è½½æºä»£ç ç›®å½•
docker run -it \
  --name dev \
  -v $(pwd):/workspace \
  -w /workspace \
  node:16 \
  /bin/bash
```

---

## ğŸ“š å‚è€ƒèµ„æº

- [Docker å®˜æ–¹æ–‡æ¡£ - æ•°æ®å·](https://docs.docker.com/storage/volumes/)
- [Docker å®˜æ–¹æ–‡æ¡£ - ç»‘å®šæŒ‚è½½](https://docs.docker.com/storage/bind-mounts/)
- [Docker å®˜æ–¹æ–‡æ¡£ - tmpfs](https://docs.docker.com/storage/tmpfs/)

---

[[!MOC-Docker|è¿”å› Docker çŸ¥è¯†ä½“ç³»]]

#Docker #å®¹å™¨ #æ•°æ®ç®¡ç† #æ•°æ®å·
