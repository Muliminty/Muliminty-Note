# é•œåƒåŸºç¡€æ“ä½œ

> Docker é•œåƒçš„æ‹‰å–ã€æŸ¥çœ‹ã€åˆ é™¤ç­‰åŸºç¡€æ“ä½œ

---

## ğŸ“‹ ç›®å½•

- [é•œåƒæ‹‰å–](#é•œåƒæ‹‰å–)
- [é•œåƒæŸ¥çœ‹](#é•œåƒæŸ¥çœ‹)
- [é•œåƒåˆ é™¤](#é•œåƒåˆ é™¤)
- [é•œåƒæ ‡ç­¾ç®¡ç†](#é•œåƒæ ‡ç­¾ç®¡ç†)
- [é•œåƒå¯¼å‡ºä¸å¯¼å…¥](#é•œåƒå¯¼å‡ºä¸å¯¼å…¥)
- [é•œåƒè¯¦ç»†ä¿¡æ¯](#é•œåƒè¯¦ç»†ä¿¡æ¯)

---

## é•œåƒæ‹‰å–

### docker pull

ä»ä»“åº“æ‹‰å–é•œåƒã€‚

```bash
# æ‹‰å–æœ€æ–°ç‰ˆæœ¬
docker pull nginx

# æ‹‰å–æŒ‡å®šç‰ˆæœ¬
docker pull nginx:1.21
docker pull ubuntu:20.04

# æ‹‰å–æŒ‡å®šä»“åº“çš„é•œåƒ
docker pull registry.example.com/myapp:latest

# æ‹‰å–æ‰€æœ‰æ ‡ç­¾
docker pull -a nginx
```

### æ‹‰å–è¿›åº¦è¯´æ˜

- `Pulling fs layer`ï¼šæ­£åœ¨ä¸‹è½½æ–‡ä»¶ç³»ç»Ÿå±‚
- `Downloading`ï¼šæ­£åœ¨ä¸‹è½½å±‚æ•°æ®
- `Extracting`ï¼šæ­£åœ¨è§£å‹å±‚æ•°æ®
- `Pull complete`ï¼šæ‹‰å–å®Œæˆ

---

## é•œåƒæŸ¥çœ‹

### docker images / docker image ls

åˆ—å‡ºæœ¬åœ°é•œåƒã€‚

```bash
# åˆ—å‡ºæ‰€æœ‰é•œåƒ
docker images

# åˆ—å‡ºæ‰€æœ‰é•œåƒï¼ˆåŒ…æ‹¬ä¸­é—´å±‚ï¼‰
docker images -a

# åªæ˜¾ç¤ºé•œåƒ ID
docker images -q

# æŒ‰æ ¼å¼è¾“å‡º
docker images --format "table {{.Repository}}\t{{.Tag}}\t{{.Size}}"

# è¿‡æ»¤é•œåƒ
docker images nginx
docker images nginx:1.21
docker images --filter "dangling=true"  # æ˜¾ç¤ºæ‚¬ç©ºé•œåƒ
docker images --filter "before=nginx:1.20"  # æ˜¾ç¤ºæŒ‡å®šé•œåƒä¹‹å‰çš„é•œåƒ
```

### è¾“å‡ºå­—æ®µè¯´æ˜

- **REPOSITORY**ï¼šé•œåƒä»“åº“å
- **TAG**ï¼šé•œåƒæ ‡ç­¾
- **IMAGE ID**ï¼šé•œåƒ IDï¼ˆSHA256 æ‘˜è¦çš„å‰12ä½ï¼‰
- **CREATED**ï¼šåˆ›å»ºæ—¶é—´
- **SIZE**ï¼šé•œåƒå¤§å°

---

## é•œåƒåˆ é™¤

### docker rmi / docker image rm

åˆ é™¤é•œåƒã€‚

```bash
# åˆ é™¤å•ä¸ªé•œåƒ
docker rmi nginx:1.21

# åˆ é™¤å¤šä¸ªé•œåƒ
docker rmi nginx:1.21 nginx:1.20

# é€šè¿‡é•œåƒ ID åˆ é™¤
docker rmi abc123def456

# å¼ºåˆ¶åˆ é™¤ï¼ˆå³ä½¿æœ‰å®¹å™¨ä½¿ç”¨ï¼‰
docker rmi -f nginx:1.21

# åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒ
docker image prune

# åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒï¼ˆåŒ…æ‹¬æœ‰æ ‡ç­¾çš„ï¼‰
docker image prune -a

# åˆ é™¤æ‰€æœ‰æ‚¬ç©ºé•œåƒ
docker image prune -f
```

### åˆ é™¤å‰æ£€æŸ¥

```bash
# æŸ¥çœ‹å“ªäº›å®¹å™¨ä½¿ç”¨äº†è¯¥é•œåƒ
docker ps -a --filter ancestor=nginx:1.21

# å…ˆåˆ é™¤ä½¿ç”¨è¯¥é•œåƒçš„å®¹å™¨
docker rm $(docker ps -a -q --filter ancestor=nginx:1.21)
```

---

## é•œåƒæ ‡ç­¾ç®¡ç†

### docker tag

ç»™é•œåƒæ‰“æ ‡ç­¾ã€‚

```bash
# åˆ›å»ºæ–°æ ‡ç­¾ï¼ˆæŒ‡å‘åŒä¸€é•œåƒï¼‰
docker tag nginx:latest nginx:1.21

# æ ‡è®°é•œåƒå‡†å¤‡æ¨é€åˆ°ä»“åº“
docker tag myapp:latest username/myapp:v1.0
docker tag myapp:latest registry.example.com/myapp:latest

# æŸ¥çœ‹é•œåƒçš„æ‰€æœ‰æ ‡ç­¾
docker images myapp
```

### æ ‡ç­¾å‘½åè§„èŒƒ

```
[ä»“åº“åœ°å€/][ç”¨æˆ·å/]é•œåƒå[:æ ‡ç­¾]
```

ç¤ºä¾‹ï¼š
- `nginx:latest` - Docker Hub å®˜æ–¹é•œåƒ
- `username/myapp:v1.0` - ç”¨æˆ·è‡ªå®šä¹‰é•œåƒ
- `registry.example.com/project/app:latest` - ç§æœ‰ä»“åº“é•œåƒ

---

## é•œåƒå¯¼å‡ºä¸å¯¼å…¥

### docker save

å¯¼å‡ºé•œåƒåˆ°æ–‡ä»¶ã€‚

```bash
# å¯¼å‡ºå•ä¸ªé•œåƒ
docker save -o nginx.tar nginx:latest

# å¯¼å‡ºå¤šä¸ªé•œåƒ
docker save -o images.tar nginx:latest ubuntu:20.04

# ä½¿ç”¨ gzip å‹ç¼©
docker save nginx:latest | gzip > nginx.tar.gz
```

### docker load

ä»æ–‡ä»¶å¯¼å…¥é•œåƒã€‚

```bash
# ä»æ–‡ä»¶å¯¼å…¥é•œåƒ
docker load -i nginx.tar

# ä»æ ‡å‡†è¾“å…¥å¯¼å…¥
docker load < nginx.tar

# ä»å‹ç¼©æ–‡ä»¶å¯¼å…¥
gunzip -c nginx.tar.gz | docker load
```

### ä½¿ç”¨åœºæ™¯

- **ç¦»çº¿ç¯å¢ƒ**ï¼šåœ¨æ²¡æœ‰ç½‘ç»œçš„ç¯å¢ƒä¸­éƒ¨ç½²é•œåƒ
- **é•œåƒå¤‡ä»½**ï¼šå¤‡ä»½é‡è¦é•œåƒ
- **é•œåƒè¿ç§»**ï¼šåœ¨ä¸åŒç¯å¢ƒé—´è¿ç§»é•œåƒ

---

## é•œåƒè¯¦ç»†ä¿¡æ¯

### docker inspect

æŸ¥çœ‹é•œåƒè¯¦ç»†ä¿¡æ¯ã€‚

```bash
# æŸ¥çœ‹é•œåƒè¯¦ç»†ä¿¡æ¯
docker inspect nginx:latest

# æŸ¥çœ‹ç‰¹å®šä¿¡æ¯
docker inspect -f '{{.Config.Env}}' nginx:latest
docker inspect -f '{{.Config.Cmd}}' nginx:latest
docker inspect -f '{{.Created}}' nginx:latest
docker inspect -f '{{.Size}}' nginx:latest

# æŸ¥çœ‹é•œåƒçš„å±‚ä¿¡æ¯
docker inspect -f '{{.RootFS.Layers}}' nginx:latest
```

### docker history

æŸ¥çœ‹é•œåƒæ„å»ºå†å²ã€‚

```bash
# æŸ¥çœ‹é•œåƒæ„å»ºå†å²
docker history nginx:latest

# ä¸æˆªæ–­è¾“å‡º
docker history --no-trunc nginx:latest

# æŒ‰æ ¼å¼è¾“å‡º
docker history --format "table {{.ID}}\t{{.CreatedBy}}\t{{.Size}}" nginx:latest
```

### docker image inspect

æŸ¥çœ‹é•œåƒè¯¦ç»†ä¿¡æ¯ï¼ˆæ–°å‘½ä»¤æ ¼å¼ï¼‰ã€‚

```bash
# æŸ¥çœ‹é•œåƒè¯¦ç»†ä¿¡æ¯
docker image inspect nginx:latest

# æŸ¥çœ‹é•œåƒå¤§å°
docker image inspect nginx:latest --format '{{.Size}}'
```

---

## é•œåƒæœç´¢

### docker search

åœ¨ Docker Hub æœç´¢é•œåƒã€‚

```bash
# æœç´¢é•œåƒ
docker search nginx

# é™åˆ¶æœç´¢ç»“æœæ•°é‡
docker search --limit 5 nginx

# åªæ˜¾ç¤ºå®˜æ–¹é•œåƒ
docker search --filter "is-official=true" nginx

# åªæ˜¾ç¤ºè‡ªåŠ¨æ„å»ºçš„é•œåƒ
docker search --filter "is-automated=true" nginx
```

---

## é•œåƒæ¸…ç†

### æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ

```bash
# åˆ é™¤æ‰€æœ‰æ‚¬ç©ºé•œåƒ
docker image prune

# åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒï¼ˆåŒ…æ‹¬æœ‰æ ‡ç­¾çš„ï¼‰
docker image prune -a

# åˆ é™¤æŒ‡å®šæ—¶é—´ä¹‹å‰çš„é•œåƒ
docker image prune -a --filter "until=24h"

# äº¤äº’å¼åˆ é™¤
docker image prune -a --filter "until=24h" --interactive
```

### æŸ¥çœ‹é•œåƒå ç”¨ç©ºé—´

```bash
# æŸ¥çœ‹é•œåƒå ç”¨ç©ºé—´
docker system df

# è¯¦ç»†æŸ¥çœ‹é•œåƒå ç”¨ç©ºé—´
docker system df -v
```

---

## å®ç”¨æŠ€å·§

### æ‰¹é‡æ“ä½œ

```bash
# æ‰¹é‡åˆ é™¤é•œåƒ
docker rmi $(docker images -q)

# æ‰¹é‡åˆ é™¤ç‰¹å®šä»“åº“çš„é•œåƒ
docker rmi $(docker images -q nginx)

# æ‰¹é‡å¯¼å‡ºé•œåƒ
for image in $(docker images -q); do
  docker save -o ${image}.tar ${image}
done
```

### é•œåƒå¤§å°ä¼˜åŒ–

```bash
# æŸ¥çœ‹é•œåƒå„å±‚å¤§å°
docker history --human nginx:latest

# æ¯”è¾ƒé•œåƒå¤§å°
docker images --format "{{.Repository}}:{{.Tag}} - {{.Size}}"
```

---

## ğŸ“š å‚è€ƒèµ„æº

- [Docker å®˜æ–¹æ–‡æ¡£ - é•œåƒç®¡ç†](https://docs.docker.com/engine/reference/commandline/image/)
- [Docker Hub](https://hub.docker.com/)

---

[[!MOC-Docker|è¿”å› Docker çŸ¥è¯†ä½“ç³»]]

#Docker #é•œåƒ #é•œåƒç®¡ç†
