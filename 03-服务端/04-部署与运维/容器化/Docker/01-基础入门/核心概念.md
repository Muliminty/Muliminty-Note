# Docker 核心概念

> Docker 基础概念理解：镜像、容器、仓库

---

## 📋 目录

- [镜像（Image）](#镜像image)
- [容器（Container）](#容器container)
- [仓库（Repository）](#仓库repository)
- [镜像与容器的关系](#镜像与容器的关系)
- [命名空间与隔离机制](#命名空间与隔离机制)

---

## 镜像（Image）

### 定义

**镜像（Image）** 是一个只读的模板，用于创建 Docker 容器。

### 特点

- **只读性**：镜像本身是只读的，不能直接修改
- **分层结构**：镜像由多个只读层组成，采用联合文件系统（UnionFS）
- **可复用性**：一个镜像可以创建多个容器
- **版本管理**：镜像可以有多个标签（tag），如 `ubuntu:20.04`、`ubuntu:latest`

### 类比

镜像类似于面向对象编程中的"类"（Class）：
- 类定义了对象的模板
- 镜像定义了容器的模板

### 示例

```bash
# 查看本地镜像
docker images

# 拉取镜像
docker pull ubuntu:20.04

# 查看镜像详细信息
docker inspect ubuntu:20.04
```

---

## 容器（Container）

### 定义

**容器（Container）** 是镜像的运行实例，是一个可运行的独立环境。

### 特点

- **可写层**：容器在镜像的基础上添加了一个可写层
- **隔离性**：每个容器都有独立的文件系统、网络和进程空间
- **生命周期**：容器可以被创建、启动、停止、删除
- **轻量级**：容器共享宿主机的操作系统内核

### 类比

容器类似于面向对象编程中的"对象"（Object）：
- 对象是类的实例
- 容器是镜像的实例

### 示例

```bash
# 创建并运行容器
docker run -it ubuntu:20.04 /bin/bash

# 查看运行中的容器
docker ps

# 查看所有容器（包括已停止的）
docker ps -a

# 停止容器
docker stop <container_id>

# 删除容器
docker rm <container_id>
```

---

## 仓库（Repository）

### 定义

**仓库（Repository）** 是存储镜像的地方，类似于代码仓库。

### 分类

1. **公共仓库**
   - Docker Hub：Docker 官方公共仓库
   - 其他公共仓库：阿里云、腾讯云等

2. **私有仓库**
   - 企业内部的镜像仓库
   - 使用 Harbor、Registry 等搭建

### 命名规则

```
[仓库地址/][用户名/]镜像名[:标签]
```

示例：
- `ubuntu:20.04` - Docker Hub 官方镜像
- `username/myapp:v1.0` - 用户自定义镜像
- `registry.example.com/project/app:latest` - 私有仓库镜像

### 示例

```bash
# 从 Docker Hub 拉取镜像
docker pull nginx:latest

# 推送镜像到仓库
docker push username/myapp:v1.0

# 登录到仓库
docker login
```

---

## 镜像与容器的关系

### 关系图

```
镜像（Image）
  ├── 只读层 1
  ├── 只读层 2
  └── 只读层 3
        ↓
容器（Container）
  ├── 只读层 1（来自镜像）
  ├── 只读层 2（来自镜像）
  ├── 只读层 3（来自镜像）
  └── 可写层（容器独有）
```

### 关键点

1. **一个镜像可以创建多个容器**
   ```bash
   docker run -d --name web1 nginx
   docker run -d --name web2 nginx
   docker run -d --name web3 nginx
   ```

2. **容器修改不影响镜像**
   - 容器中的修改只存在于可写层
   - 删除容器后，修改会丢失
   - 如果需要持久化，使用数据卷（Volume）

3. **基于容器创建新镜像**
   ```bash
   # 修改容器后，可以提交为新镜像
   docker commit <container_id> new-image:tag
   ```

---

## 命名空间与隔离机制

### Linux 命名空间（Namespaces）

Docker 使用 Linux 命名空间实现隔离：

1. **PID 命名空间**：进程隔离
   - 容器内的进程 ID 独立于宿主机
   - 容器内 PID 1 的进程是容器的主进程

2. **网络命名空间**：网络隔离
   - 每个容器有独立的网络接口
   - 容器间网络隔离，可通过网络连接

3. **挂载命名空间**：文件系统隔离
   - 每个容器有独立的文件系统视图
   - 可以挂载不同的目录

4. **UTS 命名空间**：主机名隔离
   - 每个容器可以有独立的主机名

5. **IPC 命名空间**：进程间通信隔离
   - 容器间进程通信隔离

6. **用户命名空间**：用户 ID 隔离
   - 容器内的用户 ID 可以映射到宿主机不同的用户 ID

### 控制组（Cgroups）

用于限制和监控资源使用：

- **CPU 限制**：限制容器使用的 CPU 资源
- **内存限制**：限制容器使用的内存
- **I/O 限制**：限制磁盘 I/O
- **设备访问**：控制设备访问权限

### 联合文件系统（UnionFS）

实现镜像的分层存储：

- **只读层**：镜像的每一层都是只读的
- **可写层**：容器在镜像基础上添加可写层
- **写时复制（Copy-on-Write）**：修改文件时，先复制到可写层再修改

---

## 📚 参考资源

- [Docker 官方文档 - 核心概念](https://docs.docker.com/get-started/overview/)
- [Docker 架构](https://docs.docker.com/get-started/overview/#docker-architecture)

---

#Docker #核心概念 #镜像 #容器 #仓库

