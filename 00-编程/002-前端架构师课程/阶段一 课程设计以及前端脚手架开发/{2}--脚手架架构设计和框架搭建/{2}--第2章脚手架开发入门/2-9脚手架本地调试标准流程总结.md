在本地开发调试脚手架时，`npm link` 是一个非常实用的工具。它允许我们将本地开发的脚手架或库文件链接到全局环境中，进行本地调试。以下是标准的流程总结：

### 1. 链接本地脚手架

首先，在开发本地脚手架时，我们需要将脚手架项目链接到全局 `node_modules`，这样可以在其他项目中引用它。

#### 步骤：

- 进入脚手架项目目录：
    
    ```bash
    cd your-cli-dir
    ```
    
- 执行 `npm link` 将当前脚手架链接到全局：
    
    ```bash
    npm link
    ```
    

这时，脚手架会被安装到全局 `node_modules` 目录，并生成可执行文件。

### 2. 链接本地库文件

如果我们有多个包（例如，库文件和脚手架），需要将本地开发的库文件也链接到全局，然后在脚手架项目中引用它。

#### 步骤：

- 进入本地库文件项目目录：
    
    ```bash
    cd your-lib-dir
    ```
    
- 执行 `npm link` 将库文件链接到全局：
    
    ```bash
    npm link
    ```
    
- 进入脚手架项目目录：
    
    ```bash
    cd your-cli-dir
    ```
    
- 执行 `npm link your-lib` 链接库文件到当前项目：
    
    ```bash
    npm link your-lib
    ```
    

此时，脚手架项目会使用本地开发的库文件，而不是远程版本。

### 3. 取消本地库文件链接

在本地调试完成后，可能需要取消本地的链接，恢复使用远程的库文件。可以通过以下步骤取消链接。

#### 步骤：

- 进入库文件项目目录：
    
    ```bash
    cd your-lib-dir
    ```
    
- 执行 `npm unlink` 取消库文件链接：
    
    ```bash
    npm unlink
    ```
    
- 进入脚手架项目目录：
    
    ```bash
    cd your-cli-dir
    ```
    
- 执行 `npm unlink your-lib` 取消库文件链接：
    
    ```bash
    npm unlink your-lib
    ```
    

### 4. 理解 `npm link`

`npm link` 是 `npm` 提供的一个命令，用于将本地开发的项目链接到全局 `node_modules` 目录下，方便本地调试和开发。

- **`npm link`**：将当前目录下的包链接到全局 `node_modules` 中。
- **`npm link your-lib`**：将全局的某个包链接到当前项目中。

### 5. 发布后的注意事项

当脚手架和库文件完成开发并发布上线后，我们需要注意以下几点：

- 确保在 `package.json` 中正确添加依赖的版本号，避免未发布的本地版本出现在项目中。
- 如果库文件已经发布到远程，执行 `npm install your-lib` 来安装远程的最新版本。
- 如果出现冲突或找不到依赖时，可以尝试删除 `node_modules` 文件夹，并重新执行 `npm install`。

### 6. 处理常见问题

- **本地链接无效**：如果执行 `npm link` 后链接无效，可以尝试删除 `node_modules` 文件夹，重新执行 `npm install`。
- **取消本地链接后无法安装**：执行 `npm unlink` 后，可能会出现无法安装远程版本的情况。此时可以通过删除 `node_modules` 并重新执行 `npm install` 来解决。

### 总结

通过 `npm link`，我们可以方便地在本地开发脚手架和库文件，并在项目中实时调试。通过标准流程链接和取消本地链接，能够确保我们在开发和发布过程中顺利地切换本地与远程依赖。