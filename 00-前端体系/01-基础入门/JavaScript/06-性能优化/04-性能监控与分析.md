# æ€§èƒ½ç›‘æ§ä¸åˆ†æï¼ˆPerformance Monitoring & Analysisï¼‰

æ€§èƒ½åˆ†æå·¥å…·å’Œæ–¹æ³•ã€‚

---

## ğŸ“š æµè§ˆå™¨å·¥å…·

### 1. Chrome DevTools

#### Performance é¢æ¿

- å½•åˆ¶æ€§èƒ½
- åˆ†æå¸§ç‡
- æŸ¥çœ‹ä¸»çº¿ç¨‹æ´»åŠ¨
- è¯†åˆ«æ€§èƒ½ç“¶é¢ˆ

#### Memory é¢æ¿

- å †å¿«ç…§
- æ—¶é—´çº¿åˆ†æ
- å†…å­˜æ³„æ¼æ£€æµ‹

#### Network é¢æ¿

- è¯·æ±‚æ—¶é—´åˆ†æ
- èµ„æºåŠ è½½ä¼˜åŒ–
- ç¼“å­˜åˆ†æ

---

### 2. Performance API

#### Performance.now()

```javascript
const start = performance.now();
// æ‰§è¡Œä»£ç 
const end = performance.now();
console.log(`è€—æ—¶: ${end - start}ms`);
```

#### Performance.mark()

```javascript
performance.mark('start');
// æ‰§è¡Œä»£ç 
performance.mark('end');
performance.measure('duration', 'start', 'end');
const measure = performance.getEntriesByName('duration')[0];
console.log(measure.duration);
```

#### Performance Observer

```javascript
const observer = new PerformanceObserver((list) => {
  for (const entry of list.getEntries()) {
    console.log(entry.name, entry.duration);
  }
});
observer.observe({ entryTypes: ['measure', 'mark'] });
```

---

## ğŸ¯ æ€§èƒ½æŒ‡æ ‡

### 1. Web Vitals

```javascript
// LCP (Largest Contentful Paint)
new PerformanceObserver((list) => {
  const entries = list.getEntries();
  const lastEntry = entries[entries.length - 1];
  console.log('LCP:', lastEntry.renderTime);
}).observe({ entryTypes: ['largest-contentful-paint'] });

// FID (First Input Delay)
new PerformanceObserver((list) => {
  for (const entry of list.getEntries()) {
    console.log('FID:', entry.processingStart - entry.startTime);
  }
}).observe({ entryTypes: ['first-input'] });

// CLS (Cumulative Layout Shift)
let clsValue = 0;
new PerformanceObserver((list) => {
  for (const entry of list.getEntries()) {
    if (!entry.hadRecentInput) {
      clsValue += entry.value;
    }
  }
  console.log('CLS:', clsValue);
}).observe({ entryTypes: ['layout-shift'] });
```

### 2. è‡ªå®šä¹‰æŒ‡æ ‡

```javascript
// é¡µé¢åŠ è½½æ—¶é—´
window.addEventListener('load', () => {
  const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
  console.log('é¡µé¢åŠ è½½æ—¶é—´:', loadTime);
});

// é¦–å±æ¸²æŸ“æ—¶é—´
const paintEntries = performance.getEntriesByType('paint');
paintEntries.forEach(entry => {
  console.log(`${entry.name}:`, entry.startTime);
});
```

---

## ğŸ’¡ æ€§èƒ½åˆ†æå·¥å…·

### 1. Lighthouse

```bash
# å‘½ä»¤è¡Œ
lighthouse https://example.com --view

# Chrome DevTools
# æ‰“å¼€ Lighthouse é¢æ¿è¿è¡Œåˆ†æ
```

### 2. WebPageTest

åœ¨çº¿å·¥å…·ï¼Œæä¾›è¯¦ç»†çš„æ€§èƒ½åˆ†ææŠ¥å‘Šã€‚

### 3. Bundle Analyzer

```javascript
// webpack-bundle-analyzer
const BundleAnalyzerPlugin = require('webpack-bundle-analyzer').BundleAnalyzerPlugin;

module.exports = {
  plugins: [
    new BundleAnalyzerPlugin()
  ]
};
```

---

## ğŸ”§ ç›‘æ§å®è·µ

### 1. æ€§èƒ½ç›‘æ§ SDK

```javascript
class PerformanceMonitor {
  constructor() {
    this.metrics = {};
    this.init();
  }
  
  init() {
    this.measureLCP();
    this.measureFID();
    this.measureCLS();
  }
  
  measureLCP() {
    new PerformanceObserver((list) => {
      const entries = list.getEntries();
      const lastEntry = entries[entries.length - 1];
      this.metrics.lcp = lastEntry.renderTime;
      this.report();
    }).observe({ entryTypes: ['largest-contentful-paint'] });
  }
  
  report() {
    // å‘é€åˆ°ç›‘æ§æœåŠ¡
    fetch('/api/metrics', {
      method: 'POST',
      body: JSON.stringify(this.metrics)
    });
  }
}

new PerformanceMonitor();
```

### 2. é”™è¯¯ç›‘æ§

```javascript
window.addEventListener('error', (event) => {
  // å‘é€é”™è¯¯ä¿¡æ¯
  sendError({
    message: event.message,
    filename: event.filename,
    lineno: event.lineno,
    colno: event.colno
  });
});
```

---

## ğŸ”— ç›¸å…³é“¾æ¥

- [ä»£ç æ€§èƒ½ä¼˜åŒ–](./03-ä»£ç æ€§èƒ½ä¼˜åŒ–.md) â€” ä»£ç å±‚é¢ä¼˜åŒ–
- [åƒåœ¾å›æ”¶æœºåˆ¶](./01-åƒåœ¾å›æ”¶æœºåˆ¶.md) â€” å†…å­˜ç®¡ç†
- [æ€§èƒ½ä¼˜åŒ– MOC](../../04-è´¨é‡ä¿éšœ/æ€§èƒ½/!MOC-æ€§èƒ½.md) â€” æ€§èƒ½ä¼˜åŒ–å®Œæ•´æŒ‡å—

---

**å‚è€ƒ**ï¼š
- [MDN: Performance API](https://developer.mozilla.org/zh-CN/docs/Web/API/Performance)
- [Web Vitals](https://web.dev/vitals/)
- [Chrome DevTools](https://developer.chrome.com/docs/devtools/)

---

#javascript #æ€§èƒ½ä¼˜åŒ– #æ€§èƒ½ç›‘æ§ #performance #web-vitals
