# åŠ¨æ€å¯¼å…¥ï¼ˆDynamic Importï¼‰

åŠ¨æ€å¯¼å…¥ä½¿ç”¨ `import()` å‡½æ•°ï¼Œåœ¨è¿è¡Œæ—¶æŒ‰éœ€åŠ è½½æ¨¡å—ã€‚

---

## ğŸ“š åŸºæœ¬è¯­æ³•

### import() å‡½æ•°

```javascript
// åŠ¨æ€å¯¼å…¥è¿”å› Promise
import('./math.js')
  .then(module => {
    console.log(module.add(1, 2));
  })
  .catch(error => {
    console.error('åŠ è½½æ¨¡å—å¤±è´¥', error);
  });
```

### ä½¿ç”¨ async/await

```javascript
async function loadModule() {
  try {
    const module = await import('./math.js');
    console.log(module.add(1, 2));
  } catch (error) {
    console.error('åŠ è½½æ¨¡å—å¤±è´¥', error);
  }
}
```

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### 1. æŒ‰éœ€åŠ è½½ï¼ˆCode Splittingï¼‰

```javascript
// è·¯ç”±æ‡’åŠ è½½
const routes = [
  {
    path: '/home',
    component: () => import('./components/Home.js')
  },
  {
    path: '/about',
    component: () => import('./components/About.js')
  }
];
```

### 2. æ¡ä»¶åŠ è½½

```javascript
async function loadPolyfill() {
  if (!window.IntersectionObserver) {
    await import('./polyfills/intersection-observer.js');
  }
}
```

### 3. æŒ‰ç¯å¢ƒåŠ è½½

```javascript
async function loadConfig() {
  const isDev = process.env.NODE_ENV === 'development';
  const config = isDev
    ? await import('./config.dev.js')
    : await import('./config.prod.js');
  return config.default;
}
```

### 4. ç”¨æˆ·äº¤äº’è§¦å‘åŠ è½½

```javascript
button.addEventListener('click', async () => {
  const { showModal } = await import('./modal.js');
  showModal();
});
```

---

## ğŸ“¦ å¯¼å…¥æ–¹å¼

### å¯¼å…¥é»˜è®¤å¯¼å‡º

```javascript
const module = await import('./utils.js');
const formatDate = module.default;
formatDate(new Date());
```

### å¯¼å…¥å‘½åå¯¼å‡º

```javascript
const { add, subtract } = await import('./math.js');
console.log(add(1, 2));
```

### å¯¼å…¥å…¨éƒ¨

```javascript
const math = await import('./math.js');
console.log(math.add(1, 2));
console.log(math.subtract(5, 2));
```

---

## ğŸ”„ ä¸é™æ€å¯¼å…¥å¯¹æ¯”

| ç‰¹æ€§ | é™æ€å¯¼å…¥ `import` | åŠ¨æ€å¯¼å…¥ `import()` |
|------|------------------|-------------------|
| åŠ è½½æ—¶æœº | ç¼–è¯‘æ—¶ | è¿è¡Œæ—¶ |
| è¿”å›å€¼ | æ¨¡å—å¯¹è±¡ | Promise |
| ä»£ç åˆ†å‰² | è‡ªåŠ¨ | éœ€è¦é…ç½® |
| Tree shaking | æ”¯æŒ | æ”¯æŒ |
| æ¡ä»¶åŠ è½½ | ä¸æ”¯æŒ | æ”¯æŒ |
| æ€§èƒ½ | åˆå§‹åŠ è½½ | æŒ‰éœ€åŠ è½½ |

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. é”™è¯¯å¤„ç†

```javascript
async function loadModule() {
  try {
    const module = await import('./math.js');
    return module;
  } catch (error) {
    console.error('æ¨¡å—åŠ è½½å¤±è´¥:', error);
    // é™çº§å¤„ç†
    return null;
  }
}
```

### 2. é¢„åŠ è½½æç¤º

```javascript
// ä½¿ç”¨ link rel="modulepreload" é¢„åŠ è½½
const link = document.createElement('link');
link.rel = 'modulepreload';
link.href = './math.js';
document.head.appendChild(link);
```

### 3. æ‰¹é‡åŠ¨æ€å¯¼å…¥

```javascript
async function loadModules() {
  const [math, utils, config] = await Promise.all([
    import('./math.js'),
    import('./utils.js'),
    import('./config.js')
  ]);
  
  return { math, utils, config };
}
```

### 4. React æ‡’åŠ è½½ç¤ºä¾‹

```javascript
import { lazy, Suspense } from 'react';

const Home = lazy(() => import('./components/Home'));
const About = lazy(() => import('./components/About'));

function App() {
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <Home />
      <About />
    </Suspense>
  );
}
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. è¿”å› Promise

```javascript
// âŒ é”™è¯¯ï¼šä¸èƒ½ç›´æ¥ä½¿ç”¨
const module = import('./math.js'); // è¿™æ˜¯ Promiseï¼Œä¸æ˜¯æ¨¡å—

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ await æˆ– then
const module = await import('./math.js');
```

### 2. è·¯å¾„å¿…é¡»æ˜¯å­—ç¬¦ä¸²å­—é¢é‡

```javascript
// âŒ é”™è¯¯ï¼šä¸èƒ½ä½¿ç”¨å˜é‡
const path = './math.js';
import(path); // è¯­æ³•é”™è¯¯

// âœ… æ­£ç¡®ï¼šä½¿ç”¨å­—ç¬¦ä¸²å­—é¢é‡
import('./math.js');
```

### 3. æµè§ˆå™¨å…¼å®¹æ€§

åŠ¨æ€å¯¼å…¥éœ€è¦ç°ä»£æµè§ˆå™¨æ”¯æŒï¼Œæ—§æµè§ˆå™¨éœ€è¦ polyfill æˆ–è½¬è¯‘ã€‚

---

## ğŸ”— ç›¸å…³é“¾æ¥

- [ES6 æ¨¡å—](./01-ES6æ¨¡å—.md) â€” ES6 æ¨¡å—åŸºç¡€
- [å¯¼å…¥å¯¼å‡º](./02-å¯¼å…¥å¯¼å‡º.md) â€” å¯¼å…¥å¯¼å‡ºè¯¦ç»†è¯´æ˜

---

**å‚è€ƒ**ï¼š
- [MDN: Dynamic import()](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/import)
- [TC39: Dynamic import() proposal](https://github.com/tc39/proposal-dynamic-import)

---

#javascript #æ¨¡å—åŒ– #åŠ¨æ€å¯¼å…¥ #code-splitting #æ‡’åŠ è½½
