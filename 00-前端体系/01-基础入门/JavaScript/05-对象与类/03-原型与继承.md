# åŸå‹ä¸ç»§æ‰¿ï¼ˆPrototype & Inheritanceï¼‰

JavaScript åŸºäºåŸå‹çš„ç»§æ‰¿æœºåˆ¶ã€‚

---

## ğŸ“š åŸå‹é“¾ï¼ˆPrototype Chainï¼‰

### åŸå‹å¯¹è±¡

æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå†…éƒ¨å±æ€§ `[[Prototype]]`ï¼ˆå¯é€šè¿‡ `__proto__` æˆ– `Object.getPrototypeOf()` è®¿é—®ï¼‰ï¼š

```javascript
const obj = {};
console.log(obj.__proto__ === Object.prototype); // true
console.log(Object.getPrototypeOf(obj) === Object.prototype); // true
```

### åŸå‹é“¾æŸ¥æ‰¾

```javascript
const obj = {};
obj.toString(); // ä» Object.prototype ç»§æ‰¿

// æŸ¥æ‰¾è¿‡ç¨‹ï¼š
// 1. obj è‡ªèº«æ˜¯å¦æœ‰ toStringï¼Ÿ
// 2. obj.__proto__ (Object.prototype) æ˜¯å¦æœ‰ toStringï¼Ÿ
// 3. æ‰¾åˆ°ï¼Œè°ƒç”¨
```

---

## ğŸ¯ æ„é€ å‡½æ•°ä¸åŸå‹

### æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡

```javascript
function Person(name) {
  this.name = name;
}

Person.prototype.greet = function() {
  return `Hello, I'm ${this.name}`;
};

const person = new Person('Alice');
console.log(person.greet()); // "Hello, I'm Alice"
```

### åŸå‹å…³ç³»

```javascript
function Person(name) {
  this.name = name;
}

const person = new Person('Alice');

// åŸå‹å…³ç³»
console.log(person.__proto__ === Person.prototype); // true
console.log(Person.prototype.__proto__ === Object.prototype); // true
console.log(Object.prototype.__proto__ === null); // trueï¼ˆåŸå‹é“¾ç»ˆç‚¹ï¼‰
```

---

## ğŸ”„ ç»§æ‰¿å®ç°

### 1. åŸå‹é“¾ç»§æ‰¿

```javascript
function Animal(name) {
  this.name = name;
}

Animal.prototype.speak = function() {
  return `${this.name} makes a sound`;
};

function Dog(name, breed) {
  Animal.call(this, name); // è°ƒç”¨çˆ¶æ„é€ å‡½æ•°
  this.breed = breed;
}

// ç»§æ‰¿åŸå‹
Dog.prototype = Object.create(Animal.prototype);
Dog.prototype.constructor = Dog;

Dog.prototype.speak = function() {
  return `${this.name} barks`;
};

const dog = new Dog('Buddy', 'Golden Retriever');
console.log(dog.speak()); // "Buddy barks"
```

### 2. ES6 ç±»ç»§æ‰¿

```javascript
class Animal {
  constructor(name) {
    this.name = name;
  }
  
  speak() {
    return `${this.name} makes a sound`;
  }
}

class Dog extends Animal {
  constructor(name, breed) {
    super(name);
    this.breed = breed;
  }
  
  speak() {
    return `${this.name} barks`;
  }
}
```

---

## ğŸ” åŸå‹æ–¹æ³•

### Object.create()

```javascript
const animal = {
  speak() {
    return 'makes a sound';
  }
};

const dog = Object.create(animal);
dog.name = 'Buddy';
console.log(dog.speak()); // "makes a sound"
```

### Object.getPrototypeOf()

```javascript
const obj = {};
console.log(Object.getPrototypeOf(obj) === Object.prototype); // true
```

### Object.setPrototypeOf()

```javascript
const animal = { speak() { return 'sound'; } };
const dog = {};
Object.setPrototypeOf(dog, animal);
console.log(dog.speak()); // "sound"
```

### hasOwnProperty()

```javascript
const obj = { name: 'Alice' };
obj.__proto__.age = 30;

console.log(obj.hasOwnProperty('name')); // trueï¼ˆè‡ªæœ‰å±æ€§ï¼‰
console.log(obj.hasOwnProperty('age')); // falseï¼ˆç»§æ‰¿å±æ€§ï¼‰
```

---

## ğŸ’¡ åŸå‹æ¨¡å¼

### 1. å…±äº«æ–¹æ³•

```javascript
function Person(name) {
  this.name = name;
}

// æ‰€æœ‰å®ä¾‹å…±äº«åŒä¸€ä¸ªæ–¹æ³•
Person.prototype.greet = function() {
  return `Hello, I'm ${this.name}`;
};

const p1 = new Person('Alice');
const p2 = new Person('Bob');

console.log(p1.greet === p2.greet); // trueï¼ˆåŒä¸€ä¸ªæ–¹æ³•ï¼‰
```

### 2. ä¿®æ”¹åŸå‹å½±å“æ‰€æœ‰å®ä¾‹

```javascript
function Person(name) {
  this.name = name;
}

const p1 = new Person('Alice');
const p2 = new Person('Bob');

// ä¿®æ”¹åŸå‹
Person.prototype.greet = function() {
  return `Hi, I'm ${this.name}`;
};

console.log(p1.greet()); // "Hi, I'm Alice"ï¼ˆå—å½±å“ï¼‰
console.log(p2.greet()); // "Hi, I'm Bob"ï¼ˆå—å½±å“ï¼‰
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ä¸è¦ç›´æ¥ä¿®æ”¹å†…ç½®å¯¹è±¡åŸå‹

```javascript
// âŒ ä¸æ¨èï¼šä¿®æ”¹å†…ç½®å¯¹è±¡åŸå‹
Array.prototype.sum = function() {
  return this.reduce((a, b) => a + b, 0);
};

// âœ… æ¨èï¼šä½¿ç”¨å·¥å…·å‡½æ•°æˆ–æ‰©å±•ç±»
class MyArray extends Array {
  sum() {
    return this.reduce((a, b) => a + b, 0);
  }
}
```

### 2. åŸå‹é“¾æŸ¥æ‰¾æ€§èƒ½

```javascript
// æ·±å±‚åŸå‹é“¾ä¼šå½±å“æ€§èƒ½
// å°½é‡å°†å¸¸ç”¨å±æ€§æ”¾åœ¨å¯¹è±¡è‡ªèº«
```

### 3. åŸå‹æ±¡æŸ“

```javascript
// æ³¨æ„é¿å…åŸå‹æ±¡æŸ“æ”»å‡»
const userInput = JSON.parse('{"__proto__":{"isAdmin":true}}');
// å¯èƒ½æ±¡æŸ“ Object.prototype
```

---

## ğŸ”— ç›¸å…³é“¾æ¥

- [å¯¹è±¡](./01-å¯¹è±¡.md) â€” å¯¹è±¡åŸºç¡€
- [ç±»](./02-ç±».md) â€” ES6 ç±»è¯­æ³•
- [this ç»‘å®š](./04-thisç»‘å®š.md) â€” this ç»‘å®šè§„åˆ™

---

**å‚è€ƒ**ï¼š
- [MDN: Inheritance and the prototype chain](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Inheritance_and_the_prototype_chain)
- [ECMAScript Object Internal Methods](https://tc39.es/ecma262/#sec-object-internal-methods-and-internal-slots)

---

#javascript #åŸå‹ #ç»§æ‰¿ #prototype #inheritance
