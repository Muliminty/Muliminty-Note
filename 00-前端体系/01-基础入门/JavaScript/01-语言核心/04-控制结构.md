# æ§åˆ¶ç»“æ„ï¼ˆControl Flowï¼‰

> JavaScript ä¸­çš„æ§åˆ¶ç»“æ„ï¼šæ¡ä»¶è¯­å¥ã€å¾ªç¯è¯­å¥çš„ä½¿ç”¨å’Œåº•å±‚åŸç†

---

## ğŸ“– å…¥é—¨ï¼šåŸºç¡€ä½¿ç”¨

### 1. æ¡ä»¶è¯­å¥

#### 1.1 `if` è¯­å¥

**åŸºæœ¬è¯­æ³•**ï¼š
```javascript
if (condition) {
  // ä»£ç å—
}
```

**ç¤ºä¾‹**ï¼š
```javascript
let x = 10;
if (x > 5) {
  console.log("x is greater than 5");
}
```

#### 1.2 `if...else` è¯­å¥

**åŸºæœ¬è¯­æ³•**ï¼š
```javascript
if (condition) {
  // ä»£ç å— 1
} else {
  // ä»£ç å— 2
}
```

**ç¤ºä¾‹**ï¼š
```javascript
let age = 18;
if (age >= 18) {
  console.log("Adult");
} else {
  console.log("Minor");
}
```

#### 1.3 `if...else if...else` è¯­å¥

**åŸºæœ¬è¯­æ³•**ï¼š
```javascript
if (condition1) {
  // ä»£ç å— 1
} else if (condition2) {
  // ä»£ç å— 2
} else {
  // ä»£ç å— 3
}
```

**ç¤ºä¾‹**ï¼š
```javascript
let score = 85;
if (score >= 90) {
  console.log("A");
} else if (score >= 80) {
  console.log("B");
} else if (score >= 70) {
  console.log("C");
} else {
  console.log("D");
}
```

#### 1.4 ä¸‰å…ƒè¿ç®—ç¬¦

**åŸºæœ¬è¯­æ³•**ï¼š
```javascript
condition ? valueIfTrue : valueIfFalse
```

**ç¤ºä¾‹**ï¼š
```javascript
let age = 20;
let status = age >= 18 ? "Adult" : "Minor";
console.log(status);  // "Adult"
```

---

### 2. `switch` è¯­å¥

**åŸºæœ¬è¯­æ³•**ï¼š
```javascript
switch (expression) {
  case value1:
    // ä»£ç å— 1
    break;
  case value2:
    // ä»£ç å— 2
    break;
  default:
    // é»˜è®¤ä»£ç å—
}
```

**ç¤ºä¾‹**ï¼š
```javascript
let fruit = "apple";
switch (fruit) {
  case "banana":
    console.log("Yellow fruit");
    break;
  case "apple":
    console.log("Red or green fruit");
    break;
  case "orange":
    console.log("Orange fruit");
    break;
  default:
    console.log("Unknown fruit");
}
```

**æ³¨æ„**ï¼š`break` è¯­å¥é˜²æ­¢"ç©¿é€"ï¼ˆfall-throughï¼‰

---

### 3. å¾ªç¯è¯­å¥

#### 3.1 `for` å¾ªç¯

**åŸºæœ¬è¯­æ³•**ï¼š
```javascript
for (initialization; condition; increment) {
  // ä»£ç å—
}
```

**ç¤ºä¾‹**ï¼š
```javascript
for (let i = 0; i < 5; i++) {
  console.log(i);  // 0, 1, 2, 3, 4
}
```

#### 3.2 `for...in` å¾ªç¯

**åŸºæœ¬è¯­æ³•**ï¼š
```javascript
for (key in object) {
  // ä»£ç å—
}
```

**ç¤ºä¾‹**ï¼š
```javascript
const obj = { a: 1, b: 2, c: 3 };
for (let key in obj) {
  console.log(key, obj[key]);  // a 1, b 2, c 3
}
```

#### 3.3 `for...of` å¾ªç¯

**åŸºæœ¬è¯­æ³•**ï¼š
```javascript
for (value of iterable) {
  // ä»£ç å—
}
```

**ç¤ºä¾‹**ï¼š
```javascript
const arr = [1, 2, 3, 4, 5];
for (let value of arr) {
  console.log(value);  // 1, 2, 3, 4, 5
}
```

#### 3.4 `while` å¾ªç¯

**åŸºæœ¬è¯­æ³•**ï¼š
```javascript
while (condition) {
  // ä»£ç å—
}
```

**ç¤ºä¾‹**ï¼š
```javascript
let i = 0;
while (i < 5) {
  console.log(i);  // 0, 1, 2, 3, 4
  i++;
}
```

#### 3.5 `do...while` å¾ªç¯

**åŸºæœ¬è¯­æ³•**ï¼š
```javascript
do {
  // ä»£ç å—
} while (condition);
```

**ç¤ºä¾‹**ï¼š
```javascript
let i = 0;
do {
  console.log(i);  // 0, 1, 2, 3, 4
  i++;
} while (i < 5);
```

**ç‰¹ç‚¹**ï¼šè‡³å°‘æ‰§è¡Œä¸€æ¬¡å¾ªç¯ä½“

---

### 4. å¾ªç¯æ§åˆ¶è¯­å¥

#### 4.1 `break` è¯­å¥

**ä½œç”¨**ï¼šè·³å‡ºå¾ªç¯

**ç¤ºä¾‹**ï¼š
```javascript
for (let i = 0; i < 10; i++) {
  if (i === 5) {
    break;  // è·³å‡ºå¾ªç¯
  }
  console.log(i);  // 0, 1, 2, 3, 4
}
```

#### 4.2 `continue` è¯­å¥

**ä½œç”¨**ï¼šè·³è¿‡å½“å‰è¿­ä»£ï¼Œç»§ç»­ä¸‹ä¸€æ¬¡å¾ªç¯

**ç¤ºä¾‹**ï¼š
```javascript
for (let i = 0; i < 10; i++) {
  if (i % 2 === 0) {
    continue;  // è·³è¿‡å¶æ•°
  }
  console.log(i);  // 1, 3, 5, 7, 9
}
```

---

## ğŸš€ æé«˜ï¼šåº•å±‚åŸç†

### 1. æ‰§è¡Œæµç¨‹æ§åˆ¶

#### 1.1 æ¡ä»¶è¯­å¥çš„æ‰§è¡Œæœºåˆ¶

**`if` è¯­å¥çš„æ‰§è¡Œæµç¨‹**ï¼š
```
1. è®¡ç®—æ¡ä»¶è¡¨è¾¾å¼
2. å°†ç»“æœè½¬æ¢ä¸ºå¸ƒå°”å€¼ï¼ˆTruthy/Falsyï¼‰
3. æ ¹æ®å¸ƒå°”å€¼å†³å®šæ‰§è¡Œè·¯å¾„
4. åˆ›å»ºæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆå¦‚æœéœ€è¦ï¼‰
```

**ç¤ºä¾‹åˆ†æ**ï¼š
```javascript
if (x > 5) {
  // åˆ›å»ºæ–°çš„å—çº§ä½œç”¨åŸŸ
  let y = 10;
  console.log(y);
}
// y åœ¨è¿™é‡Œä¸å¯è®¿é—®
```

---

#### 1.2 å¸ƒå°”å€¼è½¬æ¢ï¼ˆTruthy/Falsyï¼‰

**Falsy å€¼**ï¼ˆä¼šè¢«è½¬æ¢ä¸º `false`ï¼‰ï¼š
- `false`
- `0`
- `-0`
- `0n` (BigInt)
- `""` (ç©ºå­—ç¬¦ä¸²)
- `null`
- `undefined`
- `NaN`

**Truthy å€¼**ï¼ˆä¼šè¢«è½¬æ¢ä¸º `true`ï¼‰ï¼š
- é™¤äº† Falsy å€¼ä¹‹å¤–çš„æ‰€æœ‰å€¼

**ç¤ºä¾‹**ï¼š
```javascript
if (0) {
  // ä¸ä¼šæ‰§è¡Œ
}
if (1) {
  // ä¼šæ‰§è¡Œ
}
if ("") {
  // ä¸ä¼šæ‰§è¡Œ
}
if ("hello") {
  // ä¼šæ‰§è¡Œ
}
```

---

### 2. `switch` è¯­å¥çš„åº•å±‚å®ç°

#### 2.1 è·³è½¬è¡¨ï¼ˆJump Tableï¼‰

**åŸç†**ï¼š
- `switch` è¯­å¥é€šå¸¸ä½¿ç”¨è·³è½¬è¡¨ä¼˜åŒ–
- å¯¹äºè¿ç»­çš„å€¼ï¼Œä½¿ç”¨è·³è½¬è¡¨æ¯”å¤šä¸ª `if` æ›´é«˜æ•ˆ
- å¯¹äºç¨€ç–çš„å€¼ï¼Œä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾æˆ–å“ˆå¸Œè¡¨

**æ€§èƒ½å¯¹æ¯”**ï¼š
```javascript
// å¤šä¸ª ifï¼ˆO(n)ï¼‰
if (x === 1) { /* ... */ }
else if (x === 2) { /* ... */ }
else if (x === 3) { /* ... */ }

// switchï¼ˆå¯èƒ½ä¼˜åŒ–ä¸º O(1)ï¼‰
switch (x) {
  case 1: /* ... */ break;
  case 2: /* ... */ break;
  case 3: /* ... */ break;
}
```

---

#### 2.2 ä¸¥æ ¼ç›¸ç­‰æ¯”è¾ƒ

**`switch` ä½¿ç”¨ä¸¥æ ¼ç›¸ç­‰ï¼ˆ`===`ï¼‰**ï¼š
```javascript
let x = "1";
switch (x) {
  case 1:      // ä¸ä¼šåŒ¹é…ï¼ˆç±»å‹ä¸åŒï¼‰
    console.log("number");
    break;
  case "1":    // ä¼šåŒ¹é…
    console.log("string");
    break;
}
```

---

### 3. å¾ªç¯è¯­å¥çš„æ‰§è¡Œæœºåˆ¶

#### 3.1 `for` å¾ªç¯çš„æ‰§è¡Œæµç¨‹

**æ‰§è¡Œæ­¥éª¤**ï¼š
```
1. æ‰§è¡Œåˆå§‹åŒ–è¡¨è¾¾å¼ï¼ˆinitializationï¼‰
2. è®¡ç®—æ¡ä»¶è¡¨è¾¾å¼ï¼ˆconditionï¼‰
3. å¦‚æœä¸º trueï¼š
   a. æ‰§è¡Œå¾ªç¯ä½“
   b. æ‰§è¡Œå¢é‡è¡¨è¾¾å¼ï¼ˆincrementï¼‰
   c. å›åˆ°æ­¥éª¤ 2
4. å¦‚æœä¸º falseï¼šé€€å‡ºå¾ªç¯
```

**ç¤ºä¾‹åˆ†æ**ï¼š
```javascript
for (let i = 0; i < 3; i++) {
  console.log(i);
}
// æ‰§è¡Œè¿‡ç¨‹ï¼š
// 1. let i = 0 (åˆå§‹åŒ–)
// 2. i < 3? true (æ¡ä»¶æ£€æŸ¥)
// 3. console.log(0) (æ‰§è¡Œå¾ªç¯ä½“)
// 4. i++ (i = 1) (å¢é‡)
// 5. i < 3? true (æ¡ä»¶æ£€æŸ¥)
// 6. console.log(1) (æ‰§è¡Œå¾ªç¯ä½“)
// 7. i++ (i = 2) (å¢é‡)
// 8. i < 3? true (æ¡ä»¶æ£€æŸ¥)
// 9. console.log(2) (æ‰§è¡Œå¾ªç¯ä½“)
// 10. i++ (i = 3) (å¢é‡)
// 11. i < 3? false (æ¡ä»¶æ£€æŸ¥)
// 12. é€€å‡ºå¾ªç¯
```

---

#### 3.2 å¾ªç¯ä½œç”¨åŸŸå’Œé—­åŒ…

**å¸¸è§é™·é˜±**ï¼š
```javascript
// é—®é¢˜ï¼šæ‰€æœ‰ setTimeout éƒ½æ‰“å° 5
for (var i = 0; i < 5; i++) {
  setTimeout(() => {
    console.log(i);  // 5, 5, 5, 5, 5
  }, 100);
}

// è§£å†³æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ letï¼ˆå—çº§ä½œç”¨åŸŸï¼‰
for (let i = 0; i < 5; i++) {
  setTimeout(() => {
    console.log(i);  // 0, 1, 2, 3, 4
  }, 100);
}

// è§£å†³æ–¹æ¡ˆ 2ï¼šä½¿ç”¨ IIFE
for (var i = 0; i < 5; i++) {
  (function(j) {
    setTimeout(() => {
      console.log(j);  // 0, 1, 2, 3, 4
    }, 100);
  })(i);
}
```

**åŸç†**ï¼š
- `var` å±äºå‡½æ•°ä½œç”¨åŸŸï¼Œå¾ªç¯ç»“æŸå `i` ä¸º 5
- `let` å±äºå—çº§ä½œç”¨åŸŸï¼Œæ¯æ¬¡å¾ªç¯åˆ›å»ºæ–°çš„ç»‘å®š
- IIFE åˆ›å»ºæ–°çš„ä½œç”¨åŸŸï¼Œæ•è·å½“å‰çš„ `i` å€¼

---

#### 3.3 `for...in` vs `for...of`

**`for...in`**ï¼š
- éå†å¯¹è±¡çš„**å¯æšä¸¾å±æ€§**ï¼ˆåŒ…æ‹¬ç»§æ‰¿çš„ï¼‰
- éå†é¡ºåºä¸ç¡®å®šï¼ˆé™¤äº†æ•°ç»„ç´¢å¼•ï¼‰
- è¿”å›çš„æ˜¯**é”®å**ï¼ˆkeyï¼‰

**`for...of`**ï¼š
- éå†**å¯è¿­ä»£å¯¹è±¡**çš„å€¼
- éå†é¡ºåºç¡®å®š
- è¿”å›çš„æ˜¯**å€¼**ï¼ˆvalueï¼‰

**ç¤ºä¾‹å¯¹æ¯”**ï¼š
```javascript
const arr = [1, 2, 3];
arr.customProp = "custom";

// for...inï¼šéå†æ‰€æœ‰å¯æšä¸¾å±æ€§
for (let key in arr) {
  console.log(key);  // "0", "1", "2", "customProp"
}

// for...ofï¼šéå†å¯è¿­ä»£çš„å€¼
for (let value of arr) {
  console.log(value);  // 1, 2, 3
}
```

---

### 4. å¾ªç¯ä¼˜åŒ–

#### 4.1 å¾ªç¯å±•å¼€ï¼ˆLoop Unrollingï¼‰

**åŸç†**ï¼š
- å‡å°‘å¾ªç¯æ¬¡æ•°
- å‡å°‘æ¡ä»¶æ£€æŸ¥æ¬¡æ•°

**ç¤ºä¾‹**ï¼š
```javascript
// ä¼˜åŒ–å‰
for (let i = 0; i < 4; i++) {
  process(arr[i]);
}

// ä¼˜åŒ–åï¼ˆå¾ªç¯å±•å¼€ï¼‰
process(arr[0]);
process(arr[1]);
process(arr[2]);
process(arr[3]);
```

---

#### 4.2 å¾ªç¯ä¸å˜å¼å¤–æï¼ˆLoop Invariant Code Motionï¼‰

**åŸç†**ï¼š
- å°†å¾ªç¯ä¸­ä¸å˜çš„è®¡ç®—ç§»åˆ°å¾ªç¯å¤–

**ç¤ºä¾‹**ï¼š
```javascript
// ä¼˜åŒ–å‰
for (let i = 0; i < arr.length; i++) {
  let result = expensiveFunction() * arr[i];
  console.log(result);
}

// ä¼˜åŒ–å
const expensiveResult = expensiveFunction();
for (let i = 0; i < arr.length; i++) {
  let result = expensiveResult * arr[i];
  console.log(result);
}
```

---

## ğŸ“ æœ€ä½³å®è·µ

1. **ä½¿ç”¨ `let` ä»£æ›¿ `var`**ï¼šé¿å…ä½œç”¨åŸŸé—®é¢˜
2. **ä¼˜å…ˆä½¿ç”¨ `for...of`**ï¼šæ›´ç®€æ´ã€æ›´å®‰å…¨
3. **é¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºå‡½æ•°**ï¼šä½¿ç”¨ `let` æˆ– IIFE
4. **åˆç†ä½¿ç”¨ `break` å’Œ `continue`**ï¼šæé«˜ä»£ç å¯è¯»æ€§
5. **ä¼˜åŒ–å¾ªç¯æ€§èƒ½**ï¼šå‡å°‘ä¸å¿…è¦çš„è®¡ç®—

---

## ğŸ”— ç›¸å…³é“¾æ¥

- [å˜é‡å£°æ˜](./å˜é‡å£°æ˜.md) â€” å˜é‡çš„ä½œç”¨åŸŸ
- [å‡½æ•°](./å‡½æ•°.md) â€” å‡½æ•°ä¸­çš„æ§åˆ¶æµç¨‹
- [ä½œç”¨åŸŸå’Œé—­åŒ…](./ä½œç”¨åŸŸå’Œé—­åŒ….md) â€” æ·±å…¥ç†è§£ä½œç”¨åŸŸ

---

#javascript #æ§åˆ¶ç»“æ„ #å¾ªç¯ #æ¡ä»¶è¯­å¥

