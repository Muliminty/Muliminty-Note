# ä¸å¯å˜æ•°æ®ï¼ˆImmutabilityï¼‰

ä¸å¯å˜æ•°æ®æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„æ ¸å¿ƒæ¦‚å¿µï¼Œæ•°æ®ä¸€æ—¦åˆ›å»ºå°±ä¸èƒ½è¢«ä¿®æ”¹ã€‚

---

## ğŸ“š åŸºæœ¬æ¦‚å¿µ

### å¯å˜ vs ä¸å¯å˜

```javascript
// å¯å˜ï¼ˆMutableï¼‰
const arr = [1, 2, 3];
arr.push(4); // ä¿®æ”¹åŸæ•°ç»„
console.log(arr); // [1, 2, 3, 4]

// ä¸å¯å˜ï¼ˆImmutableï¼‰
const arr = [1, 2, 3];
const newArr = [...arr, 4]; // åˆ›å»ºæ–°æ•°ç»„
console.log(arr); // [1, 2, 3]ï¼ˆåŸæ•°ç»„æœªå˜ï¼‰
console.log(newArr); // [1, 2, 3, 4]
```

---

## ğŸ¯ å®ç°æ–¹å¼

### 1. Object.freeze()

æµ…å†»ç»“å¯¹è±¡ï¼š

```javascript
const obj = { name: 'Alice', age: 30 };
Object.freeze(obj);

obj.name = 'Bob'; // é™é»˜å¤±è´¥ï¼ˆä¸¥æ ¼æ¨¡å¼ä¸‹æŠ¥é”™ï¼‰
console.log(obj.name); // "Alice"

// åµŒå¥—å¯¹è±¡ä»å¯å˜
obj.address = { city: 'Beijing' };
obj.address.city = 'Shanghai'; // ä»å¯ä¿®æ”¹
```

### 2. æ·±å†»ç»“

```javascript
function deepFreeze(obj) {
  Object.getOwnPropertyNames(obj).forEach(prop => {
    if (typeof obj[prop] === 'object' && obj[prop] !== null) {
      deepFreeze(obj[prop]);
    }
  });
  return Object.freeze(obj);
}

const obj = {
  name: 'Alice',
  address: { city: 'Beijing' }
};
deepFreeze(obj);
obj.address.city = 'Shanghai'; // æ— æ³•ä¿®æ”¹
```

### 3. æ‰©å±•è¿ç®—ç¬¦

```javascript
// æ•°ç»„
const arr = [1, 2, 3];
const newArr = [...arr, 4]; // æ–°æ•°ç»„

// å¯¹è±¡
const obj = { name: 'Alice', age: 30 };
const newObj = { ...obj, age: 31 }; // æ–°å¯¹è±¡
```

### 4. Array æ–¹æ³•

```javascript
// map - è¿”å›æ–°æ•°ç»„
const doubled = [1, 2, 3].map(x => x * 2);

// filter - è¿”å›æ–°æ•°ç»„
const evens = [1, 2, 3, 4].filter(x => x % 2 === 0);

// slice - è¿”å›æ–°æ•°ç»„
const copy = [1, 2, 3].slice();

// concat - è¿”å›æ–°æ•°ç»„
const merged = [1, 2].concat([3, 4]);
```

---

## ğŸ’¡ å®é™…åº”ç”¨

### 1. React çŠ¶æ€æ›´æ–°

```javascript
// âŒ é”™è¯¯ï¼šç›´æ¥ä¿®æ”¹çŠ¶æ€
this.state.items.push(newItem);

// âœ… æ­£ç¡®ï¼šåˆ›å»ºæ–°æ•°ç»„
this.setState({
  items: [...this.state.items, newItem]
});
```

### 2. Redux çŠ¶æ€ç®¡ç†

```javascript
// Redux reducer å¿…é¡»æ˜¯çº¯å‡½æ•°
function todosReducer(state = [], action) {
  switch (action.type) {
    case 'ADD_TODO':
      return [...state, action.payload]; // è¿”å›æ–°æ•°ç»„
    case 'TOGGLE_TODO':
      return state.map(todo =>
        todo.id === action.id
          ? { ...todo, completed: !todo.completed }
          : todo
      );
    default:
      return state;
  }
}
```

### 3. åµŒå¥—å¯¹è±¡æ›´æ–°

```javascript
// æ›´æ–°åµŒå¥—å¯¹è±¡
const user = {
  name: 'Alice',
  profile: {
    age: 30,
    address: { city: 'Beijing' }
  }
};

// ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦
const updatedUser = {
  ...user,
  profile: {
    ...user.profile,
    address: {
      ...user.profile.address,
      city: 'Shanghai'
    }
  }
};
```

---

## ğŸ”§ å·¥å…·åº“

### 1. Immer

```javascript
import produce from 'immer';

const state = {
  users: [
    { id: 1, name: 'Alice' }
  ]
};

const nextState = produce(state, draft => {
  draft.users.push({ id: 2, name: 'Bob' });
  draft.users[0].name = 'Alice Updated';
});
```

### 2. Immutable.js

```javascript
import { List, Map } from 'immutable';

const list = List([1, 2, 3]);
const newList = list.push(4); // è¿”å›æ–° List

const map = Map({ name: 'Alice', age: 30 });
const newMap = map.set('age', 31); // è¿”å›æ–° Map
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ€§èƒ½è€ƒè™‘

```javascript
// å¤§å¯¹è±¡/æ•°ç»„çš„æ·±æ‹·è´å¯èƒ½å½±å“æ€§èƒ½
// è€ƒè™‘ä½¿ç”¨ Immutable.js ç­‰åº“çš„ç»“æ„å…±äº«
```

### 2. æµ…æ‹·è´é™·é˜±

```javascript
const obj = {
  items: [1, 2, 3]
};

const newObj = { ...obj };
newObj.items.push(4); // ä¿®æ”¹äº†åŸå¯¹è±¡çš„ items

// éœ€è¦æ·±æ‹·è´
const newObj = {
  ...obj,
  items: [...obj.items]
};
```

### 3. å¼•ç”¨æ¯”è¾ƒ

```javascript
// ä¸å¯å˜æ•°æ®å¯ä»¥å®‰å…¨åœ°è¿›è¡Œå¼•ç”¨æ¯”è¾ƒ
const arr1 = [1, 2, 3];
const arr2 = [1, 2, 3];
console.log(arr1 === arr2); // falseï¼ˆä¸åŒå¼•ç”¨ï¼‰

// å¦‚æœæ•°æ®æœªå˜ï¼Œå¼•ç”¨åº”è¯¥ç›¸åŒ
const arr3 = arr1;
console.log(arr1 === arr3); // trueï¼ˆç›¸åŒå¼•ç”¨ï¼‰
```

---

## ğŸ”— ç›¸å…³é“¾æ¥

- [é«˜é˜¶å‡½æ•°](./01-é«˜é˜¶å‡½æ•°.md) â€” é«˜é˜¶å‡½æ•°è¯¦è§£
- [å‡½æ•°å¼ç¼–ç¨‹æ¨¡å¼](./04-å‡½æ•°å¼ç¼–ç¨‹æ¨¡å¼.md) â€” å‡½æ•°å¼ç¼–ç¨‹æ¨¡å¼
- [æ€§èƒ½ä¼˜åŒ–](../06-æ€§èƒ½ä¼˜åŒ–/ä»£ç æ€§èƒ½ä¼˜åŒ–.md) â€” æ€§èƒ½ä¼˜åŒ–æŠ€å·§

---

**å‚è€ƒ**ï¼š
- [MDN: Object.freeze()](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze)
- [Immer](https://immerjs.github.io/immer/)
- [Immutable.js](https://immutable-js.com/)

---

#javascript #ä¸å¯å˜æ•°æ® #immutability #å‡½æ•°å¼ç¼–ç¨‹
