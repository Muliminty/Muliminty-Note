# 05. è·¯ç”±ç³»ç»ŸåŸºç¡€

Next.js çš„è·¯ç”±ç³»ç»ŸåŸºäºæ–‡ä»¶ç³»ç»Ÿï¼Œä½†æ”¯æŒåŠ¨æ€è·¯ç”±ã€æŸ¥è¯¢å‚æ•°ã€è·¯ç”±ç»„ç­‰é«˜çº§åŠŸèƒ½ã€‚æœ¬ç« å°†æ·±å…¥å­¦ä¹ è¿™äº›ç‰¹æ€§ã€‚

---

## 1. åŠ¨æ€è·¯ç”±

åŠ¨æ€è·¯ç”±å…è®¸ä½ æ ¹æ® URL å‚æ•°åŠ¨æ€ç”Ÿæˆé¡µé¢ã€‚

### åŸºç¡€è¯­æ³•

ä½¿ç”¨æ–¹æ‹¬å· `[]` åˆ›å»ºåŠ¨æ€è·¯ç”±æ®µï¼š

| æ–‡ä»¶è·¯å¾„ | URL ç¤ºä¾‹ | å‚æ•° |
|---------|---------|------|
| `app/blog/[id]/page.tsx` | `/blog/123` | `id = "123"` |
| `app/user/[userId]/page.tsx` | `/user/456` | `userId = "456"` |
| `app/shop/[...slug]/page.tsx` | `/shop/a/b/c` | `slug = ["a", "b", "c"]` |

### å®æˆ˜æ¡ˆä¾‹ï¼šåšå®¢è¯¦æƒ…é¡µ

**æ­¥éª¤ 1ï¼šåˆ›å»ºåŠ¨æ€è·¯ç”±æ–‡ä»¶**

```tsx
// src/app/blog/[id]/page.tsx
interface PageProps {
  params: {
    id: string
  }
}

// æ¨¡æ‹Ÿæ•°æ®ï¼ˆå®é™…åº”è¯¥ä»æ•°æ®åº“è·å–ï¼‰
const posts: Record<string, { title: string; content: string; date: string }> = {
  '1': {
    title: 'Next.js å…¥é—¨æŒ‡å—',
    content: 'è¿™æ˜¯ä¸€ç¯‡å…³äº Next.js å…¥é—¨çš„æ–‡ç« ...',
    date: '2024-01-15',
  },
  '2': {
    title: 'TypeScript æœ€ä½³å®è·µ',
    content: 'è¿™æ˜¯ä¸€ç¯‡å…³äº TypeScript çš„æ–‡ç« ...',
    date: '2024-01-10',
  },
}

export default function BlogPost({ params }: PageProps) {
  const post = posts[params.id]

  if (!post) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-center">
          <h1 className="text-4xl font-bold mb-4">æ–‡ç« æœªæ‰¾åˆ°</h1>
          <p className="text-gray-600">æŠ±æ­‰ï¼Œæ‚¨è®¿é—®çš„æ–‡ç« ä¸å­˜åœ¨ã€‚</p>
        </div>
      </div>
    )
  }

  return (
    <article className="max-w-4xl mx-auto px-4 py-20">
      <h1 className="text-4xl font-bold mb-4">{post.title}</h1>
      <p className="text-gray-500 mb-8">{post.date}</p>
      <div className="prose max-w-none">
        <p className="text-lg leading-relaxed">{post.content}</p>
      </div>
    </article>
  )
}
```

**æ­¥éª¤ 2ï¼šä»åˆ—è¡¨é¡µé“¾æ¥åˆ°è¯¦æƒ…é¡µ**

```tsx
// src/app/blog/page.tsx
import Link from 'next/link'

const posts = [
  { id: '1', title: 'Next.js å…¥é—¨æŒ‡å—', excerpt: '...' },
  { id: '2', title: 'TypeScript æœ€ä½³å®è·µ', excerpt: '...' },
]

export default function Blog() {
  return (
    <div>
      {posts.map((post) => (
        <Link key={post.id} href={`/blog/${post.id}`}>
          <h2>{post.title}</h2>
        </Link>
      ))}
    </div>
  )
}
```

### å¤šæ®µåŠ¨æ€è·¯ç”±

```tsx
// src/app/shop/[...slug]/page.tsx
interface PageProps {
  params: {
    slug: string[] // æ•°ç»„ç±»å‹
  }
}

export default function ShopPage({ params }: PageProps) {
  // è®¿é—® /shop/electronics/phones/iphone
  // params.slug = ['electronics', 'phones', 'iphone']
  
  return (
    <div>
      <h1>å•†å“åˆ†ç±»ï¼š{params.slug.join(' / ')}</h1>
    </div>
  )
}
```

### å¯é€‰åŠ¨æ€è·¯ç”±

ä½¿ç”¨åŒæ‹¬å· `[[...slug]]` åˆ›å»ºå¯é€‰åŠ¨æ€è·¯ç”±ï¼š

```tsx
// src/app/docs/[[...slug]]/page.tsx
// å¯ä»¥åŒ¹é…ï¼š
// /docs
// /docs/getting-started
// /docs/getting-started/installation
```

---

## 2. æŸ¥è¯¢å‚æ•°ï¼ˆSearch Paramsï¼‰

æŸ¥è¯¢å‚æ•°é€šè¿‡ URL çš„ `?` åé¢çš„éƒ¨åˆ†ä¼ é€’ï¼Œå¦‚ `/search?q=nextjs&page=1`ã€‚

### è¯»å–æŸ¥è¯¢å‚æ•°

```tsx
// src/app/search/page.tsx
interface PageProps {
  searchParams: {
    q?: string
    page?: string
  }
}

export default function SearchPage({ searchParams }: PageProps) {
  const query = searchParams.q || ''
  const page = parseInt(searchParams.page || '1')

  return (
    <div className="max-w-4xl mx-auto px-4 py-20">
      <h1 className="text-3xl font-bold mb-8">æœç´¢ç»“æœ</h1>
      <p>æœç´¢å…³é”®è¯ï¼š{query}</p>
      <p>å½“å‰é¡µç ï¼š{page}</p>
    </div>
  )
}
```

### å®æˆ˜æ¡ˆä¾‹ï¼šå¸¦ç­›é€‰çš„åšå®¢åˆ—è¡¨

```tsx
// src/app/blog/page.tsx
interface PageProps {
  searchParams: {
    category?: string
    tag?: string
  }
}

const allPosts = [
  { id: '1', title: 'Next.js å…¥é—¨', category: 'å‰ç«¯', tags: ['Next.js', 'React'] },
  { id: '2', title: 'TypeScript å®è·µ', category: 'å‰ç«¯', tags: ['TypeScript'] },
  { id: '3', title: 'Node.js åç«¯', category: 'åç«¯', tags: ['Node.js'] },
]

export default function BlogPage({ searchParams }: PageProps) {
  // ç­›é€‰é€»è¾‘
  let filteredPosts = allPosts

  if (searchParams.category) {
    filteredPosts = filteredPosts.filter(
      (post) => post.category === searchParams.category
    )
  }

  if (searchParams.tag) {
    filteredPosts = filteredPosts.filter((post) =>
      post.tags.includes(searchParams.tag!)
    )
  }

  return (
    <div className="max-w-6xl mx-auto px-4 py-20">
      <h1 className="text-4xl font-bold mb-8">åšå®¢</h1>

      {/* ç­›é€‰å™¨ */}
      <div className="mb-8 flex gap-4">
        <a
          href="/blog"
          className={`px-4 py-2 rounded ${
            !searchParams.category
              ? 'bg-blue-600 text-white'
              : 'bg-gray-200 text-gray-700'
          }`}
        >
          å…¨éƒ¨
        </a>
        <a
          href="/blog?category=å‰ç«¯"
          className={`px-4 py-2 rounded ${
            searchParams.category === 'å‰ç«¯'
              ? 'bg-blue-600 text-white'
              : 'bg-gray-200 text-gray-700'
          }`}
        >
          å‰ç«¯
        </a>
        <a
          href="/blog?category=åç«¯"
          className={`px-4 py-2 rounded ${
            searchParams.category === 'åç«¯'
              ? 'bg-blue-600 text-white'
              : 'bg-gray-200 text-gray-700'
          }`}
        >
          åç«¯
        </a>
      </div>

      {/* æ–‡ç« åˆ—è¡¨ */}
      <div className="space-y-6">
        {filteredPosts.map((post) => (
          <article key={post.id} className="bg-white p-6 rounded-lg shadow">
            <h2 className="text-2xl font-semibold mb-2">{post.title}</h2>
            <div className="flex gap-2">
              {post.tags.map((tag) => (
                <a
                  key={tag}
                  href={`/blog?tag=${tag}`}
                  className="text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded"
                >
                  {tag}
                </a>
              ))}
            </div>
          </article>
        ))}
      </div>
    </div>
  )
}
```

---

## 3. å®¢æˆ·ç«¯å¯¼èˆªä¸çŠ¶æ€ç®¡ç†

### ä½¿ç”¨ useRouter Hook

åœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­ä½¿ç”¨ `useRouter` è¿›è¡Œç¼–ç¨‹å¼å¯¼èˆªï¼š

```tsx
// src/app/components/Navigation.tsx
'use client'

import { useRouter, useSearchParams } from 'next/navigation'
import { useState } from 'react'

export default function SearchBox() {
  const router = useRouter()
  const searchParams = useSearchParams()
  const [query, setQuery] = useState(searchParams.get('q') || '')

  const handleSearch = (e: React.FormEvent) => {
    e.preventDefault()
    router.push(`/search?q=${encodeURIComponent(query)}`)
  }

  return (
    <form onSubmit={handleSearch} className="flex gap-2">
      <input
        type="text"
        value={query}
        onChange={(e) => setQuery(e.target.value)}
        placeholder="æœç´¢..."
        className="px-4 py-2 border rounded"
      />
      <button
        type="submit"
        className="bg-blue-600 text-white px-6 py-2 rounded"
      >
        æœç´¢
      </button>
    </form>
  )
}
```

### æ›´æ–°æŸ¥è¯¢å‚æ•°ï¼ˆä¸åˆ·æ–°é¡µé¢ï¼‰

```tsx
'use client'

import { useRouter, useSearchParams } from 'next/navigation'

export default function FilterButton({ category }: { category: string }) {
  const router = useRouter()
  const searchParams = useSearchParams()

  const handleClick = () => {
    const params = new URLSearchParams(searchParams.toString())
    params.set('category', category)
    router.push(`/blog?${params.toString()}`)
  }

  return (
    <button onClick={handleClick} className="px-4 py-2 bg-blue-600 text-white rounded">
      {category}
    </button>
  )
}
```

---

## 4. è·¯ç”±ç»„ï¼ˆRoute Groupsï¼‰

è·¯ç”±ç»„ä½¿ç”¨æ‹¬å· `()` ç»„ç»‡è·¯ç”±ï¼Œä½†ä¸ä¼šå½±å“ URL è·¯å¾„ã€‚

### ä½¿ç”¨åœºæ™¯

**åœºæ™¯ 1ï¼šç»„ç»‡ä¸åŒå¸ƒå±€çš„é¡µé¢**

```
app/
â”œâ”€â”€ (marketing)/
â”‚   â”œâ”€â”€ layout.tsx      # è¥é”€é¡µé¢å¸ƒå±€ï¼ˆæœ‰å¯¼èˆªæ ï¼‰
â”‚   â”œâ”€â”€ about/
â”‚   â”‚   â””â”€â”€ page.tsx    # /about
â”‚   â””â”€â”€ contact/
â”‚       â””â”€â”€ page.tsx    # /contact
â”œâ”€â”€ (dashboard)/
â”‚   â”œâ”€â”€ layout.tsx      # åå°å¸ƒå±€ï¼ˆæœ‰ä¾§è¾¹æ ï¼‰
â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â””â”€â”€ page.tsx    # /dashboard
â”‚   â””â”€â”€ settings/
â”‚       â””â”€â”€ page.tsx    # /settings
â””â”€â”€ layout.tsx          # æ ¹å¸ƒå±€
```

**åœºæ™¯ 2ï¼šå¤šè¯­è¨€è·¯ç”±**

```
app/
â”œâ”€â”€ (en)/
â”‚   â”œâ”€â”€ about/
â”‚   â”‚   â””â”€â”€ page.tsx    # /en/about
â”‚   â””â”€â”€ contact/
â”‚       â””â”€â”€ page.tsx    # /en/contact
â””â”€â”€ (zh)/
    â”œâ”€â”€ about/
    â”‚   â””â”€â”€ page.tsx    # /zh/about
    â””â”€â”€ contact/
        â””â”€â”€ page.tsx    # /zh/contact
```

### å®æˆ˜æ¡ˆä¾‹ï¼šè¥é”€é¡µé¢å’Œåå°é¡µé¢åˆ†ç¦»

```tsx
// src/app/(marketing)/layout.tsx
export default function MarketingLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <div className="marketing-layout">
      <nav className="bg-white shadow">
        {/* è¥é”€é¡µé¢å¯¼èˆªæ  */}
        <div className="max-w-6xl mx-auto px-4 py-4">
          <Link href="/">é¦–é¡µ</Link>
          <Link href="/about">å…³äº</Link>
          <Link href="/contact">è”ç³»</Link>
        </div>
      </nav>
      {children}
    </div>
  )
}

// src/app/(dashboard)/layout.tsx
export default function DashboardLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <div className="flex">
      <aside className="w-64 bg-gray-800 text-white p-4">
        {/* åå°ä¾§è¾¹æ  */}
        <nav>
          <Link href="/dashboard">ä»ªè¡¨ç›˜</Link>
          <Link href="/settings">è®¾ç½®</Link>
        </nav>
      </aside>
      <main className="flex-1 p-8">{children}</main>
    </div>
  )
}
```

---

## 5. è·¯ç”±æ‹¦æˆªï¼ˆIntercepting Routesï¼‰

è·¯ç”±æ‹¦æˆªå…è®¸ä½ åœ¨ä¸æ”¹å˜ URL çš„æƒ…å†µä¸‹æ˜¾ç¤ºä¸åŒçš„ UIï¼ˆå¦‚å¼¹çª—ï¼‰ã€‚

### è¯­æ³•

ä½¿ç”¨ `(.)` è¡¨ç¤ºåŒçº§æ‹¦æˆªï¼Œ`(..)` è¡¨ç¤ºä¸Šä¸€çº§æ‹¦æˆªï¼š

```
app/
â”œâ”€â”€ @modal/
â”‚   â””â”€â”€ (.)photo/
â”‚       â””â”€â”€ [id]/
â”‚           â””â”€â”€ page.tsx    # æ‹¦æˆª /photo/[id]ï¼Œæ˜¾ç¤ºä¸ºå¼¹çª—
â””â”€â”€ photo/
    â””â”€â”€ [id]/
        â””â”€â”€ page.tsx         # æ­£å¸¸é¡µé¢
```

> ğŸ’¡ **æ³¨æ„**ï¼šè·¯ç”±æ‹¦æˆªæ˜¯é«˜çº§åŠŸèƒ½ï¼Œåœ¨åŸºç¡€é˜¶æ®µäº†è§£å³å¯ï¼Œè¯¦ç»†å†…å®¹åœ¨åç»­ç« èŠ‚è®²è§£ã€‚

---

## 6. å®æˆ˜ç»ƒä¹ ï¼šæ„å»ºå•†å“è¯¦æƒ…é¡µ

### éœ€æ±‚
åˆ›å»ºä¸€ä¸ªç”µå•†ç½‘ç«™çš„å•†å“åˆ—è¡¨å’Œè¯¦æƒ…é¡µï¼š
- `/products` - å•†å“åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†ç±»ç­›é€‰ï¼‰
- `/products/[id]` - å•†å“è¯¦æƒ…é¡µ

### å®ç°

```tsx
// src/app/products/page.tsx
interface PageProps {
  searchParams: {
    category?: string
  }
}

const products = [
  { id: '1', name: 'iPhone 15', price: 5999, category: 'æ‰‹æœº' },
  { id: '2', name: 'MacBook Pro', price: 12999, category: 'ç”µè„‘' },
  { id: '3', name: 'AirPods Pro', price: 1899, category: 'é…ä»¶' },
]

export default function ProductsPage({ searchParams }: PageProps) {
  const filteredProducts = searchParams.category
    ? products.filter((p) => p.category === searchParams.category)
    : products

  return (
    <div className="max-w-6xl mx-auto px-4 py-20">
      <h1 className="text-4xl font-bold mb-8">å•†å“åˆ—è¡¨</h1>

      <div className="mb-6 flex gap-4">
        <a
          href="/products"
          className={`px-4 py-2 rounded ${
            !searchParams.category ? 'bg-blue-600 text-white' : 'bg-gray-200'
          }`}
        >
          å…¨éƒ¨
        </a>
        <a
          href="/products?category=æ‰‹æœº"
          className={`px-4 py-2 rounded ${
            searchParams.category === 'æ‰‹æœº' ? 'bg-blue-600 text-white' : 'bg-gray-200'
          }`}
        >
          æ‰‹æœº
        </a>
        <a
          href="/products?category=ç”µè„‘"
          className={`px-4 py-2 rounded ${
            searchParams.category === 'ç”µè„‘' ? 'bg-blue-600 text-white' : 'bg-gray-200'
          }`}
        >
          ç”µè„‘
        </a>
      </div>

      <div className="grid md:grid-cols-3 gap-6">
        {filteredProducts.map((product) => (
          <a
            key={product.id}
            href={`/products/${product.id}`}
            className="bg-white p-6 rounded-lg shadow hover:shadow-lg transition"
          >
            <h3 className="text-xl font-semibold mb-2">{product.name}</h3>
            <p className="text-2xl font-bold text-blue-600">Â¥{product.price}</p>
          </a>
        ))}
      </div>
    </div>
  )
}
```

```tsx
// src/app/products/[id]/page.tsx
interface PageProps {
  params: {
    id: string
  }
}

const products: Record<string, { name: string; price: number; description: string }> = {
  '1': {
    name: 'iPhone 15',
    price: 5999,
    description: 'æœ€æ–°çš„ iPhoneï¼Œæ‹¥æœ‰å¼ºå¤§çš„ A17 èŠ¯ç‰‡...',
  },
  '2': {
    name: 'MacBook Pro',
    price: 12999,
    description: 'ä¸“ä¸šçº§ç¬”è®°æœ¬ç”µè„‘ï¼Œé€‚åˆå¼€å‘è€…å’Œè®¾è®¡å¸ˆ...',
  },
  '3': {
    name: 'AirPods Pro',
    price: 1899,
    description: 'ä¸»åŠ¨é™å™ªæ— çº¿è€³æœº...',
  },
}

export default function ProductDetailPage({ params }: PageProps) {
  const product = products[params.id]

  if (!product) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <h1 className="text-4xl font-bold">å•†å“æœªæ‰¾åˆ°</h1>
      </div>
    )
  }

  return (
    <div className="max-w-4xl mx-auto px-4 py-20">
      <a href="/products" className="text-blue-600 hover:underline mb-8 inline-block">
        â† è¿”å›å•†å“åˆ—è¡¨
      </a>
      <div className="bg-white p-8 rounded-lg shadow">
        <h1 className="text-4xl font-bold mb-4">{product.name}</h1>
        <p className="text-3xl font-bold text-blue-600 mb-6">Â¥{product.price}</p>
        <p className="text-lg text-gray-700">{product.description}</p>
        <button className="mt-8 bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700">
          åŠ å…¥è´­ç‰©è½¦
        </button>
      </div>
    </div>
  )
}
```

---

## 7. æ€»ç»“

æœ¬ç« æˆ‘ä»¬å­¦ä¹ äº†ï¼š
1. âœ… åŠ¨æ€è·¯ç”±çš„ä½¿ç”¨ï¼ˆ`[id]`ã€`[...slug]`ã€`[[...slug]]`ï¼‰
2. âœ… æŸ¥è¯¢å‚æ•°çš„è¯»å–å’Œä½¿ç”¨
3. âœ… å®¢æˆ·ç«¯å¯¼èˆªï¼ˆ`useRouter`ã€`useSearchParams`ï¼‰
4. âœ… è·¯ç”±ç»„çš„æ¦‚å¿µå’Œåº”ç”¨
5. âœ… æ„å»ºäº†å®Œæ•´çš„å•†å“åˆ—è¡¨å’Œè¯¦æƒ…é¡µ

**å…³é”®è¦ç‚¹**ï¼š
- ğŸ“ åŠ¨æ€è·¯ç”±ä½¿ç”¨æ–¹æ‹¬å· `[]`
- ğŸ” æŸ¥è¯¢å‚æ•°é€šè¿‡ `searchParams` è®¿é—®
- ğŸ§­ å®¢æˆ·ç«¯å¯¼èˆªä½¿ç”¨ `useRouter` Hook
- ğŸ“¦ è·¯ç”±ç»„ç”¨äºç»„ç»‡ä»£ç ï¼Œä¸å½±å“ URL

**ä¸‹ä¸€æ­¥**ï¼šåœ¨ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†æ·±å…¥å­¦ä¹ ç»„ä»¶å¼€å‘ï¼ŒåŒ…æ‹¬ Server Component å’Œ Client Component çš„åŒºåˆ«ã€‚

