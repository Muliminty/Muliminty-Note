# 08. é™æ€èµ„æºç®¡ç†

Next.js æä¾›äº†å¼ºå¤§çš„é™æ€èµ„æºç®¡ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬å›¾ç‰‡ä¼˜åŒ–ã€å­—ä½“åŠ è½½ã€public ç›®å½•ç­‰ã€‚æœ¬ç« å°†æ·±å…¥å­¦ä¹ è¿™äº›åŠŸèƒ½ã€‚

---

## 1. public ç›®å½•

`public` ç›®å½•ç”¨äºå­˜æ”¾é™æ€èµ„æºï¼Œè¿™äº›æ–‡ä»¶å¯ä»¥ç›´æ¥é€šè¿‡ URL è®¿é—®ã€‚

### ç›®å½•ç»“æ„

```
public/
â”œâ”€â”€ images/
â”‚   â”œâ”€â”€ logo.png
â”‚   â””â”€â”€ hero.jpg
â”œâ”€â”€ icons/
â”‚   â””â”€â”€ favicon.ico
â””â”€â”€ files/
    â””â”€â”€ resume.pdf
```

### è®¿é—®æ–¹å¼

```tsx
// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
<img src="/images/logo.png" alt="Logo" />
<Link href="/files/resume.pdf">ä¸‹è½½ç®€å†</Link>
```

> âš ï¸ **æ³¨æ„**ï¼š`public` ç›®å½•ä¸­çš„æ–‡ä»¶è·¯å¾„ä»¥ `/` å¼€å¤´ï¼Œä¸éœ€è¦åŒ…å« `public`ã€‚

---

## 2. Next.js Image ç»„ä»¶

Next.js æä¾›äº†ä¼˜åŒ–çš„ `Image` ç»„ä»¶ï¼Œè‡ªåŠ¨å¤„ç†å›¾ç‰‡ä¼˜åŒ–ã€æ‡’åŠ è½½ã€å“åº”å¼ç­‰ã€‚

### åŸºç¡€ç”¨æ³•

```tsx
// src/app/page.tsx
import Image from 'next/image'

export default function Home() {
  return (
    <div>
      <Image
        src="/images/hero.jpg"
        alt="Hero image"
        width={800}
        height={600}
      />
    </div>
  )
}
```

### ä¸ºä»€ä¹ˆä½¿ç”¨ Image ç»„ä»¶ï¼Ÿ

- âœ… **è‡ªåŠ¨ä¼˜åŒ–**ï¼šWebPã€AVIF æ ¼å¼è½¬æ¢
- âœ… **æ‡’åŠ è½½**ï¼šåªåŠ è½½å¯è§åŒºåŸŸçš„å›¾ç‰‡
- âœ… **å“åº”å¼**ï¼šæ ¹æ®è®¾å¤‡è‡ªåŠ¨è°ƒæ•´å°ºå¯¸
- âœ… **é˜²æ­¢å¸ƒå±€åç§»**ï¼šè‡ªåŠ¨è®¡ç®—å®½é«˜æ¯”

### é‡è¦å±æ€§

```tsx
<Image
  src="/images/photo.jpg"
  alt="æè¿°æ–‡å­—"
  width={800}        // å¿…éœ€ï¼šå›¾ç‰‡å®½åº¦
  height={600}       // å¿…éœ€ï¼šå›¾ç‰‡é«˜åº¦
  priority={false}   // æ˜¯å¦ä¼˜å…ˆåŠ è½½ï¼ˆé¦–å±å›¾ç‰‡è®¾ä¸º trueï¼‰
  quality={75}       // å›¾ç‰‡è´¨é‡ï¼ˆ1-100ï¼Œé»˜è®¤ 75ï¼‰
  placeholder="blur" // å ä½ç¬¦ç±»å‹
  blurDataURL="..."  // æ¨¡ç³Šå ä½ç¬¦æ•°æ®
  fill={false}       // æ˜¯å¦å¡«å……çˆ¶å®¹å™¨
  sizes="(max-width: 768px) 100vw, 50vw" // å“åº”å¼å°ºå¯¸
/>
```

---

## 3. å®æˆ˜æ¡ˆä¾‹ï¼šå“åº”å¼å›¾ç‰‡

### å›ºå®šå°ºå¯¸å›¾ç‰‡

```tsx
// src/components/HeroImage.tsx
import Image from 'next/image'

export default function HeroImage() {
  return (
    <div className="relative w-full h-96">
      <Image
        src="/images/hero.jpg"
        alt="Hero"
        fill
        className="object-cover"
        priority
      />
    </div>
  )
}
```

### å“åº”å¼å›¾ç‰‡

```tsx
// src/components/ProductImage.tsx
import Image from 'next/image'

interface ProductImageProps {
  src: string
  alt: string
}

export default function ProductImage({ src, alt }: ProductImageProps) {
  return (
    <div className="relative w-full aspect-square">
      <Image
        src={src}
        alt={alt}
        fill
        className="object-cover rounded-lg"
        sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
      />
    </div>
  )
}
```

### ä½¿ç”¨ blur å ä½ç¬¦

```tsx
import Image from 'next/image'

const blurDataURL = 'data:image/jpeg;base64,/9j/4AAQSkZJRg...' // å°å°ºå¯¸ base64 å›¾ç‰‡

export default function BlurImage() {
  return (
    <Image
      src="/images/large.jpg"
      alt="Large image"
      width={1200}
      height={800}
      placeholder="blur"
      blurDataURL={blurDataURL}
    />
  )
}
```

---

## 4. å¤–éƒ¨å›¾ç‰‡ï¼ˆCDNï¼‰

### é…ç½®å…è®¸çš„åŸŸå

```javascript
// next.config.js
module.exports = {
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: 'example.com',
        pathname: '/images/**',
      },
      {
        protocol: 'https',
        hostname: '**.cloudinary.com', // æ”¯æŒé€šé…ç¬¦
      },
    ],
  },
}
```

### ä½¿ç”¨å¤–éƒ¨å›¾ç‰‡

```tsx
import Image from 'next/image'

export default function ExternalImage() {
  return (
    <Image
      src="https://example.com/images/photo.jpg"
      alt="External image"
      width={800}
      height={600}
    />
  )
}
```

---

## 5. å­—ä½“ä¼˜åŒ–

Next.js æä¾›äº† `next/font` ç”¨äºä¼˜åŒ–å­—ä½“åŠ è½½ã€‚

### ä½¿ç”¨ Google Fonts

```tsx
// src/app/layout.tsx
import { Inter } from 'next/font/google'

const inter = Inter({ subsets: ['latin'] })

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="zh-CN" className={inter.className}>
      <body>{children}</body>
    </html>
  )
}
```

### ä½¿ç”¨æœ¬åœ°å­—ä½“

```tsx
// src/app/layout.tsx
import localFont from 'next/font/local'

const myFont = localFont({
  src: [
    {
      path: '../fonts/CustomFont-Regular.woff2',
      weight: '400',
      style: 'normal',
    },
    {
      path: '../fonts/CustomFont-Bold.woff2',
      weight: '700',
      style: 'normal',
    },
  ],
  variable: '--font-custom',
})

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="zh-CN" className={myFont.variable}>
      <body>{children}</body>
    </html>
  )
}
```

### åœ¨ CSS ä¸­ä½¿ç”¨å­—ä½“å˜é‡

```css
/* src/app/globals.css */
:root {
  --font-custom: 'CustomFont', sans-serif;
}

.custom-text {
  font-family: var(--font-custom);
}
```

---

## 6. å›¾æ ‡å’Œ Favicon

### ä½¿ç”¨ Next.js App Icon

åœ¨ `app` ç›®å½•ä¸‹æ”¾ç½® `icon.png` æˆ– `icon.ico`ï¼ŒNext.js ä¼šè‡ªåŠ¨ç”Ÿæˆ faviconï¼š

```
app/
â”œâ”€â”€ icon.png      # è‡ªåŠ¨ç”Ÿæˆ favicon
â”œâ”€â”€ apple-icon.png # iOS å›¾æ ‡
â””â”€â”€ layout.tsx
```

### æ‰‹åŠ¨é…ç½®

```tsx
// src/app/layout.tsx
export const metadata = {
  icons: {
    icon: '/icons/favicon.ico',
    apple: '/icons/apple-icon.png',
  },
}
```

---

## 7. æ–‡ä»¶ä¸‹è½½

### æä¾›æ–‡ä»¶ä¸‹è½½

```tsx
// src/app/download/page.tsx
import Link from 'next/link'

export default function DownloadPage() {
  return (
    <div>
      <h1>ä¸‹è½½æ–‡ä»¶</h1>
      <Link
        href="/files/resume.pdf"
        download
        className="bg-blue-600 text-white px-6 py-3 rounded-lg"
      >
        ä¸‹è½½ç®€å†
      </Link>
    </div>
  )
}
```

### é€šè¿‡ API è·¯ç”±æä¾›æ–‡ä»¶

```tsx
// src/app/api/download/route.ts
import { NextResponse } from 'next/server'
import fs from 'fs'
import path from 'path'

export async function GET() {
  const filePath = path.join(process.cwd(), 'public', 'files', 'resume.pdf')
  const fileBuffer = fs.readFileSync(filePath)

  return new NextResponse(fileBuffer, {
    headers: {
      'Content-Type': 'application/pdf',
      'Content-Disposition': 'attachment; filename="resume.pdf"',
    },
  })
}
```

---

## 8. å®æˆ˜æ¡ˆä¾‹ï¼šå›¾ç‰‡ç”»å»Š

### éœ€æ±‚
åˆ›å»ºä¸€ä¸ªå›¾ç‰‡ç”»å»Šï¼Œå±•ç¤ºå¤šå¼ å›¾ç‰‡ï¼Œæ”¯æŒå“åº”å¼å’Œæ‡’åŠ è½½ã€‚

### å®ç°

```tsx
// src/app/gallery/page.tsx
import Image from 'next/image'

const images = [
  { src: '/images/gallery/1.jpg', alt: 'å›¾ç‰‡ 1' },
  { src: '/images/gallery/2.jpg', alt: 'å›¾ç‰‡ 2' },
  { src: '/images/gallery/3.jpg', alt: 'å›¾ç‰‡ 3' },
  { src: '/images/gallery/4.jpg', alt: 'å›¾ç‰‡ 4' },
  { src: '/images/gallery/5.jpg', alt: 'å›¾ç‰‡ 5' },
  { src: '/images/gallery/6.jpg', alt: 'å›¾ç‰‡ 6' },
]

export default function GalleryPage() {
  return (
    <div className="min-h-screen py-20">
      <div className="max-w-7xl mx-auto px-4">
        <h1 className="text-4xl font-bold mb-12 text-center">å›¾ç‰‡ç”»å»Š</h1>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {images.map((image, index) => (
            <div
              key={index}
              className="relative aspect-square overflow-hidden rounded-lg shadow-md hover:shadow-xl transition-shadow"
            >
              <Image
                src={image.src}
                alt={image.alt}
                fill
                className="object-cover"
                sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
              />
            </div>
          ))}
        </div>
      </div>
    </div>
  )
}
```

---

## 9. å®æˆ˜æ¡ˆä¾‹ï¼šå¤´åƒç»„ä»¶

### ä½¿ç”¨ Next.js Image ä¼˜åŒ–å¤´åƒ

```tsx
// src/components/Avatar.tsx
import Image from 'next/image'

interface AvatarProps {
  src: string
  alt: string
  size?: number
}

export default function Avatar({ src, alt, size = 64 }: AvatarProps) {
  return (
    <div
      className="relative rounded-full overflow-hidden"
      style={{ width: size, height: size }}
    >
      <Image
        src={src}
        alt={alt}
        fill
        className="object-cover"
        sizes={`${size}px`}
      />
    </div>
  )
}
```

### ä½¿ç”¨ç¤ºä¾‹

```tsx
// src/app/profile/page.tsx
import Avatar from '@/components/Avatar'

export default function ProfilePage() {
  return (
    <div className="max-w-4xl mx-auto px-4 py-20">
      <div className="flex items-center gap-6">
        <Avatar src="/images/avatar.jpg" alt="ç”¨æˆ·å¤´åƒ" size={128} />
        <div>
          <h1 className="text-3xl font-bold">ç”¨æˆ·å</h1>
          <p className="text-gray-600">ç”¨æˆ·ç®€ä»‹</p>
        </div>
      </div>
    </div>
  )
}
```

---

## 10. æ€§èƒ½ä¼˜åŒ–æŠ€å·§

### 1. ä½¿ç”¨ priority å±æ€§

é¦–å±å¯è§çš„å›¾ç‰‡åº”è¯¥è®¾ç½® `priority={true}`ï¼š

```tsx
<Image
  src="/images/hero.jpg"
  alt="Hero"
  width={1200}
  height={600}
  priority // ä¼˜å…ˆåŠ è½½
/>
```

### 2. ä½¿ç”¨ sizes å±æ€§

å‘Šè¯‰æµè§ˆå™¨åœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹å›¾ç‰‡çš„æ˜¾ç¤ºå¤§å°ï¼š

```tsx
<Image
  src="/images/product.jpg"
  alt="Product"
  width={800}
  height={600}
  sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
/>
```

### 3. ä½¿ç”¨ blur å ä½ç¬¦

æå‡ç”¨æˆ·ä½“éªŒï¼Œé¿å…å¸ƒå±€åç§»ï¼š

```tsx
<Image
  src="/images/large.jpg"
  alt="Large"
  width={1200}
  height={800}
  placeholder="blur"
  blurDataURL={blurDataURL}
/>
```

---

## 11. å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šå›¾ç‰‡ä¸æ˜¾ç¤º

**åŸå› **ï¼šè·¯å¾„é”™è¯¯æˆ–å›¾ç‰‡ä¸åœ¨ `public` ç›®å½•

**è§£å†³**ï¼š
- ç¡®ä¿å›¾ç‰‡åœ¨ `public` ç›®å½•ä¸‹
- ä½¿ç”¨ `/images/photo.jpg` è€Œä¸æ˜¯ `/public/images/photo.jpg`

### é—®é¢˜ 2ï¼šå¤–éƒ¨å›¾ç‰‡æŠ¥é”™

**åŸå› **ï¼šæœªåœ¨ `next.config.js` ä¸­é…ç½®å…è®¸çš„åŸŸå

**è§£å†³**ï¼šåœ¨ `next.config.js` ä¸­æ·»åŠ  `remotePatterns`

### é—®é¢˜ 3ï¼šå›¾ç‰‡å°ºå¯¸è­¦å‘Š

**åŸå› **ï¼šæœªæŒ‡å®š `width` å’Œ `height`ï¼Œæˆ–ä½¿ç”¨ `fill` æ—¶çˆ¶å®¹å™¨æœªè®¾ç½® `position: relative`

**è§£å†³**ï¼š
- æŒ‡å®šæ˜ç¡®çš„å®½é«˜ï¼Œæˆ–
- ä½¿ç”¨ `fill` æ—¶ç¡®ä¿çˆ¶å®¹å™¨æœ‰ `relative` å®šä½

---

## 12. å®æˆ˜ç»ƒä¹ ï¼šæ„å»ºäº§å“å±•ç¤ºé¡µ

### éœ€æ±‚
åˆ›å»ºä¸€ä¸ªäº§å“å±•ç¤ºé¡µï¼ŒåŒ…å«ï¼š
- äº§å“ä¸»å›¾ï¼ˆä½¿ç”¨ Image ç»„ä»¶ï¼‰
- äº§å“ç¼©ç•¥å›¾åˆ—è¡¨
- å“åº”å¼è®¾è®¡

### å®ç°

```tsx
// src/app/products/[id]/page.tsx
'use client'

import { useState } from 'react'
import Image from 'next/image'
import { useParams } from 'next/navigation'

const productImages = [
  '/images/products/1/main.jpg',
  '/images/products/1/thumb1.jpg',
  '/images/products/1/thumb2.jpg',
  '/images/products/1/thumb3.jpg',
]

export default function ProductPage() {
  const params = useParams()
  const [selectedImage, setSelectedImage] = useState(productImages[0])

  return (
    <div className="max-w-6xl mx-auto px-4 py-20">
      <div className="grid md:grid-cols-2 gap-8">
        {/* ä¸»å›¾ */}
        <div>
          <div className="relative aspect-square mb-4">
            <Image
              src={selectedImage}
              alt="äº§å“ä¸»å›¾"
              fill
              className="object-cover rounded-lg"
              priority
            />
          </div>
          
          {/* ç¼©ç•¥å›¾ */}
          <div className="grid grid-cols-4 gap-2">
            {productImages.map((image, index) => (
              <button
                key={index}
                onClick={() => setSelectedImage(image)}
                className={`relative aspect-square rounded overflow-hidden border-2 ${
                  selectedImage === image
                    ? 'border-blue-600'
                    : 'border-transparent'
                }`}
              >
                <Image
                  src={image}
                  alt={`ç¼©ç•¥å›¾ ${index + 1}`}
                  fill
                  className="object-cover"
                />
              </button>
            ))}
          </div>
        </div>

        {/* äº§å“ä¿¡æ¯ */}
        <div>
          <h1 className="text-4xl font-bold mb-4">äº§å“åç§°</h1>
          <p className="text-3xl font-bold text-blue-600 mb-6">Â¥999</p>
          <p className="text-gray-700 mb-8">
            è¿™æ˜¯äº§å“çš„è¯¦ç»†æè¿°ä¿¡æ¯...
          </p>
          <button className="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700">
            åŠ å…¥è´­ç‰©è½¦
          </button>
        </div>
      </div>
    </div>
  )
}
```

---

## 13. æ€»ç»“

æœ¬ç« æˆ‘ä»¬å­¦ä¹ äº†ï¼š
1. âœ… `public` ç›®å½•çš„ä½¿ç”¨
2. âœ… Next.js `Image` ç»„ä»¶çš„ä¼˜åŒ–åŠŸèƒ½
3. âœ… å­—ä½“ä¼˜åŒ–ï¼ˆ`next/font`ï¼‰
4. âœ… å›¾æ ‡å’Œ Favicon é…ç½®
5. âœ… æ–‡ä»¶ä¸‹è½½çš„å®ç°
6. âœ… æ„å»ºäº†å›¾ç‰‡ç”»å»Šå’Œäº§å“å±•ç¤ºé¡µ

**å…³é”®è¦ç‚¹**ï¼š
- ğŸ–¼ï¸ å§‹ç»ˆä½¿ç”¨ `Image` ç»„ä»¶è€Œä¸æ˜¯ `<img>` æ ‡ç­¾
- ğŸ–¼ï¸ é¦–å±å›¾ç‰‡è®¾ç½® `priority={true}`
- ğŸ–¼ï¸ ä½¿ç”¨ `sizes` å±æ€§ä¼˜åŒ–å“åº”å¼å›¾ç‰‡
- ğŸ–¼ï¸ å¤–éƒ¨å›¾ç‰‡éœ€è¦åœ¨ `next.config.js` ä¸­é…ç½®

**ä¸‹ä¸€æ­¥**ï¼šæ­å–œï¼ä½ å·²ç»å®Œæˆäº† Next.js åŸºç¡€å…¥é—¨çš„å­¦ä¹ ã€‚æ¥ä¸‹æ¥å¯ä»¥æ·±å…¥å­¦ä¹ æ ¸å¿ƒæœºåˆ¶ã€App Router ä½“ç³»ç­‰é«˜çº§å†…å®¹ã€‚

