# Model æ’ä»¶

> `@umijs/plugin-model` æ˜¯ Umi å†…ç½®çš„ä¸€ç§è½»é‡çº§ã€åŸºäº Hooks çš„æ•°æ®æµæ–¹æ¡ˆã€‚å®ƒæ—¨åœ¨è§£å†³ç»„ä»¶é—´çŠ¶æ€å…±äº«çš„é—®é¢˜ï¼ŒåŒæ—¶é¿å… Redux ç­‰æ–¹æ¡ˆä¸­ç¹ççš„ Boilerplate ä»£ç ã€‚

---

## ğŸ“‹ ç›®å½•
- [æ ¸å¿ƒç†å¿µ](#æ ¸å¿ƒç†å¿µ)
- [å¼€å§‹ä½¿ç”¨ï¼šå‘½åç©ºé—´è§„åˆ™](#å¼€å§‹ä½¿ç”¨å‘½åç©ºé—´è§„åˆ™)
- [å…¨å±€åˆå§‹çŠ¶æ€ @@initialState](#å…¨å±€åˆå§‹çŠ¶æ€-initialstate)
- [ä½¿ç”¨ Model](#ä½¿ç”¨-model)
- [æ€§èƒ½ä¼˜åŒ–ï¼šé€‰æ‹©å™¨](#æ€§èƒ½ä¼˜åŒ–é€‰æ‹©å™¨)
- [é¡µé¢å†…â€œå°æ¨¡å—â€ä¸å…¨å±€ç®¡ç†](#é¡µé¢å†…å°æ¨¡å—ä¸å…¨å±€ç®¡ç†)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## æ ¸å¿ƒç†å¿µ

Umi Model æ’ä»¶çš„æ ¸å¿ƒç†å¿µæ˜¯ï¼š**â€œä¸€ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ª Hookâ€**ã€‚

### 1. æœ¬è´¨å…¬å¼
> **Umi Model = è‡ªå®šä¹‰ Hook + å…¨å±€å…±äº« (å•ä¾‹æ¨¡å¼)**

### 2. ç›´è§‚æ¯”å–»
- **æ™®é€šè‡ªå®šä¹‰ Hook** æ˜¯ä¸€é¢ **â€œéšèº«é•œâ€**ï¼šæ¯ä¸ªç»„ä»¶è°ƒç”¨æ—¶éƒ½ä¼šç»™è‡ªå·±ç”Ÿæˆä¸€ä¸ªç‹¬ç«‹çš„çŠ¶æ€ã€‚
- **Umi Model** æ˜¯æŒ‚åœ¨åº—ä¸­å¤®çš„ä¸€å— **â€œå¤§å±å¹•â€**ï¼šåº”ç”¨ä¸­ä»»ä½•åœ°æ–¹çœ‹åˆ°çš„éƒ½æ˜¯åŒä¸€å—å±å¹•ã€‚

---

## å¼€å§‹ä½¿ç”¨ï¼šå‘½åç©ºé—´è§„åˆ™

æ‰€è°“çš„ Modelï¼Œå°±æ˜¯ä¸€ä¸ªé»˜è®¤å¯¼å‡ºçš„è‡ªå®šä¹‰ Hookã€‚Umi ä¼šæ ¹æ®æ–‡ä»¶è·¯å¾„è‡ªåŠ¨ç”Ÿæˆ **å‘½åç©ºé—´ï¼ˆNamespaceï¼‰**ã€‚

### 1. å‘½åç©ºé—´ç”Ÿæˆè¡¨
| è·¯å¾„ | å‘½åç©ºé—´ | è¯´æ˜ |
| :--- | :--- | :--- |
| `src/models/count.ts` | `count` | `src/models` ç›®å½•ä¸‹**ä¸æ”¯æŒ**åµŒå¥—å®šä¹‰ |
| `src/pages/pageA/model.ts` | `pageA.model` | é¡µé¢çº§ model |
| `src/pages/pageB/models/product.ts` | `pageB.product` | é¡µé¢çº§ models ç›®å½• |
| `src/pages/pageB/models/fruit/apple.ts` | `pageB.fruit.apple` | `pages` ç›®å½•ä¸‹**æ”¯æŒ**åµŒå¥—å®šä¹‰ |

### 2. ç¼–å†™ Model ç¤ºä¾‹
```typescript
// src/models/userModel.ts
import { useState } from 'react';

export default () => {
  const [user, setUser] = useState({ username: 'umi' });
  return { user, setUser };
};
```

---

## å…¨å±€åˆå§‹çŠ¶æ€ @@initialState

`@@initialState` æ˜¯ä¸€ç§ç‰¹æ®Šçš„ã€å†…ç½®çš„å…¨å±€ Modelã€‚å®ƒåœ¨é¡¹ç›®å¯åŠ¨çš„æœ€å¼€å§‹åˆ›å»ºï¼Œé€šå¸¸ç”¨äºå­˜å‚¨å½“å‰ç”¨æˆ·ã€æƒé™ã€å…¨å±€é…ç½®ç­‰ã€‚

### 1. åˆå§‹åŒ– (src/app.ts)
```typescript
// src/app.ts
export async function getInitialState() {
  const data = await fetchUserInfo();
  return data; // è¿™é‡Œçš„è¿”å›å€¼å°±æ˜¯ initialState
}
```

### 2. æ¶ˆè´¹çŠ¶æ€
```tsx
const { initialState, loading, refresh, setInitialState } = useModel('@@initialState');
```

---

## ä½¿ç”¨ Model

åœ¨ç»„ä»¶ä¸­é€šè¿‡ `useModel(namespace)` è·å–çŠ¶æ€ã€‚

```tsx
import { useModel } from 'umi';

export default () => {
  const { user } = useModel('userModel');
  const { initialState } = useModel('@@initialState');
  return <div>{user.username}</div>;
};
```

---

## æ€§èƒ½ä¼˜åŒ–ï¼šé€‰æ‹©å™¨

`useModel` çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯é€‰çš„ **updater (Selector)**ã€‚å½“ Model ä¸­åªæœ‰éƒ¨åˆ†å‚æ•°å˜åŒ–æ—¶ï¼Œä½¿ç”¨å®ƒå¯ä»¥é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“ã€‚

```tsx
// åªæœ‰å½“ count å˜åŒ–æ—¶ï¼Œè¯¥ç»„ä»¶æ‰ä¼šé‡æ–°æ¸²æŸ“
const { count } = useModel('counterModel', (model) => ({
  count: model.count,
}));
```

---

## ğŸ’¡ æ ¸å¿ƒè¿›é˜¶ï¼šé¡µé¢å†…â€œå°æ¨¡å—â€ Modal vs å…¨å±€ Modal

### 1. åœºæ™¯å†³ç­–æŒ‡å—

| ç»´åº¦ | é¡µé¢/ç»„ä»¶å†…â€œå°æ¨¡å—â€ Modal | å…¨å±€/åº”ç”¨çº§ Model Modal |
| :--- | :--- | :--- |
| **å­˜æ”¾ä½ç½®** | é¡µé¢ç»„ä»¶å†…éƒ¨ï¼ˆä½¿ç”¨ `useState`ï¼‰ | `src/models/` ç›®å½• |
| **çŠ¶æ€å½’å±** | **ç§æœ‰çŠ¶æ€**ï¼šåªä¸ºå½“å‰é¡µé¢æœåŠ¡ | **å…±äº«çŠ¶æ€**ï¼šè·¨é¡µé¢æˆ–å…¨å±€ç»„ä»¶ï¼ˆå¦‚å¯¼èˆªæ ï¼‰ |
| **å°ç™½å»ºè®®** | **90% çš„ä¸šåŠ¡å¼¹çª—**è¯·é€‰è¿™ä¸ªã€‚ | **5% çš„å…¨å±€å¼¹çª—**ï¼ˆå¦‚ç™»å½•ã€å…¬å‘Šï¼‰é€‰è¿™ä¸ªã€‚ |

### 2. ä»£ç å®æˆ˜ä¸ç›®å½•ç®¡ç†

#### A. å±€éƒ¨ Modalï¼ˆæ¨èï¼‰
**ç›®å½•ç»“æ„ï¼š**
```text
src/pages/User/
  â”œâ”€â”€ index.tsx          # çŠ¶æ€å®šä¹‰åœ¨è¿™é‡Œ (useState)
  â””â”€â”€ components/
      â””â”€â”€ EditModal.tsx  # çº¯å±•ç¤º/æ¥æ”¶ Props çš„ Modal
```

#### B. å…¨å±€ Modalï¼ˆè·¨ç»„ä»¶è”åŠ¨ï¼‰
**ç›®å½•ç»“æ„ï¼š**
```text
src/
  â”œâ”€â”€ models/
  â”‚   â””â”€â”€ useAuthModel.ts  # å®šä¹‰å…¨å±€æ§åˆ¶é€»è¾‘
  â”œâ”€â”€ components/
  â”‚   â””â”€â”€ LoginModal.tsx   # ç™»å½•å¼¹çª—
  â””â”€â”€ layouts/
      â””â”€â”€ index.tsx        # åœ¨è¿™é‡ŒæŒ‚è½½ LoginModalï¼Œå®ç°å…¨ç«™è°ƒç”¨
```

---

## ğŸš€ è¿›é˜¶ï¼šå¾®å‰ç«¯é€šä¿¡ (@@qiankunStateFromMaster)

å½“ä½œä¸ºå¾®å‰ç«¯å­åº”ç”¨è¿è¡Œæ—¶ï¼ŒUmi å†…ç½®äº†è¯¥ Model ç”¨äºæ¥æ”¶ä¸»åº”ç”¨ä¸‹å‘çš„æ•°æ®ã€‚
```tsx
const masterState = useModel('@@qiankunStateFromMaster');
```

---

## æœ€ä½³å®è·µ

1. **å‘½åè§„èŒƒ**ï¼šå»ºè®®ä»¥ `useXXXModel.ts` å‘½åï¼Œç›®å½•å¿…é€‰å¤æ•° `src/models`ã€‚
2. **çŠ¶æ€ä¸‹æ²‰**ï¼šä¸è¦æŠŠæ‰€æœ‰çŠ¶æ€éƒ½å¡è¿›å…¨å±€ï¼Œä¼˜å…ˆè€ƒè™‘ç»„ä»¶å†… `useState`ã€‚
3. **æ€§èƒ½æ„è¯†**ï¼šå¤§ Model åŠ¡å¿…ä½¿ç”¨ Selector ä¼˜åŒ–ã€‚
4. **é…åˆ useRequest**ï¼šå°†å¼‚æ­¥æ•°æ®è¯·æ±‚ç»“æœå­˜å…¥ Model æ˜¯ Umi å¼€å‘çš„æ ‡å‡†æ¨¡å¼ã€‚

---

## ğŸ”— ç›¸å…³é“¾æ¥
- [Umi å®˜æ–¹æ–‡æ¡£ - æ•°æ®æµ](https://umijs.org/docs/max/data-flow)
- [Request æ’ä»¶](./03-Requestæ’ä»¶.md)

---

**æœ€åæ›´æ–°**ï¼š2026-01-14
**ç»´æŠ¤è§„èŒƒ**ï¼šéµå¾ª [.cursorrules](../../../.cursorrules)

#Umi #Modelæ’ä»¶ #æ•°æ®æµ #initialState #çŠ¶æ€ç®¡ç†
