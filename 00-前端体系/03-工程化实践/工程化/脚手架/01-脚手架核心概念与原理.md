# è„šæ‰‹æ¶æ ¸å¿ƒæ¦‚å¿µä¸åŸç†ï¼ˆScaffold Core Conceptsï¼‰

> ç†è§£å‰ç«¯è„šæ‰‹æ¶çš„åŸºæœ¬æ¦‚å¿µã€å·¥ä½œåŸç†å’Œæ ¸å¿ƒæœºåˆ¶ï¼Œä¸ºæ„å»ºè‡ªå·±çš„è„šæ‰‹æ¶ç³»ç»Ÿæ‰“ä¸‹ç†è®ºåŸºç¡€ã€‚

---

## ğŸ“‹ ç›®å½•

- [1. ä»€ä¹ˆæ˜¯å‰ç«¯è„šæ‰‹æ¶](#1-ä»€ä¹ˆæ˜¯å‰ç«¯è„šæ‰‹æ¶)
- [2. è„šæ‰‹æ¶è¿è¡Œæœºåˆ¶](#2-è„šæ‰‹æ¶è¿è¡Œæœºåˆ¶)
- [3. Node CLI å·¥ä½œåŸç†](#3-node-cli-å·¥ä½œåŸç†)
- [4. æ–‡ä»¶æ¨¡æ¿å¤„ç†](#4-æ–‡ä»¶æ¨¡æ¿å¤„ç†)
- [5. æ’ä»¶æ¶æ„](#5-æ’ä»¶æ¶æ„)
- [6. æ‰©å±•æœºåˆ¶](#6-æ‰©å±•æœºåˆ¶)

---

## 1. ä»€ä¹ˆæ˜¯å‰ç«¯è„šæ‰‹æ¶

### 1.1 å®šä¹‰

**å‰ç«¯è„šæ‰‹æ¶ï¼ˆScaffoldingï¼‰** æ˜¯ä¸€ç§è‡ªåŠ¨åŒ–å·¥å…·ï¼Œç”¨äºå¿«é€Ÿç”Ÿæˆé¡¹ç›®çš„åŸºç¡€ç»“æ„å’Œé…ç½®æ–‡ä»¶ï¼Œå¸®åŠ©å¼€å‘è€…è·³è¿‡é‡å¤çš„åˆå§‹åŒ–å·¥ä½œï¼Œä¸“æ³¨äºä¸šåŠ¡å¼€å‘ã€‚

### 1.2 å¸¸è§è„šæ‰‹æ¶

- **create-react-app** - React é¡¹ç›®è„šæ‰‹æ¶
- **Vue CLI** - Vue é¡¹ç›®è„šæ‰‹æ¶
- **Vite** - å¿«é€Ÿçš„å‰ç«¯æ„å»ºå·¥å…·ï¼Œä¹Ÿæä¾›é¡¹ç›®åˆ›å»ºåŠŸèƒ½
- **Angular CLI** - Angular é¡¹ç›®è„šæ‰‹æ¶
- **Next.js CLI** - Next.js é¡¹ç›®è„šæ‰‹æ¶

### 1.3 è„šæ‰‹æ¶çš„ä½œç”¨

1. **å¿«é€Ÿåˆå§‹åŒ–é¡¹ç›®**ï¼šä¸€é”®ç”Ÿæˆå®Œæ•´çš„é¡¹ç›®ç»“æ„
2. **ç»Ÿä¸€é¡¹ç›®è§„èŒƒ**ï¼šç¡®ä¿å›¢é˜Ÿé¡¹ç›®ç»“æ„ä¸€è‡´
3. **é›†æˆæœ€ä½³å®è·µ**ï¼šå†…ç½®å¸¸ç”¨çš„é…ç½®å’Œå·¥å…·
4. **å‡å°‘é‡å¤å·¥ä½œ**ï¼šé¿å…æ¯æ¬¡æ‰‹åŠ¨åˆ›å»ºæ–‡ä»¶ç»“æ„

---

## 2. è„šæ‰‹æ¶è¿è¡Œæœºåˆ¶

### 2.1 åŸºæœ¬æµç¨‹

```
ç”¨æˆ·æ‰§è¡Œå‘½ä»¤
    â†“
CLI å·¥å…·å¯åŠ¨
    â†“
è§£æå‘½ä»¤å‚æ•°
    â†“
ç”¨æˆ·äº¤äº’é€‰æ‹©ï¼ˆå¯é€‰ï¼‰
    â†“
åŠ è½½æ¨¡æ¿
    â†“
å¤„ç†æ¨¡æ¿å˜é‡
    â†“
ç”Ÿæˆæ–‡ä»¶
    â†“
å®‰è£…ä¾èµ–ï¼ˆå¯é€‰ï¼‰
    â†“
åˆå§‹åŒ– Gitï¼ˆå¯é€‰ï¼‰
    â†“
å®Œæˆ
```

### 2.2 æ ¸å¿ƒæ­¥éª¤

#### æ­¥éª¤ 1ï¼šå‘½ä»¤è§£æ

```bash
# ç”¨æˆ·è¾“å…¥
my-cli create my-app --template react-ts

# CLI è§£æ
- å‘½ä»¤ï¼šcreate
- é¡¹ç›®åï¼šmy-app
- é€‰é¡¹ï¼š--template react-ts
```

#### æ­¥éª¤ 2ï¼šç”¨æˆ·äº¤äº’

```bash
# äº¤äº’å¼é€‰æ‹©
? é€‰æ‹©åŒ…ç®¡ç†å™¨: (Use arrow keys)
  â¯ npm
    yarn
    pnpm

? æ˜¯å¦å®‰è£…ä¾èµ–? (Y/n)
? æ˜¯å¦åˆå§‹åŒ– Git? (Y/n)
```

#### æ­¥éª¤ 3ï¼šæ¨¡æ¿å¤„ç†

```javascript
// æ¨¡æ¿æ–‡ä»¶
const template = `
import React from 'react';

function App() {
  return <div>Hello {{projectName}}</div>;
}

export default App;
`;

// å¤„ç†å
const result = `
import React from 'react';

function App() {
  return <div>Hello my-app</div>;
}

export default App;
`;
```

#### æ­¥éª¤ 4ï¼šæ–‡ä»¶ç”Ÿæˆ

```javascript
// ç”Ÿæˆç›®å½•ç»“æ„
my-app/
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ App.tsx
â”‚   â””â”€â”€ index.tsx
â””â”€â”€ public/
    â””â”€â”€ index.html
```

---

## 3. Node CLI å·¥ä½œåŸç†

### 3.1 CLI å·¥å…·çš„æœ¬è´¨

CLIï¼ˆCommand Line Interfaceï¼‰å·¥å…·æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¯æ‰§è¡Œçš„ Node.js è„šæœ¬ï¼Œé€šè¿‡ `package.json` çš„ `bin` å­—æ®µæ³¨å†Œä¸ºå…¨å±€å‘½ä»¤ã€‚

### 3.2 package.json é…ç½®

```json
{
  "name": "my-cli",
  "version": "1.0.0",
  "bin": {
    "my-cli": "./bin/cli.js"
  }
}
```

### 3.3 bin æ–‡ä»¶æ ¼å¼

#### æ–¹å¼ä¸€ï¼šJavaScript æ–‡ä»¶

```javascript
#!/usr/bin/env node

// bin/cli.js
console.log('Hello from CLI!');
```

#### æ–¹å¼äºŒï¼šTypeScript ç¼–è¯‘å

```json
{
  "bin": {
    "my-cli": "./dist/cli.js"
  }
}
```

### 3.4 å‘½ä»¤è§£æåº“

#### Commander.js

```javascript
const { Command } = require('commander');

const program = new Command();

program
  .name('my-cli')
  .description('å‰ç«¯è„šæ‰‹æ¶å·¥å…·')
  .version('1.0.0');

program
  .command('create')
  .description('åˆ›å»ºæ–°é¡¹ç›®')
  .argument('<project-name>', 'é¡¹ç›®åç§°')
  .option('-t, --template <template>', 'é€‰æ‹©æ¨¡æ¿')
  .action((name, options) => {
    console.log(`åˆ›å»ºé¡¹ç›®: ${name}`);
    console.log(`æ¨¡æ¿: ${options.template}`);
  });

program.parse();
```

#### Yargs

```javascript
const yargs = require('yargs');

yargs
  .command('create <project-name>', 'åˆ›å»ºæ–°é¡¹ç›®', (yargs) => {
    return yargs
      .positional('project-name', {
        describe: 'é¡¹ç›®åç§°',
        type: 'string'
      })
      .option('template', {
        alias: 't',
        type: 'string',
        description: 'é€‰æ‹©æ¨¡æ¿'
      });
  }, (argv) => {
    console.log(`åˆ›å»ºé¡¹ç›®: ${argv.projectName}`);
    console.log(`æ¨¡æ¿: ${argv.template}`);
  })
  .parse();
```

---

## 4. æ–‡ä»¶æ¨¡æ¿å¤„ç†

### 4.1 æ¨¡æ¿å¼•æ“

æ¨¡æ¿å¼•æ“ç”¨äºå¤„ç†æ¨¡æ¿æ–‡ä»¶ä¸­çš„å˜é‡æ›¿æ¢å’Œé€»è¾‘å¤„ç†ã€‚

#### EJSï¼ˆEmbedded JavaScriptï¼‰

```javascript
const ejs = require('ejs');

const template = `
<%= projectName %>
<% if (useTypeScript) { %>
import React from 'react';
<% } else { %>
import React from 'react';
<% } %>
`;

const result = ejs.render(template, {
  projectName: 'my-app',
  useTypeScript: true
});
```

#### Mustache

```javascript
const Mustache = require('mustache');

const template = `
{{projectName}}
{{#useTypeScript}}
import React from 'react';
{{/useTypeScript}}
`;

const result = Mustache.render(template, {
  projectName: 'my-app',
  useTypeScript: true
});
```

#### Handlebars

```javascript
const Handlebars = require('handlebars');

const template = Handlebars.compile(`
{{projectName}}
{{#if useTypeScript}}
import React from 'react';
{{/if}}
`);

const result = template({
  projectName: 'my-app',
  useTypeScript: true
});
```

### 4.2 æ–‡ä»¶å¤„ç†æµç¨‹

```javascript
// 1. è¯»å–æ¨¡æ¿æ–‡ä»¶
const templateContent = fs.readFileSync('template/App.tsx.ejs', 'utf-8');

// 2. æ¸²æŸ“æ¨¡æ¿
const rendered = ejs.render(templateContent, {
  projectName: 'my-app',
  author: 'John Doe'
});

// 3. å†™å…¥ç›®æ ‡æ–‡ä»¶
fs.writeFileSync('my-app/src/App.tsx', rendered);
```

### 4.3 ç›®å½•ç»“æ„æ¨¡æ¿

```javascript
// æ¨¡æ¿ç›®å½•ç»“æ„
templates/
â””â”€â”€ react-ts/
    â”œâ”€â”€ package.json.ejs
    â”œâ”€â”€ tsconfig.json
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ App.tsx.ejs
    â”‚   â””â”€â”€ index.tsx
    â””â”€â”€ public/
        â””â”€â”€ index.html

// ç”Ÿæˆåçš„ç›®å½•ç»“æ„
my-app/
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ App.tsx
â”‚   â””â”€â”€ index.tsx
â””â”€â”€ public/
    â””â”€â”€ index.html
```

---

## 5. æ’ä»¶æ¶æ„

### 5.1 æ’ä»¶çš„ä½œç”¨

æ’ä»¶æœºåˆ¶å…è®¸è„šæ‰‹æ¶åœ¨æ ¸å¿ƒåŠŸèƒ½åŸºç¡€ä¸Šæ‰©å±•èƒ½åŠ›ï¼Œç±»ä¼¼äº Webpack å’Œ Vite çš„æ’ä»¶ç³»ç»Ÿã€‚

### 5.2 æ’ä»¶æ¶æ„è®¾è®¡

```
CLI Core
    â†“
Plugin System
    â”œâ”€â”€ Hook æœºåˆ¶
    â”œâ”€â”€ ç”Ÿå‘½å‘¨æœŸ
    â””â”€â”€ æ’ä»¶æ³¨å†Œ
    â†“
Plugins
    â”œâ”€â”€ Plugin A
    â”œâ”€â”€ Plugin B
    â””â”€â”€ Plugin C
```

### 5.3 Hook æœºåˆ¶

```javascript
class Scaffold {
  constructor() {
    this.hooks = {
      beforeCreate: [],
      afterCreate: [],
      beforeInstall: [],
      afterInstall: []
    };
  }

  // æ³¨å†Œ Hook
  hook(name, fn) {
    if (this.hooks[name]) {
      this.hooks[name].push(fn);
    }
  }

  // æ‰§è¡Œ Hook
  async executeHook(name, ...args) {
    const hooks = this.hooks[name] || [];
    for (const hook of hooks) {
      await hook(...args);
    }
  }

  // åˆ›å»ºé¡¹ç›®
  async create(projectName, options) {
    await this.executeHook('beforeCreate', projectName, options);
    // åˆ›å»ºé€»è¾‘
    await this.executeHook('afterCreate', projectName, options);
  }
}
```

### 5.4 æ’ä»¶ç¤ºä¾‹

```javascript
// æ’ä»¶ï¼šè‡ªåŠ¨æ·»åŠ  ESLint
function eslintPlugin(scaffold) {
  scaffold.hook('afterCreate', async (projectName) => {
    // æ·»åŠ  ESLint é…ç½®
    const eslintConfig = {
      extends: ['eslint:recommended']
    };
    fs.writeFileSync(
      `${projectName}/.eslintrc.json`,
      JSON.stringify(eslintConfig, null, 2)
    );
  });
}

// ä½¿ç”¨æ’ä»¶
const scaffold = new Scaffold();
eslintPlugin(scaffold);
```

---

## 6. æ‰©å±•æœºåˆ¶

### 6.1 é…ç½®ç³»ç»Ÿ

å…è®¸ç”¨æˆ·é€šè¿‡é…ç½®æ–‡ä»¶è‡ªå®šä¹‰è„šæ‰‹æ¶è¡Œä¸ºã€‚

```javascript
// .scaffoldrc.json
{
  "templates": {
    "custom-react": "./templates/custom-react"
  },
  "defaults": {
    "packageManager": "pnpm",
    "installDeps": true
  }
}
```

### 6.2 è‡ªå®šä¹‰æ¨¡æ¿

å…è®¸ç”¨æˆ·åˆ›å»ºå’Œä½¿ç”¨è‡ªå·±çš„æ¨¡æ¿ã€‚

```bash
# æ·»åŠ è‡ªå®šä¹‰æ¨¡æ¿
my-cli template add my-template ./my-template

# ä½¿ç”¨è‡ªå®šä¹‰æ¨¡æ¿
my-cli create my-app --template my-template
```

### 6.3 è¿œç¨‹æ¨¡æ¿

æ”¯æŒä»è¿œç¨‹ä»“åº“ä¸‹è½½æ¨¡æ¿ã€‚

```bash
# ä» GitHub ä¸‹è½½æ¨¡æ¿
my-cli create my-app --template github:user/repo

# ä» npm åŒ…ä¸‹è½½æ¨¡æ¿
my-cli create my-app --template npm:my-template-package
```

### 6.4 è¿è¡Œæ—¶æ‰©å±•

æ”¯æŒåœ¨é¡¹ç›®è¿è¡Œæ—¶æ·»åŠ åŠŸèƒ½ï¼ˆç±»ä¼¼ Vite ä¸­é—´ä»¶ï¼‰ã€‚

```javascript
// æ·»åŠ  Mock æœåŠ¡å™¨
my-cli add mock-server

// æ·»åŠ å¼€å‘å·¥å…·
my-cli add devtools
```

---

## ğŸ“ æ€»ç»“

### æ ¸å¿ƒæ¦‚å¿µ

1. **è„šæ‰‹æ¶**ï¼šè‡ªåŠ¨åŒ–é¡¹ç›®åˆå§‹åŒ–å·¥å…·
2. **CLI**ï¼šå‘½ä»¤è¡Œæ¥å£ï¼Œé€šè¿‡ Node.js å®ç°
3. **æ¨¡æ¿å¼•æ“**ï¼šå¤„ç†æ¨¡æ¿å˜é‡å’Œé€»è¾‘
4. **æ’ä»¶ç³»ç»Ÿ**ï¼šæ‰©å±•è„šæ‰‹æ¶åŠŸèƒ½
5. **æ‰©å±•æœºåˆ¶**ï¼šæ”¯æŒç”¨æˆ·è‡ªå®šä¹‰å’Œè¿œç¨‹æ¨¡æ¿

### å…³é”®æŠ€æœ¯

- **Node.js**ï¼šè¿è¡Œç¯å¢ƒ
- **Commander/Yargs**ï¼šå‘½ä»¤è§£æ
- **EJS/Mustache**ï¼šæ¨¡æ¿å¼•æ“
- **Inquirer**ï¼šç”¨æˆ·äº¤äº’
- **æ–‡ä»¶ç³»ç»Ÿ API**ï¼šæ–‡ä»¶æ“ä½œ

### ä¸‹ä¸€æ­¥

- [ä»é›¶å¼€å§‹æ„å»ºè„šæ‰‹æ¶](./02-ä»é›¶å¼€å§‹æ„å»ºè„šæ‰‹æ¶.md) - å®è·µæ„å»ºä¸€ä¸ªå®Œæ•´çš„è„šæ‰‹æ¶ç³»ç»Ÿ

---

#è„šæ‰‹æ¶ #å‰ç«¯å·¥ç¨‹åŒ– #CLIå·¥å…· #Node.js #åŸç†

