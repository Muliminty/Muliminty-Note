# æ¨¡æ¿ç³»ç»Ÿå®ç°ï¼ˆTemplate Systemï¼‰

> å®ç°å¯æ‰©å±•çš„æ¨¡æ¿ç³»ç»Ÿï¼Œæ”¯æŒå¤šç§æ¡†æ¶æ¨¡æ¿ï¼ˆVueã€Reactã€TypeScript ç­‰ï¼‰ï¼ŒåŒ…æ‹¬æ¨¡æ¿å¼•æ“é€‰æ‹©ã€å˜é‡æ³¨å…¥ã€åŠ¨æ€æ–‡ä»¶ç”Ÿæˆç­‰åŠŸèƒ½ã€‚

---

## ğŸ“‹ ç›®å½•

- [1. æ¨¡æ¿å¼•æ“é€‰æ‹©](#1-æ¨¡æ¿å¼•æ“é€‰æ‹©)
- [2. å†…ç½®æ¨¡æ¿ä½“ç³»](#2-å†…ç½®æ¨¡æ¿ä½“ç³»)
- [3. æ¨¡æ¿å˜é‡æ³¨å…¥](#3-æ¨¡æ¿å˜é‡æ³¨å…¥)
- [4. åŠ¨æ€æ–‡ä»¶ç”Ÿæˆ](#4-åŠ¨æ€æ–‡ä»¶ç”Ÿæˆ)
- [5. æ¨¡æ¿é…ç½®ç®¡ç†](#5-æ¨¡æ¿é…ç½®ç®¡ç†)
- [6. æ¨¡æ¿ç¤ºä¾‹](#6-æ¨¡æ¿ç¤ºä¾‹)

---

## 1. æ¨¡æ¿å¼•æ“é€‰æ‹©

### 1.1 å¸¸ç”¨æ¨¡æ¿å¼•æ“å¯¹æ¯”

| å¼•æ“ | è¯­æ³• | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| EJS | `<%= %>` | åŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒ JavaScript | å¤æ‚é€»è¾‘å¤„ç† |
| Mustache | `{{ }}` | æ— é€»è¾‘ï¼Œç®€æ´ | ç®€å•å˜é‡æ›¿æ¢ |
| Handlebars | `{{ }}` | Mustache å¢å¼ºç‰ˆ | éœ€è¦è¾…åŠ©å‡½æ•° |
| Nunjucks | `{% %}` | åŠŸèƒ½ä¸°å¯Œï¼Œç±»ä¼¼ Jinja2 | å¤æ‚æ¨¡æ¿ |

### 1.2 é€‰æ‹© EJS çš„åŸå› 

- **åŠŸèƒ½å¼ºå¤§**ï¼šæ”¯æŒå®Œæ•´çš„ JavaScript è¯­æ³•
- **çµæ´»æ€§å¼º**ï¼šå¯ä»¥å¤„ç†å¤æ‚çš„é€»è¾‘
- **æ˜“äºä½¿ç”¨**ï¼šè¯­æ³•ç›´è§‚ï¼Œå­¦ä¹ æˆæœ¬ä½
- **ç”Ÿæ€å®Œå–„**ï¼šæ–‡æ¡£å’Œç¤¾åŒºæ”¯æŒå¥½

### 1.3 EJS åŸºç¡€è¯­æ³•

```ejs
<%# æ³¨é‡Š %>

<%# å˜é‡è¾“å‡º %>
<%= projectName %>

<%# è½¬ä¹‰è¾“å‡ºï¼ˆé˜²æ­¢ XSSï¼‰ %>
<%- htmlContent %>

<%# æ¡ä»¶åˆ¤æ–­ %>
<% if (useTypeScript) { %>
import React from 'react';
<% } %>

<%# å¾ªç¯ %>
<% dependencies.forEach(dep => { %>
  "<%= dep.name %>": "<%= dep.version %>",
<% }); %>

<%# åŒ…å«å…¶ä»–æ¨¡æ¿ %>
<%- include('header.ejs') %>
```

---

## 2. å†…ç½®æ¨¡æ¿ä½“ç³»

### 2.1 æ¨¡æ¿ç›®å½•ç»“æ„

```
templates/
â”œâ”€â”€ basic-js/          # åŸºç¡€ JavaScript æ¨¡æ¿
â”‚   â”œâ”€â”€ package.json.ejs
â”‚   â”œâ”€â”€ .gitignore
â”‚   â””â”€â”€ index.js
â”œâ”€â”€ basic-ts/          # åŸºç¡€ TypeScript æ¨¡æ¿
â”‚   â”œâ”€â”€ package.json.ejs
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ .gitignore
â”‚   â””â”€â”€ src/
â”‚       â””â”€â”€ index.ts
â”œâ”€â”€ react/             # React æ¨¡æ¿
â”‚   â”œâ”€â”€ package.json.ejs
â”‚   â”œâ”€â”€ .gitignore
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â””â”€â”€ index.html
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ App.jsx
â”‚       â””â”€â”€ index.jsx
â”œâ”€â”€ react-ts/          # React + TypeScript æ¨¡æ¿
â”‚   â”œâ”€â”€ package.json.ejs
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ .gitignore
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â””â”€â”€ index.html
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ App.tsx
â”‚       â””â”€â”€ index.tsx
â”œâ”€â”€ vue/               # Vue æ¨¡æ¿
â”‚   â”œâ”€â”€ package.json.ejs
â”‚   â”œâ”€â”€ .gitignore
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â””â”€â”€ index.html
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ App.vue
â”‚       â””â”€â”€ main.js
â””â”€â”€ vue-ts/            # Vue + TypeScript æ¨¡æ¿
    â”œâ”€â”€ package.json.ejs
    â”œâ”€â”€ tsconfig.json
    â”œâ”€â”€ .gitignore
    â”œâ”€â”€ public/
    â”‚   â””â”€â”€ index.html
    â””â”€â”€ src/
        â”œâ”€â”€ App.vue
        â””â”€â”€ main.ts
```

### 2.2 æ¨¡æ¿ç®¡ç†å™¨

```typescript
// src/utils/template.ts
import path from 'path';
import fs from 'fs-extra';
import ejs from 'ejs';

export interface TemplateConfig {
  name: string;
  description: string;
  dependencies?: Record<string, string>;
  devDependencies?: Record<string, string>;
  scripts?: Record<string, string>;
}

export class TemplateManager {
  private templatesDir: string;

  constructor() {
    this.templatesDir = path.resolve(__dirname, '../templates');
  }

  // è·å–æ‰€æœ‰å¯ç”¨æ¨¡æ¿
  async getAvailableTemplates(): Promise<string[]> {
    const entries = await fs.readdir(this.templatesDir);
    const templates: string[] = [];

    for (const entry of entries) {
      const entryPath = path.join(this.templatesDir, entry);
      const stat = await fs.stat(entryPath);
      if (stat.isDirectory()) {
        templates.push(entry);
      }
    }

    return templates;
  }

  // è·å–æ¨¡æ¿é…ç½®
  async getTemplateConfig(templateName: string): Promise<TemplateConfig | null> {
    const configPath = path.join(
      this.templatesDir,
      templateName,
      'template.config.json'
    );

    if (await fs.pathExists(configPath)) {
      return await fs.readJson(configPath);
    }

    return null;
  }

  // æ£€æŸ¥æ¨¡æ¿æ˜¯å¦å­˜åœ¨
  async templateExists(templateName: string): Promise<boolean> {
    const templatePath = path.join(this.templatesDir, templateName);
    return await fs.pathExists(templatePath);
  }

  // è·å–æ¨¡æ¿è·¯å¾„
  getTemplatePath(templateName: string): string {
    return path.join(this.templatesDir, templateName);
  }
}
```

---

## 3. æ¨¡æ¿å˜é‡æ³¨å…¥

### 3.1 å˜é‡å®šä¹‰

```typescript
// src/utils/variables.ts
export interface TemplateVariables {
  projectName: string;
  projectDescription?: string;
  author?: string;
  license?: string;
  version?: string;
  useTypeScript?: boolean;
  useESLint?: boolean;
  usePrettier?: boolean;
  useHusky?: boolean;
  packageManager?: 'npm' | 'yarn' | 'pnpm';
  [key: string]: any;
}

export function createTemplateVariables(
  projectName: string,
  options: any
): TemplateVariables {
  return {
    projectName,
    projectDescription: options.description || '',
    author: options.author || '',
    license: options.license || 'MIT',
    version: '1.0.0',
    useTypeScript: options.template?.includes('ts') || false,
    useESLint: options.features?.includes('eslint') || false,
    usePrettier: options.features?.includes('prettier') || false,
    useHusky: options.features?.includes('husky') || false,
    packageManager: options.packageManager || 'npm',
    ...options
  };
}
```

### 3.2 æ¨¡æ¿æ¸²æŸ“

```typescript
// src/utils/render.ts
import ejs from 'ejs';
import fs from 'fs-extra';
import path from 'path';

export async function renderTemplate(
  templatePath: string,
  targetPath: string,
  variables: Record<string, any>
): Promise<void> {
  const content = await fs.readFile(templatePath, 'utf-8');
  const rendered = ejs.render(content, variables, {
    filename: templatePath
  });

  // ç§»é™¤ .ejs æ‰©å±•å
  const targetFile = targetPath.replace(/\.ejs$/, '');
  await fs.ensureDir(path.dirname(targetFile));
  await fs.writeFile(targetFile, rendered);
}
```

---

## 4. åŠ¨æ€æ–‡ä»¶ç”Ÿæˆ

### 4.1 é€’å½’å¤„ç†æ¨¡æ¿ç›®å½•

```typescript
// src/utils/file.ts
import fs from 'fs-extra';
import path from 'path';
import { renderTemplate } from './render';

export async function copyTemplate(
  srcDir: string,
  targetDir: string,
  variables: Record<string, any>
): Promise<void> {
  await fs.ensureDir(targetDir);

  const entries = await fs.readdir(srcDir);

  for (const entry of entries) {
    // è·³è¿‡é…ç½®æ–‡ä»¶
    if (entry === 'template.config.json') {
      continue;
    }

    const srcPath = path.join(srcDir, entry);
    const targetPath = path.join(targetDir, entry);
    const stat = await fs.stat(srcPath);

    if (stat.isDirectory()) {
      await copyTemplate(srcPath, targetPath, variables);
    } else {
      // å¤„ç†æ¨¡æ¿æ–‡ä»¶
      if (entry.endsWith('.ejs')) {
        await renderTemplate(srcPath, targetPath, variables);
      } else {
        // æ™®é€šæ–‡ä»¶ç›´æ¥å¤åˆ¶
        await fs.copy(srcPath, targetPath);
      }
    }
  }
}
```

### 4.2 æ¡ä»¶æ–‡ä»¶ç”Ÿæˆ

```typescript
// æ ¹æ®é€‰é¡¹å†³å®šæ˜¯å¦ç”ŸæˆæŸäº›æ–‡ä»¶
export async function generateFiles(
  targetDir: string,
  variables: TemplateVariables
): Promise<void> {
  // åŸºç¡€æ–‡ä»¶
  await copyTemplate(templatePath, targetDir, variables);

  // æ¡ä»¶ç”Ÿæˆ ESLint é…ç½®
  if (variables.useESLint) {
    await generateESLintConfig(targetDir, variables);
  }

  // æ¡ä»¶ç”Ÿæˆ Prettier é…ç½®
  if (variables.usePrettier) {
    await generatePrettierConfig(targetDir, variables);
  }

  // æ¡ä»¶ç”Ÿæˆ Husky é…ç½®
  if (variables.useHusky) {
    await generateHuskyConfig(targetDir, variables);
  }
}
```

---

## 5. æ¨¡æ¿é…ç½®ç®¡ç†

### 5.1 æ¨¡æ¿é…ç½®æ–‡ä»¶

```json
// templates/react-ts/template.config.json
{
  "name": "react-ts",
  "description": "React + TypeScript é¡¹ç›®æ¨¡æ¿",
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0"
  },
  "devDependencies": {
    "@types/react": "^18.2.0",
    "@types/react-dom": "^18.2.0",
    "typescript": "^5.0.0",
    "vite": "^4.0.0",
    "@vitejs/plugin-react": "^4.0.0"
  },
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "features": ["typescript", "vite"]
}
```

### 5.2 ä½¿ç”¨æ¨¡æ¿é…ç½®

```typescript
// src/commands/create.ts
import { TemplateManager } from '../utils/template';

const templateManager = new TemplateManager();

export async function createCommand(projectName: string, options: any) {
  // è·å–æ¨¡æ¿é…ç½®
  const config = await templateManager.getTemplateConfig(options.template);
  
  if (config) {
    // åˆå¹¶ä¾èµ–
    const packageJson = {
      name: projectName,
      version: '1.0.0',
      dependencies: config.dependencies || {},
      devDependencies: config.devDependencies || {},
      scripts: config.scripts || {}
    };

    // ç”Ÿæˆ package.json
    await generatePackageJson(targetDir, packageJson);
  }

  // å¤åˆ¶æ¨¡æ¿æ–‡ä»¶
  const templatePath = templateManager.getTemplatePath(options.template);
  await copyTemplate(templatePath, targetDir, variables);
}
```

---

## 6. æ¨¡æ¿ç¤ºä¾‹

### 6.1 React + TypeScript æ¨¡æ¿

#### package.json.ejs

```ejs
{
  "name": "<%= projectName %>",
  "version": "1.0.0",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0"
  },
  "devDependencies": {
    "@types/react": "^18.2.0",
    "@types/react-dom": "^18.2.0",
    "@vitejs/plugin-react": "^4.0.0",
    "typescript": "^5.0.0",
    "vite": "^4.0.0"
    <% if (useESLint) { %>,
    "eslint": "^8.0.0",
    "@typescript-eslint/eslint-plugin": "^5.0.0",
    "@typescript-eslint/parser": "^5.0.0"
    <% } %>
    <% if (usePrettier) { %>,
    "prettier": "^2.8.0"
    <% } %>
  }
}
```

#### src/App.tsx.ejs

```ejs
import React from 'react';

function App() {
  return (
    <div className="App">
      <h1>Welcome to <%= projectName %></h1>
      <% if (projectDescription) { %>
      <p><%= projectDescription %></p>
      <% } %>
    </div>
  );
}

export default App;
```

#### tsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}
```

### 6.2 Vue + TypeScript æ¨¡æ¿

#### package.json.ejs

```ejs
{
  "name": "<%= projectName %>",
  "version": "1.0.0",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vue-tsc && vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "vue": "^3.3.0"
  },
  "devDependencies": {
    "@vitejs/plugin-vue": "^4.0.0",
    "typescript": "^5.0.0",
    "vite": "^4.0.0",
    "vue-tsc": "^1.8.0"
  }
}
```

#### src/App.vue.ejs

```vue
<template>
  <div class="app">
    <h1>{{ message }}</h1>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue';

const message = ref('Welcome to <%= projectName %>');
</script>

<style scoped>
.app {
  text-align: center;
}
</style>
```

---

## ğŸ“ æ€»ç»“

### æ ¸å¿ƒåŠŸèƒ½

1. âœ… æ¨¡æ¿å¼•æ“é›†æˆï¼ˆEJSï¼‰
2. âœ… å¤šæ¨¡æ¿æ”¯æŒï¼ˆReactã€Vueã€TypeScriptï¼‰
3. âœ… å˜é‡æ³¨å…¥å’Œæ¡ä»¶æ¸²æŸ“
4. âœ… åŠ¨æ€æ–‡ä»¶ç”Ÿæˆ
5. âœ… æ¨¡æ¿é…ç½®ç®¡ç†

### ä¸‹ä¸€æ­¥

- [æ’ä»¶ç³»ç»Ÿå®ç°](./04-æ’ä»¶ç³»ç»Ÿå®ç°.md) - å®ç°æ’ä»¶æœºåˆ¶ï¼Œæ‰©å±•è„šæ‰‹æ¶åŠŸèƒ½

---

#è„šæ‰‹æ¶ #å‰ç«¯å·¥ç¨‹åŒ– #æ¨¡æ¿ç³»ç»Ÿ #EJS #TypeScript

