# å¸¸è§é—®é¢˜æ’æŸ¥

> åœ¨ä½¿ç”¨ Webpack çš„è¿‡ç¨‹ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°å„ç§é—®é¢˜ã€‚æœ¬ç« æ•´ç†å¸¸è§é—®é¢˜åŠå…¶è§£å†³æ–¹æ¡ˆï¼Œå¸®åŠ©ä½ å¿«é€Ÿè§£å†³é—®é¢˜ã€‚

---

## ğŸ“‹ å¸¸è§é—®é¢˜

- [è·¯å¾„è§£æé—®é¢˜](#è·¯å¾„è§£æé—®é¢˜)
- [ä¾èµ–å†²çª](#ä¾èµ–å†²çª)
- [æ„å»ºé€Ÿåº¦æ…¢](#æ„å»ºé€Ÿåº¦æ…¢)
- [å†…å­˜æº¢å‡º](#å†…å­˜æº¢å‡º)
- [æ ·å¼ä¸ç”Ÿæ•ˆ](#æ ·å¼ä¸ç”Ÿæ•ˆ)
- [çƒ­æ›´æ–°ä¸å·¥ä½œ](#çƒ­æ›´æ–°ä¸å·¥ä½œ)
- [æ‰“åŒ…æ–‡ä»¶è¿‡å¤§](#æ‰“åŒ…æ–‡ä»¶è¿‡å¤§)

---

## è·¯å¾„è§£æé—®é¢˜

### é—®é¢˜ï¼šModule not found

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Module not found: Error: Can't resolve './components/Button'
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **æ£€æŸ¥è·¯å¾„æ˜¯å¦æ­£ç¡®**
```javascript
// âŒ é”™è¯¯
import Button from './components/Button'

// âœ… æ­£ç¡®
import Button from './components/Button.js'
// æˆ–é…ç½® extensions
```

2. **é…ç½® resolve.extensions**
```javascript
module.exports = {
  resolve: {
    extensions: ['.js', '.jsx', '.json', '.ts', '.tsx']
  }
}
```

3. **é…ç½®è·¯å¾„åˆ«å**
```javascript
module.exports = {
  resolve: {
    alias: {
      '@': path.resolve(__dirname, 'src'),
      '@components': path.resolve(__dirname, 'src/components')
    }
  }
}
```

---

## ä¾èµ–å†²çª

### é—®é¢˜ï¼šå¤šä¸ªç‰ˆæœ¬çš„åŒä¸€ä¾èµ–

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Module not found: Can't resolve 'react'
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **ä½¿ç”¨ resolve.alias å¼ºåˆ¶ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬**
```javascript
module.exports = {
  resolve: {
    alias: {
      'react': path.resolve(__dirname, 'node_modules/react')
    }
  }
}
```

2. **æ£€æŸ¥ package.json**
```bash
npm ls react
```

3. **ä½¿ç”¨ npm dedupe**
```bash
npm dedupe
```

4. **åˆ é™¤ node_modules é‡æ–°å®‰è£…**
```bash
rm -rf node_modules package-lock.json
npm install
```

---

## æ„å»ºé€Ÿåº¦æ…¢

### é—®é¢˜ï¼šæ„å»ºæ—¶é—´è¿‡é•¿

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **å¯ç”¨ç¼“å­˜**
```javascript
module.exports = {
  cache: {
    type: 'filesystem'
  }
}
```

2. **å‡å°‘è§£æèŒƒå›´**
```javascript
module.exports = {
  resolve: {
    modules: [path.resolve(__dirname, 'src'), 'node_modules']
  },
  module: {
    rules: [
      {
        test: /\.js$/,
        include: path.resolve(__dirname, 'src'),
        exclude: /node_modules/
      }
    ]
  }
}
```

3. **ä½¿ç”¨å¤šè¿›ç¨‹**
```javascript
const TerserPlugin = require('terser-webpack-plugin')

module.exports = {
  optimization: {
    minimizer: [
      new TerserPlugin({
        parallel: true
      })
    ]
  }
}
```

4. **ä½¿ç”¨ DllPlugin**
å‚è€ƒ [æ€§èƒ½ä¼˜åŒ–](./09-æ€§èƒ½ä¼˜åŒ–.md) ç« èŠ‚ã€‚

---

## å†…å­˜æº¢å‡º

### é—®é¢˜ï¼šJavaScript heap out of memory

**é”™è¯¯ä¿¡æ¯**ï¼š
```
FATAL ERROR: Reached heap limit Allocation failed - JavaScript heap out of memory
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **å¢åŠ  Node.js å†…å­˜é™åˆ¶**
```bash
node --max-old-space-size=4096 node_modules/.bin/webpack
```

2. **ä¿®æ”¹ package.json**
```json
{
  "scripts": {
    "build": "node --max-old-space-size=4096 node_modules/.bin/webpack"
  }
}
```

3. **ä¼˜åŒ–é…ç½®**
- å‡å°‘å…¥å£æ–‡ä»¶
- ä½¿ç”¨ä»£ç åˆ†å‰²
- æ’é™¤ä¸å¿…è¦çš„æ–‡ä»¶

---

## æ ·å¼ä¸ç”Ÿæ•ˆ

### é—®é¢˜ï¼šCSS æ ·å¼æœªåŠ è½½

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **æ£€æŸ¥ Loader é…ç½®é¡ºåº**
```javascript
// âœ… æ­£ç¡®é¡ºåº
use: ['style-loader', 'css-loader', 'sass-loader']
```

2. **æ£€æŸ¥ sideEffects é…ç½®**
```json
{
  "sideEffects": ["*.css", "*.scss"]
}
```

3. **ä½¿ç”¨ MiniCssExtractPlugin**
```javascript
const MiniCssExtractPlugin = require('mini-css-extract-plugin')

module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [MiniCssExtractPlugin.loader, 'css-loader']
      }
    ]
  },
  plugins: [
    new MiniCssExtractPlugin()
  ]
}
```

4. **æ£€æŸ¥ CSS Modules é…ç½®**
```javascript
{
  loader: 'css-loader',
  options: {
    modules: {
      localIdentName: '[name]__[local]__[hash:base64:5]'
    }
  }
}
```

---

## çƒ­æ›´æ–°ä¸å·¥ä½œ

### é—®é¢˜ï¼šHMR ä¸ç”Ÿæ•ˆ

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **æ£€æŸ¥ devServer é…ç½®**
```javascript
module.exports = {
  devServer: {
    hot: true
  },
  plugins: [
    new webpack.HotModuleReplacementPlugin()
  ]
}
```

2. **React HMR**
```bash
npm install --save-dev @pmmmwh/react-refresh-webpack-plugin
```

```javascript
const ReactRefreshWebpackPlugin = require('@pmmmwh/react-refresh-webpack-plugin')

module.exports = {
  module: {
    rules: [
      {
        test: /\.(js|jsx)$/,
        use: {
          loader: 'babel-loader',
          options: {
            plugins: ['react-refresh/babel']
          }
        }
      }
    ]
  },
  plugins: [
    new ReactRefreshWebpackPlugin()
  ]
}
```

3. **æ£€æŸ¥æ–‡ä»¶ç›‘å¬**
```javascript
module.exports = {
  watchOptions: {
    ignored: /node_modules/
  }
}
```

---

## æ‰“åŒ…æ–‡ä»¶è¿‡å¤§

### é—®é¢˜ï¼šæ‰“åŒ…åçš„æ–‡ä»¶ä½“ç§¯è¿‡å¤§

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **å¯ç”¨ä»£ç åˆ†å‰²**
```javascript
module.exports = {
  optimization: {
    splitChunks: {
      chunks: 'all'
    }
  }
}
```

2. **ä½¿ç”¨ Tree Shaking**
```javascript
module.exports = {
  mode: 'production',
  optimization: {
    usedExports: true,
    sideEffects: false
  }
}
```

3. **å‹ç¼©ä»£ç **
```javascript
const TerserPlugin = require('terser-webpack-plugin')

module.exports = {
  optimization: {
    minimize: true,
    minimizer: [new TerserPlugin()]
  }
}
```

4. **ä½¿ç”¨ externals**
```javascript
module.exports = {
  externals: {
    'react': 'React',
    'react-dom': 'ReactDOM'
  }
}
```

5. **åˆ†ææ‰“åŒ…ç»“æœ**
```bash
npm install --save-dev webpack-bundle-analyzer
```

```javascript
const BundleAnalyzerPlugin = require('webpack-bundle-analyzer').BundleAnalyzerPlugin

module.exports = {
  plugins: [
    new BundleAnalyzerPlugin()
  ]
}
```

---

## å…¶ä»–å¸¸è§é—®é¢˜

### Source Map ä¸å·¥ä½œ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```javascript
module.exports = {
  devtool: 'source-map'  // æˆ– 'eval-source-map'
}
```

### å›¾ç‰‡è·¯å¾„é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
```javascript
module.exports = {
  output: {
    publicPath: '/'  // æˆ– CDN è·¯å¾„
  }
}
```

### TypeScript ç±»å‹é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ `tsconfig.json` é…ç½®
2. ç¡®ä¿å®‰è£…äº†ç±»å‹å®šä¹‰
3. æ£€æŸ¥ `@types` åŒ…ç‰ˆæœ¬

### ç«¯å£è¢«å ç”¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
```javascript
module.exports = {
  devServer: {
    port: 3001  // æ›´æ¢ç«¯å£
  }
}
```

---

## è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯

```bash
webpack --stats verbose
```

### 2. ä½¿ç”¨ webpack-bundle-analyzer

```bash
npm run build -- --analyze
```

### 3. æ£€æŸ¥é…ç½®

```javascript
console.log(JSON.stringify(config, null, 2))
```

### 4. ä½¿ç”¨ Speed Measure Plugin

```javascript
const SpeedMeasurePlugin = require('speed-measure-webpack-plugin')
const smp = new SpeedMeasurePlugin()

module.exports = smp.wrap({
  // é…ç½®
})
```

---

## æ€»ç»“

- **è·¯å¾„é—®é¢˜**ï¼šæ£€æŸ¥è·¯å¾„ã€é…ç½® alias å’Œ extensions
- **ä¾èµ–å†²çª**ï¼šä½¿ç”¨ alias æˆ–é‡æ–°å®‰è£…
- **æ„å»ºé€Ÿåº¦**ï¼šå¯ç”¨ç¼“å­˜ã€å¤šè¿›ç¨‹ã€å‡å°‘è§£æèŒƒå›´
- **å†…å­˜æº¢å‡º**ï¼šå¢åŠ å†…å­˜é™åˆ¶æˆ–ä¼˜åŒ–é…ç½®
- **æ ·å¼é—®é¢˜**ï¼šæ£€æŸ¥ Loader é¡ºåºå’Œ sideEffects
- **çƒ­æ›´æ–°**ï¼šæ£€æŸ¥é…ç½®å’Œæ’ä»¶
- **æ–‡ä»¶è¿‡å¤§**ï¼šä»£ç åˆ†å‰²ã€Tree Shakingã€å‹ç¼©

---

## ä¸‹ä¸€æ­¥

- [æœ€ä½³å®è·µ](./14-æœ€ä½³å®è·µ.md) - å­¦ä¹ æœ€ä½³å®è·µ
- [æ€§èƒ½ä¼˜åŒ–](./09-æ€§èƒ½ä¼˜åŒ–.md) - æ·±å…¥å­¦ä¹ æ€§èƒ½ä¼˜åŒ–

---

#Webpack #é—®é¢˜æ’æŸ¥ #è°ƒè¯• #å¸¸è§é”™è¯¯

