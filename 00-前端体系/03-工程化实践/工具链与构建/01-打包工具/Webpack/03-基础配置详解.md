# åŸºç¡€é…ç½®è¯¦è§£

> æ·±å…¥å­¦ä¹  Webpack çš„åŸºç¡€é…ç½®é€‰é¡¹ï¼ŒåŒ…æ‹¬ Entryã€Outputã€Resolve ç­‰é…ç½®çš„è¯¦ç»†è¯´æ˜å’Œæœ€ä½³å®è·µã€‚

---

## ğŸ“‹ å­¦ä¹ ç›®æ ‡

- âœ… ç†è§£å®Œæ•´çš„é…ç½®ç»“æ„
- âœ… æŒæ¡ Entry çš„å„ç§é…ç½®æ–¹å¼
- âœ… æŒæ¡ Output çš„è¯¦ç»†é…ç½®
- âœ… ç†è§£ Resolve é…ç½®ï¼ˆè·¯å¾„è§£æï¼‰
- âœ… å­¦ä¼šç¯å¢ƒå˜é‡é…ç½®

---

## å®Œæ•´é…ç½®ç»“æ„

### åŸºç¡€é…ç½®æ¨¡æ¿

```javascript
const path = require('path')

module.exports = {
  // å…¥å£é…ç½®
  entry: './src/index.js',
  
  // è¾“å‡ºé…ç½®
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: 'bundle.js'
  },
  
  // æ¨¡å¼
  mode: 'development',
  
  // æ¨¡å—å¤„ç†
  module: {
    rules: []
  },
  
  // æ’ä»¶
  plugins: [],
  
  // è§£æé…ç½®
  resolve: {
    extensions: ['.js', '.json'],
    alias: {}
  },
  
  // å¼€å‘æœåŠ¡å™¨
  devServer: {},
  
  // ä¼˜åŒ–é…ç½®
  optimization: {}
}
```

---

## Entry é…ç½®è¯¦è§£

### 1. å•å…¥å£ï¼ˆå­—ç¬¦ä¸²ï¼‰

```javascript
module.exports = {
  entry: './src/index.js'
}
```

**é€‚ç”¨åœºæ™¯**ï¼šå•é¡µé¢åº”ç”¨ï¼ˆSPAï¼‰

### 2. å¤šå…¥å£ï¼ˆå¯¹è±¡ï¼‰

```javascript
module.exports = {
  entry: {
    main: './src/index.js',
    vendor: './src/vendor.js',
    admin: './src/admin.js'
  }
}
```

**é€‚ç”¨åœºæ™¯**ï¼š
- éœ€è¦åˆ†ç¦»ç¬¬ä¸‰æ–¹åº“ä»£ç 
- å¤šé¡µé¢åº”ç”¨
- éœ€è¦ç‹¬ç«‹çš„å…¥å£ç‚¹

### 3. åŠ¨æ€å…¥å£ï¼ˆå‡½æ•°ï¼‰

```javascript
module.exports = {
  entry: () => {
    return './src/index.js'
  }
}
```

**é«˜çº§ç”¨æ³•**ï¼šæ ¹æ®æ¡ä»¶åŠ¨æ€å†³å®šå…¥å£

```javascript
module.exports = {
  entry: () => {
    return new Promise((resolve) => {
      // åŠ¨æ€å†³å®šå…¥å£
      const entry = process.env.NODE_ENV === 'production'
        ? './src/index.prod.js'
        : './src/index.dev.js'
      resolve(entry)
    })
  }
}
```

### 4. æ•°ç»„å…¥å£

```javascript
module.exports = {
  entry: ['./src/index.js', './src/polyfills.js']
}
```

**è¯´æ˜**ï¼šå¤šä¸ªæ–‡ä»¶ä¼šæ‰“åŒ…åˆ°ä¸€ä¸ª chunk ä¸­

---

## Output é…ç½®è¯¦è§£

### åŸºç¡€é…ç½®

```javascript
const path = require('path')

module.exports = {
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: 'bundle.js'
  }
}
```

### å®Œæ•´é…ç½®é€‰é¡¹

```javascript
const path = require('path')

module.exports = {
  output: {
    // è¾“å‡ºç›®å½•ï¼ˆå¿…é¡»æ˜¯ç»å¯¹è·¯å¾„ï¼‰
    path: path.resolve(__dirname, 'dist'),
    
    // è¾“å‡ºæ–‡ä»¶åï¼ˆå•å…¥å£ï¼‰
    filename: 'bundle.js',
    
    // è¾“å‡ºæ–‡ä»¶åï¼ˆå¤šå…¥å£ï¼Œä½¿ç”¨å ä½ç¬¦ï¼‰
    filename: '[name].bundle.js',
    
    // éå…¥å£ chunk çš„æ–‡ä»¶å
    chunkFilename: '[name].chunk.js',
    
    // å…¬å…±è·¯å¾„ï¼ˆCDN è·¯å¾„ï¼‰
    publicPath: '/',
    
    // æ¸…ç†è¾“å‡ºç›®å½•
    clean: true,
    
    // èµ„æºæ¨¡å—çš„æ–‡ä»¶å
    assetModuleFilename: 'assets/[hash][ext]',
    
    // è¾“å‡ºåº“çš„é…ç½®ï¼ˆç”¨äºåº“å¼€å‘ï¼‰
    library: {
      name: 'MyLibrary',
      type: 'umd'
    }
  }
}
```

### æ–‡ä»¶åå ä½ç¬¦

```javascript
module.exports = {
  output: {
    filename: '[name].[contenthash:8].js'
  }
}
```

**å¯ç”¨å ä½ç¬¦**ï¼š
- `[name]` - chunk åç§°
- `[id]` - chunk ID
- `[hash]` - æ•´ä¸ªé¡¹ç›®çš„ hash
- `[chunkhash]` - chunk çš„ hash
- `[contenthash]` - å†…å®¹çš„ hashï¼ˆæ¨èï¼‰
- `[fullhash]` - å®Œæ•´ hash

**Hash é•¿åº¦**ï¼š`[contenthash:8]` è¡¨ç¤ºåªå–å‰ 8 ä½

### å¤šå…¥å£è¾“å‡ºé…ç½®

```javascript
module.exports = {
  entry: {
    main: './src/index.js',
    vendor: './src/vendor.js'
  },
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: 'js/[name].[contenthash].js',
    chunkFilename: 'js/[name].[contenthash].chunk.js'
  }
}
```

**è¾“å‡ºç»“æœ**ï¼š
- `dist/js/main.abc123.js`
- `dist/js/vendor.def456.js`

---

## Resolve é…ç½®ï¼ˆè·¯å¾„è§£æï¼‰

Resolve é…ç½®å‘Šè¯‰ Webpack å¦‚ä½•è§£ææ¨¡å—è·¯å¾„ã€‚

### åŸºç¡€é…ç½®

```javascript
module.exports = {
  resolve: {
    // è‡ªåŠ¨è§£æçš„æ‰©å±•å
    extensions: ['.js', '.json', '.jsx', '.ts', '.tsx'],
    
    // è·¯å¾„åˆ«å
    alias: {
      '@': path.resolve(__dirname, 'src'),
      '@components': path.resolve(__dirname, 'src/components'),
      '@utils': path.resolve(__dirname, 'src/utils')
    },
    
    // æ¨¡å—æŸ¥æ‰¾ç›®å½•
    modules: [
      path.resolve(__dirname, 'src'),
      'node_modules'
    ]
  }
}
```

### extensions é…ç½®

```javascript
module.exports = {
  resolve: {
    extensions: ['.js', '.jsx', '.ts', '.tsx']
  }
}
```

**è¯´æ˜**ï¼šé…ç½®åå¯ä»¥çœç•¥æ–‡ä»¶æ‰©å±•å
```javascript
// å¯ä»¥è¿™æ ·å¯¼å…¥
import App from './App'  // è‡ªåŠ¨æŸ¥æ‰¾ App.js, App.jsx, App.ts, App.tsx
```

### alias é…ç½®ï¼ˆè·¯å¾„åˆ«åï¼‰

```javascript
module.exports = {
  resolve: {
    alias: {
      '@': path.resolve(__dirname, 'src'),
      '@components': path.resolve(__dirname, 'src/components'),
      '@utils': path.resolve(__dirname, 'src/utils'),
      '@assets': path.resolve(__dirname, 'src/assets')
    }
  }
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```javascript
// ä½¿ç”¨åˆ«å
import Button from '@components/Button'
import { formatDate } from '@utils/date'
import logo from '@assets/logo.png'

// è€Œä¸æ˜¯
import Button from '../../../components/Button'
```

### modules é…ç½®

```javascript
module.exports = {
  resolve: {
    modules: [
      path.resolve(__dirname, 'src'),  // ä¼˜å…ˆæŸ¥æ‰¾ src ç›®å½•
      'node_modules'                    // ç„¶åæŸ¥æ‰¾ node_modules
    ]
  }
}
```

**è¯´æ˜**ï¼šé…ç½®åå¯ä»¥ç›´æ¥ä» src ç›®å½•å¯¼å…¥
```javascript
// å¯ä»¥ç›´æ¥è¿™æ ·å¯¼å…¥
import utils from 'utils'  // è‡ªåŠ¨ä» src/utils æŸ¥æ‰¾
```

### å®Œæ•´ Resolve é…ç½®ç¤ºä¾‹

```javascript
const path = require('path')

module.exports = {
  resolve: {
    extensions: ['.tsx', '.ts', '.js', '.jsx', '.json'],
    alias: {
      '@': path.resolve(__dirname, 'src'),
      '@components': path.resolve(__dirname, 'src/components'),
      '@utils': path.resolve(__dirname, 'src/utils'),
      '@styles': path.resolve(__dirname, 'src/styles'),
      '@assets': path.resolve(__dirname, 'src/assets')
    },
    modules: [
      path.resolve(__dirname, 'src'),
      'node_modules'
    ],
    // è§£æåŒ…çš„ä¸»å…¥å£
    mainFields: ['browser', 'module', 'main'],
    // è§£æåŒ…çš„ä¸»æ–‡ä»¶
    mainFiles: ['index']
  }
}
```

---

## ç¯å¢ƒå˜é‡é…ç½®

### ä½¿ç”¨ DefinePlugin

```javascript
const webpack = require('webpack')

module.exports = {
  plugins: [
    new webpack.DefinePlugin({
      'process.env.NODE_ENV': JSON.stringify('production'),
      'process.env.API_URL': JSON.stringify('https://api.example.com')
    })
  ]
}
```

### ä½¿ç”¨ dotenv

```bash
npm install --save-dev dotenv-webpack
```

**åˆ›å»º .env æ–‡ä»¶**ï¼š
```bash
# .env
NODE_ENV=development
API_URL=http://localhost:8080
```

**é…ç½® webpack**ï¼š
```javascript
const Dotenv = require('dotenv-webpack')

module.exports = {
  plugins: [
    new Dotenv({
      path: '.env',  // é»˜è®¤æ˜¯ .env
      safe: false,   // å¦‚æœ .env.example å­˜åœ¨ï¼Œä½¿ç”¨å®ƒä½œä¸ºæ¨¡æ¿
      systemvars: true  // åŠ è½½ç³»ç»Ÿå˜é‡
    })
  ]
}
```

### å¤šç¯å¢ƒé…ç½®

**åˆ›å»ºä¸åŒç¯å¢ƒçš„ .env æ–‡ä»¶**ï¼š
- `.env.development`
- `.env.production`
- `.env.test`

**webpack.config.js**ï¼š
```javascript
const Dotenv = require('dotenv-webpack')
const path = require('path')

module.exports = (env) => {
  const envFile = `.env.${env.NODE_ENV || 'development'}`
  
  return {
    plugins: [
      new Dotenv({
        path: path.resolve(__dirname, envFile)
      })
    ]
  }
}
```

---

## å…¶ä»–é‡è¦é…ç½®

### Context é…ç½®

```javascript
module.exports = {
  context: path.resolve(__dirname, 'src'),
  entry: './index.js'  // ç›¸å¯¹äº context
}
```

### Target é…ç½®

```javascript
module.exports = {
  target: 'web',  // é»˜è®¤å€¼ï¼Œç”¨äºæµè§ˆå™¨
  // target: 'node',  // ç”¨äº Node.js
  // target: 'electron-main',  // ç”¨äº Electron ä¸»è¿›ç¨‹
}
```

### Externals é…ç½®

```javascript
module.exports = {
  externals: {
    jquery: 'jQuery',  // ä» CDN å¼•å…¥ï¼Œä¸æ‰“åŒ…
    react: 'React',
    'react-dom': 'ReactDOM'
  }
}
```

---

## é…ç½®æœ€ä½³å®è·µ

### 1. ä½¿ç”¨å‡½æ•°å¼é…ç½®

```javascript
module.exports = (env, argv) => {
  const isProduction = argv.mode === 'production'
  
  return {
    mode: isProduction ? 'production' : 'development',
    output: {
      filename: isProduction
        ? '[name].[contenthash].js'
        : '[name].js'
    }
  }
}
```

### 2. åˆ†ç¦»é…ç½®æ–‡ä»¶

**webpack.common.js**ï¼š
```javascript
const path = require('path')
const HtmlWebpackPlugin = require('html-webpack-plugin')

module.exports = {
  entry: './src/index.js',
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: '[name].js'
  },
  plugins: [
    new HtmlWebpackPlugin({
      template: './src/index.html'
    })
  ]
}
```

**webpack.dev.js**ï¼š
```javascript
const { merge } = require('webpack-merge')
const common = require('./webpack.common.js')

module.exports = merge(common, {
  mode: 'development',
  devtool: 'eval-source-map'
})
```

**webpack.prod.js**ï¼š
```javascript
const { merge } = require('webpack-merge')
const common = require('./webpack.common.js')

module.exports = merge(common, {
  mode: 'production',
  devtool: 'source-map'
})
```

### 3. ä½¿ç”¨ç¯å¢ƒå˜é‡

```javascript
module.exports = (env) => {
  return {
    output: {
      publicPath: env.production
        ? 'https://cdn.example.com/'
        : '/'
    }
  }
}
```

---

## å®Œæ•´é…ç½®ç¤ºä¾‹

```javascript
const path = require('path')
const HtmlWebpackPlugin = require('html-webpack-plugin')
const webpack = require('webpack')

module.exports = (env, argv) => {
  const isProduction = argv.mode === 'production'
  
  return {
    entry: './src/index.js',
    
    output: {
      path: path.resolve(__dirname, 'dist'),
      filename: isProduction
        ? 'js/[name].[contenthash:8].js'
        : 'js/[name].js',
      chunkFilename: isProduction
        ? 'js/[name].[contenthash:8].chunk.js'
        : 'js/[name].chunk.js',
      publicPath: '/',
      clean: true
    },
    
    mode: isProduction ? 'production' : 'development',
    
    resolve: {
      extensions: ['.js', '.jsx', '.json'],
      alias: {
        '@': path.resolve(__dirname, 'src')
      },
      modules: [
        path.resolve(__dirname, 'src'),
        'node_modules'
      ]
    },
    
    plugins: [
      new HtmlWebpackPlugin({
        template: './src/index.html'
      }),
      new webpack.DefinePlugin({
        'process.env.NODE_ENV': JSON.stringify(argv.mode)
      })
    ]
  }
}
```

---

## æ€»ç»“

- **Entry**ï¼šæ”¯æŒå­—ç¬¦ä¸²ã€å¯¹è±¡ã€å‡½æ•°ç­‰å¤šç§é…ç½®æ–¹å¼
- **Output**ï¼šä½¿ç”¨å ä½ç¬¦å®ç°çµæ´»çš„æ–‡ä»¶å‘½å
- **Resolve**ï¼šé…ç½®è·¯å¾„åˆ«åå’Œæ‰©å±•åï¼Œç®€åŒ–å¯¼å…¥
- **ç¯å¢ƒå˜é‡**ï¼šä½¿ç”¨ DefinePlugin æˆ– dotenv ç®¡ç†ç¯å¢ƒå˜é‡
- **æœ€ä½³å®è·µ**ï¼šåˆ†ç¦»é…ç½®ã€ä½¿ç”¨å‡½æ•°å¼é…ç½®

---

## ä¸‹ä¸€æ­¥

- [Loader è¯¦è§£](./04-Loaderè¯¦è§£.md) - å­¦ä¹ å¦‚ä½•å¤„ç†å„ç§èµ„æº
- [Plugin è¯¦è§£](./05-Pluginè¯¦è§£.md) - å­¦ä¹ æ’ä»¶çš„ä½¿ç”¨
- [å¼€å‘ç¯å¢ƒé…ç½®](./06-å¼€å‘ç¯å¢ƒé…ç½®.md) - é…ç½®å¼€å‘ç¯å¢ƒ

---

#Webpack #åŸºç¡€é…ç½® #Entry #Output #Resolve #ç¯å¢ƒå˜é‡

