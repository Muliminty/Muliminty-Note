# ä»£ç åˆ†å‰²

> ä»£ç åˆ†å‰²æ˜¯ä¼˜åŒ–åº”ç”¨æ€§èƒ½çš„é‡è¦æ‰‹æ®µã€‚æœ¬ç« ä»‹ç»ä¸ºä»€ä¹ˆéœ€è¦ä»£ç åˆ†å‰²ï¼Œä»¥åŠå¦‚ä½•é€šè¿‡ Entry åˆ†å‰²ã€SplitChunks å’ŒåŠ¨æ€å¯¼å…¥å®ç°ä»£ç åˆ†å‰²ã€‚

---

## ğŸ“‹ å­¦ä¹ ç›®æ ‡

- âœ… ç†è§£ä¸ºä»€ä¹ˆéœ€è¦ä»£ç åˆ†å‰²
- âœ… æŒæ¡ Entry åˆ†å‰²
- âœ… æŒæ¡ SplitChunks é…ç½®
- âœ… å­¦ä¼šä½¿ç”¨åŠ¨æ€å¯¼å…¥
- âœ… ç†è§£æ‡’åŠ è½½å’Œé¢„åŠ è½½

---

## ä¸ºä»€ä¹ˆéœ€è¦ä»£ç åˆ†å‰²

### é—®é¢˜

å°†æ‰€æœ‰ä»£ç æ‰“åŒ…åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ä¼šå¯¼è‡´ï¼š
- æ–‡ä»¶ä½“ç§¯è¿‡å¤§
- é¦–æ¬¡åŠ è½½æ—¶é—´é•¿
- æ— æ³•åˆ©ç”¨æµè§ˆå™¨ç¼“å­˜
- ç”¨æˆ·ä½“éªŒå·®

### è§£å†³æ–¹æ¡ˆ

ä»£ç åˆ†å‰²å¯ä»¥å°†ä»£ç æ‹†åˆ†æˆå¤šä¸ªå°æ–‡ä»¶ï¼š
- æŒ‰éœ€åŠ è½½
- å¹¶è¡ŒåŠ è½½
- åˆ©ç”¨æµè§ˆå™¨ç¼“å­˜
- æå‡åŠ è½½é€Ÿåº¦

---

## Entry åˆ†å‰²

### åŸºç¡€åˆ†å‰²

```javascript
module.exports = {
  entry: {
    main: './src/index.js',
    vendor: './src/vendor.js'
  },
  output: {
    filename: '[name].bundle.js'
  }
}
```

### åˆ†ç¦»ç¬¬ä¸‰æ–¹åº“

```javascript
module.exports = {
  entry: {
    main: './src/index.js',
    vendor: ['react', 'react-dom', 'lodash']
  }
}
```

**é—®é¢˜**ï¼šæ‰‹åŠ¨ç»´æŠ¤ï¼Œå®¹æ˜“å‡ºé”™

---

## SplitChunks è‡ªåŠ¨åˆ†å‰²

### åŸºç¡€é…ç½®

```javascript
module.exports = {
  optimization: {
    splitChunks: {
      chunks: 'all'
    }
  }
}
```

### å®Œæ•´é…ç½®

```javascript
module.exports = {
  optimization: {
    splitChunks: {
      chunks: 'all',  // 'initial' | 'async' | 'all'
      minSize: 20000,  // æœ€å° chunk å¤§å°ï¼ˆå­—èŠ‚ï¼‰
      maxSize: 0,  // æœ€å¤§ chunk å¤§å°
      minChunks: 1,  // æœ€å°å¼•ç”¨æ¬¡æ•°
      maxAsyncRequests: 30,  // æœ€å¤§å¼‚æ­¥è¯·æ±‚æ•°
      maxInitialRequests: 30,  // æœ€å¤§åˆå§‹è¯·æ±‚æ•°
      cacheGroups: {
        default: {
          minChunks: 2,
          priority: -20,
          reuseExistingChunk: true
        },
        vendor: {
          test: /[\\/]node_modules[\\/]/,
          name: 'vendors',
          priority: -10,
          reuseExistingChunk: true
        }
      }
    }
  }
}
```

### chunks é€‰é¡¹

- `'initial'`ï¼šåªåˆ†å‰²åˆå§‹ chunk
- `'async'`ï¼šåªåˆ†å‰²å¼‚æ­¥ chunkï¼ˆåŠ¨æ€å¯¼å…¥ï¼‰
- `'all'`ï¼šåˆ†å‰²æ‰€æœ‰ chunkï¼ˆæ¨èï¼‰

### cacheGroups é…ç½®

```javascript
module.exports = {
  optimization: {
    splitChunks: {
      cacheGroups: {
        // é»˜è®¤ç»„
        default: {
          minChunks: 2,
          priority: -20,
          reuseExistingChunk: true
        },
        
        // ç¬¬ä¸‰æ–¹åº“
        vendor: {
          test: /[\\/]node_modules[\\/]/,
          name: 'vendors',
          priority: 10,
          chunks: 'all'
        },
        
        // å…¬å…±ä»£ç 
        common: {
          minChunks: 2,
          priority: 5,
          reuseExistingChunk: true
        },
        
        // React ç›¸å…³
        react: {
          test: /[\\/]node_modules[\\/](react|react-dom)[\\/]/,
          name: 'react',
          priority: 20,
          chunks: 'all'
        }
      }
    }
  }
}
```

---

## åŠ¨æ€å¯¼å…¥ï¼ˆDynamic Importï¼‰

### åŸºç¡€ç”¨æ³•

```javascript
// åŠ¨æ€å¯¼å…¥
import('./module').then(module => {
  module.doSomething()
})
```

### React æ‡’åŠ è½½

```javascript
import React, { lazy, Suspense } from 'react'

const Home = lazy(() => import('./pages/Home'))
const About = lazy(() => import('./pages/About'))

function App() {
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <Routes>
        <Route path="/" element={<Home />} />
        <Route path="/about" element={<About />} />
      </Routes>
    </Suspense>
  )
}
```

### Vue æ‡’åŠ è½½

```javascript
const routes = [
  {
    path: '/home',
    component: () => import('./pages/Home.vue')
  },
  {
    path: '/about',
    component: () => import('./pages/About.vue')
  }
]
```

---

## é¢„åŠ è½½å’Œé¢„è·å–

### é¢„åŠ è½½ï¼ˆPreloadï¼‰

```javascript
// é«˜ä¼˜å…ˆçº§ï¼Œç«‹å³åŠ è½½
import(/* webpackPreload: true */ './module')
```

### é¢„è·å–ï¼ˆPrefetchï¼‰

```javascript
// ä½ä¼˜å…ˆçº§ï¼Œç©ºé—²æ—¶åŠ è½½
import(/* webpackPrefetch: true */ './module')
```

### ä½¿ç”¨åœºæ™¯

**é¢„åŠ è½½**ï¼šå…³é”®èµ„æºï¼Œéœ€è¦ç«‹å³ä½¿ç”¨
```javascript
// ç”¨æˆ·ç‚¹å‡»æŒ‰é’®åç«‹å³éœ€è¦
button.onclick = () => {
  import(/* webpackPreload: true */ './dialog')
}
```

**é¢„è·å–**ï¼šå¯èƒ½éœ€è¦çš„èµ„æº
```javascript
// è·¯ç”±æ‡’åŠ è½½ï¼Œé¢„è·å–ä¸‹ä¸€ä¸ªé¡µé¢
const Home = lazy(() => import(/* webpackPrefetch: true */ './pages/Home'))
```

---

## ä»£ç åˆ†å‰²ç­–ç•¥

### ç­–ç•¥ä¸€ï¼šæŒ‰æ¡†æ¶åˆ†ç¦»

```javascript
module.exports = {
  optimization: {
    splitChunks: {
      cacheGroups: {
        framework: {
          test: /[\\/]node_modules[\\/](react|react-dom|react-router)[\\/]/,
          name: 'framework',
          priority: 40,
          chunks: 'all'
        }
      }
    }
  }
}
```

### ç­–ç•¥äºŒï¼šæŒ‰åŠŸèƒ½åˆ†ç¦»

```javascript
module.exports = {
  optimization: {
    splitChunks: {
      cacheGroups: {
        utils: {
          test: /[\\/]src[\\/]utils[\\/]/,
          name: 'utils',
          priority: 10,
          chunks: 'all'
        },
        components: {
          test: /[\\/]src[\\/]components[\\/]/,
          name: 'components',
          priority: 10,
          chunks: 'all'
        }
      }
    }
  }
}
```

### ç­–ç•¥ä¸‰ï¼šæŒ‰é¡µé¢åˆ†ç¦»

```javascript
// ä½¿ç”¨åŠ¨æ€å¯¼å…¥
const Home = lazy(() => import('./pages/Home'))
const About = lazy(() => import('./pages/About'))
const Contact = lazy(() => import('./pages/Contact'))
```

---

## å®Œæ•´é…ç½®ç¤ºä¾‹

```javascript
module.exports = {
  optimization: {
    splitChunks: {
      chunks: 'all',
      minSize: 20000,
      maxSize: 244000,
      cacheGroups: {
        default: {
          minChunks: 2,
          priority: -20,
          reuseExistingChunk: true
        },
        vendor: {
          test: /[\\/]node_modules[\\/]/,
          name: 'vendors',
          priority: -10,
          chunks: 'all'
        },
        common: {
          minChunks: 2,
          priority: 5,
          reuseExistingChunk: true
        },
        react: {
          test: /[\\/]node_modules[\\/](react|react-dom)[\\/]/,
          name: 'react',
          priority: 20,
          chunks: 'all'
        }
      }
    },
    runtimeChunk: {
      name: 'runtime'
    }
  }
}
```

---

## æœ€ä½³å®è·µ

### 1. åˆ†ç¦»è¿è¡Œæ—¶ä»£ç 

```javascript
module.exports = {
  optimization: {
    runtimeChunk: 'single'  // æˆ– { name: 'runtime' }
  }
}
```

### 2. åˆç†è®¾ç½® chunk å¤§å°

```javascript
module.exports = {
  optimization: {
    splitChunks: {
      minSize: 20000,
      maxSize: 244000  // é¿å… chunk è¿‡å¤§
    }
  }
}
```

### 3. ä½¿ç”¨åŠ¨æ€å¯¼å…¥

```javascript
// âœ… æ¨èï¼šæŒ‰éœ€åŠ è½½
const Component = lazy(() => import('./Component'))

// âŒ ä¸æ¨èï¼šä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰
import Component from './Component'
```

### 4. é…ç½®é¢„è·å–

```javascript
// é¢„è·å–å¯èƒ½è®¿é—®çš„é¡µé¢
const NextPage = lazy(() => 
  import(/* webpackPrefetch: true */ './pages/NextPage')
)
```

---

## æ€»ç»“

- **Entry åˆ†å‰²**ï¼šæ‰‹åŠ¨åˆ†ç¦»å…¥å£
- **SplitChunks**ï¼šè‡ªåŠ¨åˆ†å‰²ä»£ç 
- **åŠ¨æ€å¯¼å…¥**ï¼šæŒ‰éœ€åŠ è½½æ¨¡å—
- **é¢„åŠ è½½/é¢„è·å–**ï¼šä¼˜åŒ–åŠ è½½ç­–ç•¥
- **æœ€ä½³å®è·µ**ï¼šåˆ†ç¦»è¿è¡Œæ—¶ä»£ç ï¼Œåˆç†è®¾ç½®å¤§å°

---

## ä¸‹ä¸€æ­¥

- [æ€§èƒ½ä¼˜åŒ–](./09-æ€§èƒ½ä¼˜åŒ–.md) - å­¦ä¹ æ€§èƒ½ä¼˜åŒ–æŠ€å·§
- [å®æˆ˜é¡¹ç›®ï¼šä»é›¶æ­å»º React é¡¹ç›®](./10-å®æˆ˜é¡¹ç›®-React.md) - å®è·µä»£ç åˆ†å‰²

---

#Webpack #ä»£ç åˆ†å‰² #SplitChunks #åŠ¨æ€å¯¼å…¥ #æ‡’åŠ è½½

