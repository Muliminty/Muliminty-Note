# å®æˆ˜é¡¹ç›®ï¼šå¤šé¡µé¢åº”ç”¨ï¼ˆMPAï¼‰

> å¤šé¡µé¢åº”ç”¨ï¼ˆMPAï¼‰éœ€è¦ä¸ºæ¯ä¸ªé¡µé¢é…ç½®ç‹¬ç«‹çš„å…¥å£å’Œ HTML æ–‡ä»¶ã€‚æœ¬ç« ä»‹ç»å¦‚ä½•ä½¿ç”¨ Webpack æ­å»ºå¤šé¡µé¢åº”ç”¨ã€‚

---

## ğŸ“‹ å­¦ä¹ ç›®æ ‡

- âœ… ç†è§£å¤šé¡µé¢åº”ç”¨çš„ç»“æ„
- âœ… é…ç½®å¤šå…¥å£
- âœ… åŠ¨æ€ç”Ÿæˆé…ç½®
- âœ… å®ç°ä»£ç åˆ†å‰²ç­–ç•¥
- âœ… ä¼˜åŒ–å¤šé¡µé¢åº”ç”¨æ„å»º

---

## å¤šé¡µé¢åº”ç”¨ vs å•é¡µé¢åº”ç”¨

### å•é¡µé¢åº”ç”¨ï¼ˆSPAï¼‰

- ä¸€ä¸ªå…¥å£æ–‡ä»¶
- ä¸€ä¸ª HTML æ–‡ä»¶
- è·¯ç”±åˆ‡æ¢é¡µé¢
- é€‚åˆç°ä»£ Web åº”ç”¨

### å¤šé¡µé¢åº”ç”¨ï¼ˆMPAï¼‰

- å¤šä¸ªå…¥å£æ–‡ä»¶
- å¤šä¸ª HTML æ–‡ä»¶
- é¡µé¢è·³è½¬åˆ·æ–°
- é€‚åˆä¼ ç»Ÿç½‘ç«™

---

## é¡¹ç›®ç»“æ„

```
mpa-project/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ home/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.js
â”‚   â”‚   â”‚   â””â”€â”€ index.html
â”‚   â”‚   â”œâ”€â”€ about/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.js
â”‚   â”‚   â”‚   â””â”€â”€ index.html
â”‚   â”‚   â””â”€â”€ contact/
â”‚   â”‚       â”œâ”€â”€ index.js
â”‚   â”‚       â””â”€â”€ index.html
â”‚   â”œâ”€â”€ shared/
â”‚   â”‚   â”œâ”€â”€ utils.js
â”‚   â”‚   â””â”€â”€ styles.css
â”‚   â””â”€â”€ assets/
â”œâ”€â”€ dist/
â”œâ”€â”€ webpack.config.js
â””â”€â”€ package.json
```

---

## ç¬¬ä¸€æ­¥ï¼šå®‰è£…ä¾èµ–

```bash
npm install --save-dev webpack webpack-cli webpack-dev-server
npm install --save-dev html-webpack-plugin
npm install --save-dev clean-webpack-plugin
npm install --save-dev glob
```

---

## ç¬¬äºŒæ­¥ï¼šåˆ›å»ºé¡µé¢æ–‡ä»¶

### é¦–é¡µ

**src/pages/home/index.html**ï¼š
```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é¦–é¡µ</title>
</head>
<body>
  <div id="app">
    <h1>é¦–é¡µ</h1>
    <p>è¿™æ˜¯é¦–é¡µå†…å®¹</p>
  </div>
</body>
</html>
```

**src/pages/home/index.js**ï¼š
```javascript
import '../../shared/styles.css'

console.log('é¦–é¡µåŠ è½½å®Œæˆ')
```

### å…³äºé¡µ

**src/pages/about/index.html**ï¼š
```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å…³äºæˆ‘ä»¬</title>
</head>
<body>
  <div id="app">
    <h1>å…³äºæˆ‘ä»¬</h1>
    <p>è¿™æ˜¯å…³äºé¡µå†…å®¹</p>
  </div>
</body>
</html>
```

**src/pages/about/index.js**ï¼š
```javascript
import '../../shared/styles.css'

console.log('å…³äºé¡µåŠ è½½å®Œæˆ')
```

---

## ç¬¬ä¸‰æ­¥ï¼šé…ç½® Webpack

### åŠ¨æ€ç”Ÿæˆå…¥å£å’Œ HTML

**webpack.config.js**ï¼š
```javascript
const path = require('path')
const HtmlWebpackPlugin = require('html-webpack-plugin')
const { CleanWebpackPlugin } = require('clean-webpack-plugin')
const glob = require('glob')

// åŠ¨æ€è·å–æ‰€æœ‰é¡µé¢å…¥å£
function getEntries() {
  const entries = {}
  const htmlPlugins = []
  
  // æŸ¥æ‰¾æ‰€æœ‰é¡µé¢çš„ index.js
  glob.sync('./src/pages/**/index.js').forEach(file => {
    // æå–é¡µé¢åç§°ï¼ˆå¦‚ home, aboutï¼‰
    const match = file.match(/\/pages\/(.+)\/index\.js$/)
    if (match) {
      const name = match[1]
      entries[name] = file
      
      // ä¸ºæ¯ä¸ªé¡µé¢åˆ›å»º HtmlWebpackPlugin
      htmlPlugins.push(
        new HtmlWebpackPlugin({
          template: file.replace('index.js', 'index.html'),
          filename: `${name}.html`,
          chunks: [name]  // åªåŒ…å«å½“å‰é¡µé¢çš„ chunk
        })
      )
    }
  })
  
  return { entries, htmlPlugins }
}

const { entries, htmlPlugins } = getEntries()

module.exports = {
  entry: entries,
  
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: 'js/[name].[contenthash:8].js',
    clean: true
  },
  
  mode: 'production',
  
  plugins: [
    new CleanWebpackPlugin(),
    ...htmlPlugins
  ],
  
  optimization: {
    splitChunks: {
      chunks: 'all',
      cacheGroups: {
        // å…¬å…±ä»£ç 
        common: {
          name: 'common',
          minChunks: 2,
          priority: 5,
          reuseExistingChunk: true
        },
        // ç¬¬ä¸‰æ–¹åº“
        vendor: {
          test: /[\\/]node_modules[\\/]/,
          name: 'vendors',
          priority: 10,
          reuseExistingChunk: true
        }
      }
    }
  },
  
  devServer: {
    static: {
      directory: path.join(__dirname, 'dist')
    },
    port: 3000,
    open: true
  }
}
```

---

## ç¬¬å››æ­¥ï¼šå…±äº«ä»£ç 

### å…±äº«æ ·å¼

**src/shared/styles.css**ï¼š
```css
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: Arial, sans-serif;
  line-height: 1.6;
  color: #333;
}

h1 {
  color: #42b983;
  margin-bottom: 20px;
}
```

### å…±äº«å·¥å…·

**src/shared/utils.js**ï¼š
```javascript
export function formatDate(date) {
  return new Date(date).toLocaleDateString()
}

export function debounce(func, wait) {
  let timeout
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout)
      func(...args)
    }
    clearTimeout(timeout)
    timeout = setTimeout(later, wait)
  }
}
```

---

## ç¬¬äº”æ­¥ï¼šä¼˜åŒ–é…ç½®

### åˆ†ç¦»å…¬å…±ä»£ç 

```javascript
module.exports = {
  optimization: {
    splitChunks: {
      chunks: 'all',
      cacheGroups: {
        // å…¬å…±æ ·å¼
        styles: {
          test: /\.css$/,
          name: 'styles',
          chunks: 'all',
          enforce: true
        },
        // å…¬å…±ä»£ç 
        common: {
          name: 'common',
          minChunks: 2,
          priority: 5
        },
        // ç¬¬ä¸‰æ–¹åº“
        vendor: {
          test: /[\\/]node_modules[\\/]/,
          name: 'vendors',
          priority: 10
        }
      }
    }
  }
}
```

### é…ç½® HTML æ’ä»¶

```javascript
htmlPlugins.push(
  new HtmlWebpackPlugin({
    template: file.replace('index.js', 'index.html'),
    filename: `${name}.html`,
    chunks: [name, 'common', 'vendors'],  // åŒ…å«å…¬å…±ä»£ç 
    minify: {
      removeComments: true,
      collapseWhitespace: true
    }
  })
)
```

---

## å®Œæ•´é…ç½®ç¤ºä¾‹

```javascript
const path = require('path')
const HtmlWebpackPlugin = require('html-webpack-plugin')
const { CleanWebpackPlugin } = require('clean-webpack-plugin')
const glob = require('glob')

function getEntries() {
  const entries = {}
  const htmlPlugins = []
  
  glob.sync('./src/pages/**/index.js').forEach(file => {
    const match = file.match(/\/pages\/(.+)\/index\.js$/)
    if (match) {
      const name = match[1]
      entries[name] = file
      
      htmlPlugins.push(
        new HtmlWebpackPlugin({
          template: file.replace('index.js', 'index.html'),
          filename: `${name}.html`,
          chunks: [name, 'common', 'vendors']
        })
      )
    }
  })
  
  return { entries, htmlPlugins }
}

const { entries, htmlPlugins } = getEntries()

module.exports = {
  entry: entries,
  
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: 'js/[name].[contenthash:8].js',
    clean: true
  },
  
  mode: 'production',
  
  module: {
    rules: [
      {
        test: /\.css$/,
        use: ['style-loader', 'css-loader']
      }
    ]
  },
  
  plugins: [
    new CleanWebpackPlugin(),
    ...htmlPlugins
  ],
  
  optimization: {
    splitChunks: {
      chunks: 'all',
      cacheGroups: {
        common: {
          name: 'common',
          minChunks: 2,
          priority: 5
        },
        vendor: {
          test: /[\\/]node_modules[\\/]/,
          name: 'vendors',
          priority: 10
        }
      }
    }
  }
}
```

---

## æœ€ä½³å®è·µ

### 1. ä½¿ç”¨ glob åŠ¨æ€å‘ç°é¡µé¢

```javascript
const glob = require('glob')

const pages = glob.sync('./src/pages/**/index.js')
```

### 2. åˆç†é…ç½® chunks

```javascript
chunks: [name, 'common', 'vendors']
```

### 3. åˆ†ç¦»å…¬å…±ä»£ç 

```javascript
splitChunks: {
  cacheGroups: {
    common: {
      minChunks: 2  // è¢« 2 ä¸ªä»¥ä¸Šé¡µé¢ä½¿ç”¨
    }
  }
}
```

### 4. ä½¿ç”¨æ¨¡æ¿å¼•æ“

å¯ä»¥ä½¿ç”¨ Handlebarsã€EJS ç­‰æ¨¡æ¿å¼•æ“ç”Ÿæˆ HTMLã€‚

---

## æ€»ç»“

- **å¤šå…¥å£**ï¼šä¸ºæ¯ä¸ªé¡µé¢é…ç½®ç‹¬ç«‹å…¥å£
- **åŠ¨æ€ç”Ÿæˆ**ï¼šä½¿ç”¨ glob è‡ªåŠ¨å‘ç°é¡µé¢
- **ä»£ç åˆ†å‰²**ï¼šåˆ†ç¦»å…¬å…±ä»£ç å’Œç¬¬ä¸‰æ–¹åº“
- **HTML ç”Ÿæˆ**ï¼šä¸ºæ¯ä¸ªé¡µé¢ç”Ÿæˆç‹¬ç«‹çš„ HTML

---

## ä¸‹ä¸€æ­¥

- [ä»£ç åˆ†å‰²](./08-ä»£ç åˆ†å‰².md) - æ·±å…¥å­¦ä¹ ä»£ç åˆ†å‰²
- [æ€§èƒ½ä¼˜åŒ–](./09-æ€§èƒ½ä¼˜åŒ–.md) - å­¦ä¹ æ€§èƒ½ä¼˜åŒ–
- [æœ€ä½³å®è·µ](./14-æœ€ä½³å®è·µ.md) - å­¦ä¹ æœ€ä½³å®è·µ

---

#Webpack #å¤šé¡µé¢åº”ç”¨ #MPA #ä»£ç åˆ†å‰²

