# å¼€å‘ç¯å¢ƒé…ç½®

> é…ç½®é«˜æ•ˆçš„å¼€å‘ç¯å¢ƒï¼Œæå‡å¼€å‘ä½“éªŒã€‚æœ¬ç« ä»‹ç» Webpack DevServerã€çƒ­æ¨¡å—æ›¿æ¢ï¼ˆHMRï¼‰ã€Source Map ç­‰å¼€å‘ç¯å¢ƒé…ç½®ã€‚

---

## ğŸ“‹ å­¦ä¹ ç›®æ ‡

- âœ… é…ç½® Webpack DevServer
- âœ… ä½¿ç”¨çƒ­æ¨¡å—æ›¿æ¢ï¼ˆHMRï¼‰
- âœ… é…ç½® Source Map
- âœ… é…ç½®ä»£ç†
- âœ… ä¼˜åŒ–å¼€å‘ä½“éªŒ

---

## Webpack DevServer

Webpack DevServer æä¾›äº†ä¸€ä¸ªå¼€å‘æœåŠ¡å™¨ï¼Œæ”¯æŒçƒ­æ›´æ–°ã€ä»£ç†ç­‰åŠŸèƒ½ã€‚

### å®‰è£…

```bash
npm install --save-dev webpack-dev-server
```

### åŸºç¡€é…ç½®

```javascript
module.exports = {
  devServer: {
    static: {
      directory: path.join(__dirname, 'dist')
    },
    port: 3000,
    open: true,
    hot: true
  }
}
```

### å¸¸ç”¨é…ç½®é€‰é¡¹

```javascript
module.exports = {
  devServer: {
    // é™æ€æ–‡ä»¶ç›®å½•
    static: {
      directory: path.join(__dirname, 'public'),
      publicPath: '/'
    },
    
    // ç«¯å£
    port: 3000,
    
    // è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
    open: true,
    
    // çƒ­æ¨¡å—æ›¿æ¢
    hot: true,
    
    // å¯ç”¨ gzip å‹ç¼©
    compress: true,
    
    // SPA è·¯ç”±æ”¯æŒ
    historyApiFallback: true,
    
    // ä»£ç†é…ç½®
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true,
        pathRewrite: {
          '^/api': ''
        }
      }
    },
    
    // å®¢æˆ·ç«¯æ—¥å¿—çº§åˆ«
    client: {
      logging: 'info',
      overlay: {
        errors: true,
        warnings: false
      }
    }
  }
}
```

---

## çƒ­æ¨¡å—æ›¿æ¢ï¼ˆHMRï¼‰

HMR å…è®¸åœ¨è¿è¡Œæ—¶æ›´æ–°æ¨¡å—ï¼Œè€Œä¸éœ€è¦å®Œå…¨åˆ·æ–°é¡µé¢ã€‚

### å¯ç”¨ HMR

```javascript
const webpack = require('webpack')

module.exports = {
  devServer: {
    hot: true
  },
  plugins: [
    new webpack.HotModuleReplacementPlugin()
  ]
}
```

### React HMR

```bash
npm install --save-dev @pmmmwh/react-refresh-webpack-plugin
```

```javascript
const ReactRefreshWebpackPlugin = require('@pmmmwh/react-refresh-webpack-plugin')

module.exports = {
  module: {
    rules: [
      {
        test: /\.(js|jsx|ts|tsx)$/,
        exclude: /node_modules/,
        use: {
          loader: 'babel-loader',
          options: {
            plugins: [
              'react-refresh/babel'
            ]
          }
        }
      }
    ]
  },
  plugins: [
    new ReactRefreshWebpackPlugin()
  ]
}
```

### Vue HMR

Vue Loader è‡ªåŠ¨æ”¯æŒ HMRï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚

---

## Source Map é…ç½®

Source Map å¸®åŠ©æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­è°ƒè¯•åŸå§‹æºä»£ç ã€‚

### é…ç½®é€‰é¡¹

```javascript
module.exports = {
  devtool: 'eval-source-map'  // å¼€å‘ç¯å¢ƒæ¨è
}
```

### Source Map ç±»å‹

| ç±»å‹ | æ„å»ºé€Ÿåº¦ | é‡æ–°æ„å»ºé€Ÿåº¦ | ç”Ÿäº§ç¯å¢ƒ | å“è´¨ |
|------|---------|-------------|---------|------|
| `eval` | å¿« | æœ€å¿« | å¦ | è½¬æ¢åçš„ä»£ç  |
| `eval-source-map` | æ…¢ | å¿« | å¦ | åŸå§‹æºä»£ç  |
| `cheap-eval-source-map` | ä¸­ç­‰ | å¿« | å¦ | è½¬æ¢åçš„ä»£ç ï¼ˆè¡Œï¼‰ |
| `cheap-module-eval-source-map` | æ…¢ | å¿« | å¦ | åŸå§‹æºä»£ç ï¼ˆè¡Œï¼‰ |
| `source-map` | æœ€æ…¢ | æ…¢ | æ˜¯ | åŸå§‹æºä»£ç  |
| `hidden-source-map` | æœ€æ…¢ | æ…¢ | æ˜¯ | åŸå§‹æºä»£ç ï¼ˆä¸å¼•ç”¨ï¼‰ |

### æ¨èé…ç½®

```javascript
// å¼€å‘ç¯å¢ƒ
module.exports = {
  devtool: 'eval-source-map'
}

// ç”Ÿäº§ç¯å¢ƒ
module.exports = {
  devtool: 'source-map'  // æˆ– 'hidden-source-map'
}
```

---

## ä»£ç†é…ç½®

å¼€å‘æ—¶ï¼Œé€šå¸¸éœ€è¦å°† API è¯·æ±‚ä»£ç†åˆ°åç«¯æœåŠ¡å™¨ã€‚

### åŸºç¡€ä»£ç†

```javascript
module.exports = {
  devServer: {
    proxy: {
      '/api': 'http://localhost:8080'
    }
  }
}
```

### é«˜çº§ä»£ç†

```javascript
module.exports = {
  devServer: {
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true,
        pathRewrite: {
          '^/api': ''
        },
        secure: false,
        logLevel: 'debug'
      }
    }
  }
}
```

---

## å¼€å‘ç¯å¢ƒä¼˜åŒ–

### 1. å‡å°‘æ„å»ºæ—¶é—´

```javascript
module.exports = {
  // ä½¿ç”¨ç¼“å­˜
  cache: {
    type: 'filesystem'
  },
  
  // å‡å°‘è§£æèŒƒå›´
  resolve: {
    modules: [path.resolve(__dirname, 'src'), 'node_modules']
  },
  
  // æ’é™¤ä¸å¿…è¦çš„å¤„ç†
  module: {
    rules: [
      {
        test: /\.js$/,
        exclude: /node_modules/,
        use: 'babel-loader'
      }
    ]
  }
}
```

### 2. ä¼˜åŒ–è¾“å‡ºä¿¡æ¯

```javascript
module.exports = {
  stats: {
    colors: true,
    modules: false,
    children: false,
    chunks: false,
    chunkModules: false
  }
}
```

---

## å®Œæ•´å¼€å‘ç¯å¢ƒé…ç½®ç¤ºä¾‹

```javascript
const path = require('path')
const webpack = require('webpack')
const HtmlWebpackPlugin = require('html-webpack-plugin')

module.exports = {
  mode: 'development',
  
  entry: './src/index.js',
  
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: 'bundle.js',
    publicPath: '/'
  },
  
  devtool: 'eval-source-map',
  
  devServer: {
    static: {
      directory: path.join(__dirname, 'public')
    },
    port: 3000,
    hot: true,
    open: true,
    compress: true,
    historyApiFallback: true,
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true,
        pathRewrite: { '^/api': '' }
      }
    }
  },
  
  plugins: [
    new HtmlWebpackPlugin({
      template: './public/index.html'
    }),
    new webpack.HotModuleReplacementPlugin()
  ]
}
```

---

## æ€»ç»“

- **DevServer**ï¼šæä¾›å¼€å‘æœåŠ¡å™¨å’Œçƒ­æ›´æ–°
- **HMR**ï¼šæå‡å¼€å‘ä½“éªŒï¼Œæ— éœ€åˆ·æ–°é¡µé¢
- **Source Map**ï¼šæ–¹ä¾¿è°ƒè¯•åŸå§‹ä»£ç 
- **ä»£ç†**ï¼šè§£å†³è·¨åŸŸé—®é¢˜
- **ä¼˜åŒ–**ï¼šå‡å°‘æ„å»ºæ—¶é—´ï¼Œæå‡å¼€å‘æ•ˆç‡

---

## ä¸‹ä¸€æ­¥

- [ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–](./07-ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–.md) - å­¦ä¹ ç”Ÿäº§ç¯å¢ƒé…ç½®
- [å®æˆ˜é¡¹ç›®ï¼šä»é›¶æ­å»º React é¡¹ç›®](./10-å®æˆ˜é¡¹ç›®-React.md) - å®è·µå¼€å‘ç¯å¢ƒé…ç½®

---

#Webpack #å¼€å‘ç¯å¢ƒ #DevServer #HMR #SourceMap

