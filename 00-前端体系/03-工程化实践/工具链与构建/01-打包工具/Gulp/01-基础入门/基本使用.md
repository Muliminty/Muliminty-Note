# Gulp åŸºæœ¬ä½¿ç”¨

> Gulp çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•å’Œå¸¸è§ä»»åŠ¡é…ç½®

---

## ğŸ“‹ ç›®å½•

- [åˆ›å»º gulpfile.js](#åˆ›å»º-gulpfilejs)
- [å®šä¹‰åŸºæœ¬ä»»åŠ¡](#å®šä¹‰åŸºæœ¬ä»»åŠ¡)
- [å¤„ç† JavaScript](#å¤„ç†-javascript)
- [å¤„ç† CSS](#å¤„ç†-css)
- [å¤„ç† HTML](#å¤„ç†-html)
- [å¤„ç†å›¾ç‰‡](#å¤„ç†å›¾ç‰‡)
- [æ–‡ä»¶ç›‘å¬](#æ–‡ä»¶ç›‘å¬)
- [åˆ›å»ºå¼€å‘æœåŠ¡å™¨](#åˆ›å»ºå¼€å‘æœåŠ¡å™¨)

---

## åˆ›å»º gulpfile.js

### åŸºæœ¬ç»“æ„

```javascript
// gulpfile.js
const { src, dest, watch, series, parallel } = require('gulp');

// å®šä¹‰ä»»åŠ¡
function taskName() {
  return src('src/file')
    .pipe(dest('dist/'));
}

// å¯¼å‡ºä»»åŠ¡
exports.taskName = taskName;
exports.default = taskName;
```

### é¡¹ç›®ç»“æ„

```
project/
â”œâ”€â”€ src/                    # æºæ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ js/                # JavaScript æ–‡ä»¶
â”‚   â”œâ”€â”€ css/               # CSS æ–‡ä»¶
â”‚   â”œâ”€â”€ images/            # å›¾ç‰‡æ–‡ä»¶
â”‚   â””â”€â”€ index.html         # HTML æ–‡ä»¶
â”œâ”€â”€ dist/                   # è¾“å‡ºç›®å½•ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”œâ”€â”€ gulpfile.js            # Gulp é…ç½®æ–‡ä»¶
â””â”€â”€ package.json           # é¡¹ç›®é…ç½®
```

---

## å®šä¹‰åŸºæœ¬ä»»åŠ¡

### å¤åˆ¶æ–‡ä»¶

```javascript
// å¤åˆ¶æ‰€æœ‰æ–‡ä»¶
function copy() {
  return src('src/**/*')
    .pipe(dest('dist/'));
}

// å¤åˆ¶ç‰¹å®šæ–‡ä»¶
function copyHtml() {
  return src('src/*.html')
    .pipe(dest('dist/'));
}

exports.copy = copy;
```

### æ¸…ç†æ–‡ä»¶

```javascript
const del = require('del');

// æ¸…ç† dist ç›®å½•
function clean() {
  return del(['dist/*']);
}

// æ¸…ç†ç‰¹å®šæ–‡ä»¶
function cleanJs() {
  return del(['dist/js/*.js']);
}

exports.clean = clean;
```

---

## å¤„ç† JavaScript

### å‹ç¼© JavaScript

```javascript
const uglify = require('gulp-uglify');

// å‹ç¼© JS
function scripts() {
  return src('src/js/**/*.js')
    .pipe(uglify())
    .pipe(dest('dist/js'));
}

exports.scripts = scripts;
```

### åˆå¹¶ JavaScript

```javascript
const concat = require('gulp-concat');

// åˆå¹¶ JS æ–‡ä»¶
function scripts() {
  return src('src/js/**/*.js')
    .pipe(concat('app.js'))  // åˆå¹¶ä¸º app.js
    .pipe(uglify())
    .pipe(dest('dist/js'));
}
```

### Babel è½¬è¯‘

```javascript
const babel = require('gulp-babel');

// ES6+ è½¬ ES5
function scripts() {
  return src('src/js/**/*.js')
    .pipe(babel({
      presets: ['@babel/preset-env']
    }))
    .pipe(uglify())
    .pipe(dest('dist/js'));
}
```

### ç”Ÿæˆ Source Map

```javascript
const sourcemaps = require('gulp-sourcemaps');

// ç”Ÿæˆ sourcemap
function scripts() {
  return src('src/js/**/*.js')
    .pipe(sourcemaps.init())
    .pipe(babel())
    .pipe(uglify())
    .pipe(sourcemaps.write('.'))
    .pipe(dest('dist/js'));
}
```

### å®Œæ•´ JavaScript å¤„ç†æµç¨‹

```javascript
function scripts() {
  return src('src/js/**/*.js')
    .pipe(sourcemaps.init())
    .pipe(babel({
      presets: ['@babel/preset-env']
    }))
    .pipe(concat('app.min.js'))
    .pipe(uglify())
    .pipe(sourcemaps.write('.'))
    .pipe(dest('dist/js'));
}
```

---

## å¤„ç† CSS

### å‹ç¼© CSS

```javascript
const cleanCSS = require('gulp-clean-css');

// å‹ç¼© CSS
function styles() {
  return src('src/css/**/*.css')
    .pipe(cleanCSS())
    .pipe(dest('dist/css'));
}
```

### Sass ç¼–è¯‘

```javascript
const sass = require('gulp-sass')(require('sass'));

// ç¼–è¯‘ Sass
function styles() {
  return src('src/scss/**/*.scss')
    .pipe(sass().on('error', sass.logError))
    .pipe(cleanCSS())
    .pipe(dest('dist/css'));
}
```

### Less ç¼–è¯‘

```javascript
const less = require('gulp-less');

// ç¼–è¯‘ Less
function styles() {
  return src('src/less/**/*.less')
    .pipe(less())
    .pipe(cleanCSS())
    .pipe(dest('dist/css'));
}
```

### PostCSS å¤„ç†

```javascript
const postcss = require('gulp-postcss');
const autoprefixer = require('autoprefixer');
const cssnano = require('cssnano');

// PostCSS å¤„ç†
function styles() {
  return src('src/css/**/*.css')
    .pipe(postcss([
      autoprefixer(),
      cssnano()
    ]))
    .pipe(dest('dist/css'));
}
```

### å®Œæ•´ CSS å¤„ç†æµç¨‹

```javascript
function styles() {
  return src('src/scss/**/*.scss')
    .pipe(sourcemaps.init())
    .pipe(sass().on('error', sass.logError))
    .pipe(postcss([
      autoprefixer(),
      cssnano()
    ]))
    .pipe(concat('app.min.css'))
    .pipe(sourcemaps.write('.'))
    .pipe(dest('dist/css'));
}
```

---

## å¤„ç† HTML

### å‹ç¼© HTML

```javascript
const htmlmin = require('gulp-htmlmin');

// å‹ç¼© HTML
function html() {
  return src('src/*.html')
    .pipe(htmlmin({
      collapseWhitespace: true,
      removeComments: true
    }))
    .pipe(dest('dist/'));
}

exports.html = html;
```

### æ¨¡æ¿å¼•æ“

```javascript
const pug = require('gulp-pug');

// ç¼–è¯‘ Pug æ¨¡æ¿
function html() {
  return src('src/pug/**/*.pug')
    .pipe(pug({
      pretty: true
    }))
    .pipe(dest('dist/'));
}
```

### æ–‡ä»¶åŒ…å«

```javascript
const fileInclude = require('gulp-file-include');

// åŒ…å« HTML ç‰‡æ®µ
function html() {
  return src('src/*.html')
    .pipe(fileInclude({
      prefix: '@@',
      basepath: '@file'
    }))
    .pipe(htmlmin())
    .pipe(dest('dist/'));
}
```

---

## å¤„ç†å›¾ç‰‡

### å‹ç¼©å›¾ç‰‡

```javascript
const imagemin = require('gulp-imagemin');

// å‹ç¼©å›¾ç‰‡
function images() {
  return src('src/images/**/*')
    .pipe(imagemin([
      imagemin.gifsicle({ interlaced: true }),
      imagemin.mozjpeg({ quality: 75, progressive: true }),
      imagemin.optipng({ optimizationLevel: 5 }),
      imagemin.svgo({
        plugins: [
          { removeViewBox: true },
          { cleanupIDs: false }
        ]
      })
    ]))
    .pipe(dest('dist/images'));
}
```

### å“åº”å¼å›¾ç‰‡

```javascript
const responsive = require('gulp-responsive');

// ç”Ÿæˆå“åº”å¼å›¾ç‰‡
function images() {
  return src('src/images/**/*.{jpg,png}')
    .pipe(responsive({
      '*.jpg': [
        { width: 320, rename: { suffix: '-small' } },
        { width: 640, rename: { suffix: '-medium' } },
        { width: 1024, rename: { suffix: '-large' } }
      ]
    }))
    .pipe(dest('dist/images'));
}
```

### WebP è½¬æ¢

```javascript
const webp = require('gulp-webp');

// è½¬æ¢ä¸º WebP
function webpImages() {
  return src('src/images/**/*.{jpg,png}')
    .pipe(webp({
      quality: 85
    }))
    .pipe(dest('dist/images'));
}
```

---

## æ–‡ä»¶ç›‘å¬

### åŸºæœ¬ç›‘å¬

```javascript
const { watch } = require('gulp');

// ç›‘å¬æ–‡ä»¶å˜åŒ–
function dev() {
  watch('src/js/**/*.js', scripts);
  watch('src/css/**/*.css', styles);
  watch('src/*.html', html);
  watch('src/images/**/*', images);
}

exports.dev = dev;
```

### ç›‘å¬é€‰é¡¹

```javascript
function dev() {
  watch('src/js/**/*.js', {
    delay: 500,           // é˜²æŠ–å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
    ignoreInitial: false, // æ˜¯å¦å¿½ç•¥åˆå§‹æ–‡ä»¶
    queue: true          // æ˜¯å¦æ’é˜Ÿæ‰§è¡Œ
  }, scripts);
}
```

### ç›‘å¬äº‹ä»¶

```javascript
function dev() {
  const watcher = watch('src/js/**/*.js', scripts);
  
  watcher.on('change', (path) => {
    console.log(`File ${path} was changed`);
  });
  
  watcher.on('add', (path) => {
    console.log(`File ${path} was added`);
  });
  
  watcher.on('unlink', (path) => {
    console.log(`File ${path} was removed`);
  });
}
```

---

## åˆ›å»ºå¼€å‘æœåŠ¡å™¨

### ä½¿ç”¨ gulp-connect

```javascript
const connect = require('gulp-connect');

// å¯åŠ¨å¼€å‘æœåŠ¡å™¨
function server() {
  connect.server({
    root: 'dist',
    port: 8080,
    livereload: true
  });
}

// è‡ªåŠ¨åˆ·æ–°
function html() {
  return src('src/*.html')
    .pipe(htmlmin())
    .pipe(dest('dist'))
    .pipe(connect.reload());
}

exports.server = series(build, server, dev);
```

### ä½¿ç”¨ browser-sync

```javascript
const browserSync = require('browser-sync').create();

// åˆå§‹åŒ– BrowserSync
function server() {
  browserSync.init({
    server: {
      baseDir: './dist'
    },
    port: 3000,
    open: true
  });
}

// è‡ªåŠ¨åˆ·æ–°
function html() {
  return src('src/*.html')
    .pipe(htmlmin())
    .pipe(dest('dist'))
    .pipe(browserSync.stream());
}

// ç›‘å¬æ–‡ä»¶
function dev() {
  watch('src/js/**/*.js', series(scripts, browserSync.reload));
  watch('src/css/**/*.css', series(styles, browserSync.reload));
  watch('src/*.html', series(html, browserSync.reload));
}

exports.dev = series(build, parallel(server, dev));
```

### å®Œæ•´å¼€å‘ç¯å¢ƒé…ç½®

```javascript
// å¼€å‘æ¨¡å¼
gulp.task('dev', gulp.series(
  'build',
  gulp.parallel('server', 'watch')
));

// ç”Ÿäº§æ„å»º
gulp.task('build', gulp.series(
  'clean',
  gulp.parallel('scripts', 'styles', 'html', 'images')
));

// é»˜è®¤ä»»åŠ¡
gulp.task('default', gulp.series('dev'));
```

---

## å®Œæ•´ç¤ºä¾‹

### å®Œæ•´ gulpfile.js

```javascript
const { src, dest, watch, series, parallel } = require('gulp');
const uglify = require('gulp-uglify');
const babel = require('gulp-babel');
const sass = require('gulp-sass')(require('sass'));
const cleanCSS = require('gulp-clean-css');
const postcss = require('gulp-postcss');
const autoprefixer = require('autoprefixer');
const htmlmin = require('gulp-htmlmin');
const imagemin = require('gulp-imagemin');
const concat = require('gulp-concat');
const sourcemaps = require('gulp-sourcemaps');
const browserSync = require('browser-sync').create();
const del = require('del');

// æ¸…ç†
gulp.task('clean', () => {
  return del(['dist/*']);
});

// JavaScript
gulp.task('scripts', () => {
  return src('src/js/**/*.js')
    .pipe(sourcemaps.init())
    .pipe(babel({
      presets: ['@babel/preset-env']
    }))
    .pipe(concat('app.min.js'))
    .pipe(uglify())
    .pipe(sourcemaps.write('.'))
    .pipe(dest('dist/js'))
    .pipe(browserSync.stream());
});

// CSS
gulp.task('styles', () => {
  return src('src/scss/**/*.scss')
    .pipe(sourcemaps.init())
    .pipe(sass().on('error', sass.logError))
    .pipe(postcss([
      autoprefixer(),
      cssnano()
    ]))
    .pipe(concat('app.min.css'))
    .pipe(sourcemaps.write('.'))
    .pipe(dest('dist/css'))
    .pipe(browserSync.stream());
});

// HTML
gulp.task('html', () => {
  return src('src/*.html')
    .pipe(htmlmin({
      collapseWhitespace: true,
      removeComments: true
    }))
    .pipe(dest('dist'))
    .pipe(browserSync.stream());
});

// Images
gulp.task('images', () => {
  return src('src/images/**/*')
    .pipe(imagemin())
    .pipe(dest('dist/images'));
});

// Server
gulp.task('server', () => {
  browserSync.init({
    server: {
      baseDir: './dist'
    }
  });
});

// Watch
gulp.task('watch', () => {
  watch('src/js/**/*.js', scripts);
  watch('src/scss/**/*.scss', styles);
  watch('src/*.html', html);
  watch('src/images/**/*', images);
});

// Build
gulp.task('build', series(
  clean,
  parallel(scripts, styles, html, images)
));

// Dev
gulp.task('dev', series(
  build,
  parallel(server, watch)
));

// Default
gulp.task('default', dev);
```

---

## ğŸ“š ç›¸å…³é“¾æ¥

- [Gulp ç®€ä»‹ä¸å®‰è£…](./Gulp-ç®€ä»‹ä¸å®‰è£….md)
- [Gulp æ ¸å¿ƒæ¦‚å¿µ](../02-æ ¸å¿ƒæ¦‚å¿µ/æ ¸å¿ƒæ¦‚å¿µ.md)
- [å¸¸ç”¨æ’ä»¶](../03-å¸¸ç”¨æ’ä»¶/å¸¸ç”¨æ’ä»¶.md)
- [å‰ç«¯é¡¹ç›®æ„å»ºå®æˆ˜](../04-å®æˆ˜æ¡ˆä¾‹/å‰ç«¯é¡¹ç›®æ„å»ºå®æˆ˜.md)

---

**æ ‡ç­¾**: #gulp #åŸºæœ¬ä½¿ç”¨ #javascript #css #html
