# Webpack æ ¸å¿ƒæ¦‚å¿µ

> ç†è§£ Webpack çš„æ ¸å¿ƒæ¦‚å¿µæ˜¯æŒæ¡ Webpack çš„åŸºç¡€ã€‚æœ¬ç« å°†è¯¦ç»†ä»‹ç» Entryã€Outputã€Loaderã€Plugin å’Œ Mode è¿™äº”ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‚

---

## ğŸ“‹ æ ¸å¿ƒæ¦‚å¿µæ¦‚è§ˆ

Webpack æœ‰äº”ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š

1. **Entryï¼ˆå…¥å£ï¼‰** - å‘Šè¯‰ Webpack ä»å“ªé‡Œå¼€å§‹
2. **Outputï¼ˆè¾“å‡ºï¼‰** - å‘Šè¯‰ Webpack åœ¨å“ªé‡Œè¾“å‡ºç»“æœ
3. **Loaderï¼ˆåŠ è½½å™¨ï¼‰** - å‘Šè¯‰ Webpack å¦‚ä½•å¤„ç†é JS æ–‡ä»¶
4. **Pluginï¼ˆæ’ä»¶ï¼‰** - æ‰§è¡Œæ›´å¹¿æ³›çš„ä»»åŠ¡
5. **Modeï¼ˆæ¨¡å¼ï¼‰** - æŒ‡å®šæ„å»ºæ¨¡å¼

---

## 1. Entryï¼ˆå…¥å£ï¼‰

Entry æŒ‡å®š Webpack ä»å“ªä¸ªæ–‡ä»¶å¼€å§‹æ„å»ºä¾èµ–å›¾ã€‚

### å•å…¥å£ï¼ˆå­—ç¬¦ä¸²ï¼‰

```javascript
module.exports = {
  entry: './src/index.js'
}
```

**é€‚ç”¨åœºæ™¯**ï¼šå•é¡µé¢åº”ç”¨ï¼ˆSPAï¼‰

### å¤šå…¥å£ï¼ˆå¯¹è±¡ï¼‰

```javascript
module.exports = {
  entry: {
    main: './src/index.js',
    vendor: './src/vendor.js'
  }
}
```

**é€‚ç”¨åœºæ™¯**ï¼šéœ€è¦åˆ†ç¦»ç¬¬ä¸‰æ–¹åº“ä»£ç 

### åŠ¨æ€å…¥å£ï¼ˆå‡½æ•°ï¼‰

```javascript
module.exports = {
  entry: () => './src/index.js'
}
```

**é€‚ç”¨åœºæ™¯**ï¼šæ ¹æ®æ¡ä»¶åŠ¨æ€å†³å®šå…¥å£

### å…¥å£é…ç½®ç¤ºä¾‹

```javascript
// webpack.config.js
module.exports = {
  // å•å…¥å£
  entry: './src/index.js',
  
  // æˆ–è€…å¤šå…¥å£
  entry: {
    app: './src/app.js',
    admin: './src/admin.js'
  }
}
```

---

## 2. Outputï¼ˆè¾“å‡ºï¼‰

Output æŒ‡å®šæ‰“åŒ…åçš„æ–‡ä»¶è¾“å‡ºä½ç½®å’Œå‘½åè§„åˆ™ã€‚

### åŸºç¡€é…ç½®

```javascript
const path = require('path')

module.exports = {
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: 'bundle.js'
  }
}
```

### å¤šå…¥å£è¾“å‡º

```javascript
module.exports = {
  entry: {
    main: './src/index.js',
    vendor: './src/vendor.js'
  },
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: '[name].bundle.js'  // main.bundle.js, vendor.bundle.js
  }
}
```

### ä½¿ç”¨ Hashï¼ˆç¼“å­˜ä¼˜åŒ–ï¼‰

```javascript
module.exports = {
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: '[name].[contenthash].js',
    chunkFilename: '[name].[chunkhash].js'
  }
}
```

**Hash ç±»å‹è¯´æ˜**ï¼š
- `[hash]`ï¼šæ•´ä¸ªé¡¹ç›®çš„ hashï¼ˆæ‰€æœ‰æ–‡ä»¶å…±äº«ï¼‰
- `[chunkhash]`ï¼šchunk çš„ hashï¼ˆæ¯ä¸ª chunk ä¸åŒï¼‰
- `[contenthash]`ï¼šå†…å®¹çš„ hashï¼ˆæ¨èï¼Œåªæœ‰å†…å®¹å˜åŒ–æ‰æ”¹å˜ï¼‰

### å®Œæ•´ Output é…ç½®

```javascript
const path = require('path')

module.exports = {
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: 'js/[name].[contenthash:8].js',
    chunkFilename: 'js/[name].[contenthash:8].chunk.js',
    publicPath: '/',  // å…¬å…±è·¯å¾„
    clean: true,      // æ¸…ç†è¾“å‡ºç›®å½•
    assetModuleFilename: 'assets/[hash][ext]'  // èµ„æºæ–‡ä»¶å‘½å
  }
}
```

---

## 3. Loaderï¼ˆåŠ è½½å™¨ï¼‰

Loader ç”¨äºè½¬æ¢é JavaScript æ–‡ä»¶ï¼Œè®© Webpack èƒ½å¤Ÿå¤„ç†å„ç§ç±»å‹çš„èµ„æºã€‚

### Loader å·¥ä½œåŸç†

```
æºæ–‡ä»¶ â†’ Loader1 â†’ Loader2 â†’ Loader3 â†’ æœ€ç»ˆç»“æœ
```

### åŸºç¡€è¯­æ³•

```javascript
module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/,  // åŒ¹é…æ–‡ä»¶
        use: ['style-loader', 'css-loader']  // ä½¿ç”¨çš„ Loader
      }
    ]
  }
}
```

### å¸¸ç”¨ Loader

#### CSS Loader

```javascript
module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [
          'style-loader',  // å°† CSS æ³¨å…¥åˆ° DOM
          'css-loader'     // è§£æ CSS æ–‡ä»¶
        ]
      }
    ]
  }
}
```

#### Babel Loaderï¼ˆè½¬è¯‘ JavaScriptï¼‰

```javascript
module.exports = {
  module: {
    rules: [
      {
        test: /\.js$/,
        exclude: /node_modules/,
        use: {
          loader: 'babel-loader',
          options: {
            presets: ['@babel/preset-env']
          }
        }
      }
    ]
  }
}
```

#### æ–‡ä»¶èµ„æº Loader

```javascript
module.exports = {
  module: {
    rules: [
      {
        test: /\.(png|jpg|gif|svg)$/,
        type: 'asset/resource',
        generator: {
          filename: 'images/[hash][ext]'
        }
      }
    ]
  }
}
```

### Loader æ‰§è¡Œé¡ºåº

Loader ä»**å³åˆ°å·¦**ï¼ˆæˆ–ä»ä¸‹åˆ°ä¸Šï¼‰æ‰§è¡Œï¼š

```javascript
module.exports = {
  module: {
    rules: [
      {
        test: /\.scss$/,
        use: [
          'style-loader',   // 3. æœ€åæ‰§è¡Œ
          'css-loader',     // 2. ç„¶åæ‰§è¡Œ
          'sass-loader'     // 1. æœ€å…ˆæ‰§è¡Œ
        ]
      }
    ]
  }
}
```

**æ‰§è¡Œæµç¨‹**ï¼š
1. `sass-loader` å°† SCSS è½¬æ¢ä¸º CSS
2. `css-loader` è§£æ CSS ä¸­çš„ `@import` å’Œ `url()`
3. `style-loader` å°† CSS æ³¨å…¥åˆ° DOM

---

## 4. Pluginï¼ˆæ’ä»¶ï¼‰

Plugin ç”¨äºæ‰§è¡Œæ›´å¹¿æ³›çš„ä»»åŠ¡ï¼Œå¦‚æ‰“åŒ…ä¼˜åŒ–ã€èµ„æºç®¡ç†ã€ç¯å¢ƒå˜é‡æ³¨å…¥ç­‰ã€‚

### Plugin å·¥ä½œåŸç†

Plugin æ˜¯ä¸€ä¸ªç±»ï¼Œé€šè¿‡ `apply` æ–¹æ³•æ³¨å†Œåˆ° Webpack çš„ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­ã€‚

```javascript
class MyPlugin {
  apply(compiler) {
    compiler.hooks.done.tap('MyPlugin', (stats) => {
      console.log('æ„å»ºå®Œæˆï¼')
    })
  }
}
```

### å¸¸ç”¨ Plugin

#### HtmlWebpackPluginï¼ˆç”Ÿæˆ HTMLï¼‰

```javascript
const HtmlWebpackPlugin = require('html-webpack-plugin')

module.exports = {
  plugins: [
    new HtmlWebpackPlugin({
      template: './src/index.html',
      filename: 'index.html',
      minify: {
        removeComments: true,
        collapseWhitespace: true
      }
    })
  ]
}
```

#### CleanWebpackPluginï¼ˆæ¸…ç†è¾“å‡ºç›®å½•ï¼‰

```javascript
const { CleanWebpackPlugin } = require('clean-webpack-plugin')

module.exports = {
  plugins: [
    new CleanWebpackPlugin()
  ]
}
```

#### DefinePluginï¼ˆå®šä¹‰ç¯å¢ƒå˜é‡ï¼‰

```javascript
const webpack = require('webpack')

module.exports = {
  plugins: [
    new webpack.DefinePlugin({
      'process.env.NODE_ENV': JSON.stringify('production'),
      'process.env.API_URL': JSON.stringify('https://api.example.com')
    })
  ]
}
```

---

## 5. Modeï¼ˆæ¨¡å¼ï¼‰

Mode æŒ‡å®šæ„å»ºæ¨¡å¼ï¼Œå½±å“ Webpack çš„ä¼˜åŒ–è¡Œä¸ºã€‚

### ä¸‰ç§æ¨¡å¼

```javascript
module.exports = {
  mode: 'development'  // æˆ– 'production' æˆ– 'none'
}
```

### Development æ¨¡å¼

```javascript
module.exports = {
  mode: 'development'
}
```

**ç‰¹ç‚¹**ï¼š
- ä»£ç ä¸ä¼šè¢«å‹ç¼©
- åŒ…å«è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- æ„å»ºé€Ÿåº¦å¿«
- å¯ç”¨ Source Map

### Production æ¨¡å¼

```javascript
module.exports = {
  mode: 'production'
}
```

**ç‰¹ç‚¹**ï¼š
- ä»£ç ä¼šè¢«å‹ç¼©å’Œä¼˜åŒ–
- ç§»é™¤æœªä½¿ç”¨çš„ä»£ç ï¼ˆTree Shakingï¼‰
- æ„å»ºé€Ÿåº¦è¾ƒæ…¢
- ç”Ÿæˆçš„æ–‡ä»¶æ›´å°

### None æ¨¡å¼

```javascript
module.exports = {
  mode: 'none'
}
```

**ç‰¹ç‚¹**ï¼š
- ä¸å¯ç”¨ä»»ä½•é»˜è®¤ä¼˜åŒ–
- å®Œå…¨æ‰‹åŠ¨æ§åˆ¶

---

## å®Œæ•´é…ç½®ç¤ºä¾‹

ç»“åˆæ‰€æœ‰æ ¸å¿ƒæ¦‚å¿µçš„å®Œæ•´é…ç½®ï¼š

```javascript
const path = require('path')
const HtmlWebpackPlugin = require('html-webpack-plugin')

module.exports = {
  // 1. Entryï¼ˆå…¥å£ï¼‰
  entry: './src/index.js',
  
  // 2. Outputï¼ˆè¾“å‡ºï¼‰
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: 'bundle.[contenthash].js',
    clean: true
  },
  
  // 3. Modeï¼ˆæ¨¡å¼ï¼‰
  mode: 'development',
  
  // 4. Loaderï¼ˆåŠ è½½å™¨ï¼‰
  module: {
    rules: [
      {
        test: /\.js$/,
        exclude: /node_modules/,
        use: 'babel-loader'
      },
      {
        test: /\.css$/,
        use: ['style-loader', 'css-loader']
      }
    ]
  },
  
  // 5. Pluginï¼ˆæ’ä»¶ï¼‰
  plugins: [
    new HtmlWebpackPlugin({
      template: './src/index.html'
    })
  ]
}
```

---

## æ ¸å¿ƒæ¦‚å¿µå…³ç³»å›¾

```
Entryï¼ˆå…¥å£ï¼‰
    â†“
[åˆ†æä¾èµ–]
    â†“
Loaderï¼ˆè½¬æ¢æ–‡ä»¶ï¼‰
    â†“
[æ‰“åŒ…æ¨¡å—]
    â†“
Pluginï¼ˆä¼˜åŒ–å¤„ç†ï¼‰
    â†“
Outputï¼ˆè¾“å‡ºï¼‰
```

---

## æ€»ç»“

- **Entry**ï¼šå‘Šè¯‰ Webpack ä»å“ªé‡Œå¼€å§‹
- **Output**ï¼šå‘Šè¯‰ Webpack è¾“å‡ºåˆ°å“ªé‡Œ
- **Loader**ï¼šè½¬æ¢é JS æ–‡ä»¶
- **Plugin**ï¼šæ‰§è¡Œæ›´å¹¿æ³›çš„ä»»åŠ¡
- **Mode**ï¼šæŒ‡å®šæ„å»ºæ¨¡å¼

ç†è§£è¿™äº”ä¸ªæ ¸å¿ƒæ¦‚å¿µåï¼Œä½ å°±å¯ä»¥å¼€å§‹é…ç½® Webpack äº†ï¼

---

## ä¸‹ä¸€æ­¥

- [åŸºç¡€é…ç½®è¯¦è§£](./03-åŸºç¡€é…ç½®è¯¦è§£.md) - æ·±å…¥å­¦ä¹ é…ç½®é€‰é¡¹
- [Loader è¯¦è§£](./04-Loaderè¯¦è§£.md) - æ·±å…¥å­¦ä¹  Loader
- [Plugin è¯¦è§£](./05-Pluginè¯¦è§£.md) - æ·±å…¥å­¦ä¹  Plugin

---

#Webpack #æ ¸å¿ƒæ¦‚å¿µ #Entry #Output #Loader #Plugin #Mode

