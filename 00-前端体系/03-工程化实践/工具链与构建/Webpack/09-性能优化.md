# æ€§èƒ½ä¼˜åŒ–

> æ€§èƒ½ä¼˜åŒ–åŒ…æ‹¬æ„å»ºé€Ÿåº¦ä¼˜åŒ–å’Œè¿è¡Œæ—¶æ€§èƒ½ä¼˜åŒ–ã€‚æœ¬ç« ä»‹ç»å¦‚ä½•æå‡ Webpack æ„å»ºé€Ÿåº¦ï¼Œä»¥åŠå¦‚ä½•ä¼˜åŒ–åº”ç”¨çš„è¿è¡Œæ—¶æ€§èƒ½ã€‚

---

## ğŸ“‹ å­¦ä¹ ç›®æ ‡

- âœ… æŒæ¡æ„å»ºé€Ÿåº¦ä¼˜åŒ–æŠ€å·§
- âœ… ç†è§£ç¼“å­˜ç­–ç•¥
- âœ… å­¦ä¼šä½¿ç”¨å¤šè¿›ç¨‹æ„å»º
- âœ… äº†è§£ DllPlugin ä½¿ç”¨
- âœ… æŒæ¡è¿è¡Œæ—¶æ€§èƒ½ä¼˜åŒ–

---

## æ„å»ºé€Ÿåº¦ä¼˜åŒ–

### 1. ä½¿ç”¨ç¼“å­˜

**æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ï¼ˆWebpack 5ï¼‰**ï¼š
```javascript
module.exports = {
  cache: {
    type: 'filesystem',
    buildDependencies: {
      config: [__filename]
    }
  }
}
```

**Babel ç¼“å­˜**ï¼š
```javascript
module.exports = {
  module: {
    rules: [
      {
        test: /\.js$/,
        use: {
          loader: 'babel-loader',
          options: {
            cacheDirectory: true
          }
        }
      }
    ]
  }
}
```

### 2. å‡å°‘è§£æèŒƒå›´

```javascript
module.exports = {
  resolve: {
    modules: [
      path.resolve(__dirname, 'src'),
      'node_modules'
    ],
    extensions: ['.js', '.json'],
    alias: {
      '@': path.resolve(__dirname, 'src')
    }
  },
  module: {
    rules: [
      {
        test: /\.js$/,
        include: path.resolve(__dirname, 'src'),
        exclude: /node_modules/,
        use: 'babel-loader'
      }
    ]
  }
}
```

### 3. ä½¿ç”¨å¤šè¿›ç¨‹æ„å»º

**TerserPlugin å¤šè¿›ç¨‹**ï¼š
```javascript
const TerserPlugin = require('terser-webpack-plugin')

module.exports = {
  optimization: {
    minimizer: [
      new TerserPlugin({
        parallel: true,  // å¯ç”¨å¤šè¿›ç¨‹
        terserOptions: {
          compress: {
            drop_console: true
          }
        }
      })
    ]
  }
}
```

**thread-loader**ï¼š
```bash
npm install --save-dev thread-loader
```

```javascript
module.exports = {
  module: {
    rules: [
      {
        test: /\.js$/,
        use: [
          'thread-loader',
          'babel-loader'
        ]
      }
    ]
  }
}
```

### 4. ä½¿ç”¨ DllPlugin

**webpack.dll.js**ï¼š
```javascript
const path = require('path')
const webpack = require('webpack')

module.exports = {
  mode: 'production',
  entry: {
    vendor: ['react', 'react-dom', 'lodash']
  },
  output: {
    path: path.resolve(__dirname, 'dll'),
    filename: '[name].dll.js',
    library: '[name]_library'
  },
  plugins: [
    new webpack.DllPlugin({
      name: '[name]_library',
      path: path.resolve(__dirname, 'dll/[name].manifest.json')
    })
  ]
}
```

**webpack.config.js**ï¼š
```javascript
const webpack = require('webpack')

module.exports = {
  plugins: [
    new webpack.DllReferencePlugin({
      manifest: require('./dll/vendor.manifest.json')
    })
  ]
}
```

### 5. å‡å°‘æ–‡ä»¶ç›‘å¬

```javascript
module.exports = {
  watchOptions: {
    ignored: /node_modules/,
    aggregateTimeout: 300,
    poll: 1000
  }
}
```

---

## è¿è¡Œæ—¶æ€§èƒ½ä¼˜åŒ–

### 1. ä»£ç åˆ†å‰²

å‚è€ƒ [ä»£ç åˆ†å‰²](./08-ä»£ç åˆ†å‰².md) ç« èŠ‚ã€‚

### 2. æ‡’åŠ è½½

```javascript
// React
const Component = lazy(() => import('./Component'))

// Vue
const Component = () => import('./Component.vue')
```

### 3. é¢„åŠ è½½å’Œé¢„è·å–

```javascript
// é¢„åŠ è½½ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰
import(/* webpackPreload: true */ './module')

// é¢„è·å–ï¼ˆä½ä¼˜å…ˆçº§ï¼‰
import(/* webpackPrefetch: true */ './module')
```

### 4. ä½¿ç”¨ CDN

```javascript
module.exports = {
  externals: {
    'react': 'React',
    'react-dom': 'ReactDOM'
  }
}
```

### 5. èµ„æºå‹ç¼©

```javascript
const CompressionPlugin = require('compression-webpack-plugin')

module.exports = {
  plugins: [
    new CompressionPlugin({
      algorithm: 'gzip'
    })
  ]
}
```

---

## æ€§èƒ½ç›‘æ§

### Speed Measure Plugin

```bash
npm install --save-dev speed-measure-webpack-plugin
```

```javascript
const SpeedMeasurePlugin = require('speed-measure-webpack-plugin')
const smp = new SpeedMeasurePlugin()

module.exports = smp.wrap({
  // webpack é…ç½®
})
```

### Bundle Analyzer

```bash
npm install --save-dev webpack-bundle-analyzer
```

```javascript
const BundleAnalyzerPlugin = require('webpack-bundle-analyzer').BundleAnalyzerPlugin

module.exports = {
  plugins: [
    new BundleAnalyzerPlugin()
  ]
}
```

---

## å®Œæ•´ä¼˜åŒ–é…ç½®ç¤ºä¾‹

```javascript
const path = require('path')
const TerserPlugin = require('terser-webpack-plugin')
const { CleanWebpackPlugin } = require('clean-webpack-plugin')

module.exports = {
  mode: 'production',
  
  // ç¼“å­˜
  cache: {
    type: 'filesystem',
    buildDependencies: {
      config: [__filename]
    }
  },
  
  // å‡å°‘è§£æèŒƒå›´
  resolve: {
    modules: [path.resolve(__dirname, 'src'), 'node_modules'],
    extensions: ['.js', '.json'],
    alias: {
      '@': path.resolve(__dirname, 'src')
    }
  },
  
  // ä¼˜åŒ–
  optimization: {
    minimize: true,
    minimizer: [
      new TerserPlugin({
        parallel: true,
        terserOptions: {
          compress: {
            drop_console: true
          }
        }
      })
    ],
    splitChunks: {
      chunks: 'all',
      cacheGroups: {
        vendor: {
          test: /[\\/]node_modules[\\/]/,
          name: 'vendors',
          priority: 10
        }
      }
    },
    runtimeChunk: 'single'
  },
  
  // ç›‘å¬ä¼˜åŒ–
  watchOptions: {
    ignored: /node_modules/
  }
}
```

---

## æœ€ä½³å®è·µ

### 1. å¼€å‘ç¯å¢ƒä¼˜åŒ–

- ä½¿ç”¨ `eval-source-map`ï¼ˆå¿«é€Ÿï¼‰
- ç¦ç”¨ä»£ç å‹ç¼©
- ä½¿ç”¨ HMR

### 2. ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–

- ä½¿ç”¨ `source-map` æˆ– `hidden-source-map`
- å¯ç”¨ä»£ç å‹ç¼©
- å¯ç”¨ Tree Shaking
- ä½¿ç”¨ contenthash

### 3. æ„å»ºé€Ÿåº¦ä¼˜åŒ–

- å¯ç”¨ç¼“å­˜
- å‡å°‘è§£æèŒƒå›´
- ä½¿ç”¨å¤šè¿›ç¨‹
- ä½¿ç”¨ DllPluginï¼ˆå¤§å‹é¡¹ç›®ï¼‰

### 4. è¿è¡Œæ—¶ä¼˜åŒ–

- ä»£ç åˆ†å‰²
- æ‡’åŠ è½½
- ä½¿ç”¨ CDN
- èµ„æºå‹ç¼©

---

## æ€»ç»“

- **æ„å»ºé€Ÿåº¦**ï¼šç¼“å­˜ã€å¤šè¿›ç¨‹ã€å‡å°‘è§£æèŒƒå›´
- **è¿è¡Œæ—¶æ€§èƒ½**ï¼šä»£ç åˆ†å‰²ã€æ‡’åŠ è½½ã€CDN
- **ç›‘æ§å·¥å…·**ï¼šSpeed Measureã€Bundle Analyzer
- **æœ€ä½³å®è·µ**ï¼šåŒºåˆ†å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒ

---

## ä¸‹ä¸€æ­¥

- [ä»£ç åˆ†å‰²](./08-ä»£ç åˆ†å‰².md) - æ·±å…¥å­¦ä¹ ä»£ç åˆ†å‰²
- [æœ€ä½³å®è·µ](./14-æœ€ä½³å®è·µ.md) - å­¦ä¹ æœ€ä½³å®è·µ
- [å®æˆ˜é¡¹ç›®ï¼šä»é›¶æ­å»º React é¡¹ç›®](./10-å®æˆ˜é¡¹ç›®-React.md) - å®è·µæ€§èƒ½ä¼˜åŒ–

---

#Webpack #æ€§èƒ½ä¼˜åŒ– #æ„å»ºé€Ÿåº¦ #è¿è¡Œæ—¶æ€§èƒ½

