/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var eu=Object.create;var ai=Object.defineProperty;var Au=Object.getOwnPropertyDescriptor;var tu=Object.getOwnPropertyNames;var iu=Object.getPrototypeOf,su=Object.prototype.hasOwnProperty;var ru=(y,A,e)=>A in y?ai(y,A,{enumerable:!0,configurable:!0,writable:!0,value:e}):y[A]=e;var cs=(y,A)=>()=>(y&&(A=y(y=0)),A);var nu=(y,A)=>()=>(A||y((A={exports:{}}).exports,A),A.exports),vo=(y,A)=>{for(var e in A)ai(y,e,{get:A[e],enumerable:!0})},Fo=(y,A,e,t)=>{if(A&&typeof A=="object"||typeof A=="function")for(let i of tu(A))!su.call(y,i)&&i!==e&&ai(y,i,{get:()=>A[i],enumerable:!(t=Au(A,i))||t.enumerable});return y};var yo=(y,A,e)=>(e=y!=null?eu(iu(y)):{},Fo(A||!y||!y.__esModule?ai(e,"default",{value:y,enumerable:!0}):e,y)),au=y=>Fo(ai({},"__esModule",{value:!0}),y);var Se=(y,A,e)=>ru(y,typeof A!="symbol"?A+"":A,e);var gn=nu((hn,dn)=>{(function(y,A){typeof hn=="object"&&typeof dn!="undefined"?dn.exports=A():typeof define=="function"&&define.amd?define(A):(y=typeof globalThis!="undefined"?globalThis:y||self,y.html2canvas=A())})(hn,function(){"use strict";var y=function(r,s){return y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,n){a.__proto__=n}||function(a,n){for(var d in n)Object.prototype.hasOwnProperty.call(n,d)&&(a[d]=n[d])},y(r,s)};function A(r,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");y(r,s);function a(){this.constructor=r}r.prototype=s===null?Object.create(s):(a.prototype=s.prototype,new a)}var e=function(){return e=Object.assign||function(s){for(var a,n=1,d=arguments.length;n<d;n++){a=arguments[n];for(var p in a)Object.prototype.hasOwnProperty.call(a,p)&&(s[p]=a[p])}return s},e.apply(this,arguments)};function t(r,s,a,n){function d(p){return p instanceof a?p:new a(function(B){B(p)})}return new(a||(a=Promise))(function(p,B){function v(S){try{U(n.next(S))}catch(I){B(I)}}function C(S){try{U(n.throw(S))}catch(I){B(I)}}function U(S){S.done?p(S.value):d(S.value).then(v,C)}U((n=n.apply(r,s||[])).next())})}function i(r,s){var a={label:0,sent:function(){if(p[0]&1)throw p[1];return p[1]},trys:[],ops:[]},n,d,p,B;return B={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(B[Symbol.iterator]=function(){return this}),B;function v(U){return function(S){return C([U,S])}}function C(U){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,d&&(p=U[0]&2?d.return:U[0]?d.throw||((p=d.return)&&p.call(d),0):d.next)&&!(p=p.call(d,U[1])).done)return p;switch(d=0,p&&(U=[U[0]&2,p.value]),U[0]){case 0:case 1:p=U;break;case 4:return a.label++,{value:U[1],done:!1};case 5:a.label++,d=U[1],U=[0];continue;case 7:U=a.ops.pop(),a.trys.pop();continue;default:if(p=a.trys,!(p=p.length>0&&p[p.length-1])&&(U[0]===6||U[0]===2)){a=0;continue}if(U[0]===3&&(!p||U[1]>p[0]&&U[1]<p[3])){a.label=U[1];break}if(U[0]===6&&a.label<p[1]){a.label=p[1],p=U;break}if(p&&a.label<p[2]){a.label=p[2],a.ops.push(U);break}p[2]&&a.ops.pop(),a.trys.pop();continue}U=s.call(r,a)}catch(S){U=[6,S],d=0}finally{n=p=0}if(U[0]&5)throw U[1];return{value:U[0]?U[1]:void 0,done:!0}}}function o(r,s,a){if(a||arguments.length===2)for(var n=0,d=s.length,p;n<d;n++)(p||!(n in s))&&(p||(p=Array.prototype.slice.call(s,0,n)),p[n]=s[n]);return r.concat(p||s)}for(var l=function(){function r(s,a,n,d){this.left=s,this.top=a,this.width=n,this.height=d}return r.prototype.add=function(s,a,n,d){return new r(this.left+s,this.top+a,this.width+n,this.height+d)},r.fromClientRect=function(s,a){return new r(a.left+s.windowBounds.left,a.top+s.windowBounds.top,a.width,a.height)},r.fromDOMRectList=function(s,a){var n=Array.from(a).find(function(d){return d.width!==0});return n?new r(n.left+s.windowBounds.left,n.top+s.windowBounds.top,n.width,n.height):r.EMPTY},r.EMPTY=new r(0,0,0,0),r}(),c=function(r,s){return l.fromClientRect(r,s.getBoundingClientRect())},h=function(r){var s=r.body,a=r.documentElement;if(!s||!a)throw new Error("Unable to get document size");var n=Math.max(Math.max(s.scrollWidth,a.scrollWidth),Math.max(s.offsetWidth,a.offsetWidth),Math.max(s.clientWidth,a.clientWidth)),d=Math.max(Math.max(s.scrollHeight,a.scrollHeight),Math.max(s.offsetHeight,a.offsetHeight),Math.max(s.clientHeight,a.clientHeight));return new l(0,0,n,d)},g=function(r){for(var s=[],a=0,n=r.length;a<n;){var d=r.charCodeAt(a++);if(d>=55296&&d<=56319&&a<n){var p=r.charCodeAt(a++);(p&64512)===56320?s.push(((d&1023)<<10)+(p&1023)+65536):(s.push(d),a--)}else s.push(d)}return s},u=function(){for(var r=[],s=0;s<arguments.length;s++)r[s]=arguments[s];if(String.fromCodePoint)return String.fromCodePoint.apply(String,r);var a=r.length;if(!a)return"";for(var n=[],d=-1,p="";++d<a;){var B=r[d];B<=65535?n.push(B):(B-=65536,n.push((B>>10)+55296,B%1024+56320)),(d+1===a||n.length>16384)&&(p+=String.fromCharCode.apply(String,n),n.length=0)}return p},m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",w=typeof Uint8Array=="undefined"?[]:new Uint8Array(256),F=0;F<m.length;F++)w[m.charCodeAt(F)]=F;for(var E="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Q=typeof Uint8Array=="undefined"?[]:new Uint8Array(256),H=0;H<E.length;H++)Q[E.charCodeAt(H)]=H;for(var x=function(r){var s=r.length*.75,a=r.length,n,d=0,p,B,v,C;r[r.length-1]==="="&&(s--,r[r.length-2]==="="&&s--);var U=typeof ArrayBuffer!="undefined"&&typeof Uint8Array!="undefined"&&typeof Uint8Array.prototype.slice!="undefined"?new ArrayBuffer(s):new Array(s),S=Array.isArray(U)?U:new Uint8Array(U);for(n=0;n<a;n+=4)p=Q[r.charCodeAt(n)],B=Q[r.charCodeAt(n+1)],v=Q[r.charCodeAt(n+2)],C=Q[r.charCodeAt(n+3)],S[d++]=p<<2|B>>4,S[d++]=(B&15)<<4|v>>2,S[d++]=(v&3)<<6|C&63;return U},P=function(r){for(var s=r.length,a=[],n=0;n<s;n+=2)a.push(r[n+1]<<8|r[n]);return a},M=function(r){for(var s=r.length,a=[],n=0;n<s;n+=4)a.push(r[n+3]<<24|r[n+2]<<16|r[n+1]<<8|r[n]);return a},D=5,O=11,J=2,se=O-D,W=65536>>D,ce=1<<D,we=ce-1,Ae=1024>>D,z=W+Ae,Le=z,ve=32,$e=Le+ve,Ze=65536>>O,Ye=1<<se,HA=Ye-1,KA=function(r,s,a){return r.slice?r.slice(s,a):new Uint16Array(Array.prototype.slice.call(r,s,a))},He=function(r,s,a){return r.slice?r.slice(s,a):new Uint32Array(Array.prototype.slice.call(r,s,a))},kA=function(r,s){var a=x(r),n=Array.isArray(a)?M(a):new Uint32Array(a),d=Array.isArray(a)?P(a):new Uint16Array(a),p=24,B=KA(d,p/2,n[4]/2),v=n[5]===2?KA(d,(p+n[4])/2):He(n,Math.ceil((p+n[4])/4));return new RA(n[0],n[1],n[2],n[3],B,v)},RA=function(){function r(s,a,n,d,p,B){this.initialValue=s,this.errorValue=a,this.highStart=n,this.highValueIndex=d,this.index=p,this.data=B}return r.prototype.get=function(s){var a;if(s>=0){if(s<55296||s>56319&&s<=65535)return a=this.index[s>>D],a=(a<<J)+(s&we),this.data[a];if(s<=65535)return a=this.index[W+(s-55296>>D)],a=(a<<J)+(s&we),this.data[a];if(s<this.highStart)return a=$e-Ze+(s>>O),a=this.index[a],a+=s>>D&HA,a=this.index[a],a=(a<<J)+(s&we),this.data[a];if(s<=1114111)return this.data[this.highValueIndex]}return this.errorValue},r}(),be="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",aA=typeof Uint8Array=="undefined"?[]:new Uint8Array(256),fe=0;fe<be.length;fe++)aA[be.charCodeAt(fe)]=fe;var Pe="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",Te=50,je=1,ye=2,Ke=3,Rt=4,Fe=5,BA=7,xe=8,In=9,OA=10,cr=11,Hn=12,hr=13,Zo=14,Ot=15,dr=16,yi=17,Nt=18,jo=19,bn=20,gr=21,Gt=22,ur=23,pt=24,oA=25,Vt=26,_t=27,ft=28,el=29,nt=30,Al=31,Ei=32,Qi=33,pr=34,fr=35,mr=36,Xt=37,Br=38,Ui=39,Si=40,wr=41,xn=42,tl=43,il=[9001,65288],Mn="!",re="\xD7",Ii="\xF7",Cr=kA(Pe),bA=[nt,mr],vr=[je,ye,Ke,Fe],Ln=[OA,xe],Tn=[_t,Vt],sl=vr.concat(Ln),Dn=[Br,Ui,Si,pr,fr],rl=[Ot,hr],nl=function(r,s){s===void 0&&(s="strict");var a=[],n=[],d=[];return r.forEach(function(p,B){var v=Cr.get(p);if(v>Te?(d.push(!0),v-=Te):d.push(!1),["normal","auto","loose"].indexOf(s)!==-1&&[8208,8211,12316,12448].indexOf(p)!==-1)return n.push(B),a.push(dr);if(v===Rt||v===cr){if(B===0)return n.push(B),a.push(nt);var C=a[B-1];return sl.indexOf(C)===-1?(n.push(n[B-1]),a.push(C)):(n.push(B),a.push(nt))}if(n.push(B),v===Al)return a.push(s==="strict"?gr:Xt);if(v===xn||v===el)return a.push(nt);if(v===tl)return p>=131072&&p<=196605||p>=196608&&p<=262141?a.push(Xt):a.push(nt);a.push(v)}),[n,a,d]},Fr=function(r,s,a,n){var d=n[a];if(Array.isArray(r)?r.indexOf(d)!==-1:r===d)for(var p=a;p<=n.length;){p++;var B=n[p];if(B===s)return!0;if(B!==OA)break}if(d===OA)for(var p=a;p>0;){p--;var v=n[p];if(Array.isArray(r)?r.indexOf(v)!==-1:r===v)for(var C=a;C<=n.length;){C++;var B=n[C];if(B===s)return!0;if(B!==OA)break}if(v!==OA)break}return!1},Pn=function(r,s){for(var a=r;a>=0;){var n=s[a];if(n===OA)a--;else return n}return 0},al=function(r,s,a,n,d){if(a[n]===0)return re;var p=n-1;if(Array.isArray(d)&&d[p]===!0)return re;var B=p-1,v=p+1,C=s[p],U=B>=0?s[B]:0,S=s[v];if(C===ye&&S===Ke)return re;if(vr.indexOf(C)!==-1)return Mn;if(vr.indexOf(S)!==-1||Ln.indexOf(S)!==-1)return re;if(Pn(p,s)===xe)return Ii;if(Cr.get(r[p])===cr||(C===Ei||C===Qi)&&Cr.get(r[v])===cr||C===BA||S===BA||C===In||[OA,hr,Ot].indexOf(C)===-1&&S===In||[yi,Nt,jo,pt,ft].indexOf(S)!==-1||Pn(p,s)===Gt||Fr(ur,Gt,p,s)||Fr([yi,Nt],gr,p,s)||Fr(Hn,Hn,p,s))return re;if(C===OA)return Ii;if(C===ur||S===ur)return re;if(S===dr||C===dr)return Ii;if([hr,Ot,gr].indexOf(S)!==-1||C===Zo||U===mr&&rl.indexOf(C)!==-1||C===ft&&S===mr||S===bn||bA.indexOf(S)!==-1&&C===oA||bA.indexOf(C)!==-1&&S===oA||C===_t&&[Xt,Ei,Qi].indexOf(S)!==-1||[Xt,Ei,Qi].indexOf(C)!==-1&&S===Vt||bA.indexOf(C)!==-1&&Tn.indexOf(S)!==-1||Tn.indexOf(C)!==-1&&bA.indexOf(S)!==-1||[_t,Vt].indexOf(C)!==-1&&(S===oA||[Gt,Ot].indexOf(S)!==-1&&s[v+1]===oA)||[Gt,Ot].indexOf(C)!==-1&&S===oA||C===oA&&[oA,ft,pt].indexOf(S)!==-1)return re;if([oA,ft,pt,yi,Nt].indexOf(S)!==-1)for(var I=p;I>=0;){var b=s[I];if(b===oA)return re;if([ft,pt].indexOf(b)!==-1)I--;else break}if([_t,Vt].indexOf(S)!==-1)for(var I=[yi,Nt].indexOf(C)!==-1?B:p;I>=0;){var b=s[I];if(b===oA)return re;if([ft,pt].indexOf(b)!==-1)I--;else break}if(Br===C&&[Br,Ui,pr,fr].indexOf(S)!==-1||[Ui,pr].indexOf(C)!==-1&&[Ui,Si].indexOf(S)!==-1||[Si,fr].indexOf(C)!==-1&&S===Si||Dn.indexOf(C)!==-1&&[bn,Vt].indexOf(S)!==-1||Dn.indexOf(S)!==-1&&C===_t||bA.indexOf(C)!==-1&&bA.indexOf(S)!==-1||C===pt&&bA.indexOf(S)!==-1||bA.concat(oA).indexOf(C)!==-1&&S===Gt&&il.indexOf(r[v])===-1||bA.concat(oA).indexOf(S)!==-1&&C===Nt)return re;if(C===wr&&S===wr){for(var N=a[p],L=1;N>0&&(N--,s[N]===wr);)L++;if(L%2!==0)return re}return C===Ei&&S===Qi?re:Ii},ol=function(r,s){s||(s={lineBreak:"normal",wordBreak:"normal"});var a=nl(r,s.lineBreak),n=a[0],d=a[1],p=a[2];(s.wordBreak==="break-all"||s.wordBreak==="break-word")&&(d=d.map(function(v){return[oA,nt,xn].indexOf(v)!==-1?Xt:v}));var B=s.wordBreak==="keep-all"?p.map(function(v,C){return v&&r[C]>=19968&&r[C]<=40959}):void 0;return[n,d,B]},ll=function(){function r(s,a,n,d){this.codePoints=s,this.required=a===Mn,this.start=n,this.end=d}return r.prototype.slice=function(){return u.apply(void 0,this.codePoints.slice(this.start,this.end))},r}(),cl=function(r,s){var a=g(r),n=ol(a,s),d=n[0],p=n[1],B=n[2],v=a.length,C=0,U=0;return{next:function(){if(U>=v)return{done:!0,value:null};for(var S=re;U<v&&(S=al(a,p,d,++U,B))===re;);if(S!==re||U===v){var I=new ll(a,S,C,U);return C=U,{value:I,done:!1}}return{done:!0,value:null}}}},hl=1,dl=2,Jt=4,Kn=8,Hi=10,kn=47,Wt=92,gl=9,ul=32,bi=34,$t=61,pl=35,fl=36,ml=37,xi=39,Mi=40,Yt=41,Bl=95,eA=45,wl=33,Cl=60,vl=62,Fl=64,yl=91,El=93,Ql=61,Ul=123,Li=63,Sl=125,Rn=124,Il=126,Hl=128,On=65533,yr=42,at=43,bl=44,xl=58,Ml=59,qt=46,Ll=0,Tl=8,Dl=11,Pl=14,Kl=31,kl=127,yA=-1,Nn=48,Gn=97,Vn=101,Rl=102,Ol=117,Nl=122,_n=65,Xn=69,Jn=70,Gl=85,Vl=90,Xe=function(r){return r>=Nn&&r<=57},_l=function(r){return r>=55296&&r<=57343},mt=function(r){return Xe(r)||r>=_n&&r<=Jn||r>=Gn&&r<=Rl},Xl=function(r){return r>=Gn&&r<=Nl},Jl=function(r){return r>=_n&&r<=Vl},Wl=function(r){return Xl(r)||Jl(r)},$l=function(r){return r>=Hl},Ti=function(r){return r===Hi||r===gl||r===ul},Di=function(r){return Wl(r)||$l(r)||r===Bl},Wn=function(r){return Di(r)||Xe(r)||r===eA},Yl=function(r){return r>=Ll&&r<=Tl||r===Dl||r>=Pl&&r<=Kl||r===kl},NA=function(r,s){return r!==Wt?!1:s!==Hi},Pi=function(r,s,a){return r===eA?Di(s)||NA(s,a):Di(r)?!0:!!(r===Wt&&NA(r,s))},Er=function(r,s,a){return r===at||r===eA?Xe(s)?!0:s===qt&&Xe(a):Xe(r===qt?s:r)},ql=function(r){var s=0,a=1;(r[s]===at||r[s]===eA)&&(r[s]===eA&&(a=-1),s++);for(var n=[];Xe(r[s]);)n.push(r[s++]);var d=n.length?parseInt(u.apply(void 0,n),10):0;r[s]===qt&&s++;for(var p=[];Xe(r[s]);)p.push(r[s++]);var B=p.length,v=B?parseInt(u.apply(void 0,p),10):0;(r[s]===Xn||r[s]===Vn)&&s++;var C=1;(r[s]===at||r[s]===eA)&&(r[s]===eA&&(C=-1),s++);for(var U=[];Xe(r[s]);)U.push(r[s++]);var S=U.length?parseInt(u.apply(void 0,U),10):0;return a*(d+v*Math.pow(10,-B))*Math.pow(10,C*S)},zl={type:2},Zl={type:3},jl={type:4},ec={type:13},Ac={type:8},tc={type:21},ic={type:9},sc={type:10},rc={type:11},nc={type:12},ac={type:14},Ki={type:23},oc={type:1},lc={type:25},cc={type:24},hc={type:26},dc={type:27},gc={type:28},uc={type:29},pc={type:31},Qr={type:32},$n=function(){function r(){this._value=[]}return r.prototype.write=function(s){this._value=this._value.concat(g(s))},r.prototype.read=function(){for(var s=[],a=this.consumeToken();a!==Qr;)s.push(a),a=this.consumeToken();return s},r.prototype.consumeToken=function(){var s=this.consumeCodePoint();switch(s){case bi:return this.consumeStringToken(bi);case pl:var a=this.peekCodePoint(0),n=this.peekCodePoint(1),d=this.peekCodePoint(2);if(Wn(a)||NA(n,d)){var p=Pi(a,n,d)?dl:hl,B=this.consumeName();return{type:5,value:B,flags:p}}break;case fl:if(this.peekCodePoint(0)===$t)return this.consumeCodePoint(),ec;break;case xi:return this.consumeStringToken(xi);case Mi:return zl;case Yt:return Zl;case yr:if(this.peekCodePoint(0)===$t)return this.consumeCodePoint(),ac;break;case at:if(Er(s,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(s),this.consumeNumericToken();break;case bl:return jl;case eA:var v=s,C=this.peekCodePoint(0),U=this.peekCodePoint(1);if(Er(v,C,U))return this.reconsumeCodePoint(s),this.consumeNumericToken();if(Pi(v,C,U))return this.reconsumeCodePoint(s),this.consumeIdentLikeToken();if(C===eA&&U===vl)return this.consumeCodePoint(),this.consumeCodePoint(),cc;break;case qt:if(Er(s,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(s),this.consumeNumericToken();break;case kn:if(this.peekCodePoint(0)===yr)for(this.consumeCodePoint();;){var S=this.consumeCodePoint();if(S===yr&&(S=this.consumeCodePoint(),S===kn))return this.consumeToken();if(S===yA)return this.consumeToken()}break;case xl:return hc;case Ml:return dc;case Cl:if(this.peekCodePoint(0)===wl&&this.peekCodePoint(1)===eA&&this.peekCodePoint(2)===eA)return this.consumeCodePoint(),this.consumeCodePoint(),lc;break;case Fl:var I=this.peekCodePoint(0),b=this.peekCodePoint(1),N=this.peekCodePoint(2);if(Pi(I,b,N)){var B=this.consumeName();return{type:7,value:B}}break;case yl:return gc;case Wt:if(NA(s,this.peekCodePoint(0)))return this.reconsumeCodePoint(s),this.consumeIdentLikeToken();break;case El:return uc;case Ql:if(this.peekCodePoint(0)===$t)return this.consumeCodePoint(),Ac;break;case Ul:return rc;case Sl:return nc;case Ol:case Gl:var L=this.peekCodePoint(0),K=this.peekCodePoint(1);return L===at&&(mt(K)||K===Li)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(s),this.consumeIdentLikeToken();case Rn:if(this.peekCodePoint(0)===$t)return this.consumeCodePoint(),ic;if(this.peekCodePoint(0)===Rn)return this.consumeCodePoint(),tc;break;case Il:if(this.peekCodePoint(0)===$t)return this.consumeCodePoint(),sc;break;case yA:return Qr}return Ti(s)?(this.consumeWhiteSpace(),pc):Xe(s)?(this.reconsumeCodePoint(s),this.consumeNumericToken()):Di(s)?(this.reconsumeCodePoint(s),this.consumeIdentLikeToken()):{type:6,value:u(s)}},r.prototype.consumeCodePoint=function(){var s=this._value.shift();return typeof s=="undefined"?-1:s},r.prototype.reconsumeCodePoint=function(s){this._value.unshift(s)},r.prototype.peekCodePoint=function(s){return s>=this._value.length?-1:this._value[s]},r.prototype.consumeUnicodeRangeToken=function(){for(var s=[],a=this.consumeCodePoint();mt(a)&&s.length<6;)s.push(a),a=this.consumeCodePoint();for(var n=!1;a===Li&&s.length<6;)s.push(a),a=this.consumeCodePoint(),n=!0;if(n){var d=parseInt(u.apply(void 0,s.map(function(C){return C===Li?Nn:C})),16),p=parseInt(u.apply(void 0,s.map(function(C){return C===Li?Jn:C})),16);return{type:30,start:d,end:p}}var B=parseInt(u.apply(void 0,s),16);if(this.peekCodePoint(0)===eA&&mt(this.peekCodePoint(1))){this.consumeCodePoint(),a=this.consumeCodePoint();for(var v=[];mt(a)&&v.length<6;)v.push(a),a=this.consumeCodePoint();var p=parseInt(u.apply(void 0,v),16);return{type:30,start:B,end:p}}else return{type:30,start:B,end:B}},r.prototype.consumeIdentLikeToken=function(){var s=this.consumeName();return s.toLowerCase()==="url"&&this.peekCodePoint(0)===Mi?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===Mi?(this.consumeCodePoint(),{type:19,value:s}):{type:20,value:s}},r.prototype.consumeUrlToken=function(){var s=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===yA)return{type:22,value:""};var a=this.peekCodePoint(0);if(a===xi||a===bi){var n=this.consumeStringToken(this.consumeCodePoint());return n.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===yA||this.peekCodePoint(0)===Yt)?(this.consumeCodePoint(),{type:22,value:n.value}):(this.consumeBadUrlRemnants(),Ki)}for(;;){var d=this.consumeCodePoint();if(d===yA||d===Yt)return{type:22,value:u.apply(void 0,s)};if(Ti(d))return this.consumeWhiteSpace(),this.peekCodePoint(0)===yA||this.peekCodePoint(0)===Yt?(this.consumeCodePoint(),{type:22,value:u.apply(void 0,s)}):(this.consumeBadUrlRemnants(),Ki);if(d===bi||d===xi||d===Mi||Yl(d))return this.consumeBadUrlRemnants(),Ki;if(d===Wt)if(NA(d,this.peekCodePoint(0)))s.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),Ki;else s.push(d)}},r.prototype.consumeWhiteSpace=function(){for(;Ti(this.peekCodePoint(0));)this.consumeCodePoint()},r.prototype.consumeBadUrlRemnants=function(){for(;;){var s=this.consumeCodePoint();if(s===Yt||s===yA)return;NA(s,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},r.prototype.consumeStringSlice=function(s){for(var a=5e4,n="";s>0;){var d=Math.min(a,s);n+=u.apply(void 0,this._value.splice(0,d)),s-=d}return this._value.shift(),n},r.prototype.consumeStringToken=function(s){var a="",n=0;do{var d=this._value[n];if(d===yA||d===void 0||d===s)return a+=this.consumeStringSlice(n),{type:0,value:a};if(d===Hi)return this._value.splice(0,n),oc;if(d===Wt){var p=this._value[n+1];p!==yA&&p!==void 0&&(p===Hi?(a+=this.consumeStringSlice(n),n=-1,this._value.shift()):NA(d,p)&&(a+=this.consumeStringSlice(n),a+=u(this.consumeEscapedCodePoint()),n=-1))}n++}while(!0)},r.prototype.consumeNumber=function(){var s=[],a=Jt,n=this.peekCodePoint(0);for((n===at||n===eA)&&s.push(this.consumeCodePoint());Xe(this.peekCodePoint(0));)s.push(this.consumeCodePoint());n=this.peekCodePoint(0);var d=this.peekCodePoint(1);if(n===qt&&Xe(d))for(s.push(this.consumeCodePoint(),this.consumeCodePoint()),a=Kn;Xe(this.peekCodePoint(0));)s.push(this.consumeCodePoint());n=this.peekCodePoint(0),d=this.peekCodePoint(1);var p=this.peekCodePoint(2);if((n===Xn||n===Vn)&&((d===at||d===eA)&&Xe(p)||Xe(d)))for(s.push(this.consumeCodePoint(),this.consumeCodePoint()),a=Kn;Xe(this.peekCodePoint(0));)s.push(this.consumeCodePoint());return[ql(s),a]},r.prototype.consumeNumericToken=function(){var s=this.consumeNumber(),a=s[0],n=s[1],d=this.peekCodePoint(0),p=this.peekCodePoint(1),B=this.peekCodePoint(2);if(Pi(d,p,B)){var v=this.consumeName();return{type:15,number:a,flags:n,unit:v}}return d===ml?(this.consumeCodePoint(),{type:16,number:a,flags:n}):{type:17,number:a,flags:n}},r.prototype.consumeEscapedCodePoint=function(){var s=this.consumeCodePoint();if(mt(s)){for(var a=u(s);mt(this.peekCodePoint(0))&&a.length<6;)a+=u(this.consumeCodePoint());Ti(this.peekCodePoint(0))&&this.consumeCodePoint();var n=parseInt(a,16);return n===0||_l(n)||n>1114111?On:n}return s===yA?On:s},r.prototype.consumeName=function(){for(var s="";;){var a=this.consumeCodePoint();if(Wn(a))s+=u(a);else if(NA(a,this.peekCodePoint(0)))s+=u(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(a),s}},r}(),Yn=function(){function r(s){this._tokens=s}return r.create=function(s){var a=new $n;return a.write(s),new r(a.read())},r.parseValue=function(s){return r.create(s).parseComponentValue()},r.parseValues=function(s){return r.create(s).parseComponentValues()},r.prototype.parseComponentValue=function(){for(var s=this.consumeToken();s.type===31;)s=this.consumeToken();if(s.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(s);var a=this.consumeComponentValue();do s=this.consumeToken();while(s.type===31);if(s.type===32)return a;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},r.prototype.parseComponentValues=function(){for(var s=[];;){var a=this.consumeComponentValue();if(a.type===32)return s;s.push(a),s.push()}},r.prototype.consumeComponentValue=function(){var s=this.consumeToken();switch(s.type){case 11:case 28:case 2:return this.consumeSimpleBlock(s.type);case 19:return this.consumeFunction(s)}return s},r.prototype.consumeSimpleBlock=function(s){for(var a={type:s,values:[]},n=this.consumeToken();;){if(n.type===32||mc(n,s))return a;this.reconsumeToken(n),a.values.push(this.consumeComponentValue()),n=this.consumeToken()}},r.prototype.consumeFunction=function(s){for(var a={name:s.value,values:[],type:18};;){var n=this.consumeToken();if(n.type===32||n.type===3)return a;this.reconsumeToken(n),a.values.push(this.consumeComponentValue())}},r.prototype.consumeToken=function(){var s=this._tokens.shift();return typeof s=="undefined"?Qr:s},r.prototype.reconsumeToken=function(s){this._tokens.unshift(s)},r}(),zt=function(r){return r.type===15},Bt=function(r){return r.type===17},ue=function(r){return r.type===20},fc=function(r){return r.type===0},Ur=function(r,s){return ue(r)&&r.value===s},qn=function(r){return r.type!==31},wt=function(r){return r.type!==31&&r.type!==4},EA=function(r){var s=[],a=[];return r.forEach(function(n){if(n.type===4){if(a.length===0)throw new Error("Error parsing function args, zero tokens for arg");s.push(a),a=[];return}n.type!==31&&a.push(n)}),a.length&&s.push(a),s},mc=function(r,s){return s===11&&r.type===12||s===28&&r.type===29?!0:s===2&&r.type===3},GA=function(r){return r.type===17||r.type===15},Qe=function(r){return r.type===16||GA(r)},zn=function(r){return r.length>1?[r[0],r[1]]:[r[0]]},ke={type:17,number:0,flags:Jt},Sr={type:16,number:50,flags:Jt},VA={type:16,number:100,flags:Jt},Zt=function(r,s,a){var n=r[0],d=r[1];return[me(n,s),me(typeof d!="undefined"?d:n,a)]},me=function(r,s){if(r.type===16)return r.number/100*s;if(zt(r))switch(r.unit){case"rem":case"em":return 16*r.number;case"px":default:return r.number}return r.number},Zn="deg",jn="grad",ea="rad",Aa="turn",ki={name:"angle",parse:function(r,s){if(s.type===15)switch(s.unit){case Zn:return Math.PI*s.number/180;case jn:return Math.PI/200*s.number;case ea:return s.number;case Aa:return Math.PI*2*s.number}throw new Error("Unsupported angle type")}},ta=function(r){return r.type===15&&(r.unit===Zn||r.unit===jn||r.unit===ea||r.unit===Aa)},ia=function(r){var s=r.filter(ue).map(function(a){return a.value}).join(" ");switch(s){case"to bottom right":case"to right bottom":case"left top":case"top left":return[ke,ke];case"to top":case"bottom":return hA(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[ke,VA];case"to right":case"left":return hA(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[VA,VA];case"to bottom":case"top":return hA(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[VA,ke];case"to left":case"right":return hA(270)}return 0},hA=function(r){return Math.PI*r/180},_A={name:"color",parse:function(r,s){if(s.type===18){var a=Bc[s.name];if(typeof a=="undefined")throw new Error('Attempting to parse an unsupported color function "'+s.name+'"');return a(r,s.values)}if(s.type===5){if(s.value.length===3){var n=s.value.substring(0,1),d=s.value.substring(1,2),p=s.value.substring(2,3);return JA(parseInt(n+n,16),parseInt(d+d,16),parseInt(p+p,16),1)}if(s.value.length===4){var n=s.value.substring(0,1),d=s.value.substring(1,2),p=s.value.substring(2,3),B=s.value.substring(3,4);return JA(parseInt(n+n,16),parseInt(d+d,16),parseInt(p+p,16),parseInt(B+B,16)/255)}if(s.value.length===6){var n=s.value.substring(0,2),d=s.value.substring(2,4),p=s.value.substring(4,6);return JA(parseInt(n,16),parseInt(d,16),parseInt(p,16),1)}if(s.value.length===8){var n=s.value.substring(0,2),d=s.value.substring(2,4),p=s.value.substring(4,6),B=s.value.substring(6,8);return JA(parseInt(n,16),parseInt(d,16),parseInt(p,16),parseInt(B,16)/255)}}if(s.type===20){var v=xA[s.value.toUpperCase()];if(typeof v!="undefined")return v}return xA.TRANSPARENT}},XA=function(r){return(255&r)===0},De=function(r){var s=255&r,a=255&r>>8,n=255&r>>16,d=255&r>>24;return s<255?"rgba("+d+","+n+","+a+","+s/255+")":"rgb("+d+","+n+","+a+")"},JA=function(r,s,a,n){return(r<<24|s<<16|a<<8|Math.round(n*255)<<0)>>>0},sa=function(r,s){if(r.type===17)return r.number;if(r.type===16){var a=s===3?1:255;return s===3?r.number/100*a:Math.round(r.number/100*a)}return 0},ra=function(r,s){var a=s.filter(wt);if(a.length===3){var n=a.map(sa),d=n[0],p=n[1],B=n[2];return JA(d,p,B,1)}if(a.length===4){var v=a.map(sa),d=v[0],p=v[1],B=v[2],C=v[3];return JA(d,p,B,C)}return 0};function Ir(r,s,a){return a<0&&(a+=1),a>=1&&(a-=1),a<1/6?(s-r)*a*6+r:a<1/2?s:a<2/3?(s-r)*6*(2/3-a)+r:r}var na=function(r,s){var a=s.filter(wt),n=a[0],d=a[1],p=a[2],B=a[3],v=(n.type===17?hA(n.number):ki.parse(r,n))/(Math.PI*2),C=Qe(d)?d.number/100:0,U=Qe(p)?p.number/100:0,S=typeof B!="undefined"&&Qe(B)?me(B,1):1;if(C===0)return JA(U*255,U*255,U*255,1);var I=U<=.5?U*(C+1):U+C-U*C,b=U*2-I,N=Ir(b,I,v+1/3),L=Ir(b,I,v),K=Ir(b,I,v-1/3);return JA(N*255,L*255,K*255,S)},Bc={hsl:na,hsla:na,rgb:ra,rgba:ra},jt=function(r,s){return _A.parse(r,Yn.create(s).parseComponentValue())},xA={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},wc={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(r,s){return s.map(function(a){if(ue(a))switch(a.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},Cc={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Ri=function(r,s){var a=_A.parse(r,s[0]),n=s[1];return n&&Qe(n)?{color:a,stop:n}:{color:a,stop:null}},aa=function(r,s){var a=r[0],n=r[r.length-1];a.stop===null&&(a.stop=ke),n.stop===null&&(n.stop=VA);for(var d=[],p=0,B=0;B<r.length;B++){var v=r[B].stop;if(v!==null){var C=me(v,s);C>p?d.push(C):d.push(p),p=C}else d.push(null)}for(var U=null,B=0;B<d.length;B++){var S=d[B];if(S===null)U===null&&(U=B);else if(U!==null){for(var I=B-U,b=d[U-1],N=(S-b)/(I+1),L=1;L<=I;L++)d[U+L-1]=N*L;U=null}}return r.map(function(K,Z){var _=K.color;return{color:_,stop:Math.max(Math.min(1,d[Z]/s),0)}})},vc=function(r,s,a){var n=s/2,d=a/2,p=me(r[0],s)-n,B=d-me(r[1],a);return(Math.atan2(B,p)+Math.PI*2)%(Math.PI*2)},Fc=function(r,s,a){var n=typeof r=="number"?r:vc(r,s,a),d=Math.abs(s*Math.sin(n))+Math.abs(a*Math.cos(n)),p=s/2,B=a/2,v=d/2,C=Math.sin(n-Math.PI/2)*v,U=Math.cos(n-Math.PI/2)*v;return[d,p-U,p+U,B-C,B+C]},wA=function(r,s){return Math.sqrt(r*r+s*s)},oa=function(r,s,a,n,d){var p=[[0,0],[0,s],[r,0],[r,s]];return p.reduce(function(B,v){var C=v[0],U=v[1],S=wA(a-C,n-U);return(d?S<B.optimumDistance:S>B.optimumDistance)?{optimumCorner:v,optimumDistance:S}:B},{optimumDistance:d?1/0:-1/0,optimumCorner:null}).optimumCorner},yc=function(r,s,a,n,d){var p=0,B=0;switch(r.size){case 0:r.shape===0?p=B=Math.min(Math.abs(s),Math.abs(s-n),Math.abs(a),Math.abs(a-d)):r.shape===1&&(p=Math.min(Math.abs(s),Math.abs(s-n)),B=Math.min(Math.abs(a),Math.abs(a-d)));break;case 2:if(r.shape===0)p=B=Math.min(wA(s,a),wA(s,a-d),wA(s-n,a),wA(s-n,a-d));else if(r.shape===1){var v=Math.min(Math.abs(a),Math.abs(a-d))/Math.min(Math.abs(s),Math.abs(s-n)),C=oa(n,d,s,a,!0),U=C[0],S=C[1];p=wA(U-s,(S-a)/v),B=v*p}break;case 1:r.shape===0?p=B=Math.max(Math.abs(s),Math.abs(s-n),Math.abs(a),Math.abs(a-d)):r.shape===1&&(p=Math.max(Math.abs(s),Math.abs(s-n)),B=Math.max(Math.abs(a),Math.abs(a-d)));break;case 3:if(r.shape===0)p=B=Math.max(wA(s,a),wA(s,a-d),wA(s-n,a),wA(s-n,a-d));else if(r.shape===1){var v=Math.max(Math.abs(a),Math.abs(a-d))/Math.max(Math.abs(s),Math.abs(s-n)),I=oa(n,d,s,a,!1),U=I[0],S=I[1];p=wA(U-s,(S-a)/v),B=v*p}break}return Array.isArray(r.size)&&(p=me(r.size[0],n),B=r.size.length===2?me(r.size[1],d):p),[p,B]},Ec=function(r,s){var a=hA(180),n=[];return EA(s).forEach(function(d,p){if(p===0){var B=d[0];if(B.type===20&&B.value==="to"){a=ia(d);return}else if(ta(B)){a=ki.parse(r,B);return}}var v=Ri(r,d);n.push(v)}),{angle:a,stops:n,type:1}},Oi=function(r,s){var a=hA(180),n=[];return EA(s).forEach(function(d,p){if(p===0){var B=d[0];if(B.type===20&&["top","left","right","bottom"].indexOf(B.value)!==-1){a=ia(d);return}else if(ta(B)){a=(ki.parse(r,B)+hA(270))%hA(360);return}}var v=Ri(r,d);n.push(v)}),{angle:a,stops:n,type:1}},Qc=function(r,s){var a=hA(180),n=[],d=1,p=0,B=3,v=[];return EA(s).forEach(function(C,U){var S=C[0];if(U===0){if(ue(S)&&S.value==="linear"){d=1;return}else if(ue(S)&&S.value==="radial"){d=2;return}}if(S.type===18){if(S.name==="from"){var I=_A.parse(r,S.values[0]);n.push({stop:ke,color:I})}else if(S.name==="to"){var I=_A.parse(r,S.values[0]);n.push({stop:VA,color:I})}else if(S.name==="color-stop"){var b=S.values.filter(wt);if(b.length===2){var I=_A.parse(r,b[1]),N=b[0];Bt(N)&&n.push({stop:{type:16,number:N.number*100,flags:N.flags},color:I})}}}}),d===1?{angle:(a+hA(180))%hA(360),stops:n,type:d}:{size:B,shape:p,stops:n,position:v,type:d}},la="closest-side",ca="farthest-side",ha="closest-corner",da="farthest-corner",ga="circle",ua="ellipse",pa="cover",fa="contain",Uc=function(r,s){var a=0,n=3,d=[],p=[];return EA(s).forEach(function(B,v){var C=!0;if(v===0){var U=!1;C=B.reduce(function(I,b){if(U)if(ue(b))switch(b.value){case"center":return p.push(Sr),I;case"top":case"left":return p.push(ke),I;case"right":case"bottom":return p.push(VA),I}else(Qe(b)||GA(b))&&p.push(b);else if(ue(b))switch(b.value){case ga:return a=0,!1;case ua:return a=1,!1;case"at":return U=!0,!1;case la:return n=0,!1;case pa:case ca:return n=1,!1;case fa:case ha:return n=2,!1;case da:return n=3,!1}else if(GA(b)||Qe(b))return Array.isArray(n)||(n=[]),n.push(b),!1;return I},C)}if(C){var S=Ri(r,B);d.push(S)}}),{size:n,shape:a,stops:d,position:p,type:2}},Ni=function(r,s){var a=0,n=3,d=[],p=[];return EA(s).forEach(function(B,v){var C=!0;if(v===0?C=B.reduce(function(S,I){if(ue(I))switch(I.value){case"center":return p.push(Sr),!1;case"top":case"left":return p.push(ke),!1;case"right":case"bottom":return p.push(VA),!1}else if(Qe(I)||GA(I))return p.push(I),!1;return S},C):v===1&&(C=B.reduce(function(S,I){if(ue(I))switch(I.value){case ga:return a=0,!1;case ua:return a=1,!1;case fa:case la:return n=0,!1;case ca:return n=1,!1;case ha:return n=2,!1;case pa:case da:return n=3,!1}else if(GA(I)||Qe(I))return Array.isArray(n)||(n=[]),n.push(I),!1;return S},C)),C){var U=Ri(r,B);d.push(U)}}),{size:n,shape:a,stops:d,position:p,type:2}},Sc=function(r){return r.type===1},Ic=function(r){return r.type===2},Hr={name:"image",parse:function(r,s){if(s.type===22){var a={url:s.value,type:0};return r.cache.addImage(s.value),a}if(s.type===18){var n=ma[s.name];if(typeof n=="undefined")throw new Error('Attempting to parse an unsupported image function "'+s.name+'"');return n(r,s.values)}throw new Error("Unsupported image type "+s.type)}};function Hc(r){return!(r.type===20&&r.value==="none")&&(r.type!==18||!!ma[r.name])}var ma={"linear-gradient":Ec,"-moz-linear-gradient":Oi,"-ms-linear-gradient":Oi,"-o-linear-gradient":Oi,"-webkit-linear-gradient":Oi,"radial-gradient":Uc,"-moz-radial-gradient":Ni,"-ms-radial-gradient":Ni,"-o-radial-gradient":Ni,"-webkit-radial-gradient":Ni,"-webkit-gradient":Qc},bc={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(r,s){if(s.length===0)return[];var a=s[0];return a.type===20&&a.value==="none"?[]:s.filter(function(n){return wt(n)&&Hc(n)}).map(function(n){return Hr.parse(r,n)})}},xc={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(r,s){return s.map(function(a){if(ue(a))switch(a.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},Mc={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(r,s){return EA(s).map(function(a){return a.filter(Qe)}).map(zn)}},Lc={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(r,s){return EA(s).map(function(a){return a.filter(ue).map(function(n){return n.value}).join(" ")}).map(Tc)}},Tc=function(r){switch(r){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},Ct;(function(r){r.AUTO="auto",r.CONTAIN="contain",r.COVER="cover"})(Ct||(Ct={}));var Dc={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(r,s){return EA(s).map(function(a){return a.filter(Pc)})}},Pc=function(r){return ue(r)||Qe(r)},Gi=function(r){return{name:"border-"+r+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},Kc=Gi("top"),kc=Gi("right"),Rc=Gi("bottom"),Oc=Gi("left"),Vi=function(r){return{name:"border-radius-"+r,initialValue:"0 0",prefix:!1,type:1,parse:function(s,a){return zn(a.filter(Qe))}}},Nc=Vi("top-left"),Gc=Vi("top-right"),Vc=Vi("bottom-right"),_c=Vi("bottom-left"),_i=function(r){return{name:"border-"+r+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(s,a){switch(a){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},Xc=_i("top"),Jc=_i("right"),Wc=_i("bottom"),$c=_i("left"),Xi=function(r){return{name:"border-"+r+"-width",initialValue:"0",type:0,prefix:!1,parse:function(s,a){return zt(a)?a.number:0}}},Yc=Xi("top"),qc=Xi("right"),zc=Xi("bottom"),Zc=Xi("left"),jc={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},eh={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(r,s){switch(s){case"rtl":return 1;case"ltr":default:return 0}}},Ah={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(r,s){return s.filter(ue).reduce(function(a,n){return a|th(n.value)},0)}},th=function(r){switch(r){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},ih={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(r,s){switch(s){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},sh={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(r,s){return s.type===20&&s.value==="normal"?0:s.type===17||s.type===15?s.number:0}},Ji;(function(r){r.NORMAL="normal",r.STRICT="strict"})(Ji||(Ji={}));var rh={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(r,s){switch(s){case"strict":return Ji.STRICT;case"normal":default:return Ji.NORMAL}}},nh={name:"line-height",initialValue:"normal",prefix:!1,type:4},Ba=function(r,s){return ue(r)&&r.value==="normal"?1.2*s:r.type===17?s*r.number:Qe(r)?me(r,s):s},ah={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(r,s){return s.type===20&&s.value==="none"?null:Hr.parse(r,s)}},oh={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(r,s){switch(s){case"inside":return 0;case"outside":default:return 1}}},br={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(r,s){switch(s){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},Wi=function(r){return{name:"margin-"+r,initialValue:"0",prefix:!1,type:4}},lh=Wi("top"),ch=Wi("right"),hh=Wi("bottom"),dh=Wi("left"),gh={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(r,s){return s.filter(ue).map(function(a){switch(a.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},uh={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(r,s){switch(s){case"break-word":return"break-word";case"normal":default:return"normal"}}},$i=function(r){return{name:"padding-"+r,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},ph=$i("top"),fh=$i("right"),mh=$i("bottom"),Bh=$i("left"),wh={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(r,s){switch(s){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},Ch={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(r,s){switch(s){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},vh={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(r,s){return s.length===1&&Ur(s[0],"none")?[]:EA(s).map(function(a){for(var n={color:xA.TRANSPARENT,offsetX:ke,offsetY:ke,blur:ke},d=0,p=0;p<a.length;p++){var B=a[p];GA(B)?(d===0?n.offsetX=B:d===1?n.offsetY=B:n.blur=B,d++):n.color=_A.parse(r,B)}return n})}},Fh={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(r,s){switch(s){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},yh={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(r,s){if(s.type===20&&s.value==="none")return null;if(s.type===18){var a=Uh[s.name];if(typeof a=="undefined")throw new Error('Attempting to parse an unsupported transform function "'+s.name+'"');return a(s.values)}return null}},Eh=function(r){var s=r.filter(function(a){return a.type===17}).map(function(a){return a.number});return s.length===6?s:null},Qh=function(r){var s=r.filter(function(C){return C.type===17}).map(function(C){return C.number}),a=s[0],n=s[1];s[2],s[3];var d=s[4],p=s[5];s[6],s[7],s[8],s[9],s[10],s[11];var B=s[12],v=s[13];return s[14],s[15],s.length===16?[a,n,d,p,B,v]:null},Uh={matrix:Eh,matrix3d:Qh},wa={type:16,number:50,flags:Jt},Sh=[wa,wa],Ih={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(r,s){var a=s.filter(Qe);return a.length!==2?Sh:[a[0],a[1]]}},Hh={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(r,s){switch(s){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},ei;(function(r){r.NORMAL="normal",r.BREAK_ALL="break-all",r.KEEP_ALL="keep-all"})(ei||(ei={}));for(var bh={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(r,s){switch(s){case"break-all":return ei.BREAK_ALL;case"keep-all":return ei.KEEP_ALL;case"normal":default:return ei.NORMAL}}},xh={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(r,s){if(s.type===20)return{auto:!0,order:0};if(Bt(s))return{auto:!1,order:s.number};throw new Error("Invalid z-index number parsed")}},Ca={name:"time",parse:function(r,s){if(s.type===15)switch(s.unit.toLowerCase()){case"s":return 1e3*s.number;case"ms":return s.number}throw new Error("Unsupported time type")}},Mh={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(r,s){return Bt(s)?s.number:1}},Lh={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Th={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(r,s){return s.filter(ue).map(function(a){switch(a.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(a){return a!==0})}},Dh={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(r,s){var a=[],n=[];return s.forEach(function(d){switch(d.type){case 20:case 0:a.push(d.value);break;case 17:a.push(d.number.toString());break;case 4:n.push(a.join(" ")),a.length=0;break}}),a.length&&n.push(a.join(" ")),n.map(function(d){return d.indexOf(" ")===-1?d:"'"+d+"'"})}},Ph={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},Kh={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(r,s){if(Bt(s))return s.number;if(ue(s))switch(s.value){case"bold":return 700;case"normal":default:return 400}return 400}},kh={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(r,s){return s.filter(ue).map(function(a){return a.value})}},Rh={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(r,s){switch(s){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},Me=function(r,s){return(r&s)!==0},Oh={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(r,s){if(s.length===0)return[];var a=s[0];return a.type===20&&a.value==="none"?[]:s}},Nh={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(r,s){if(s.length===0)return null;var a=s[0];if(a.type===20&&a.value==="none")return null;for(var n=[],d=s.filter(qn),p=0;p<d.length;p++){var B=d[p],v=d[p+1];if(B.type===20){var C=v&&Bt(v)?v.number:1;n.push({counter:B.value,increment:C})}}return n}},Gh={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(r,s){if(s.length===0)return[];for(var a=[],n=s.filter(qn),d=0;d<n.length;d++){var p=n[d],B=n[d+1];if(ue(p)&&p.value!=="none"){var v=B&&Bt(B)?B.number:0;a.push({counter:p.value,reset:v})}}return a}},Vh={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(r,s){return s.filter(zt).map(function(a){return Ca.parse(r,a)})}},_h={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(r,s){if(s.length===0)return null;var a=s[0];if(a.type===20&&a.value==="none")return null;var n=[],d=s.filter(fc);if(d.length%2!==0)return null;for(var p=0;p<d.length;p+=2){var B=d[p].value,v=d[p+1].value;n.push({open:B,close:v})}return n}},va=function(r,s,a){if(!r)return"";var n=r[Math.min(s,r.length-1)];return n?a?n.open:n.close:""},Xh={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(r,s){return s.length===1&&Ur(s[0],"none")?[]:EA(s).map(function(a){for(var n={color:255,offsetX:ke,offsetY:ke,blur:ke,spread:ke,inset:!1},d=0,p=0;p<a.length;p++){var B=a[p];Ur(B,"inset")?n.inset=!0:GA(B)?(d===0?n.offsetX=B:d===1?n.offsetY=B:d===2?n.blur=B:n.spread=B,d++):n.color=_A.parse(r,B)}return n})}},Jh={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(r,s){var a=[0,1,2],n=[];return s.filter(ue).forEach(function(d){switch(d.value){case"stroke":n.push(1);break;case"fill":n.push(0);break;case"markers":n.push(2);break}}),a.forEach(function(d){n.indexOf(d)===-1&&n.push(d)}),n}},Wh={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},$h={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(r,s){return zt(s)?s.number:0}},Yh=function(){function r(s,a){var n,d;this.animationDuration=G(s,Vh,a.animationDuration),this.backgroundClip=G(s,wc,a.backgroundClip),this.backgroundColor=G(s,Cc,a.backgroundColor),this.backgroundImage=G(s,bc,a.backgroundImage),this.backgroundOrigin=G(s,xc,a.backgroundOrigin),this.backgroundPosition=G(s,Mc,a.backgroundPosition),this.backgroundRepeat=G(s,Lc,a.backgroundRepeat),this.backgroundSize=G(s,Dc,a.backgroundSize),this.borderTopColor=G(s,Kc,a.borderTopColor),this.borderRightColor=G(s,kc,a.borderRightColor),this.borderBottomColor=G(s,Rc,a.borderBottomColor),this.borderLeftColor=G(s,Oc,a.borderLeftColor),this.borderTopLeftRadius=G(s,Nc,a.borderTopLeftRadius),this.borderTopRightRadius=G(s,Gc,a.borderTopRightRadius),this.borderBottomRightRadius=G(s,Vc,a.borderBottomRightRadius),this.borderBottomLeftRadius=G(s,_c,a.borderBottomLeftRadius),this.borderTopStyle=G(s,Xc,a.borderTopStyle),this.borderRightStyle=G(s,Jc,a.borderRightStyle),this.borderBottomStyle=G(s,Wc,a.borderBottomStyle),this.borderLeftStyle=G(s,$c,a.borderLeftStyle),this.borderTopWidth=G(s,Yc,a.borderTopWidth),this.borderRightWidth=G(s,qc,a.borderRightWidth),this.borderBottomWidth=G(s,zc,a.borderBottomWidth),this.borderLeftWidth=G(s,Zc,a.borderLeftWidth),this.boxShadow=G(s,Xh,a.boxShadow),this.color=G(s,jc,a.color),this.direction=G(s,eh,a.direction),this.display=G(s,Ah,a.display),this.float=G(s,ih,a.cssFloat),this.fontFamily=G(s,Dh,a.fontFamily),this.fontSize=G(s,Ph,a.fontSize),this.fontStyle=G(s,Rh,a.fontStyle),this.fontVariant=G(s,kh,a.fontVariant),this.fontWeight=G(s,Kh,a.fontWeight),this.letterSpacing=G(s,sh,a.letterSpacing),this.lineBreak=G(s,rh,a.lineBreak),this.lineHeight=G(s,nh,a.lineHeight),this.listStyleImage=G(s,ah,a.listStyleImage),this.listStylePosition=G(s,oh,a.listStylePosition),this.listStyleType=G(s,br,a.listStyleType),this.marginTop=G(s,lh,a.marginTop),this.marginRight=G(s,ch,a.marginRight),this.marginBottom=G(s,hh,a.marginBottom),this.marginLeft=G(s,dh,a.marginLeft),this.opacity=G(s,Mh,a.opacity);var p=G(s,gh,a.overflow);this.overflowX=p[0],this.overflowY=p[p.length>1?1:0],this.overflowWrap=G(s,uh,a.overflowWrap),this.paddingTop=G(s,ph,a.paddingTop),this.paddingRight=G(s,fh,a.paddingRight),this.paddingBottom=G(s,mh,a.paddingBottom),this.paddingLeft=G(s,Bh,a.paddingLeft),this.paintOrder=G(s,Jh,a.paintOrder),this.position=G(s,Ch,a.position),this.textAlign=G(s,wh,a.textAlign),this.textDecorationColor=G(s,Lh,(n=a.textDecorationColor)!==null&&n!==void 0?n:a.color),this.textDecorationLine=G(s,Th,(d=a.textDecorationLine)!==null&&d!==void 0?d:a.textDecoration),this.textShadow=G(s,vh,a.textShadow),this.textTransform=G(s,Fh,a.textTransform),this.transform=G(s,yh,a.transform),this.transformOrigin=G(s,Ih,a.transformOrigin),this.visibility=G(s,Hh,a.visibility),this.webkitTextStrokeColor=G(s,Wh,a.webkitTextStrokeColor),this.webkitTextStrokeWidth=G(s,$h,a.webkitTextStrokeWidth),this.wordBreak=G(s,bh,a.wordBreak),this.zIndex=G(s,xh,a.zIndex)}return r.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},r.prototype.isTransparent=function(){return XA(this.backgroundColor)},r.prototype.isTransformed=function(){return this.transform!==null},r.prototype.isPositioned=function(){return this.position!==0},r.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},r.prototype.isFloating=function(){return this.float!==0},r.prototype.isInlineLevel=function(){return Me(this.display,4)||Me(this.display,33554432)||Me(this.display,268435456)||Me(this.display,536870912)||Me(this.display,67108864)||Me(this.display,134217728)},r}(),qh=function(){function r(s,a){this.content=G(s,Oh,a.content),this.quotes=G(s,_h,a.quotes)}return r}(),Fa=function(){function r(s,a){this.counterIncrement=G(s,Nh,a.counterIncrement),this.counterReset=G(s,Gh,a.counterReset)}return r}(),G=function(r,s,a){var n=new $n,d=a!==null&&typeof a!="undefined"?a.toString():s.initialValue;n.write(d);var p=new Yn(n.read());switch(s.type){case 2:var B=p.parseComponentValue();return s.parse(r,ue(B)?B.value:s.initialValue);case 0:return s.parse(r,p.parseComponentValue());case 1:return s.parse(r,p.parseComponentValues());case 4:return p.parseComponentValue();case 3:switch(s.format){case"angle":return ki.parse(r,p.parseComponentValue());case"color":return _A.parse(r,p.parseComponentValue());case"image":return Hr.parse(r,p.parseComponentValue());case"length":var v=p.parseComponentValue();return GA(v)?v:ke;case"length-percentage":var C=p.parseComponentValue();return Qe(C)?C:ke;case"time":return Ca.parse(r,p.parseComponentValue())}break}},zh="data-html2canvas-debug",Zh=function(r){var s=r.getAttribute(zh);switch(s){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},xr=function(r,s){var a=Zh(r);return a===1||s===a},QA=function(){function r(s,a){if(this.context=s,this.textNodes=[],this.elements=[],this.flags=0,xr(a,3))debugger;this.styles=new Yh(s,window.getComputedStyle(a,null)),Xr(a)&&(this.styles.animationDuration.some(function(n){return n>0})&&(a.style.animationDuration="0s"),this.styles.transform!==null&&(a.style.transform="none")),this.bounds=c(this.context,a),xr(a,4)&&(this.flags|=16)}return r}(),jh="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",ya="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ai=typeof Uint8Array=="undefined"?[]:new Uint8Array(256),Yi=0;Yi<ya.length;Yi++)Ai[ya.charCodeAt(Yi)]=Yi;for(var ed=function(r){var s=r.length*.75,a=r.length,n,d=0,p,B,v,C;r[r.length-1]==="="&&(s--,r[r.length-2]==="="&&s--);var U=typeof ArrayBuffer!="undefined"&&typeof Uint8Array!="undefined"&&typeof Uint8Array.prototype.slice!="undefined"?new ArrayBuffer(s):new Array(s),S=Array.isArray(U)?U:new Uint8Array(U);for(n=0;n<a;n+=4)p=Ai[r.charCodeAt(n)],B=Ai[r.charCodeAt(n+1)],v=Ai[r.charCodeAt(n+2)],C=Ai[r.charCodeAt(n+3)],S[d++]=p<<2|B>>4,S[d++]=(B&15)<<4|v>>2,S[d++]=(v&3)<<6|C&63;return U},Ad=function(r){for(var s=r.length,a=[],n=0;n<s;n+=2)a.push(r[n+1]<<8|r[n]);return a},td=function(r){for(var s=r.length,a=[],n=0;n<s;n+=4)a.push(r[n+3]<<24|r[n+2]<<16|r[n+1]<<8|r[n]);return a},ot=5,Mr=11,Lr=2,id=Mr-ot,Ea=65536>>ot,sd=1<<ot,Tr=sd-1,rd=1024>>ot,nd=Ea+rd,ad=nd,od=32,ld=ad+od,cd=65536>>Mr,hd=1<<id,dd=hd-1,Qa=function(r,s,a){return r.slice?r.slice(s,a):new Uint16Array(Array.prototype.slice.call(r,s,a))},gd=function(r,s,a){return r.slice?r.slice(s,a):new Uint32Array(Array.prototype.slice.call(r,s,a))},ud=function(r,s){var a=ed(r),n=Array.isArray(a)?td(a):new Uint32Array(a),d=Array.isArray(a)?Ad(a):new Uint16Array(a),p=24,B=Qa(d,p/2,n[4]/2),v=n[5]===2?Qa(d,(p+n[4])/2):gd(n,Math.ceil((p+n[4])/4));return new pd(n[0],n[1],n[2],n[3],B,v)},pd=function(){function r(s,a,n,d,p,B){this.initialValue=s,this.errorValue=a,this.highStart=n,this.highValueIndex=d,this.index=p,this.data=B}return r.prototype.get=function(s){var a;if(s>=0){if(s<55296||s>56319&&s<=65535)return a=this.index[s>>ot],a=(a<<Lr)+(s&Tr),this.data[a];if(s<=65535)return a=this.index[Ea+(s-55296>>ot)],a=(a<<Lr)+(s&Tr),this.data[a];if(s<this.highStart)return a=ld-cd+(s>>Mr),a=this.index[a],a+=s>>ot&dd,a=this.index[a],a=(a<<Lr)+(s&Tr),this.data[a];if(s<=1114111)return this.data[this.highValueIndex]}return this.errorValue},r}(),Ua="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fd=typeof Uint8Array=="undefined"?[]:new Uint8Array(256),qi=0;qi<Ua.length;qi++)fd[Ua.charCodeAt(qi)]=qi;var md=1,Dr=2,Pr=3,Sa=4,Ia=5,Bd=7,Ha=8,Kr=9,kr=10,ba=11,xa=12,Ma=13,La=14,Rr=15,wd=function(r){for(var s=[],a=0,n=r.length;a<n;){var d=r.charCodeAt(a++);if(d>=55296&&d<=56319&&a<n){var p=r.charCodeAt(a++);(p&64512)===56320?s.push(((d&1023)<<10)+(p&1023)+65536):(s.push(d),a--)}else s.push(d)}return s},Cd=function(){for(var r=[],s=0;s<arguments.length;s++)r[s]=arguments[s];if(String.fromCodePoint)return String.fromCodePoint.apply(String,r);var a=r.length;if(!a)return"";for(var n=[],d=-1,p="";++d<a;){var B=r[d];B<=65535?n.push(B):(B-=65536,n.push((B>>10)+55296,B%1024+56320)),(d+1===a||n.length>16384)&&(p+=String.fromCharCode.apply(String,n),n.length=0)}return p},vd=ud(jh),dA="\xD7",Or="\xF7",Fd=function(r){return vd.get(r)},yd=function(r,s,a){var n=a-2,d=s[n],p=s[a-1],B=s[a];if(p===Dr&&B===Pr)return dA;if(p===Dr||p===Pr||p===Sa||B===Dr||B===Pr||B===Sa)return Or;if(p===Ha&&[Ha,Kr,ba,xa].indexOf(B)!==-1||(p===ba||p===Kr)&&(B===Kr||B===kr)||(p===xa||p===kr)&&B===kr||B===Ma||B===Ia||B===Bd||p===md)return dA;if(p===Ma&&B===La){for(;d===Ia;)d=s[--n];if(d===La)return dA}if(p===Rr&&B===Rr){for(var v=0;d===Rr;)v++,d=s[--n];if(v%2===0)return dA}return Or},Ed=function(r){var s=wd(r),a=s.length,n=0,d=0,p=s.map(Fd);return{next:function(){if(n>=a)return{done:!0,value:null};for(var B=dA;n<a&&(B=yd(s,p,++n))===dA;);if(B!==dA||n===a){var v=Cd.apply(null,s.slice(d,n));return d=n,{value:v,done:!1}}return{done:!0,value:null}}}},Qd=function(r){for(var s=Ed(r),a=[],n;!(n=s.next()).done;)n.value&&a.push(n.value.slice());return a},Ud=function(r){var s=123;if(r.createRange){var a=r.createRange();if(a.getBoundingClientRect){var n=r.createElement("boundtest");n.style.height=s+"px",n.style.display="block",r.body.appendChild(n),a.selectNode(n);var d=a.getBoundingClientRect(),p=Math.round(d.height);if(r.body.removeChild(n),p===s)return!0}}return!1},Sd=function(r){var s=r.createElement("boundtest");s.style.width="50px",s.style.display="block",s.style.fontSize="12px",s.style.letterSpacing="0px",s.style.wordSpacing="0px",r.body.appendChild(s);var a=r.createRange();s.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var n=s.firstChild,d=g(n.data).map(function(C){return u(C)}),p=0,B={},v=d.every(function(C,U){a.setStart(n,p),a.setEnd(n,p+C.length);var S=a.getBoundingClientRect();p+=C.length;var I=S.x>B.x||S.y>B.y;return B=S,U===0?!0:I});return r.body.removeChild(s),v},Id=function(){return typeof new Image().crossOrigin!="undefined"},Hd=function(){return typeof new XMLHttpRequest().responseType=="string"},bd=function(r){var s=new Image,a=r.createElement("canvas"),n=a.getContext("2d");if(!n)return!1;s.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{n.drawImage(s,0,0),a.toDataURL()}catch(d){return!1}return!0},Ta=function(r){return r[0]===0&&r[1]===255&&r[2]===0&&r[3]===255},xd=function(r){var s=r.createElement("canvas"),a=100;s.width=a,s.height=a;var n=s.getContext("2d");if(!n)return Promise.reject(!1);n.fillStyle="rgb(0, 255, 0)",n.fillRect(0,0,a,a);var d=new Image,p=s.toDataURL();d.src=p;var B=Nr(a,a,0,0,d);return n.fillStyle="red",n.fillRect(0,0,a,a),Da(B).then(function(v){n.drawImage(v,0,0);var C=n.getImageData(0,0,a,a).data;n.fillStyle="red",n.fillRect(0,0,a,a);var U=r.createElement("div");return U.style.backgroundImage="url("+p+")",U.style.height=a+"px",Ta(C)?Da(Nr(a,a,0,0,U)):Promise.reject(!1)}).then(function(v){return n.drawImage(v,0,0),Ta(n.getImageData(0,0,a,a).data)}).catch(function(){return!1})},Nr=function(r,s,a,n,d){var p="http://www.w3.org/2000/svg",B=document.createElementNS(p,"svg"),v=document.createElementNS(p,"foreignObject");return B.setAttributeNS(null,"width",r.toString()),B.setAttributeNS(null,"height",s.toString()),v.setAttributeNS(null,"width","100%"),v.setAttributeNS(null,"height","100%"),v.setAttributeNS(null,"x",a.toString()),v.setAttributeNS(null,"y",n.toString()),v.setAttributeNS(null,"externalResourcesRequired","true"),B.appendChild(v),v.appendChild(d),B},Da=function(r){return new Promise(function(s,a){var n=new Image;n.onload=function(){return s(n)},n.onerror=a,n.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(r))})},Re={get SUPPORT_RANGE_BOUNDS(){var r=Ud(document);return Object.defineProperty(Re,"SUPPORT_RANGE_BOUNDS",{value:r}),r},get SUPPORT_WORD_BREAKING(){var r=Re.SUPPORT_RANGE_BOUNDS&&Sd(document);return Object.defineProperty(Re,"SUPPORT_WORD_BREAKING",{value:r}),r},get SUPPORT_SVG_DRAWING(){var r=bd(document);return Object.defineProperty(Re,"SUPPORT_SVG_DRAWING",{value:r}),r},get SUPPORT_FOREIGNOBJECT_DRAWING(){var r=typeof Array.from=="function"&&typeof window.fetch=="function"?xd(document):Promise.resolve(!1);return Object.defineProperty(Re,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:r}),r},get SUPPORT_CORS_IMAGES(){var r=Id();return Object.defineProperty(Re,"SUPPORT_CORS_IMAGES",{value:r}),r},get SUPPORT_RESPONSE_TYPE(){var r=Hd();return Object.defineProperty(Re,"SUPPORT_RESPONSE_TYPE",{value:r}),r},get SUPPORT_CORS_XHR(){var r="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Re,"SUPPORT_CORS_XHR",{value:r}),r},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var r=!!(typeof Intl!="undefined"&&Intl.Segmenter);return Object.defineProperty(Re,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:r}),r}},ti=function(){function r(s,a){this.text=s,this.bounds=a}return r}(),Md=function(r,s,a,n){var d=Dd(s,a),p=[],B=0;return d.forEach(function(v){if(a.textDecorationLine.length||v.trim().length>0)if(Re.SUPPORT_RANGE_BOUNDS){var C=Pa(n,B,v.length).getClientRects();if(C.length>1){var U=Gr(v),S=0;U.forEach(function(b){p.push(new ti(b,l.fromDOMRectList(r,Pa(n,S+B,b.length).getClientRects()))),S+=b.length})}else p.push(new ti(v,l.fromDOMRectList(r,C)))}else{var I=n.splitText(v.length);p.push(new ti(v,Ld(r,n))),n=I}else Re.SUPPORT_RANGE_BOUNDS||(n=n.splitText(v.length));B+=v.length}),p},Ld=function(r,s){var a=s.ownerDocument;if(a){var n=a.createElement("html2canvaswrapper");n.appendChild(s.cloneNode(!0));var d=s.parentNode;if(d){d.replaceChild(n,s);var p=c(r,n);return n.firstChild&&d.replaceChild(n.firstChild,n),p}}return l.EMPTY},Pa=function(r,s,a){var n=r.ownerDocument;if(!n)throw new Error("Node has no owner document");var d=n.createRange();return d.setStart(r,s),d.setEnd(r,s+a),d},Gr=function(r){if(Re.SUPPORT_NATIVE_TEXT_SEGMENTATION){var s=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(s.segment(r)).map(function(a){return a.segment})}return Qd(r)},Td=function(r,s){if(Re.SUPPORT_NATIVE_TEXT_SEGMENTATION){var a=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(a.segment(r)).map(function(n){return n.segment})}return Kd(r,s)},Dd=function(r,s){return s.letterSpacing!==0?Gr(r):Td(r,s)},Pd=[32,160,4961,65792,65793,4153,4241],Kd=function(r,s){for(var a=cl(r,{lineBreak:s.lineBreak,wordBreak:s.overflowWrap==="break-word"?"break-word":s.wordBreak}),n=[],d,p=function(){if(d.value){var B=d.value.slice(),v=g(B),C="";v.forEach(function(U){Pd.indexOf(U)===-1?C+=u(U):(C.length&&n.push(C),n.push(u(U)),C="")}),C.length&&n.push(C)}};!(d=a.next()).done;)p();return n},kd=function(){function r(s,a,n){this.text=Rd(a.data,n.textTransform),this.textBounds=Md(s,this.text,n,a)}return r}(),Rd=function(r,s){switch(s){case 1:return r.toLowerCase();case 3:return r.replace(Od,Nd);case 2:return r.toUpperCase();default:return r}},Od=/(^|\s|:|-|\(|\))([a-z])/g,Nd=function(r,s,a){return r.length>0?s+a.toUpperCase():r},Ka=function(r){A(s,r);function s(a,n){var d=r.call(this,a,n)||this;return d.src=n.currentSrc||n.src,d.intrinsicWidth=n.naturalWidth,d.intrinsicHeight=n.naturalHeight,d.context.cache.addImage(d.src),d}return s}(QA),ka=function(r){A(s,r);function s(a,n){var d=r.call(this,a,n)||this;return d.canvas=n,d.intrinsicWidth=n.width,d.intrinsicHeight=n.height,d}return s}(QA),Ra=function(r){A(s,r);function s(a,n){var d=r.call(this,a,n)||this,p=new XMLSerializer,B=c(a,n);return n.setAttribute("width",B.width+"px"),n.setAttribute("height",B.height+"px"),d.svg="data:image/svg+xml,"+encodeURIComponent(p.serializeToString(n)),d.intrinsicWidth=n.width.baseVal.value,d.intrinsicHeight=n.height.baseVal.value,d.context.cache.addImage(d.svg),d}return s}(QA),Oa=function(r){A(s,r);function s(a,n){var d=r.call(this,a,n)||this;return d.value=n.value,d}return s}(QA),Vr=function(r){A(s,r);function s(a,n){var d=r.call(this,a,n)||this;return d.start=n.start,d.reversed=typeof n.reversed=="boolean"&&n.reversed===!0,d}return s}(QA),Gd=[{type:15,flags:0,unit:"px",number:3}],Vd=[{type:16,flags:0,number:50}],_d=function(r){return r.width>r.height?new l(r.left+(r.width-r.height)/2,r.top,r.height,r.height):r.width<r.height?new l(r.left,r.top+(r.height-r.width)/2,r.width,r.width):r},Xd=function(r){var s=r.type===Jd?new Array(r.value.length+1).join("\u2022"):r.value;return s.length===0?r.placeholder||"":s},zi="checkbox",Zi="radio",Jd="password",Na=707406591,_r=function(r){A(s,r);function s(a,n){var d=r.call(this,a,n)||this;switch(d.type=n.type.toLowerCase(),d.checked=n.checked,d.value=Xd(n),(d.type===zi||d.type===Zi)&&(d.styles.backgroundColor=3739148031,d.styles.borderTopColor=d.styles.borderRightColor=d.styles.borderBottomColor=d.styles.borderLeftColor=2779096575,d.styles.borderTopWidth=d.styles.borderRightWidth=d.styles.borderBottomWidth=d.styles.borderLeftWidth=1,d.styles.borderTopStyle=d.styles.borderRightStyle=d.styles.borderBottomStyle=d.styles.borderLeftStyle=1,d.styles.backgroundClip=[0],d.styles.backgroundOrigin=[0],d.bounds=_d(d.bounds)),d.type){case zi:d.styles.borderTopRightRadius=d.styles.borderTopLeftRadius=d.styles.borderBottomRightRadius=d.styles.borderBottomLeftRadius=Gd;break;case Zi:d.styles.borderTopRightRadius=d.styles.borderTopLeftRadius=d.styles.borderBottomRightRadius=d.styles.borderBottomLeftRadius=Vd;break}return d}return s}(QA),Ga=function(r){A(s,r);function s(a,n){var d=r.call(this,a,n)||this,p=n.options[n.selectedIndex||0];return d.value=p&&p.text||"",d}return s}(QA),Va=function(r){A(s,r);function s(a,n){var d=r.call(this,a,n)||this;return d.value=n.value,d}return s}(QA),_a=function(r){A(s,r);function s(a,n){var d=r.call(this,a,n)||this;d.src=n.src,d.width=parseInt(n.width,10)||0,d.height=parseInt(n.height,10)||0,d.backgroundColor=d.styles.backgroundColor;try{if(n.contentWindow&&n.contentWindow.document&&n.contentWindow.document.documentElement){d.tree=Ja(a,n.contentWindow.document.documentElement);var p=n.contentWindow.document.documentElement?jt(a,getComputedStyle(n.contentWindow.document.documentElement).backgroundColor):xA.TRANSPARENT,B=n.contentWindow.document.body?jt(a,getComputedStyle(n.contentWindow.document.body).backgroundColor):xA.TRANSPARENT;d.backgroundColor=XA(p)?XA(B)?d.styles.backgroundColor:B:p}}catch(v){}return d}return s}(QA),Wd=["OL","UL","MENU"],ji=function(r,s,a,n){for(var d=s.firstChild,p=void 0;d;d=p)if(p=d.nextSibling,Wa(d)&&d.data.trim().length>0)a.textNodes.push(new kd(r,d,a.styles));else if(vt(d))if(ja(d)&&d.assignedNodes)d.assignedNodes().forEach(function(v){return ji(r,v,a,n)});else{var B=Xa(r,d);B.styles.isVisible()&&($d(d,B,n)?B.flags|=4:Yd(B.styles)&&(B.flags|=2),Wd.indexOf(d.tagName)!==-1&&(B.flags|=8),a.elements.push(B),d.slot,d.shadowRoot?ji(r,d.shadowRoot,B,n):!As(d)&&!$a(d)&&!ts(d)&&ji(r,d,B,n))}},Xa=function(r,s){return Wr(s)?new Ka(r,s):Ya(s)?new ka(r,s):$a(s)?new Ra(r,s):qd(s)?new Oa(r,s):zd(s)?new Vr(r,s):Zd(s)?new _r(r,s):ts(s)?new Ga(r,s):As(s)?new Va(r,s):za(s)?new _a(r,s):new QA(r,s)},Ja=function(r,s){var a=Xa(r,s);return a.flags|=4,ji(r,s,a,a),a},$d=function(r,s,a){return s.styles.isPositionedWithZIndex()||s.styles.opacity<1||s.styles.isTransformed()||Jr(r)&&a.styles.isTransparent()},Yd=function(r){return r.isPositioned()||r.isFloating()},Wa=function(r){return r.nodeType===Node.TEXT_NODE},vt=function(r){return r.nodeType===Node.ELEMENT_NODE},Xr=function(r){return vt(r)&&typeof r.style!="undefined"&&!es(r)},es=function(r){return typeof r.className=="object"},qd=function(r){return r.tagName==="LI"},zd=function(r){return r.tagName==="OL"},Zd=function(r){return r.tagName==="INPUT"},jd=function(r){return r.tagName==="HTML"},$a=function(r){return r.tagName==="svg"},Jr=function(r){return r.tagName==="BODY"},Ya=function(r){return r.tagName==="CANVAS"},qa=function(r){return r.tagName==="VIDEO"},Wr=function(r){return r.tagName==="IMG"},za=function(r){return r.tagName==="IFRAME"},Za=function(r){return r.tagName==="STYLE"},eg=function(r){return r.tagName==="SCRIPT"},As=function(r){return r.tagName==="TEXTAREA"},ts=function(r){return r.tagName==="SELECT"},ja=function(r){return r.tagName==="SLOT"},eo=function(r){return r.tagName.indexOf("-")>0},Ag=function(){function r(){this.counters={}}return r.prototype.getCounterValue=function(s){var a=this.counters[s];return a&&a.length?a[a.length-1]:1},r.prototype.getCounterValues=function(s){var a=this.counters[s];return a||[]},r.prototype.pop=function(s){var a=this;s.forEach(function(n){return a.counters[n].pop()})},r.prototype.parse=function(s){var a=this,n=s.counterIncrement,d=s.counterReset,p=!0;n!==null&&n.forEach(function(v){var C=a.counters[v.counter];C&&v.increment!==0&&(p=!1,C.length||C.push(1),C[Math.max(0,C.length-1)]+=v.increment)});var B=[];return p&&d.forEach(function(v){var C=a.counters[v.counter];B.push(v.counter),C||(C=a.counters[v.counter]=[]),C.push(v.reset)}),B},r}(),Ao={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},to={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["\u0554","\u0553","\u0552","\u0551","\u0550","\u054F","\u054E","\u054D","\u054C","\u054B","\u054A","\u0549","\u0548","\u0547","\u0546","\u0545","\u0544","\u0543","\u0542","\u0541","\u0540","\u053F","\u053E","\u053D","\u053C","\u053B","\u053A","\u0539","\u0538","\u0537","\u0536","\u0535","\u0534","\u0533","\u0532","\u0531"]},tg={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["\u05D9\u05F3","\u05D8\u05F3","\u05D7\u05F3","\u05D6\u05F3","\u05D5\u05F3","\u05D4\u05F3","\u05D3\u05F3","\u05D2\u05F3","\u05D1\u05F3","\u05D0\u05F3","\u05EA","\u05E9","\u05E8","\u05E7","\u05E6","\u05E4","\u05E2","\u05E1","\u05E0","\u05DE","\u05DC","\u05DB","\u05D9\u05D8","\u05D9\u05D7","\u05D9\u05D6","\u05D8\u05D6","\u05D8\u05D5","\u05D9","\u05D8","\u05D7","\u05D6","\u05D5","\u05D4","\u05D3","\u05D2","\u05D1","\u05D0"]},ig={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["\u10F5","\u10F0","\u10EF","\u10F4","\u10EE","\u10ED","\u10EC","\u10EB","\u10EA","\u10E9","\u10E8","\u10E7","\u10E6","\u10E5","\u10E4","\u10F3","\u10E2","\u10E1","\u10E0","\u10DF","\u10DE","\u10DD","\u10F2","\u10DC","\u10DB","\u10DA","\u10D9","\u10D8","\u10D7","\u10F1","\u10D6","\u10D5","\u10D4","\u10D3","\u10D2","\u10D1","\u10D0"]},Ft=function(r,s,a,n,d,p){return r<s||r>a?si(r,d,p.length>0):n.integers.reduce(function(B,v,C){for(;r>=v;)r-=v,B+=n.values[C];return B},"")+p},io=function(r,s,a,n){var d="";do a||r--,d=n(r)+d,r/=s;while(r*s>=s);return d},Ee=function(r,s,a,n,d){var p=a-s+1;return(r<0?"-":"")+(io(Math.abs(r),p,n,function(B){return u(Math.floor(B%p)+s)})+d)},lt=function(r,s,a){a===void 0&&(a=". ");var n=s.length;return io(Math.abs(r),n,!1,function(d){return s[Math.floor(d%n)]})+a},yt=1,WA=2,$A=4,ii=8,MA=function(r,s,a,n,d,p){if(r<-9999||r>9999)return si(r,4,d.length>0);var B=Math.abs(r),v=d;if(B===0)return s[0]+v;for(var C=0;B>0&&C<=4;C++){var U=B%10;U===0&&Me(p,yt)&&v!==""?v=s[U]+v:U>1||U===1&&C===0||U===1&&C===1&&Me(p,WA)||U===1&&C===1&&Me(p,$A)&&r>100||U===1&&C>1&&Me(p,ii)?v=s[U]+(C>0?a[C-1]:"")+v:U===1&&C>0&&(v=a[C-1]+v),B=Math.floor(B/10)}return(r<0?n:"")+v},so="\u5341\u767E\u5343\u842C",ro="\u62FE\u4F70\u4EDF\u842C",no="\u30DE\u30A4\u30CA\u30B9",$r="\uB9C8\uC774\uB108\uC2A4",si=function(r,s,a){var n=a?". ":"",d=a?"\u3001":"",p=a?", ":"",B=a?" ":"";switch(s){case 0:return"\u2022"+B;case 1:return"\u25E6"+B;case 2:return"\u25FE"+B;case 5:var v=Ee(r,48,57,!0,n);return v.length<4?"0"+v:v;case 4:return lt(r,"\u3007\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D",d);case 6:return Ft(r,1,3999,Ao,3,n).toLowerCase();case 7:return Ft(r,1,3999,Ao,3,n);case 8:return Ee(r,945,969,!1,n);case 9:return Ee(r,97,122,!1,n);case 10:return Ee(r,65,90,!1,n);case 11:return Ee(r,1632,1641,!0,n);case 12:case 49:return Ft(r,1,9999,to,3,n);case 35:return Ft(r,1,9999,to,3,n).toLowerCase();case 13:return Ee(r,2534,2543,!0,n);case 14:case 30:return Ee(r,6112,6121,!0,n);case 15:return lt(r,"\u5B50\u4E11\u5BC5\u536F\u8FB0\u5DF3\u5348\u672A\u7533\u9149\u620C\u4EA5",d);case 16:return lt(r,"\u7532\u4E59\u4E19\u4E01\u620A\u5DF1\u5E9A\u8F9B\u58EC\u7678",d);case 17:case 48:return MA(r,"\u96F6\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D",so,"\u8CA0",d,WA|$A|ii);case 47:return MA(r,"\u96F6\u58F9\u8CB3\u53C3\u8086\u4F0D\u9678\u67D2\u634C\u7396",ro,"\u8CA0",d,yt|WA|$A|ii);case 42:return MA(r,"\u96F6\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D",so,"\u8D1F",d,WA|$A|ii);case 41:return MA(r,"\u96F6\u58F9\u8D30\u53C1\u8086\u4F0D\u9646\u67D2\u634C\u7396",ro,"\u8D1F",d,yt|WA|$A|ii);case 26:return MA(r,"\u3007\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D","\u5341\u767E\u5343\u4E07",no,d,0);case 25:return MA(r,"\u96F6\u58F1\u5F10\u53C2\u56DB\u4F0D\u516D\u4E03\u516B\u4E5D","\u62FE\u767E\u5343\u4E07",no,d,yt|WA|$A);case 31:return MA(r,"\uC601\uC77C\uC774\uC0BC\uC0AC\uC624\uC721\uCE60\uD314\uAD6C","\uC2ED\uBC31\uCC9C\uB9CC",$r,p,yt|WA|$A);case 33:return MA(r,"\u96F6\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D","\u5341\u767E\u5343\u842C",$r,p,0);case 32:return MA(r,"\u96F6\u58F9\u8CB3\u53C3\u56DB\u4E94\u516D\u4E03\u516B\u4E5D","\u62FE\u767E\u5343",$r,p,yt|WA|$A);case 18:return Ee(r,2406,2415,!0,n);case 20:return Ft(r,1,19999,ig,3,n);case 21:return Ee(r,2790,2799,!0,n);case 22:return Ee(r,2662,2671,!0,n);case 22:return Ft(r,1,10999,tg,3,n);case 23:return lt(r,"\u3042\u3044\u3046\u3048\u304A\u304B\u304D\u304F\u3051\u3053\u3055\u3057\u3059\u305B\u305D\u305F\u3061\u3064\u3066\u3068\u306A\u306B\u306C\u306D\u306E\u306F\u3072\u3075\u3078\u307B\u307E\u307F\u3080\u3081\u3082\u3084\u3086\u3088\u3089\u308A\u308B\u308C\u308D\u308F\u3090\u3091\u3092\u3093");case 24:return lt(r,"\u3044\u308D\u306F\u306B\u307B\u3078\u3068\u3061\u308A\u306C\u308B\u3092\u308F\u304B\u3088\u305F\u308C\u305D\u3064\u306D\u306A\u3089\u3080\u3046\u3090\u306E\u304A\u304F\u3084\u307E\u3051\u3075\u3053\u3048\u3066\u3042\u3055\u304D\u3086\u3081\u307F\u3057\u3091\u3072\u3082\u305B\u3059");case 27:return Ee(r,3302,3311,!0,n);case 28:return lt(r,"\u30A2\u30A4\u30A6\u30A8\u30AA\u30AB\u30AD\u30AF\u30B1\u30B3\u30B5\u30B7\u30B9\u30BB\u30BD\u30BF\u30C1\u30C4\u30C6\u30C8\u30CA\u30CB\u30CC\u30CD\u30CE\u30CF\u30D2\u30D5\u30D8\u30DB\u30DE\u30DF\u30E0\u30E1\u30E2\u30E4\u30E6\u30E8\u30E9\u30EA\u30EB\u30EC\u30ED\u30EF\u30F0\u30F1\u30F2\u30F3",d);case 29:return lt(r,"\u30A4\u30ED\u30CF\u30CB\u30DB\u30D8\u30C8\u30C1\u30EA\u30CC\u30EB\u30F2\u30EF\u30AB\u30E8\u30BF\u30EC\u30BD\u30C4\u30CD\u30CA\u30E9\u30E0\u30A6\u30F0\u30CE\u30AA\u30AF\u30E4\u30DE\u30B1\u30D5\u30B3\u30A8\u30C6\u30A2\u30B5\u30AD\u30E6\u30E1\u30DF\u30B7\u30F1\u30D2\u30E2\u30BB\u30B9",d);case 34:return Ee(r,3792,3801,!0,n);case 37:return Ee(r,6160,6169,!0,n);case 38:return Ee(r,4160,4169,!0,n);case 39:return Ee(r,2918,2927,!0,n);case 40:return Ee(r,1776,1785,!0,n);case 43:return Ee(r,3046,3055,!0,n);case 44:return Ee(r,3174,3183,!0,n);case 45:return Ee(r,3664,3673,!0,n);case 46:return Ee(r,3872,3881,!0,n);case 3:default:return Ee(r,48,57,!0,n)}},ao="data-html2canvas-ignore",oo=function(){function r(s,a,n){if(this.context=s,this.options=n,this.scrolledElements=[],this.referenceElement=a,this.counters=new Ag,this.quoteDepth=0,!a.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(a.ownerDocument.documentElement,!1)}return r.prototype.toIFrame=function(s,a){var n=this,d=sg(s,a);if(!d.contentWindow)return Promise.reject("Unable to find iframe window");var p=s.defaultView.pageXOffset,B=s.defaultView.pageYOffset,v=d.contentWindow,C=v.document,U=ag(d).then(function(){return t(n,void 0,void 0,function(){var S,I;return i(this,function(b){switch(b.label){case 0:return this.scrolledElements.forEach(hg),v&&(v.scrollTo(a.left,a.top),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(v.scrollY!==a.top||v.scrollX!==a.left)&&(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(v.scrollX-a.left,v.scrollY-a.top,0,0))),S=this.options.onclone,I=this.clonedReferenceElement,typeof I=="undefined"?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:C.fonts&&C.fonts.ready?[4,C.fonts.ready]:[3,2];case 1:b.sent(),b.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,ng(C)]:[3,4];case 3:b.sent(),b.label=4;case 4:return typeof S=="function"?[2,Promise.resolve().then(function(){return S(C,I)}).then(function(){return d})]:[2,d]}})})});return C.open(),C.write(lg(document.doctype)+"<html></html>"),cg(this.referenceElement.ownerDocument,p,B),C.replaceChild(C.adoptNode(this.documentElement),C.documentElement),C.close(),U},r.prototype.createElementClone=function(s){if(xr(s,2))debugger;if(Ya(s))return this.createCanvasClone(s);if(qa(s))return this.createVideoClone(s);if(Za(s))return this.createStyleClone(s);var a=s.cloneNode(!1);return Wr(a)&&(Wr(s)&&s.currentSrc&&s.currentSrc!==s.src&&(a.src=s.currentSrc,a.srcset=""),a.loading==="lazy"&&(a.loading="eager")),eo(a)?this.createCustomElementClone(a):a},r.prototype.createCustomElementClone=function(s){var a=document.createElement("html2canvascustomelement");return Yr(s.style,a),a},r.prototype.createStyleClone=function(s){try{var a=s.sheet;if(a&&a.cssRules){var n=[].slice.call(a.cssRules,0).reduce(function(p,B){return B&&typeof B.cssText=="string"?p+B.cssText:p},""),d=s.cloneNode(!1);return d.textContent=n,d}}catch(p){if(this.context.logger.error("Unable to access cssRules property",p),p.name!=="SecurityError")throw p}return s.cloneNode(!1)},r.prototype.createCanvasClone=function(s){var a;if(this.options.inlineImages&&s.ownerDocument){var n=s.ownerDocument.createElement("img");try{return n.src=s.toDataURL(),n}catch(U){this.context.logger.info("Unable to inline canvas contents, canvas is tainted",s)}}var d=s.cloneNode(!1);try{d.width=s.width,d.height=s.height;var p=s.getContext("2d"),B=d.getContext("2d");if(B)if(!this.options.allowTaint&&p)B.putImageData(p.getImageData(0,0,s.width,s.height),0,0);else{var v=(a=s.getContext("webgl2"))!==null&&a!==void 0?a:s.getContext("webgl");if(v){var C=v.getContextAttributes();(C==null?void 0:C.preserveDrawingBuffer)===!1&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",s)}B.drawImage(s,0,0)}return d}catch(U){this.context.logger.info("Unable to clone canvas as it is tainted",s)}return d},r.prototype.createVideoClone=function(s){var a=s.ownerDocument.createElement("canvas");a.width=s.offsetWidth,a.height=s.offsetHeight;var n=a.getContext("2d");try{return n&&(n.drawImage(s,0,0,a.width,a.height),this.options.allowTaint||n.getImageData(0,0,a.width,a.height)),a}catch(p){this.context.logger.info("Unable to clone video as it is tainted",s)}var d=s.ownerDocument.createElement("canvas");return d.width=s.offsetWidth,d.height=s.offsetHeight,d},r.prototype.appendChildNode=function(s,a,n){(!vt(a)||!eg(a)&&!a.hasAttribute(ao)&&(typeof this.options.ignoreElements!="function"||!this.options.ignoreElements(a)))&&(!this.options.copyStyles||!vt(a)||!Za(a))&&s.appendChild(this.cloneNode(a,n))},r.prototype.cloneChildNodes=function(s,a,n){for(var d=this,p=s.shadowRoot?s.shadowRoot.firstChild:s.firstChild;p;p=p.nextSibling)if(vt(p)&&ja(p)&&typeof p.assignedNodes=="function"){var B=p.assignedNodes();B.length&&B.forEach(function(v){return d.appendChildNode(a,v,n)})}else this.appendChildNode(a,p,n)},r.prototype.cloneNode=function(s,a){if(Wa(s))return document.createTextNode(s.data);if(!s.ownerDocument)return s.cloneNode(!1);var n=s.ownerDocument.defaultView;if(n&&vt(s)&&(Xr(s)||es(s))){var d=this.createElementClone(s);d.style.transitionProperty="none";var p=n.getComputedStyle(s),B=n.getComputedStyle(s,":before"),v=n.getComputedStyle(s,":after");this.referenceElement===s&&Xr(d)&&(this.clonedReferenceElement=d),Jr(d)&&ug(d);var C=this.counters.parse(new Fa(this.context,p)),U=this.resolvePseudoContent(s,d,B,ri.BEFORE);eo(s)&&(a=!0),qa(s)||this.cloneChildNodes(s,d,a),U&&d.insertBefore(U,d.firstChild);var S=this.resolvePseudoContent(s,d,v,ri.AFTER);return S&&d.appendChild(S),this.counters.pop(C),(p&&(this.options.copyStyles||es(s))&&!za(s)||a)&&Yr(p,d),(s.scrollTop!==0||s.scrollLeft!==0)&&this.scrolledElements.push([d,s.scrollLeft,s.scrollTop]),(As(s)||ts(s))&&(As(d)||ts(d))&&(d.value=s.value),d}return s.cloneNode(!1)},r.prototype.resolvePseudoContent=function(s,a,n,d){var p=this;if(n){var B=n.content,v=a.ownerDocument;if(!(!v||!B||B==="none"||B==="-moz-alt-content"||n.display==="none")){this.counters.parse(new Fa(this.context,n));var C=new qh(this.context,n),U=v.createElement("html2canvaspseudoelement");Yr(n,U),C.content.forEach(function(I){if(I.type===0)U.appendChild(v.createTextNode(I.value));else if(I.type===22){var b=v.createElement("img");b.src=I.value,b.style.opacity="1",U.appendChild(b)}else if(I.type===18){if(I.name==="attr"){var N=I.values.filter(ue);N.length&&U.appendChild(v.createTextNode(s.getAttribute(N[0].value)||""))}else if(I.name==="counter"){var L=I.values.filter(wt),K=L[0],Z=L[1];if(K&&ue(K)){var _=p.counters.getCounterValue(K.value),V=Z&&ue(Z)?br.parse(p.context,Z.value):3;U.appendChild(v.createTextNode(si(_,V,!1)))}}else if(I.name==="counters"){var le=I.values.filter(wt),K=le[0],j=le[1],Z=le[2];if(K&&ue(K)){var $=p.counters.getCounterValues(K.value),R=Z&&ue(Z)?br.parse(p.context,Z.value):3,ne=j&&j.type===0?j.value:"",ae=$.map(function(AA){return si(AA,R,!1)}).join(ne);U.appendChild(v.createTextNode(ae))}}}else if(I.type===20)switch(I.value){case"open-quote":U.appendChild(v.createTextNode(va(C.quotes,p.quoteDepth++,!0)));break;case"close-quote":U.appendChild(v.createTextNode(va(C.quotes,--p.quoteDepth,!1)));break;default:U.appendChild(v.createTextNode(I.value))}}),U.className=qr+" "+zr;var S=d===ri.BEFORE?" "+qr:" "+zr;return es(a)?a.className.baseValue+=S:a.className+=S,U}}},r.destroy=function(s){return s.parentNode?(s.parentNode.removeChild(s),!0):!1},r}(),ri;(function(r){r[r.BEFORE=0]="BEFORE",r[r.AFTER=1]="AFTER"})(ri||(ri={}));var sg=function(r,s){var a=r.createElement("iframe");return a.className="html2canvas-container",a.style.visibility="hidden",a.style.position="fixed",a.style.left="-10000px",a.style.top="0px",a.style.border="0",a.width=s.width.toString(),a.height=s.height.toString(),a.scrolling="no",a.setAttribute(ao,"true"),r.body.appendChild(a),a},rg=function(r){return new Promise(function(s){if(r.complete){s();return}if(!r.src){s();return}r.onload=s,r.onerror=s})},ng=function(r){return Promise.all([].slice.call(r.images,0).map(rg))},ag=function(r){return new Promise(function(s,a){var n=r.contentWindow;if(!n)return a("No window assigned for iframe");var d=n.document;n.onload=r.onload=function(){n.onload=r.onload=null;var p=setInterval(function(){d.body.childNodes.length>0&&d.readyState==="complete"&&(clearInterval(p),s(r))},50)}})},og=["all","d","content"],Yr=function(r,s){for(var a=r.length-1;a>=0;a--){var n=r.item(a);og.indexOf(n)===-1&&s.style.setProperty(n,r.getPropertyValue(n))}return s},lg=function(r){var s="";return r&&(s+="<!DOCTYPE ",r.name&&(s+=r.name),r.internalSubset&&(s+=r.internalSubset),r.publicId&&(s+='"'+r.publicId+'"'),r.systemId&&(s+='"'+r.systemId+'"'),s+=">"),s},cg=function(r,s,a){r&&r.defaultView&&(s!==r.defaultView.pageXOffset||a!==r.defaultView.pageYOffset)&&r.defaultView.scrollTo(s,a)},hg=function(r){var s=r[0],a=r[1],n=r[2];s.scrollLeft=a,s.scrollTop=n},dg=":before",gg=":after",qr="___html2canvas___pseudoelement_before",zr="___html2canvas___pseudoelement_after",lo=`{
    content: "" !important;
    display: none !important;
}`,ug=function(r){pg(r,"."+qr+dg+lo+`
         .`+zr+gg+lo)},pg=function(r,s){var a=r.ownerDocument;if(a){var n=a.createElement("style");n.textContent=s,r.appendChild(n)}},co=function(){function r(){}return r.getOrigin=function(s){var a=r._link;return a?(a.href=s,a.href=a.href,a.protocol+a.hostname+a.port):"about:blank"},r.isSameOrigin=function(s){return r.getOrigin(s)===r._origin},r.setContext=function(s){r._link=s.document.createElement("a"),r._origin=r.getOrigin(s.location.href)},r._origin="about:blank",r}(),fg=function(){function r(s,a){this.context=s,this._options=a,this._cache={}}return r.prototype.addImage=function(s){var a=Promise.resolve();return this.has(s)||(jr(s)||Cg(s))&&(this._cache[s]=this.loadImage(s)).catch(function(){}),a},r.prototype.match=function(s){return this._cache[s]},r.prototype.loadImage=function(s){return t(this,void 0,void 0,function(){var a,n,d,p,B=this;return i(this,function(v){switch(v.label){case 0:return a=co.isSameOrigin(s),n=!Zr(s)&&this._options.useCORS===!0&&Re.SUPPORT_CORS_IMAGES&&!a,d=!Zr(s)&&!a&&!jr(s)&&typeof this._options.proxy=="string"&&Re.SUPPORT_CORS_XHR&&!n,!a&&this._options.allowTaint===!1&&!Zr(s)&&!jr(s)&&!d&&!n?[2]:(p=s,d?[4,this.proxy(p)]:[3,2]);case 1:p=v.sent(),v.label=2;case 2:return this.context.logger.debug("Added image "+s.substring(0,256)),[4,new Promise(function(C,U){var S=new Image;S.onload=function(){return C(S)},S.onerror=U,(vg(p)||n)&&(S.crossOrigin="anonymous"),S.src=p,S.complete===!0&&setTimeout(function(){return C(S)},500),B._options.imageTimeout>0&&setTimeout(function(){return U("Timed out ("+B._options.imageTimeout+"ms) loading image")},B._options.imageTimeout)})];case 3:return[2,v.sent()]}})})},r.prototype.has=function(s){return typeof this._cache[s]!="undefined"},r.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},r.prototype.proxy=function(s){var a=this,n=this._options.proxy;if(!n)throw new Error("No proxy defined");var d=s.substring(0,256);return new Promise(function(p,B){var v=Re.SUPPORT_RESPONSE_TYPE?"blob":"text",C=new XMLHttpRequest;C.onload=function(){if(C.status===200)if(v==="text")p(C.response);else{var I=new FileReader;I.addEventListener("load",function(){return p(I.result)},!1),I.addEventListener("error",function(b){return B(b)},!1),I.readAsDataURL(C.response)}else B("Failed to proxy resource "+d+" with status code "+C.status)},C.onerror=B;var U=n.indexOf("?")>-1?"&":"?";if(C.open("GET",""+n+U+"url="+encodeURIComponent(s)+"&responseType="+v),v!=="text"&&C instanceof XMLHttpRequest&&(C.responseType=v),a._options.imageTimeout){var S=a._options.imageTimeout;C.timeout=S,C.ontimeout=function(){return B("Timed out ("+S+"ms) proxying "+d)}}C.send()})},r}(),mg=/^data:image\/svg\+xml/i,Bg=/^data:image\/.*;base64,/i,wg=/^data:image\/.*/i,Cg=function(r){return Re.SUPPORT_SVG_DRAWING||!Fg(r)},Zr=function(r){return wg.test(r)},vg=function(r){return Bg.test(r)},jr=function(r){return r.substr(0,4)==="blob"},Fg=function(r){return r.substr(-3).toLowerCase()==="svg"||mg.test(r)},k=function(){function r(s,a){this.type=0,this.x=s,this.y=a}return r.prototype.add=function(s,a){return new r(this.x+s,this.y+a)},r}(),Et=function(r,s,a){return new k(r.x+(s.x-r.x)*a,r.y+(s.y-r.y)*a)},is=function(){function r(s,a,n,d){this.type=1,this.start=s,this.startControl=a,this.endControl=n,this.end=d}return r.prototype.subdivide=function(s,a){var n=Et(this.start,this.startControl,s),d=Et(this.startControl,this.endControl,s),p=Et(this.endControl,this.end,s),B=Et(n,d,s),v=Et(d,p,s),C=Et(B,v,s);return a?new r(this.start,n,B,C):new r(C,v,p,this.end)},r.prototype.add=function(s,a){return new r(this.start.add(s,a),this.startControl.add(s,a),this.endControl.add(s,a),this.end.add(s,a))},r.prototype.reverse=function(){return new r(this.end,this.endControl,this.startControl,this.start)},r}(),gA=function(r){return r.type===1},yg=function(){function r(s){var a=s.styles,n=s.bounds,d=Zt(a.borderTopLeftRadius,n.width,n.height),p=d[0],B=d[1],v=Zt(a.borderTopRightRadius,n.width,n.height),C=v[0],U=v[1],S=Zt(a.borderBottomRightRadius,n.width,n.height),I=S[0],b=S[1],N=Zt(a.borderBottomLeftRadius,n.width,n.height),L=N[0],K=N[1],Z=[];Z.push((p+C)/n.width),Z.push((L+I)/n.width),Z.push((B+K)/n.height),Z.push((U+b)/n.height);var _=Math.max.apply(Math,Z);_>1&&(p/=_,B/=_,C/=_,U/=_,I/=_,b/=_,L/=_,K/=_);var V=n.width-C,le=n.height-b,j=n.width-I,$=n.height-K,R=a.borderTopWidth,ne=a.borderRightWidth,ae=a.borderBottomWidth,Y=a.borderLeftWidth,Ue=me(a.paddingTop,s.bounds.width),AA=me(a.paddingRight,s.bounds.width),lA=me(a.paddingBottom,s.bounds.width),pe=me(a.paddingLeft,s.bounds.width);this.topLeftBorderDoubleOuterBox=p>0||B>0?Ce(n.left+Y/3,n.top+R/3,p-Y/3,B-R/3,he.TOP_LEFT):new k(n.left+Y/3,n.top+R/3),this.topRightBorderDoubleOuterBox=p>0||B>0?Ce(n.left+V,n.top+R/3,C-ne/3,U-R/3,he.TOP_RIGHT):new k(n.left+n.width-ne/3,n.top+R/3),this.bottomRightBorderDoubleOuterBox=I>0||b>0?Ce(n.left+j,n.top+le,I-ne/3,b-ae/3,he.BOTTOM_RIGHT):new k(n.left+n.width-ne/3,n.top+n.height-ae/3),this.bottomLeftBorderDoubleOuterBox=L>0||K>0?Ce(n.left+Y/3,n.top+$,L-Y/3,K-ae/3,he.BOTTOM_LEFT):new k(n.left+Y/3,n.top+n.height-ae/3),this.topLeftBorderDoubleInnerBox=p>0||B>0?Ce(n.left+Y*2/3,n.top+R*2/3,p-Y*2/3,B-R*2/3,he.TOP_LEFT):new k(n.left+Y*2/3,n.top+R*2/3),this.topRightBorderDoubleInnerBox=p>0||B>0?Ce(n.left+V,n.top+R*2/3,C-ne*2/3,U-R*2/3,he.TOP_RIGHT):new k(n.left+n.width-ne*2/3,n.top+R*2/3),this.bottomRightBorderDoubleInnerBox=I>0||b>0?Ce(n.left+j,n.top+le,I-ne*2/3,b-ae*2/3,he.BOTTOM_RIGHT):new k(n.left+n.width-ne*2/3,n.top+n.height-ae*2/3),this.bottomLeftBorderDoubleInnerBox=L>0||K>0?Ce(n.left+Y*2/3,n.top+$,L-Y*2/3,K-ae*2/3,he.BOTTOM_LEFT):new k(n.left+Y*2/3,n.top+n.height-ae*2/3),this.topLeftBorderStroke=p>0||B>0?Ce(n.left+Y/2,n.top+R/2,p-Y/2,B-R/2,he.TOP_LEFT):new k(n.left+Y/2,n.top+R/2),this.topRightBorderStroke=p>0||B>0?Ce(n.left+V,n.top+R/2,C-ne/2,U-R/2,he.TOP_RIGHT):new k(n.left+n.width-ne/2,n.top+R/2),this.bottomRightBorderStroke=I>0||b>0?Ce(n.left+j,n.top+le,I-ne/2,b-ae/2,he.BOTTOM_RIGHT):new k(n.left+n.width-ne/2,n.top+n.height-ae/2),this.bottomLeftBorderStroke=L>0||K>0?Ce(n.left+Y/2,n.top+$,L-Y/2,K-ae/2,he.BOTTOM_LEFT):new k(n.left+Y/2,n.top+n.height-ae/2),this.topLeftBorderBox=p>0||B>0?Ce(n.left,n.top,p,B,he.TOP_LEFT):new k(n.left,n.top),this.topRightBorderBox=C>0||U>0?Ce(n.left+V,n.top,C,U,he.TOP_RIGHT):new k(n.left+n.width,n.top),this.bottomRightBorderBox=I>0||b>0?Ce(n.left+j,n.top+le,I,b,he.BOTTOM_RIGHT):new k(n.left+n.width,n.top+n.height),this.bottomLeftBorderBox=L>0||K>0?Ce(n.left,n.top+$,L,K,he.BOTTOM_LEFT):new k(n.left,n.top+n.height),this.topLeftPaddingBox=p>0||B>0?Ce(n.left+Y,n.top+R,Math.max(0,p-Y),Math.max(0,B-R),he.TOP_LEFT):new k(n.left+Y,n.top+R),this.topRightPaddingBox=C>0||U>0?Ce(n.left+Math.min(V,n.width-ne),n.top+R,V>n.width+ne?0:Math.max(0,C-ne),Math.max(0,U-R),he.TOP_RIGHT):new k(n.left+n.width-ne,n.top+R),this.bottomRightPaddingBox=I>0||b>0?Ce(n.left+Math.min(j,n.width-Y),n.top+Math.min(le,n.height-ae),Math.max(0,I-ne),Math.max(0,b-ae),he.BOTTOM_RIGHT):new k(n.left+n.width-ne,n.top+n.height-ae),this.bottomLeftPaddingBox=L>0||K>0?Ce(n.left+Y,n.top+Math.min($,n.height-ae),Math.max(0,L-Y),Math.max(0,K-ae),he.BOTTOM_LEFT):new k(n.left+Y,n.top+n.height-ae),this.topLeftContentBox=p>0||B>0?Ce(n.left+Y+pe,n.top+R+Ue,Math.max(0,p-(Y+pe)),Math.max(0,B-(R+Ue)),he.TOP_LEFT):new k(n.left+Y+pe,n.top+R+Ue),this.topRightContentBox=C>0||U>0?Ce(n.left+Math.min(V,n.width+Y+pe),n.top+R+Ue,V>n.width+Y+pe?0:C-Y+pe,U-(R+Ue),he.TOP_RIGHT):new k(n.left+n.width-(ne+AA),n.top+R+Ue),this.bottomRightContentBox=I>0||b>0?Ce(n.left+Math.min(j,n.width-(Y+pe)),n.top+Math.min(le,n.height+R+Ue),Math.max(0,I-(ne+AA)),b-(ae+lA),he.BOTTOM_RIGHT):new k(n.left+n.width-(ne+AA),n.top+n.height-(ae+lA)),this.bottomLeftContentBox=L>0||K>0?Ce(n.left+Y+pe,n.top+$,Math.max(0,L-(Y+pe)),K-(ae+lA),he.BOTTOM_LEFT):new k(n.left+Y+pe,n.top+n.height-(ae+lA))}return r}(),he;(function(r){r[r.TOP_LEFT=0]="TOP_LEFT",r[r.TOP_RIGHT=1]="TOP_RIGHT",r[r.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",r[r.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(he||(he={}));var Ce=function(r,s,a,n,d){var p=4*((Math.sqrt(2)-1)/3),B=a*p,v=n*p,C=r+a,U=s+n;switch(d){case he.TOP_LEFT:return new is(new k(r,U),new k(r,U-v),new k(C-B,s),new k(C,s));case he.TOP_RIGHT:return new is(new k(r,s),new k(r+B,s),new k(C,U-v),new k(C,U));case he.BOTTOM_RIGHT:return new is(new k(C,s),new k(C,s+v),new k(r+B,U),new k(r,U));case he.BOTTOM_LEFT:default:return new is(new k(C,U),new k(C-B,U),new k(r,s+v),new k(r,s))}},ss=function(r){return[r.topLeftBorderBox,r.topRightBorderBox,r.bottomRightBorderBox,r.bottomLeftBorderBox]},Eg=function(r){return[r.topLeftContentBox,r.topRightContentBox,r.bottomRightContentBox,r.bottomLeftContentBox]},rs=function(r){return[r.topLeftPaddingBox,r.topRightPaddingBox,r.bottomRightPaddingBox,r.bottomLeftPaddingBox]},Qg=function(){function r(s,a,n){this.offsetX=s,this.offsetY=a,this.matrix=n,this.type=0,this.target=6}return r}(),ns=function(){function r(s,a){this.path=s,this.target=a,this.type=1}return r}(),Ug=function(){function r(s){this.opacity=s,this.type=2,this.target=6}return r}(),Sg=function(r){return r.type===0},ho=function(r){return r.type===1},Ig=function(r){return r.type===2},go=function(r,s){return r.length===s.length?r.some(function(a,n){return a===s[n]}):!1},Hg=function(r,s,a,n,d){return r.map(function(p,B){switch(B){case 0:return p.add(s,a);case 1:return p.add(s+n,a);case 2:return p.add(s+n,a+d);case 3:return p.add(s,a+d)}return p})},uo=function(){function r(s){this.element=s,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return r}(),po=function(){function r(s,a){if(this.container=s,this.parent=a,this.effects=[],this.curves=new yg(this.container),this.container.styles.opacity<1&&this.effects.push(new Ug(this.container.styles.opacity)),this.container.styles.transform!==null){var n=this.container.bounds.left+this.container.styles.transformOrigin[0].number,d=this.container.bounds.top+this.container.styles.transformOrigin[1].number,p=this.container.styles.transform;this.effects.push(new Qg(n,d,p))}if(this.container.styles.overflowX!==0){var B=ss(this.curves),v=rs(this.curves);go(B,v)?this.effects.push(new ns(B,6)):(this.effects.push(new ns(B,2)),this.effects.push(new ns(v,4)))}}return r.prototype.getEffects=function(s){for(var a=[2,3].indexOf(this.container.styles.position)===-1,n=this.parent,d=this.effects.slice(0);n;){var p=n.effects.filter(function(C){return!ho(C)});if(a||n.container.styles.position!==0||!n.parent){if(d.unshift.apply(d,p),a=[2,3].indexOf(n.container.styles.position)===-1,n.container.styles.overflowX!==0){var B=ss(n.curves),v=rs(n.curves);go(B,v)||d.unshift(new ns(v,6))}}else d.unshift.apply(d,p);n=n.parent}return d.filter(function(C){return Me(C.target,s)})},r}(),en=function(r,s,a,n){r.container.elements.forEach(function(d){var p=Me(d.flags,4),B=Me(d.flags,2),v=new po(d,r);Me(d.styles.display,2048)&&n.push(v);var C=Me(d.flags,8)?[]:n;if(p||B){var U=p||d.styles.isPositioned()?a:s,S=new uo(v);if(d.styles.isPositioned()||d.styles.opacity<1||d.styles.isTransformed()){var I=d.styles.zIndex.order;if(I<0){var b=0;U.negativeZIndex.some(function(L,K){return I>L.element.container.styles.zIndex.order?(b=K,!1):b>0}),U.negativeZIndex.splice(b,0,S)}else if(I>0){var N=0;U.positiveZIndex.some(function(L,K){return I>=L.element.container.styles.zIndex.order?(N=K+1,!1):N>0}),U.positiveZIndex.splice(N,0,S)}else U.zeroOrAutoZIndexOrTransformedOrOpacity.push(S)}else d.styles.isFloating()?U.nonPositionedFloats.push(S):U.nonPositionedInlineLevel.push(S);en(v,S,p?S:a,C)}else d.styles.isInlineLevel()?s.inlineLevel.push(v):s.nonInlineLevel.push(v),en(v,s,a,C);Me(d.flags,8)&&fo(d,C)})},fo=function(r,s){for(var a=r instanceof Vr?r.start:1,n=r instanceof Vr?r.reversed:!1,d=0;d<s.length;d++){var p=s[d];p.container instanceof Oa&&typeof p.container.value=="number"&&p.container.value!==0&&(a=p.container.value),p.listValue=si(a,p.container.styles.listStyleType,!0),a+=n?-1:1}},bg=function(r){var s=new po(r,null),a=new uo(s),n=[];return en(s,a,a,n),fo(s.container,n),a},mo=function(r,s){switch(s){case 0:return uA(r.topLeftBorderBox,r.topLeftPaddingBox,r.topRightBorderBox,r.topRightPaddingBox);case 1:return uA(r.topRightBorderBox,r.topRightPaddingBox,r.bottomRightBorderBox,r.bottomRightPaddingBox);case 2:return uA(r.bottomRightBorderBox,r.bottomRightPaddingBox,r.bottomLeftBorderBox,r.bottomLeftPaddingBox);case 3:default:return uA(r.bottomLeftBorderBox,r.bottomLeftPaddingBox,r.topLeftBorderBox,r.topLeftPaddingBox)}},xg=function(r,s){switch(s){case 0:return uA(r.topLeftBorderBox,r.topLeftBorderDoubleOuterBox,r.topRightBorderBox,r.topRightBorderDoubleOuterBox);case 1:return uA(r.topRightBorderBox,r.topRightBorderDoubleOuterBox,r.bottomRightBorderBox,r.bottomRightBorderDoubleOuterBox);case 2:return uA(r.bottomRightBorderBox,r.bottomRightBorderDoubleOuterBox,r.bottomLeftBorderBox,r.bottomLeftBorderDoubleOuterBox);case 3:default:return uA(r.bottomLeftBorderBox,r.bottomLeftBorderDoubleOuterBox,r.topLeftBorderBox,r.topLeftBorderDoubleOuterBox)}},Mg=function(r,s){switch(s){case 0:return uA(r.topLeftBorderDoubleInnerBox,r.topLeftPaddingBox,r.topRightBorderDoubleInnerBox,r.topRightPaddingBox);case 1:return uA(r.topRightBorderDoubleInnerBox,r.topRightPaddingBox,r.bottomRightBorderDoubleInnerBox,r.bottomRightPaddingBox);case 2:return uA(r.bottomRightBorderDoubleInnerBox,r.bottomRightPaddingBox,r.bottomLeftBorderDoubleInnerBox,r.bottomLeftPaddingBox);case 3:default:return uA(r.bottomLeftBorderDoubleInnerBox,r.bottomLeftPaddingBox,r.topLeftBorderDoubleInnerBox,r.topLeftPaddingBox)}},Lg=function(r,s){switch(s){case 0:return as(r.topLeftBorderStroke,r.topRightBorderStroke);case 1:return as(r.topRightBorderStroke,r.bottomRightBorderStroke);case 2:return as(r.bottomRightBorderStroke,r.bottomLeftBorderStroke);case 3:default:return as(r.bottomLeftBorderStroke,r.topLeftBorderStroke)}},as=function(r,s){var a=[];return gA(r)?a.push(r.subdivide(.5,!1)):a.push(r),gA(s)?a.push(s.subdivide(.5,!0)):a.push(s),a},uA=function(r,s,a,n){var d=[];return gA(r)?d.push(r.subdivide(.5,!1)):d.push(r),gA(a)?d.push(a.subdivide(.5,!0)):d.push(a),gA(n)?d.push(n.subdivide(.5,!0).reverse()):d.push(n),gA(s)?d.push(s.subdivide(.5,!1).reverse()):d.push(s),d},Bo=function(r){var s=r.bounds,a=r.styles;return s.add(a.borderLeftWidth,a.borderTopWidth,-(a.borderRightWidth+a.borderLeftWidth),-(a.borderTopWidth+a.borderBottomWidth))},os=function(r){var s=r.styles,a=r.bounds,n=me(s.paddingLeft,a.width),d=me(s.paddingRight,a.width),p=me(s.paddingTop,a.width),B=me(s.paddingBottom,a.width);return a.add(n+s.borderLeftWidth,p+s.borderTopWidth,-(s.borderRightWidth+s.borderLeftWidth+n+d),-(s.borderTopWidth+s.borderBottomWidth+p+B))},Tg=function(r,s){return r===0?s.bounds:r===2?os(s):Bo(s)},Dg=function(r,s){return r===0?s.bounds:r===2?os(s):Bo(s)},An=function(r,s,a){var n=Tg(Ut(r.styles.backgroundOrigin,s),r),d=Dg(Ut(r.styles.backgroundClip,s),r),p=Pg(Ut(r.styles.backgroundSize,s),a,n),B=p[0],v=p[1],C=Zt(Ut(r.styles.backgroundPosition,s),n.width-B,n.height-v),U=Kg(Ut(r.styles.backgroundRepeat,s),C,p,n,d),S=Math.round(n.left+C[0]),I=Math.round(n.top+C[1]);return[U,S,I,B,v]},Qt=function(r){return ue(r)&&r.value===Ct.AUTO},ls=function(r){return typeof r=="number"},Pg=function(r,s,a){var n=s[0],d=s[1],p=s[2],B=r[0],v=r[1];if(!B)return[0,0];if(Qe(B)&&v&&Qe(v))return[me(B,a.width),me(v,a.height)];var C=ls(p);if(ue(B)&&(B.value===Ct.CONTAIN||B.value===Ct.COVER)){if(ls(p)){var U=a.width/a.height;return U<p!=(B.value===Ct.COVER)?[a.width,a.width/p]:[a.height*p,a.height]}return[a.width,a.height]}var S=ls(n),I=ls(d),b=S||I;if(Qt(B)&&(!v||Qt(v))){if(S&&I)return[n,d];if(!C&&!b)return[a.width,a.height];if(b&&C){var N=S?n:d*p,L=I?d:n/p;return[N,L]}var K=S?n:a.width,Z=I?d:a.height;return[K,Z]}if(C){var _=0,V=0;return Qe(B)?_=me(B,a.width):Qe(v)&&(V=me(v,a.height)),Qt(B)?_=V*p:(!v||Qt(v))&&(V=_/p),[_,V]}var le=null,j=null;if(Qe(B)?le=me(B,a.width):v&&Qe(v)&&(j=me(v,a.height)),le!==null&&(!v||Qt(v))&&(j=S&&I?le/n*d:a.height),j!==null&&Qt(B)&&(le=S&&I?j/d*n:a.width),le!==null&&j!==null)return[le,j];throw new Error("Unable to calculate background-size for element")},Ut=function(r,s){var a=r[s];return typeof a=="undefined"?r[0]:a},Kg=function(r,s,a,n,d){var p=s[0],B=s[1],v=a[0],C=a[1];switch(r){case 2:return[new k(Math.round(n.left),Math.round(n.top+B)),new k(Math.round(n.left+n.width),Math.round(n.top+B)),new k(Math.round(n.left+n.width),Math.round(C+n.top+B)),new k(Math.round(n.left),Math.round(C+n.top+B))];case 3:return[new k(Math.round(n.left+p),Math.round(n.top)),new k(Math.round(n.left+p+v),Math.round(n.top)),new k(Math.round(n.left+p+v),Math.round(n.height+n.top)),new k(Math.round(n.left+p),Math.round(n.height+n.top))];case 1:return[new k(Math.round(n.left+p),Math.round(n.top+B)),new k(Math.round(n.left+p+v),Math.round(n.top+B)),new k(Math.round(n.left+p+v),Math.round(n.top+B+C)),new k(Math.round(n.left+p),Math.round(n.top+B+C))];default:return[new k(Math.round(d.left),Math.round(d.top)),new k(Math.round(d.left+d.width),Math.round(d.top)),new k(Math.round(d.left+d.width),Math.round(d.height+d.top)),new k(Math.round(d.left),Math.round(d.height+d.top))]}},kg="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",wo="Hidden Text",Rg=function(){function r(s){this._data={},this._document=s}return r.prototype.parseMetrics=function(s,a){var n=this._document.createElement("div"),d=this._document.createElement("img"),p=this._document.createElement("span"),B=this._document.body;n.style.visibility="hidden",n.style.fontFamily=s,n.style.fontSize=a,n.style.margin="0",n.style.padding="0",n.style.whiteSpace="nowrap",B.appendChild(n),d.src=kg,d.width=1,d.height=1,d.style.margin="0",d.style.padding="0",d.style.verticalAlign="baseline",p.style.fontFamily=s,p.style.fontSize=a,p.style.margin="0",p.style.padding="0",p.appendChild(this._document.createTextNode(wo)),n.appendChild(p),n.appendChild(d);var v=d.offsetTop-p.offsetTop+2;n.removeChild(p),n.appendChild(this._document.createTextNode(wo)),n.style.lineHeight="normal",d.style.verticalAlign="super";var C=d.offsetTop-n.offsetTop+2;return B.removeChild(n),{baseline:v,middle:C}},r.prototype.getMetrics=function(s,a){var n=s+" "+a;return typeof this._data[n]=="undefined"&&(this._data[n]=this.parseMetrics(s,a)),this._data[n]},r}(),Co=function(){function r(s,a){this.context=s,this.options=a}return r}(),Og=1e4,Ng=function(r){A(s,r);function s(a,n){var d=r.call(this,a,n)||this;return d._activeEffects=[],d.canvas=n.canvas?n.canvas:document.createElement("canvas"),d.ctx=d.canvas.getContext("2d"),n.canvas||(d.canvas.width=Math.floor(n.width*n.scale),d.canvas.height=Math.floor(n.height*n.scale),d.canvas.style.width=n.width+"px",d.canvas.style.height=n.height+"px"),d.fontMetrics=new Rg(document),d.ctx.scale(d.options.scale,d.options.scale),d.ctx.translate(-n.x,-n.y),d.ctx.textBaseline="bottom",d._activeEffects=[],d.context.logger.debug("Canvas renderer initialized ("+n.width+"x"+n.height+") with scale "+n.scale),d}return s.prototype.applyEffects=function(a){for(var n=this;this._activeEffects.length;)this.popEffect();a.forEach(function(d){return n.applyEffect(d)})},s.prototype.applyEffect=function(a){this.ctx.save(),Ig(a)&&(this.ctx.globalAlpha=a.opacity),Sg(a)&&(this.ctx.translate(a.offsetX,a.offsetY),this.ctx.transform(a.matrix[0],a.matrix[1],a.matrix[2],a.matrix[3],a.matrix[4],a.matrix[5]),this.ctx.translate(-a.offsetX,-a.offsetY)),ho(a)&&(this.path(a.path),this.ctx.clip()),this._activeEffects.push(a)},s.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},s.prototype.renderStack=function(a){return t(this,void 0,void 0,function(){var n;return i(this,function(d){switch(d.label){case 0:return n=a.element.container.styles,n.isVisible()?[4,this.renderStackContent(a)]:[3,2];case 1:d.sent(),d.label=2;case 2:return[2]}})})},s.prototype.renderNode=function(a){return t(this,void 0,void 0,function(){return i(this,function(n){switch(n.label){case 0:if(Me(a.container.flags,16))debugger;return a.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(a)]:[3,3];case 1:return n.sent(),[4,this.renderNodeContent(a)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},s.prototype.renderTextWithLetterSpacing=function(a,n,d){var p=this;if(n===0)this.ctx.fillText(a.text,a.bounds.left,a.bounds.top+d);else{var B=Gr(a.text);B.reduce(function(v,C){return p.ctx.fillText(C,v,a.bounds.top+d),v+p.ctx.measureText(C).width},a.bounds.left)}},s.prototype.createFontStyle=function(a){var n=a.fontVariant.filter(function(B){return B==="normal"||B==="small-caps"}).join(""),d=Jg(a.fontFamily).join(", "),p=zt(a.fontSize)?""+a.fontSize.number+a.fontSize.unit:a.fontSize.number+"px";return[[a.fontStyle,n,a.fontWeight,p,d].join(" "),d,p]},s.prototype.renderTextNode=function(a,n){return t(this,void 0,void 0,function(){var d,p,B,v,C,U,S,I,b=this;return i(this,function(N){return d=this.createFontStyle(n),p=d[0],B=d[1],v=d[2],this.ctx.font=p,this.ctx.direction=n.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",C=this.fontMetrics.getMetrics(B,v),U=C.baseline,S=C.middle,I=n.paintOrder,a.textBounds.forEach(function(L){I.forEach(function(K){switch(K){case 0:b.ctx.fillStyle=De(n.color),b.renderTextWithLetterSpacing(L,n.letterSpacing,U);var Z=n.textShadow;Z.length&&L.text.trim().length&&(Z.slice(0).reverse().forEach(function(_){b.ctx.shadowColor=De(_.color),b.ctx.shadowOffsetX=_.offsetX.number*b.options.scale,b.ctx.shadowOffsetY=_.offsetY.number*b.options.scale,b.ctx.shadowBlur=_.blur.number,b.renderTextWithLetterSpacing(L,n.letterSpacing,U)}),b.ctx.shadowColor="",b.ctx.shadowOffsetX=0,b.ctx.shadowOffsetY=0,b.ctx.shadowBlur=0),n.textDecorationLine.length&&(b.ctx.fillStyle=De(n.textDecorationColor||n.color),n.textDecorationLine.forEach(function(_){switch(_){case 1:b.ctx.fillRect(L.bounds.left,Math.round(L.bounds.top+U),L.bounds.width,1);break;case 2:b.ctx.fillRect(L.bounds.left,Math.round(L.bounds.top),L.bounds.width,1);break;case 3:b.ctx.fillRect(L.bounds.left,Math.ceil(L.bounds.top+S),L.bounds.width,1);break}}));break;case 1:n.webkitTextStrokeWidth&&L.text.trim().length&&(b.ctx.strokeStyle=De(n.webkitTextStrokeColor),b.ctx.lineWidth=n.webkitTextStrokeWidth,b.ctx.lineJoin=window.chrome?"miter":"round",b.ctx.strokeText(L.text,L.bounds.left,L.bounds.top+U)),b.ctx.strokeStyle="",b.ctx.lineWidth=0,b.ctx.lineJoin="miter";break}})}),[2]})})},s.prototype.renderReplacedElement=function(a,n,d){if(d&&a.intrinsicWidth>0&&a.intrinsicHeight>0){var p=os(a),B=rs(n);this.path(B),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(d,0,0,a.intrinsicWidth,a.intrinsicHeight,p.left,p.top,p.width,p.height),this.ctx.restore()}},s.prototype.renderNodeContent=function(a){return t(this,void 0,void 0,function(){var n,d,p,B,v,C,V,V,U,S,I,b,j,N,L,$,K,Z,_,V,le,j,$;return i(this,function(R){switch(R.label){case 0:this.applyEffects(a.getEffects(4)),n=a.container,d=a.curves,p=n.styles,B=0,v=n.textNodes,R.label=1;case 1:return B<v.length?(C=v[B],[4,this.renderTextNode(C,p)]):[3,4];case 2:R.sent(),R.label=3;case 3:return B++,[3,1];case 4:if(!(n instanceof Ka))return[3,8];R.label=5;case 5:return R.trys.push([5,7,,8]),[4,this.context.cache.match(n.src)];case 6:return V=R.sent(),this.renderReplacedElement(n,d,V),[3,8];case 7:return R.sent(),this.context.logger.error("Error loading image "+n.src),[3,8];case 8:if(n instanceof ka&&this.renderReplacedElement(n,d,n.canvas),!(n instanceof Ra))return[3,12];R.label=9;case 9:return R.trys.push([9,11,,12]),[4,this.context.cache.match(n.svg)];case 10:return V=R.sent(),this.renderReplacedElement(n,d,V),[3,12];case 11:return R.sent(),this.context.logger.error("Error loading svg "+n.svg.substring(0,255)),[3,12];case 12:return n instanceof _a&&n.tree?(U=new s(this.context,{scale:this.options.scale,backgroundColor:n.backgroundColor,x:0,y:0,width:n.width,height:n.height}),[4,U.render(n.tree)]):[3,14];case 13:S=R.sent(),n.width&&n.height&&this.ctx.drawImage(S,0,0,n.width,n.height,n.bounds.left,n.bounds.top,n.bounds.width,n.bounds.height),R.label=14;case 14:if(n instanceof _r&&(I=Math.min(n.bounds.width,n.bounds.height),n.type===zi?n.checked&&(this.ctx.save(),this.path([new k(n.bounds.left+I*.39363,n.bounds.top+I*.79),new k(n.bounds.left+I*.16,n.bounds.top+I*.5549),new k(n.bounds.left+I*.27347,n.bounds.top+I*.44071),new k(n.bounds.left+I*.39694,n.bounds.top+I*.5649),new k(n.bounds.left+I*.72983,n.bounds.top+I*.23),new k(n.bounds.left+I*.84,n.bounds.top+I*.34085),new k(n.bounds.left+I*.39363,n.bounds.top+I*.79)]),this.ctx.fillStyle=De(Na),this.ctx.fill(),this.ctx.restore()):n.type===Zi&&n.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(n.bounds.left+I/2,n.bounds.top+I/2,I/4,0,Math.PI*2,!0),this.ctx.fillStyle=De(Na),this.ctx.fill(),this.ctx.restore())),Gg(n)&&n.value.length){switch(b=this.createFontStyle(p),j=b[0],N=b[1],L=this.fontMetrics.getMetrics(j,N).baseline,this.ctx.font=j,this.ctx.fillStyle=De(p.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=_g(n.styles.textAlign),$=os(n),K=0,n.styles.textAlign){case 1:K+=$.width/2;break;case 2:K+=$.width;break}Z=$.add(K,0,0,-$.height/2+1),this.ctx.save(),this.path([new k($.left,$.top),new k($.left+$.width,$.top),new k($.left+$.width,$.top+$.height),new k($.left,$.top+$.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new ti(n.value,Z),p.letterSpacing,L),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!Me(n.styles.display,2048))return[3,20];if(n.styles.listStyleImage===null)return[3,19];if(_=n.styles.listStyleImage,_.type!==0)return[3,18];V=void 0,le=_.url,R.label=15;case 15:return R.trys.push([15,17,,18]),[4,this.context.cache.match(le)];case 16:return V=R.sent(),this.ctx.drawImage(V,n.bounds.left-(V.width+10),n.bounds.top),[3,18];case 17:return R.sent(),this.context.logger.error("Error loading list-style-image "+le),[3,18];case 18:return[3,20];case 19:a.listValue&&n.styles.listStyleType!==-1&&(j=this.createFontStyle(p)[0],this.ctx.font=j,this.ctx.fillStyle=De(p.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",$=new l(n.bounds.left,n.bounds.top+me(n.styles.paddingTop,n.bounds.width),n.bounds.width,Ba(p.lineHeight,p.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new ti(a.listValue,$),p.letterSpacing,Ba(p.lineHeight,p.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),R.label=20;case 20:return[2]}})})},s.prototype.renderStackContent=function(a){return t(this,void 0,void 0,function(){var n,d,_,p,B,_,v,C,_,U,S,_,I,b,_,N,L,_,K,Z,_;return i(this,function(V){switch(V.label){case 0:if(Me(a.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(a.element)];case 1:V.sent(),n=0,d=a.negativeZIndex,V.label=2;case 2:return n<d.length?(_=d[n],[4,this.renderStack(_)]):[3,5];case 3:V.sent(),V.label=4;case 4:return n++,[3,2];case 5:return[4,this.renderNodeContent(a.element)];case 6:V.sent(),p=0,B=a.nonInlineLevel,V.label=7;case 7:return p<B.length?(_=B[p],[4,this.renderNode(_)]):[3,10];case 8:V.sent(),V.label=9;case 9:return p++,[3,7];case 10:v=0,C=a.nonPositionedFloats,V.label=11;case 11:return v<C.length?(_=C[v],[4,this.renderStack(_)]):[3,14];case 12:V.sent(),V.label=13;case 13:return v++,[3,11];case 14:U=0,S=a.nonPositionedInlineLevel,V.label=15;case 15:return U<S.length?(_=S[U],[4,this.renderStack(_)]):[3,18];case 16:V.sent(),V.label=17;case 17:return U++,[3,15];case 18:I=0,b=a.inlineLevel,V.label=19;case 19:return I<b.length?(_=b[I],[4,this.renderNode(_)]):[3,22];case 20:V.sent(),V.label=21;case 21:return I++,[3,19];case 22:N=0,L=a.zeroOrAutoZIndexOrTransformedOrOpacity,V.label=23;case 23:return N<L.length?(_=L[N],[4,this.renderStack(_)]):[3,26];case 24:V.sent(),V.label=25;case 25:return N++,[3,23];case 26:K=0,Z=a.positiveZIndex,V.label=27;case 27:return K<Z.length?(_=Z[K],[4,this.renderStack(_)]):[3,30];case 28:V.sent(),V.label=29;case 29:return K++,[3,27];case 30:return[2]}})})},s.prototype.mask=function(a){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(a.slice(0).reverse()),this.ctx.closePath()},s.prototype.path=function(a){this.ctx.beginPath(),this.formatPath(a),this.ctx.closePath()},s.prototype.formatPath=function(a){var n=this;a.forEach(function(d,p){var B=gA(d)?d.start:d;p===0?n.ctx.moveTo(B.x,B.y):n.ctx.lineTo(B.x,B.y),gA(d)&&n.ctx.bezierCurveTo(d.startControl.x,d.startControl.y,d.endControl.x,d.endControl.y,d.end.x,d.end.y)})},s.prototype.renderRepeat=function(a,n,d,p){this.path(a),this.ctx.fillStyle=n,this.ctx.translate(d,p),this.ctx.fill(),this.ctx.translate(-d,-p)},s.prototype.resizeImage=function(a,n,d){var p;if(a.width===n&&a.height===d)return a;var B=(p=this.canvas.ownerDocument)!==null&&p!==void 0?p:document,v=B.createElement("canvas");v.width=Math.max(1,n),v.height=Math.max(1,d);var C=v.getContext("2d");return C.drawImage(a,0,0,a.width,a.height,0,0,n,d),v},s.prototype.renderBackgroundImage=function(a){return t(this,void 0,void 0,function(){var n,d,p,B,v,C;return i(this,function(U){switch(U.label){case 0:n=a.styles.backgroundImage.length-1,d=function(S){var I,b,N,Ue,tA,iA,pe,Oe,ae,L,Ue,tA,iA,pe,Oe,K,Z,_,V,le,j,$,R,ne,ae,Y,Ue,AA,lA,pe,Oe,YA,tA,iA,ct,UA,qA,ht,dt,LA,gt,TA;return i(this,function(St){switch(St.label){case 0:if(S.type!==0)return[3,5];I=void 0,b=S.url,St.label=1;case 1:return St.trys.push([1,3,,4]),[4,p.context.cache.match(b)];case 2:return I=St.sent(),[3,4];case 3:return St.sent(),p.context.logger.error("Error loading background-image "+b),[3,4];case 4:return I&&(N=An(a,n,[I.width,I.height,I.width/I.height]),Ue=N[0],tA=N[1],iA=N[2],pe=N[3],Oe=N[4],ae=p.ctx.createPattern(p.resizeImage(I,pe,Oe),"repeat"),p.renderRepeat(Ue,ae,tA,iA)),[3,6];case 5:Sc(S)?(L=An(a,n,[null,null,null]),Ue=L[0],tA=L[1],iA=L[2],pe=L[3],Oe=L[4],K=Fc(S.angle,pe,Oe),Z=K[0],_=K[1],V=K[2],le=K[3],j=K[4],$=document.createElement("canvas"),$.width=pe,$.height=Oe,R=$.getContext("2d"),ne=R.createLinearGradient(_,le,V,j),aa(S.stops,Z).forEach(function(ni){return ne.addColorStop(ni.stop,De(ni.color))}),R.fillStyle=ne,R.fillRect(0,0,pe,Oe),pe>0&&Oe>0&&(ae=p.ctx.createPattern($,"repeat"),p.renderRepeat(Ue,ae,tA,iA))):Ic(S)&&(Y=An(a,n,[null,null,null]),Ue=Y[0],AA=Y[1],lA=Y[2],pe=Y[3],Oe=Y[4],YA=S.position.length===0?[Sr]:S.position,tA=me(YA[0],pe),iA=me(YA[YA.length-1],Oe),ct=yc(S,tA,iA,pe,Oe),UA=ct[0],qA=ct[1],UA>0&&qA>0&&(ht=p.ctx.createRadialGradient(AA+tA,lA+iA,0,AA+tA,lA+iA,UA),aa(S.stops,UA*2).forEach(function(ni){return ht.addColorStop(ni.stop,De(ni.color))}),p.path(Ue),p.ctx.fillStyle=ht,UA!==qA?(dt=a.bounds.left+.5*a.bounds.width,LA=a.bounds.top+.5*a.bounds.height,gt=qA/UA,TA=1/gt,p.ctx.save(),p.ctx.translate(dt,LA),p.ctx.transform(1,0,0,gt,0,0),p.ctx.translate(-dt,-LA),p.ctx.fillRect(AA,TA*(lA-LA)+LA,pe,Oe*TA),p.ctx.restore()):p.ctx.fill())),St.label=6;case 6:return n--,[2]}})},p=this,B=0,v=a.styles.backgroundImage.slice(0).reverse(),U.label=1;case 1:return B<v.length?(C=v[B],[5,d(C)]):[3,4];case 2:U.sent(),U.label=3;case 3:return B++,[3,1];case 4:return[2]}})})},s.prototype.renderSolidBorder=function(a,n,d){return t(this,void 0,void 0,function(){return i(this,function(p){return this.path(mo(d,n)),this.ctx.fillStyle=De(a),this.ctx.fill(),[2]})})},s.prototype.renderDoubleBorder=function(a,n,d,p){return t(this,void 0,void 0,function(){var B,v;return i(this,function(C){switch(C.label){case 0:return n<3?[4,this.renderSolidBorder(a,d,p)]:[3,2];case 1:return C.sent(),[2];case 2:return B=xg(p,d),this.path(B),this.ctx.fillStyle=De(a),this.ctx.fill(),v=Mg(p,d),this.path(v),this.ctx.fill(),[2]}})})},s.prototype.renderNodeBackgroundAndBorders=function(a){return t(this,void 0,void 0,function(){var n,d,p,B,v,C,U,S,I=this;return i(this,function(b){switch(b.label){case 0:return this.applyEffects(a.getEffects(2)),n=a.container.styles,d=!XA(n.backgroundColor)||n.backgroundImage.length,p=[{style:n.borderTopStyle,color:n.borderTopColor,width:n.borderTopWidth},{style:n.borderRightStyle,color:n.borderRightColor,width:n.borderRightWidth},{style:n.borderBottomStyle,color:n.borderBottomColor,width:n.borderBottomWidth},{style:n.borderLeftStyle,color:n.borderLeftColor,width:n.borderLeftWidth}],B=Vg(Ut(n.backgroundClip,0),a.curves),d||n.boxShadow.length?(this.ctx.save(),this.path(B),this.ctx.clip(),XA(n.backgroundColor)||(this.ctx.fillStyle=De(n.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(a.container)]):[3,2];case 1:b.sent(),this.ctx.restore(),n.boxShadow.slice(0).reverse().forEach(function(N){I.ctx.save();var L=ss(a.curves),K=N.inset?0:Og,Z=Hg(L,-K+(N.inset?1:-1)*N.spread.number,(N.inset?1:-1)*N.spread.number,N.spread.number*(N.inset?-2:2),N.spread.number*(N.inset?-2:2));N.inset?(I.path(L),I.ctx.clip(),I.mask(Z)):(I.mask(L),I.ctx.clip(),I.path(Z)),I.ctx.shadowOffsetX=N.offsetX.number+K,I.ctx.shadowOffsetY=N.offsetY.number,I.ctx.shadowColor=De(N.color),I.ctx.shadowBlur=N.blur.number,I.ctx.fillStyle=N.inset?De(N.color):"rgba(0,0,0,1)",I.ctx.fill(),I.ctx.restore()}),b.label=2;case 2:v=0,C=0,U=p,b.label=3;case 3:return C<U.length?(S=U[C],S.style!==0&&!XA(S.color)&&S.width>0?S.style!==2?[3,5]:[4,this.renderDashedDottedBorder(S.color,S.width,v,a.curves,2)]:[3,11]):[3,13];case 4:return b.sent(),[3,11];case 5:return S.style!==3?[3,7]:[4,this.renderDashedDottedBorder(S.color,S.width,v,a.curves,3)];case 6:return b.sent(),[3,11];case 7:return S.style!==4?[3,9]:[4,this.renderDoubleBorder(S.color,S.width,v,a.curves)];case 8:return b.sent(),[3,11];case 9:return[4,this.renderSolidBorder(S.color,v,a.curves)];case 10:b.sent(),b.label=11;case 11:v++,b.label=12;case 12:return C++,[3,3];case 13:return[2]}})})},s.prototype.renderDashedDottedBorder=function(a,n,d,p,B){return t(this,void 0,void 0,function(){var v,C,U,S,I,b,N,L,K,Z,_,V,le,j,$,R,$,R;return i(this,function(ne){return this.ctx.save(),v=Lg(p,d),C=mo(p,d),B===2&&(this.path(C),this.ctx.clip()),gA(C[0])?(U=C[0].start.x,S=C[0].start.y):(U=C[0].x,S=C[0].y),gA(C[1])?(I=C[1].end.x,b=C[1].end.y):(I=C[1].x,b=C[1].y),d===0||d===2?N=Math.abs(U-I):N=Math.abs(S-b),this.ctx.beginPath(),B===3?this.formatPath(v):this.formatPath(C.slice(0,2)),L=n<3?n*3:n*2,K=n<3?n*2:n,B===3&&(L=n,K=n),Z=!0,N<=L*2?Z=!1:N<=L*2+K?(_=N/(2*L+K),L*=_,K*=_):(V=Math.floor((N+K)/(L+K)),le=(N-V*L)/(V-1),j=(N-(V+1)*L)/V,K=j<=0||Math.abs(K-le)<Math.abs(K-j)?le:j),Z&&(B===3?this.ctx.setLineDash([0,L+K]):this.ctx.setLineDash([L,K])),B===3?(this.ctx.lineCap="round",this.ctx.lineWidth=n):this.ctx.lineWidth=n*2+1.1,this.ctx.strokeStyle=De(a),this.ctx.stroke(),this.ctx.setLineDash([]),B===2&&(gA(C[0])&&($=C[3],R=C[0],this.ctx.beginPath(),this.formatPath([new k($.end.x,$.end.y),new k(R.start.x,R.start.y)]),this.ctx.stroke()),gA(C[1])&&($=C[1],R=C[2],this.ctx.beginPath(),this.formatPath([new k($.end.x,$.end.y),new k(R.start.x,R.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},s.prototype.render=function(a){return t(this,void 0,void 0,function(){var n;return i(this,function(d){switch(d.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=De(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),n=bg(a),[4,this.renderStack(n)];case 1:return d.sent(),this.applyEffects([]),[2,this.canvas]}})})},s}(Co),Gg=function(r){return r instanceof Va||r instanceof Ga?!0:r instanceof _r&&r.type!==Zi&&r.type!==zi},Vg=function(r,s){switch(r){case 0:return ss(s);case 2:return Eg(s);case 1:default:return rs(s)}},_g=function(r){switch(r){case 1:return"center";case 2:return"right";case 0:default:return"left"}},Xg=["-apple-system","system-ui"],Jg=function(r){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?r.filter(function(s){return Xg.indexOf(s)===-1}):r},Wg=function(r){A(s,r);function s(a,n){var d=r.call(this,a,n)||this;return d.canvas=n.canvas?n.canvas:document.createElement("canvas"),d.ctx=d.canvas.getContext("2d"),d.options=n,d.canvas.width=Math.floor(n.width*n.scale),d.canvas.height=Math.floor(n.height*n.scale),d.canvas.style.width=n.width+"px",d.canvas.style.height=n.height+"px",d.ctx.scale(d.options.scale,d.options.scale),d.ctx.translate(-n.x,-n.y),d.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+n.width+"x"+n.height+" at "+n.x+","+n.y+") with scale "+n.scale),d}return s.prototype.render=function(a){return t(this,void 0,void 0,function(){var n,d;return i(this,function(p){switch(p.label){case 0:return n=Nr(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,a),[4,$g(n)];case 1:return d=p.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=De(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(d,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},s}(Co),$g=function(r){return new Promise(function(s,a){var n=new Image;n.onload=function(){s(n)},n.onerror=a,n.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(r))})},Yg=function(){function r(s){var a=s.id,n=s.enabled;this.id=a,this.enabled=n,this.start=Date.now()}return r.prototype.debug=function(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];this.enabled&&(typeof window!="undefined"&&window.console&&typeof console.debug=="function"?console.debug.apply(console,o([this.id,this.getTime()+"ms"],s)):this.info.apply(this,s))},r.prototype.getTime=function(){return Date.now()-this.start},r.prototype.info=function(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];this.enabled&&typeof window!="undefined"&&window.console&&typeof console.info=="function"&&console.info.apply(console,o([this.id,this.getTime()+"ms"],s))},r.prototype.warn=function(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];this.enabled&&(typeof window!="undefined"&&window.console&&typeof console.warn=="function"?console.warn.apply(console,o([this.id,this.getTime()+"ms"],s)):this.info.apply(this,s))},r.prototype.error=function(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];this.enabled&&(typeof window!="undefined"&&window.console&&typeof console.error=="function"?console.error.apply(console,o([this.id,this.getTime()+"ms"],s)):this.info.apply(this,s))},r.instances={},r}(),qg=function(){function r(s,a){var n;this.windowBounds=a,this.instanceName="#"+r.instanceCount++,this.logger=new Yg({id:this.instanceName,enabled:s.logging}),this.cache=(n=s.cache)!==null&&n!==void 0?n:new fg(this,s)}return r.instanceCount=1,r}(),zg=function(r,s){return s===void 0&&(s={}),Zg(r,s)};typeof window!="undefined"&&co.setContext(window);var Zg=function(r,s){return t(void 0,void 0,void 0,function(){var a,n,d,p,B,v,C,U,S,I,b,N,L,K,Z,_,V,le,j,$,ne,R,ne,ae,Y,Ue,AA,lA,pe,Oe,YA,tA,iA,ct,UA,qA,ht,dt,LA,gt;return i(this,function(TA){switch(TA.label){case 0:if(!r||typeof r!="object")return[2,Promise.reject("Invalid element provided as first argument")];if(a=r.ownerDocument,!a)throw new Error("Element is not attached to a Document");if(n=a.defaultView,!n)throw new Error("Document is not attached to a Window");return d={allowTaint:(ae=s.allowTaint)!==null&&ae!==void 0?ae:!1,imageTimeout:(Y=s.imageTimeout)!==null&&Y!==void 0?Y:15e3,proxy:s.proxy,useCORS:(Ue=s.useCORS)!==null&&Ue!==void 0?Ue:!1},p=e({logging:(AA=s.logging)!==null&&AA!==void 0?AA:!0,cache:s.cache},d),B={windowWidth:(lA=s.windowWidth)!==null&&lA!==void 0?lA:n.innerWidth,windowHeight:(pe=s.windowHeight)!==null&&pe!==void 0?pe:n.innerHeight,scrollX:(Oe=s.scrollX)!==null&&Oe!==void 0?Oe:n.pageXOffset,scrollY:(YA=s.scrollY)!==null&&YA!==void 0?YA:n.pageYOffset},v=new l(B.scrollX,B.scrollY,B.windowWidth,B.windowHeight),C=new qg(p,v),U=(tA=s.foreignObjectRendering)!==null&&tA!==void 0?tA:!1,S={allowTaint:(iA=s.allowTaint)!==null&&iA!==void 0?iA:!1,onclone:s.onclone,ignoreElements:s.ignoreElements,inlineImages:U,copyStyles:U},C.logger.debug("Starting document clone with size "+v.width+"x"+v.height+" scrolled to "+-v.left+","+-v.top),I=new oo(C,r,S),b=I.clonedReferenceElement,b?[4,I.toIFrame(a,v)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return N=TA.sent(),L=Jr(b)||jd(b)?h(b.ownerDocument):c(C,b),K=L.width,Z=L.height,_=L.left,V=L.top,le=jg(C,b,s.backgroundColor),j={canvas:s.canvas,backgroundColor:le,scale:(UA=(ct=s.scale)!==null&&ct!==void 0?ct:n.devicePixelRatio)!==null&&UA!==void 0?UA:1,x:((qA=s.x)!==null&&qA!==void 0?qA:0)+_,y:((ht=s.y)!==null&&ht!==void 0?ht:0)+V,width:(dt=s.width)!==null&&dt!==void 0?dt:Math.ceil(K),height:(LA=s.height)!==null&&LA!==void 0?LA:Math.ceil(Z)},U?(C.logger.debug("Document cloned, using foreign object rendering"),ne=new Wg(C,j),[4,ne.render(b)]):[3,3];case 2:return $=TA.sent(),[3,5];case 3:return C.logger.debug("Document cloned, element located at "+_+","+V+" with size "+K+"x"+Z+" using computed rendering"),C.logger.debug("Starting DOM parsing"),R=Ja(C,b),le===R.styles.backgroundColor&&(R.styles.backgroundColor=xA.TRANSPARENT),C.logger.debug("Starting renderer for element at "+j.x+","+j.y+" with size "+j.width+"x"+j.height),ne=new Ng(C,j),[4,ne.render(R)];case 4:$=TA.sent(),TA.label=5;case 5:return(!((gt=s.removeContainer)!==null&&gt!==void 0)||gt)&&(oo.destroy(N)||C.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),C.logger.debug("Finished rendering"),[2,$]}})})},jg=function(r,s,a){var n=s.ownerDocument,d=n.documentElement?jt(r,getComputedStyle(n.documentElement).backgroundColor):xA.TRANSPARENT,p=n.body?jt(r,getComputedStyle(n.body).backgroundColor):xA.TRANSPARENT,B=typeof a=="string"?jt(r,a):a===null?xA.TRANSPARENT:4294967295;return s===n.documentElement?XA(d)?XA(p)?B:p:d:B};return zg})});var ko,Ne,un=cs(()=>{ko=require("crypto"),Ne=class{static toSafeFileName(A){return A.replace(/[\/\\:*?"<>|]/g,"_").replace(/\s+/g,"_").toLowerCase()+".json"}static fromSafeFileName(A){return A.replace(/\.json$/,"")}static generateHash(A){return(0,ko.createHash)("md5").update(A).digest("hex")}static isSafePath(A){return!/[\/\\:*?"<>|]/.test(A)}static getHiNoteDir(A){return`${A}/.hinote`}static getHighlightsDir(A){return`${this.getHiNoteDir(A)}/highlights`}static getFlashcardsDir(A){return`${this.getHiNoteDir(A)}/flashcards`}static getMetadataDir(A){return`${this.getHiNoteDir(A)}/metadata`}}});var Lt,Ro=cs(()=>{Lt=class{static validateHighlightData(A){let e=[];if(!A||typeof A!="object")return e.push("\u6570\u636E\u5FC5\u987B\u662F\u5BF9\u8C61"),{valid:!1,errors:e};if((!A.version||typeof A.version!="string")&&e.push("\u7F3A\u5C11\u6709\u6548\u7684\u7248\u672C\u4FE1\u606F"),A.lastModified&&typeof A.lastModified!="number"&&e.push("lastModified\u5FC5\u987B\u662F\u6570\u5B57"),!A.highlights||typeof A.highlights!="object")return e.push("\u7F3A\u5C11highlights\u5BF9\u8C61"),{valid:!1,errors:e};for(let[t,i]of Object.entries(A.highlights)){let o=this.validateHighlight(t,i);e.push(...o)}return{valid:e.length===0,errors:e}}static validateHighlight(A,e){let t=[];return!e||typeof e!="object"?(t.push(`\u9AD8\u4EAE ${A}: \u6570\u636E\u5FC5\u987B\u662F\u5BF9\u8C61`),t):((!e.text||typeof e.text!="string")&&t.push(`\u9AD8\u4EAE ${A}: \u7F3A\u5C11\u6709\u6548\u7684text\u5B57\u6BB5`),typeof e.position!="number"&&t.push(`\u9AD8\u4EAE ${A}: position\u5FC5\u987B\u662F\u6570\u5B57`),typeof e.created!="number"&&t.push(`\u9AD8\u4EAE ${A}: created\u5FC5\u987B\u662F\u6570\u5B57`),typeof e.updated!="number"&&t.push(`\u9AD8\u4EAE ${A}: updated\u5FC5\u987B\u662F\u6570\u5B57`),e.backgroundColor&&typeof e.backgroundColor!="string"&&t.push(`\u9AD8\u4EAE ${A}: backgroundColor\u5FC5\u987B\u662F\u5B57\u7B26\u4E32`),e.blockId&&typeof e.blockId!="string"&&t.push(`\u9AD8\u4EAE ${A}: blockId\u5FC5\u987B\u662F\u5B57\u7B26\u4E32`),e.isCloze&&typeof e.isCloze!="boolean"&&t.push(`\u9AD8\u4EAE ${A}: isCloze\u5FC5\u987B\u662F\u5E03\u5C14\u503C`),e.comments&&(Array.isArray(e.comments)?e.comments.forEach((i,o)=>{let l=this.validateComment(i,`${A}.comments[${o}]`);t.push(...l)}):t.push(`\u9AD8\u4EAE ${A}: comments\u5FC5\u987B\u662F\u6570\u7EC4`)),t)}static validateComment(A,e){let t=[];return!A||typeof A!="object"?(t.push(`${e}: \u8BC4\u8BBA\u6570\u636E\u5FC5\u987B\u662F\u5BF9\u8C61`),t):((!A.id||typeof A.id!="string")&&t.push(`${e}: \u7F3A\u5C11\u6709\u6548\u7684id\u5B57\u6BB5`),(!A.content||typeof A.content!="string")&&t.push(`${e}: \u7F3A\u5C11\u6709\u6548\u7684content\u5B57\u6BB5`),typeof A.created!="number"&&t.push(`${e}: created\u5FC5\u987B\u662F\u6570\u5B57`),typeof A.updated!="number"&&t.push(`${e}: updated\u5FC5\u987B\u662F\u6570\u5B57`),t)}static validateFlashcardData(A){let e=[];return!A||typeof A!="object"?(e.push("\u95EA\u5361\u6570\u636E\u5FC5\u987B\u662F\u5BF9\u8C61"),{valid:!1,errors:e}):((!A.version||typeof A.version!="string")&&e.push("\u7F3A\u5C11\u6709\u6548\u7684\u7248\u672C\u4FE1\u606F"),A.cards&&typeof A.cards!="object"&&e.push("cards\u5FC5\u987B\u662F\u5BF9\u8C61"),A.globalStats&&typeof A.globalStats!="object"&&e.push("globalStats\u5FC5\u987B\u662F\u5BF9\u8C61"),A.cardGroups&&!Array.isArray(A.cardGroups)&&e.push("cardGroups\u5FC5\u987B\u662F\u6570\u7EC4"),{valid:e.length===0,errors:e})}static validateFileMappingData(A){let e=[];return!A||typeof A!="object"?(e.push("\u6620\u5C04\u6570\u636E\u5FC5\u987B\u662F\u5BF9\u8C61"),{valid:!1,errors:e}):((!A.version||typeof A.version!="string")&&e.push("\u7F3A\u5C11\u6709\u6548\u7684\u7248\u672C\u4FE1\u606F"),(!A.mapping||typeof A.mapping!="object")&&e.push("\u7F3A\u5C11mapping\u5BF9\u8C61"),typeof A.lastUpdated!="number"&&e.push("lastUpdated\u5FC5\u987B\u662F\u6570\u5B57"),{valid:e.length===0,errors:e})}static sanitizeHighlight(A){let e={};return A.text&&typeof A.text=="string"&&(e.text=A.text),typeof A.position=="number"&&(e.position=A.position),typeof A.created=="number"?e.created=A.created:typeof A.createdAt=="number"&&(e.created=A.createdAt),typeof A.updated=="number"?e.updated=A.updated:typeof A.updatedAt=="number"&&(e.updated=A.updatedAt),A.backgroundColor&&typeof A.backgroundColor=="string"&&(e.backgroundColor=A.backgroundColor),A.blockId&&typeof A.blockId=="string"&&(e.blockId=A.blockId),typeof A.isCloze=="boolean"&&(e.isCloze=A.isCloze),typeof A.paragraphOffset=="number"&&(e.paragraphOffset=A.paragraphOffset),Array.isArray(A.comments)&&(e.comments=A.comments.filter(t=>t&&typeof t=="object").map(t=>this.sanitizeComment(t)).filter(t=>t.id&&t.content)),e}static sanitizeComment(A){let e={};return A.id&&typeof A.id=="string"&&(e.id=A.id),A.content&&typeof A.content=="string"&&(e.content=A.content),typeof A.created=="number"?e.created=A.created:typeof A.createdAt=="number"&&(e.created=A.createdAt),typeof A.updated=="number"?e.updated=A.updated:typeof A.updatedAt=="number"&&(e.updated=A.updatedAt),e}}});var Oo,tt,Ds=cs(()=>{Oo=require("obsidian");un();Ro();tt=class{constructor(A){this.fileMapping=new Map;this.CURRENT_VERSION="2.0";this.app=A,this.vaultPath=""}async initialize(){await this.ensureDirectoryStructure(),await this.loadFileMapping()}async ensureDirectoryStructure(){let A=[Ne.getHiNoteDir(this.vaultPath),Ne.getHighlightsDir(this.vaultPath),Ne.getFlashcardsDir(this.vaultPath),Ne.getMetadataDir(this.vaultPath)];for(let e of A)try{await this.app.vault.adapter.mkdir(e)}catch(t){}}async loadFileMapping(){let A=`${Ne.getMetadataDir(this.vaultPath)}/file-mapping.json`;try{let e=await this.app.vault.adapter.read(A),t=JSON.parse(e),i=Lt.validateFileMappingData(t);if(!i.valid){console.warn("\u6587\u4EF6\u6620\u5C04\u6570\u636E\u9A8C\u8BC1\u5931\u8D25:",i.errors);return}this.fileMapping=new Map(Object.entries(t.mapping))}catch(e){this.fileMapping=new Map}}async saveFileMapping(){let A=`${Ne.getMetadataDir(this.vaultPath)}/file-mapping.json`,e={version:this.CURRENT_VERSION,mapping:Object.fromEntries(this.fileMapping),lastUpdated:Date.now()};await this.app.vault.adapter.write(A,JSON.stringify(e,null,2))}getStoragePathForFile(A){let e=this.fileMapping.get(A);return e||(e=Ne.toSafeFileName(A),this.fileMapping.set(A,e),this.saveFileMapping().catch(console.error)),`${Ne.getHighlightsDir(this.vaultPath)}/${e}`}async getFileHighlights(A){let e=this.getStoragePathForFile(A);try{let t=await this.app.vault.adapter.read(e),i=JSON.parse(t),o=Lt.validateHighlightData(i);return o.valid?Object.entries(i.highlights).map(([l,c])=>this.convertToLegacyFormat(l,c,A)):(console.warn(`\u6587\u4EF6 ${A} \u7684\u9AD8\u4EAE\u6570\u636E\u9A8C\u8BC1\u5931\u8D25:`,o.errors),[])}catch(t){return[]}}async saveFileHighlights(A,e){let t=this.getStoragePathForFile(A),i={};for(let l of e){let c=this.convertToOptimizedFormat(l);i[l.id]=c}let o={version:this.CURRENT_VERSION,lastModified:Date.now(),highlights:i};await this.app.vault.adapter.write(t,JSON.stringify(o,null,2))}async deleteFileHighlights(A){let e=this.getStoragePathForFile(A);try{await this.app.vault.adapter.remove(e),this.fileMapping.delete(A),await this.saveFileMapping()}catch(t){}}async handleFileRename(A,e){let t=this.getStoragePathForFile(A),i=this.getStoragePathForFile(e);try{let o=await this.app.vault.adapter.read(t);await this.app.vault.adapter.write(i,o),await this.app.vault.adapter.remove(t),this.fileMapping.delete(A),await this.saveFileMapping()}catch(o){}}async getAllHighlightFiles(){let A=Array.from(this.fileMapping.keys());if(A.length===0)try{let e=Ne.getHighlightsDir(this.vaultPath),t=await this.app.vault.adapter.list(e),i=[];for(let o of t.files)if(o.endsWith(".json")){let l=o.replace(/\.json$/,"").replace(e+"/","");try{let c=await this.app.vault.adapter.read(o),h=JSON.parse(c);if(h.highlights&&Object.keys(h.highlights).length>0)if(l==="why_write.md")i.push("Why Write.md");else if(l==="obsidian_manifesto.md")i.push("Obsidian Manifesto.md");else{let g=l.replace(/_/g," ").replace(/\.md$/,".md");i.push(g)}}catch(c){console.warn(`\u65E0\u6CD5\u8BFB\u53D6\u9AD8\u4EAE\u6587\u4EF6 ${o}:`,c)}}for(let o of i){let l=Ne.toSafeFileName(o);this.fileMapping.set(o,l)}return i.length>0&&await this.saveFileMapping(),i}catch(e){return console.warn("\u626B\u63CF\u9AD8\u4EAE\u76EE\u5F55\u5931\u8D25:",e),[]}return A}async cleanOrphanedHighlights(){let A=await this.getAllHighlightFiles(),e=0;for(let t of A){let i=this.app.vault.getAbstractFileByPath(t);(!i||!(i instanceof Oo.TFile))&&(await this.deleteFileHighlights(t),e++)}return{removedFiles:e,totalFiles:A.length}}convertToLegacyFormat(A,e,t){var i;return{id:A,text:e.text,position:e.position,createdAt:e.created,updatedAt:e.updated,filePath:t,backgroundColor:e.backgroundColor,blockId:e.blockId,isCloze:e.isCloze||!1,paragraphOffset:e.paragraphOffset,comments:((i=e.comments)==null?void 0:i.map(o=>({id:o.id,content:o.content,createdAt:o.created,updatedAt:o.updated})))||[]}}convertToOptimizedFormat(A){let e={text:A.text,position:A.position,created:A.createdAt,updated:A.updatedAt};return A.backgroundColor&&(e.backgroundColor=A.backgroundColor),A.blockId&&(e.blockId=A.blockId),A.isCloze&&(e.isCloze=A.isCloze),A.paragraphOffset!==void 0&&(e.paragraphOffset=A.paragraphOffset),A.comments&&A.comments.length>0&&(e.comments=A.comments.map(t=>({id:t.id,content:t.content,created:t.createdAt,updated:t.updatedAt}))),e}async getFlashcardData(){let A=`${Ne.getFlashcardsDir(this.vaultPath)}/cards.json`;try{let e=await this.app.vault.adapter.read(A),t=JSON.parse(e),i=Lt.validateFlashcardData(t);return i.valid?t:(console.warn("\u95EA\u5361\u6570\u636E\u9A8C\u8BC1\u5931\u8D25:",i.errors),null)}catch(e){return null}}async saveFlashcardData(A){let e=`${Ne.getFlashcardsDir(this.vaultPath)}/cards.json`;await this.app.vault.adapter.write(e,JSON.stringify(A,null,2))}}});var Yo={};vo(Yo,{DataRecovery:()=>Sn});var Sn,qo=cs(()=>{Ds();un();Sn=class{constructor(A){this.plugin=A,this.dataManager=new tt(A.app)}async recoverFromBackup(A){try{let e=await this.plugin.app.vault.adapter.read(A),t=JSON.parse(e);return await this.dataManager.initialize(),t.comments&&await this.recoverHighlights(t.comments),t.fsrs&&await this.recoverFlashcards(t.fsrs),!0}catch(e){return console.error("\u274C \u6570\u636E\u6062\u590D\u5931\u8D25:",e),!1}}async recoverHighlights(A){var e;for(let[t,i]of Object.entries(A)){let o={version:"2.0",lastModified:Date.now(),highlights:{}};for(let[c,h]of Object.entries(i)){let g=h;o.highlights[c]={text:g.text,position:g.position,endPosition:g.position+(g.originalLength||g.text.length),backgroundColor:g.backgroundColor,created:g.createdAt,updated:g.updatedAt,comments:((e=g.comments)==null?void 0:e.map(u=>({id:u.id,text:u.content,created:u.createdAt,updated:u.updatedAt})))||[]}}let l=`.hinote/highlights/${Ne.toSafeFileName(t)}.json`;await this.plugin.app.vault.adapter.write(l,JSON.stringify(o,null,2))}}async recoverFlashcards(A){let e={version:"2.0",lastModified:Date.now(),cards:A.cards||{},globalStats:A.globalStats||{totalCards:0,totalReviews:0,averageRetention:0},groups:A.groups||{},dailyStats:A.dailyStats||{}};await this.plugin.app.vault.adapter.write(".hinote/flashcards/cards.json",JSON.stringify(e,null,2))}async listBackupFiles(){try{return(await this.plugin.app.vault.adapter.list(".hinote/backup")).files.filter(t=>t.endsWith(".json"))}catch(A){return console.error("\u83B7\u53D6\u5907\u4EFD\u6587\u4EF6\u5217\u8868\u5931\u8D25:",A),[]}}async autoRecover(){var A;try{let e=await this.listBackupFiles(),t="",i=0;for(let o of e)try{let l=await this.plugin.app.vault.adapter.read(o),c=JSON.parse(l),h=Object.keys(c.comments||{}).length,g=Object.keys(((A=c.fsrs)==null?void 0:A.cards)||{}).length,u=h+g;u>i&&(i=u,t=o)}catch(l){console.warn(`\u65E0\u6CD5\u8BFB\u53D6\u5907\u4EFD\u6587\u4EF6 ${o}:`,l)}return t&&i>0?await this.recoverFromBackup(t):!1}catch(e){return console.error("\u274C \u81EA\u52A8\u6062\u590D\u5931\u8D25:",e),!1}}async resetMigrationStatus(){try{await this.plugin.app.vault.adapter.remove(".hinote/metadata/migration-status.json")}catch(A){console.warn("\u91CD\u7F6E\u8FC1\u79FB\u72B6\u6001\u5931\u8D25:",A)}}}});var Lu={};vo(Lu,{default:()=>lr});module.exports=au(Lu);var kt=require("obsidian");var X=require("obsidian");var hs=class{constructor(A){this.vault=A}async parseCanvasFile(A){try{let e=await this.vault.read(A),t=JSON.parse(e),i=[];if(t&&t.nodes)for(let o of t.nodes)o.type==="file"&&o.file&&i.push(o.file);return i}catch(e){return console.error("\u89E3\u6790 Canvas \u6587\u4EF6\u5931\u8D25:",e),[]}}};var Ho=require("obsidian");var ge={AGAIN:1,HARD:2,GOOD:3,EASY:4},tn={request_retention:.9,maximum_interval:36500,newCardsPerDay:20,reviewsPerDay:100,w:[.4872,1.4003,3.7145,13.8206,5.1618,1.2298,.8975,.031,1.6474,.1367,1.0461,2.1072,.0793,.3246,1.587,.2272,2.8755]};var So=require("obsidian");var Eo={"Ollama (Local)":"Ollama (local)",Model:"Model",Save:"Save",Cancel:"Cancel",Edit:"Edit",Delete:"Delete","Custom Model":"Custom model","Checking...":"Checking...","Select the AI service provider":"Select the AI service provider.","API Key":"API key","Please enter your API Key.":"Please enter your API key.","API Key is valid!":"API Key is valid!","API Key and model available.":"API Key and model available.","Invalid API Key or server error. Please verify your API Key.":"Invalid API Key or server error. Please verify your API Key.","Select a model or enter a custom one.":"Select a model or enter a custom one.","Provider URL":"Provider URL","Leave it blank, unless you are using a proxy.":"Leave it blank, unless you are using a proxy.","Please enter an API Key first":"Please enter an API Key first.","Custom model unavailable. Please check the model ID and your access permissions.":"Custom model unavailable. Please check the model ID and your access permissions.","OpenAI service":"OpenAI service","No models available. Please check your API Key.":"No models available. Please check your API Key.","Anthropic service":"Anthropic service","Model ID can only contain letters, numbers, underscores, dots and hyphens.":"Model ID can only contain letters, numbers, underscores, dots and hyphens.","Unable to create model selection dropdown menu.":"Unable to create model selection dropdown menu.","Gemini service":"Gemini service","Deepseek service":"Deepseek service","Ollama service":"Ollama service","Ollama server URL (default: http://localhost:11434)":"Ollama server URL (default: http://localhost:11434)",Check:"Check","Server URL":"Server URL","Successfully connected to Ollama service":"Successfully connected to Ollama service.","No models found. Please download models using ollama":"No models found. Please download models using ollama.","Could not connect to Ollama service":"Could not connect to Ollama service","Failed to connect to Ollama service. Please check the server URL.":"Failed to connect to Ollama service. Please check the server URL.","Currently selected model (Test connection to see all available models)":"Currently selected model (Test connection to see all available models)","Select a Ollama model.":"Select a Ollama model.","No models available. Please load an available model first.":"No models available. Please load an available model first.","No models available":"No models available","Prompt settings":"Custom prompt","Add Prompt":"Add prompt","Input Prompt Name":"Input prompt name","Input Prompt Content\nAvailable parameters:\n{{highlight}} - Current highlighted text\n{{comment}} - Existing comment":`Input prompt content
Available parameters:
{{highlight}} - Current highlighted text
{{comment}} - Existing comment`,"Prompt added":"Prompt added","Prompt updated":"Prompt updated","Shift + Enter Wrap, Enter Save":"Shift + Enter Wrap, Enter Save","Tab AI, Shift + Enter Wrap, Enter Save":"Tab AI, Shift + Enter Wrap, Enter Save","Please enter AI instruction":"Please enter AI instruction","AI response generated":"AI response generated","AI generation failed":"AI generation failed","Delete comment":"Delete","Add Comment":"Add comment","Export as Image":"Export as image","Select Prompt":"Select prompt","Please add Prompt in the settings first":"Please add prompt in the settings first","AI comments have been added":"AI comments have been added","AI comments failed:":"AI comments failed:",Chat:"Chat","Failed to process dropped highlight:":"Failed to process dropped highlight:","highlighted notes":" highlighted notes","Input message...":"Input message...","Unable to access the Ollama model, please check the service.":"Unable to access the Ollama model, please check the service.","Unable to get Gemini model list, please check API Key and network connection.":"Unable to get Gemini model list, please check API key and network connection.",Download:"Download","Export successful!":"Export successful!","Export failed, please try again.":"Export failed, please try again.","Loading...":"Loading...","Search...":"Search...","No matching content found.":"No matching content found.","The current document has no highlighted content.":"The current document has no highlighted content.","No corresponding file found.":"No corresponding file found.","Export failed: Failed to load necessary components.":"Export failed: Failed to load necessary components.","All Highlight":"All highlight","Export as notes":"Export as notes","Add File Comment":"Add file comment","File Comment":"File comment","Successfully exported highlights to: ":"Successfully exported highlights to: ","Failed to export highlights: ":"Failed to export highlights: ","Default Template":"Default template","Modern minimalist knowledge card style":"Modern minimalist knowledge card style","Academic Template":"Academic template","Formal style suitable for academic citations":"Formal style suitable for academic citations","Social Template":"Social template","Modern style suitable for social media sharing":"Modern style suitable for social media sharing","Open AI chat window":"Open AI chat window","Open HiNote window":"Open HiNote window",General:"Highlight","Export Path":"Export path","Set the path for exported highlight notes. Leave empty to use vault root. The path should be relative to your vault root.":"Set the path for exported highlight notes. Leave empty to use vault root. The path should be relative to your vault root.",Exclusions:"Exclusions","Comma separated list of paths, tags, note titles or file extensions that will be excluded from highlighting. e.g. folder1, folder1/folder2, [[note1]], [[note2]], *.excalidraw.md":"Comma separated list of paths, tags, note titles or file extensions that will be excluded from highlighting. e.g. folder1, folder1/folder2, [[note1]], [[note2]], *.excalidraw.md","Custom text extraction":"Custom text extraction","Use Custom Pattern":"Use custom pattern","Enable to use a custom regular expression for extracting text.":"Enable to use a custom regular expression for extracting text.","Custom Pattern":"Custom pattern","Enter a custom regular expression for extracting text. Use capture groups () to specify the text to extract. The first non-empty capture group will be used as the extracted text.":"Enter a custom regular expression for extracting text. Use capture groups () to specify the text to extract. The first non-empty capture group will be used as the extracted text.","Default Color":"Default color","Set the default color for decorators when no color is specified. Leave empty to use system default.":"Set the default color for decorators when no color is specified. Leave empty to use system default.","Show Comment Widget":"Show comment widget","Show or hide the comment widget next to highlights. Disabling this can reduce visual clutter while reading.":"Show or hide the comment widget next to highlights. Disabling this can reduce visual clutter while reading.","Export template":"Export template","Clean orphaned data":"Clean orphaned data","Remove highlights and comments that no longer exist in your documents. This is useful if you have deleted highlights but their comments are still stored in the data file.":"Remove highlights and comments that no longer exist in your documents. This is useful if you have deleted highlights but their comments are still stored in the data file.","Flashcard learning":"Flashcard learning","New cards per day":"New cards per day","Maximum number of new cards to learn each day":"Maximum number of new cards to learn each day.","Reviews per day":"Reviews per day","Maximum number of cards to review each day":"Maximum number of cards to review each day.","Target retention":"Target retention","Target memory retention rate (0.8 = 80%)":"Target memory retention rate (0.8 = 80%).","Maximum interval":"Maximum interval","Maximum interval in days between reviews":"Maximum interval in days between reviews.","Reset daily stats":"Reset daily stats","Reset today's learning statistics":"Reset today's learning statistics.",Reset:"Reset","Daily statistics have been reset":"Daily statistics have been reset","No statistics to reset for today":"No statistics to reset for today",Advanced:"Advanced","These settings control the FSRS algorithm parameters. Only change them if you understand the algorithm.":"These settings control the FSRS algorithm parameters. Only change them if you understand the algorithm.","Reset algorithm parameters":"Reset algorithm parameters","Reset the FSRS algorithm parameters to default values":"Reset the FSRS algorithm parameters to default values.","Reset to Default":"Reset to default","FSRS parameters have been reset to default values":"FSRS parameters have been reset to default values.",days:"days","Activate HiCard":"Activate HiCard","Enter your license key to activate HiCard feature.":"Enter your license key to activate HiCard feature.","Get your license key from":"Get your license key from","HiNote official website":"HiNote official website","Enter license key":"Enter license key",Activate:"Activate","Please enter a license key":"Please enter a license key","HiCard activated successfully!":"HiCard activated successfully!","Invalid license key":"Invalid license key","Use global settings":"Use global settings","New cards per day:":"New cards per day:","Reviews per day:":"Reviews per day:","Create Group":"Create group",Create:"Create",Again:"Again",Hard:"Hard",Good:"Good",Easy:"Easy",Card:"Card",of:"of",Settings:"Settings","Are you sure you want to delete this group?":"Are you sure you want to delete this group?",Yes:"Yes",No:"No","You've completed All cards for today!":"You've completed All cards for today!","No cards available.":"No cards available.","Return to First Card":"Return to First Card","Edit Group":"Edit group","Create New Group":"Create new group","Please fill in all fields":"Please fill in all fields","Saving...":"Saving...","Creating...":"Creating...","Group updated successfully":"Group updated successfully","Failed to update group":"Failed to update group","Group created successfully":"Group created successfully","Failed to create or update group":"Failed to create or update group",Retention:"Retention","Limits:":"Limits:","Learning completed!":"Learning completed!","Group deleted":"Group deleted","search-prefix-all":"match all file highlights","search-prefix-hicard":"match flashcards only","search-prefix-comment":"match with comments only","search-prefix-path":"match path of the file","Recover data from backup":"Recover data from backup","Starting data recovery from backup, please check console output":"Starting data recovery from backup, please check console output","Data recovery successful! Please reload the plugin to see the effects":"Data recovery successful! Please reload the plugin to see the effects","Data recovery failed, please check console error messages":"Data recovery failed, please check console error messages","Open (DoubleClick)":"Open (double-click)"};var Qo={"Ollama (Local)":"Ollama (\u672C\u5730)",Model:"\u6A21\u578B",Save:"\u4FDD\u5B58",Cancel:"\u53D6\u6D88",Edit:"\u7F16\u8F91",Delete:"\u5220\u9664","Custom Model":"\u81EA\u5B9A\u4E49\u6A21\u578B","Checking...":"\u68C0\u67E5\u4E2D...","Select the AI service provider":"\u9009\u62E9 AI \u670D\u52A1\u63D0\u4F9B\u5546\u3002","API Key":"API \u5BC6\u94A5","Please enter your API Key.":"\u8BF7\u8F93\u5165\u60A8\u7684 API \u5BC6\u94A5\u3002","API Key is valid!":"API \u5BC6\u94A5\u6709\u6548\uFF01","API Key and model available.":"API \u5BC6\u94A5\u548C\u6A21\u578B\u53EF\u7528\uFF01","Invalid API Key or server error. Please verify your API Key.":"API\u5BC6\u94A5\u65E0\u6548\u6216\u670D\u52A1\u5668\u9519\u8BEF\uFF0C\u8BF7\u68C0\u67E5\u5BC6\u94A5\u3002","Select a model or enter a custom one.":"\u9009\u62E9\u6A21\u578B\u6216\u8F93\u5165\u81EA\u5B9A\u4E49\u6A21\u578B\u3002","Provider URL":"\u670D\u52A1\u5730\u5740","Leave it blank, unless you are using a proxy.":"\u7559\u7A7A\uFF0C\u9664\u975E\u60A8\u4F7F\u7528\u4EE3\u7406\u3002","Please enter an API Key first":"\u8BF7\u5148\u8F93\u5165 API \u5BC6\u94A5\u3002","Custom model unavailable. Please check the model ID and your access permissions.":"\u81EA\u5B9A\u4E49\u6A21\u578B\u4E0D\u53EF\u7528\u3002\u8BF7\u68C0\u67E5\u6A21\u578B ID \u548C\u60A8\u7684\u8BBF\u95EE\u6743\u9650\u3002","OpenAI service":"OpenAI \u670D\u52A1","No models available. Please check your API Key.":"\u6CA1\u6709\u53EF\u7528\u7684\u6A21\u578B\u3002\u8BF7\u68C0\u67E5\u60A8\u7684 API \u5BC6\u94A5\u3002","Anthropic service":"Anthropic \u670D\u52A1","Model ID can only contain letters, numbers, underscores, dots and hyphens.":"\u6A21\u578B ID \u53EA\u80FD\u5305\u542B\u5B57\u6BCD\u3001\u6570\u5B57\u3001\u4E0B\u5212\u7EBF\u3001\u70B9\u548C\u8FDE\u5B57\u7B26","Unable to create model selection dropdown menu.":"\u65E0\u6CD5\u521B\u5EFA\u6A21\u578B\u9009\u62E9\u4E0B\u62C9\u83DC\u5355\u3002","Gemini service":"Gemini \u670D\u52A1","Deepseek service":"Deepseek \u670D\u52A1","Ollama service":"Ollama \u670D\u52A1","Ollama server URL (default: http://localhost:11434)":"Ollama server URL\uFF08\u9ED8\u8BA4\uFF1Ahttp://localhost:11434\uFF09",Check:"\u9A8C\u8BC1","Server URL":"\u670D\u52A1\u5668 URL","Successfully connected to Ollama service":"\u6210\u529F\u8FDE\u63A5\u5230 Ollama \u670D\u52A1","No models found. Please download models using ollama":"\u672A\u627E\u5230\u6A21\u578B\u3002\u8BF7\u4F7F\u7528 ollama \u4E0B\u8F7D\u6A21\u578B","Could not connect to Ollama service":"\u65E0\u6CD5\u8FDE\u63A5\u5230 Ollama \u670D\u52A1","Failed to connect to Ollama service. Please check the server URL.":"\u65E0\u6CD5\u8FDE\u63A5\u5230 Ollama \u670D\u52A1\uFF0C\u8BF7\u68C0\u67E5 server URL\u3002","Currently selected model (Test connection to see all available models)":"\u5F53\u524D\u9009\u62E9\u7684\u6A21\u578B\uFF08\u6D4B\u8BD5\u8FDE\u63A5\u4EE5\u67E5\u770B\u53EF\u7528\u6A21\u578B\uFF09","Select a Ollama model.":"\u9009\u62E9\u4E00\u4E2A Ollama \u6A21\u578B","No models available. Please load an available model first.":"\u65E0\u53EF\u7528\u6A21\u578B\uFF0C\u8BF7\u5148\u52A0\u8F7D\u53EF\u7528\u6A21\u578B\u3002","No models available":"\u65E0\u53EF\u7528\u6A21\u578B","Prompt settings":"\u81EA\u5B9A\u4E49 Prompt","Add Prompt":"\u6DFB\u52A0 Prompt","Input Prompt Name":"\u8F93\u5165 Prompt \u540D\u79F0","Input Prompt Content\nAvailable parameters:\n{{highlight}} - Current highlighted text\n{{comment}} - Existing comment":`\u8F93\u5165 Prompt \u5185\u5BB9
\u53EF\u7528\u53C2\u6570:
{{highlight}} - \u5F53\u524D\u9AD8\u4EAE\u6587\u672C
{{comment}} - \u5DF2\u5B58\u5728\u7684\u6CE8\u91CA`,"Prompt added":"Prompt \u5DF2\u6DFB\u52A0","Prompt updated":"Prompt \u5DF2\u66F4\u65B0","Shift + Enter Wrap, Enter Save":"Shift + Enter \u6362\u884C\uFF0CEnter \u4FDD\u5B58","Tab AI, Shift + Enter Wrap, Enter Save":"Tab AI\uFF0CShift + Enter \u6362\u884C\uFF0CEnter \u4FDD\u5B58","Please enter AI instruction":"\u8BF7\u8F93\u5165AI\u6307\u4EE4","AI response generated":"AI\u54CD\u5E94\u5DF2\u751F\u6210","AI generation failed":"AI\u751F\u6210\u5931\u8D25","Delete comment":"\u5220\u9664\u8BC4\u8BBA","Add Comment":"\u6DFB\u52A0\u8BC4\u8BBA","Export as Image":"\u5BFC\u51FA\u4E3A\u56FE\u7247","Select Prompt":"\u9009\u62E9 Prompt","Please add Prompt in the settings first":"\u8BF7\u5148\u5728\u8BBE\u7F6E\u4E2D\u6DFB\u52A0 Prompt","AI comments added ":"AI \u8BC4\u8BBA\u5DF2\u6DFB\u52A0","AI comments failed:":"AI \u8BC4\u8BBA\u5931\u8D25\uFF1A",Chat:"\u5BF9\u8BDD","Failed to process dropped highlight:":"\u65E0\u6CD5\u5904\u7406\u5220\u9664\u7684\u9AD8\u4EAE\uFF1A","highlighted notes":" \u6761\u9AD8\u4EAE\u7B14\u8BB0","Input message...":"\u8F93\u5165\u6D88\u606F...","Unable to access the Ollama model, please check the service.":"\u65E0\u6CD5\u8BBF\u95EE Ollama \u6A21\u578B\uFF0C\u8BF7\u68C0\u67E5\u670D\u52A1\u662F\u5426\u6B63\u5E38\u8FD0\u884C","Unable to get Gemini model list, please check API Key and network connection.":"\u65E0\u6CD5\u83B7\u53D6 Gemini \u6A21\u578B\u5217\u8868\uFF0C\u8BF7\u68C0\u67E5 API Key \u548C\u7F51\u7EDC\u8FDE\u63A5",Download:"\u4E0B\u8F7D","Export successful!":"\u5BFC\u51FA\u6210\u529F\uFF01","Export failed, please try again.":"\u5BFC\u51FA\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5","Loading...":"\u52A0\u8F7D\u4E2D...","Search...":"\u641C\u7D22\u9AD8\u4EAE\u6216\u8BC4\u8BBA...","No matching content found.":"\u672A\u627E\u5230\u5339\u914D\u7684\u5185\u5BB9\u3002","The current document has no highlighted content.":"\u5F53\u524D\u6587\u6863\u6CA1\u6709\u9AD8\u4EAE\u5185\u5BB9\u3002","No corresponding file found.":"\u672A\u627E\u5230\u76F8\u5E94\u7684\u6587\u4EF6\u3002","Export failed: Failed to load necessary components.":"\u5BFC\u51FA\u5931\u8D25\uFF1A\u52A0\u8F7D\u5FC5\u8981\u7EC4\u4EF6\u5931\u8D25\u3002","All Highlight":"\u5168\u90E8\u9AD8\u4EAE","Export as notes":"\u5BFC\u51FA\u4E3A\u7B14\u8BB0","Add File Comment":"\u6DFB\u52A0\u6587\u4EF6\u8BC4\u8BBA","File Comment":"\u6587\u4EF6\u8BC4\u8BBA","Successfully exported highlights to: ":"\u6210\u529F\u5BFC\u51FA\u9AD8\u4EAE\u5230\uFF1A","Failed to export highlights: ":"\u65E0\u6CD5\u5BFC\u51FA\u9AD8\u4EAE\uFF1A","Default Template":"\u9ED8\u8BA4\u6A21\u677F","Modern minimalist knowledge card style":"\u73B0\u4EE3\u6781\u7B80\u77E5\u8BC6\u5361\u7247\u98CE\u683C","Academic Template":"\u5B66\u672F\u6A21\u677F","Formal style suitable for academic citations":"\u9002\u7528\u4E8E\u5B66\u672F\u5F15\u7528\u7684\u6B63\u5F0F\u98CE\u683C","Social Template":"\u793E\u4EA4\u6A21\u677F","Modern style suitable for social media sharing":"\u9002\u7528\u4E8E\u793E\u4EA4\u5A92\u4F53\u5206\u4EAB\u7684\u73B0\u4EE3\u98CE\u683C","Open AI chat window":"\u6253\u5F00 AI \u5BF9\u8BDD\u7A97\u53E3","Open HiNote window":"\u6253\u5F00 HiNote \u7A97\u53E3","General Settings":"\u901A\u7528\u8BBE\u7F6E","Export Path":"\u5BFC\u51FA\u8DEF\u5F84","Set the path for exported highlight notes. Leave empty to use vault root. The path should be relative to your vault root.":"\u8BBE\u7F6E\u9AD8\u4EAE\u7B14\u8BB0\u7684\u5BFC\u51FA\u8DEF\u5F84\u3002\u7559\u7A7A\u5219\u4F7F\u7528 vault \u6839\u76EE\u5F55\u3002\u8DEF\u5F84\u5E94\u76F8\u5BF9\u4E8E vault \u6839\u76EE\u5F55\u3002",Exclusions:"\u6392\u9664","Comma separated list of paths, tags, note titles or file extensions that will be excluded from highlighting. e.g. folder1, folder1/folder2, [[note1]], [[note2]], *.excalidraw.md":"\u9017\u53F7\u5206\u9694\u7684\u8DEF\u5F84\uFF0C\u6807\u7B7E\uFF0C\u7B14\u8BB0\u6807\u9898\u6216\u6587\u4EF6\u6269\u5C55\u540D\uFF0C\u5C06\u4ECE\u9AD8\u4EAE\u4E2D\u6392\u9664\u3002\u4F8B\u5982\uFF1Afolder1, folder1/folder2, [[note1]], [[note2]], *.excalidraw.md","Custom text extraction":"\u81EA\u5B9A\u4E49\u6587\u672C\u63D0\u53D6","Use Custom Pattern":"\u4F7F\u7528\u81EA\u5B9A\u4E49\u6A21\u5F0F","Enable to use a custom regular expression for extracting text.":"\u542F\u7528\u81EA\u5B9A\u4E49\u6B63\u5219\u8868\u8FBE\u5F0F\u4EE5\u63D0\u53D6\u6587\u672C\u3002","Custom Pattern":"\u81EA\u5B9A\u4E49\u6A21\u5F0F","Enter a custom regular expression for extracting text. Use capture groups () to specify the text to extract. The first non-empty capture group will be used as the extracted text.":"\u8F93\u5165\u81EA\u5B9A\u4E49\u6B63\u5219\u8868\u8FBE\u5F0F\u4EE5\u63D0\u53D6\u6587\u672C\u3002\u4F7F\u7528\u6355\u83B7\u7EC4 () \u6307\u5B9A\u8981\u63D0\u53D6\u7684\u6587\u672C\u3002\u7B2C\u4E00\u4E2A\u975E\u7A7A\u6355\u83B7\u7EC4\u5C06\u7528\u4F5C\u63D0\u53D6\u7684\u6587\u672C\u3002","Default Color":"\u9ED8\u8BA4\u989C\u8272","Set the default color for decorators when no color is specified. Leave empty to use system default.":"\u8BBE\u7F6E\u5F53\u672A\u6307\u5B9A\u989C\u8272\u65F6\u7684\u88C5\u9970\u5668\u7684\u9ED8\u8BA4\u989C\u8272\u3002\u7559\u7A7A\u4EE5\u4F7F\u7528\u7CFB\u7EDF\u9ED8\u8BA4\u989C\u8272\u3002","Show Comment Widget":"\u663E\u793A\u8BC4\u8BBA\u5C0F\u7EC4\u4EF6","Show or hide the comment widget next to highlights. Disabling this can reduce visual clutter while reading.":"\u663E\u793A\u6216\u9690\u85CF\u9AD8\u4EAE\u65C1\u8FB9\u7684\u8BC4\u8BBA\u5C0F\u7EC4\u4EF6\u3002\u7981\u7528\u6B64\u9009\u9879\u53EF\u4EE5\u51CF\u5C11\u9605\u8BFB\u65F6\u7684\u89C6\u89C9\u5E72\u6270\u3002","Export template":"\u5BFC\u51FA\u6A21\u677F","Clean orphaned data":"\u6E05\u7406\u5B64\u7ACB\u6570\u636E","Remove highlights and comments that no longer exist in your documents. This is useful if you have deleted highlights but their comments are still stored in the data file.":"\u5220\u9664\u4E0D\u518D\u5B58\u5728\u4E8E\u60A8\u7684\u6587\u6863\u4E2D\u7684\u9AD8\u4EAE\u548C\u6CE8\u91CA\u3002\u8FD9\u5728\u60A8\u5220\u9664\u9AD8\u4EAE\u4F46\u6CE8\u91CA\u4ECD\u7136\u5B58\u50A8\u5728\u6570\u636E\u6587\u4EF6\u4E2D\u65F6\u5F88\u6709\u7528\u3002","Flashcard learning":"\u95EA\u5361\u5B66\u4E60\u8BBE\u7F6E","New cards per day":"\u6BCF\u65E5\u65B0\u5361\u7247\u6570\u91CF","Maximum number of new cards to learn each day":"\u6BCF\u5929\u5B66\u4E60\u7684\u65B0\u5361\u7247\u6700\u5927\u6570\u91CF","Reviews per day":"\u6BCF\u65E5\u590D\u4E60\u6570\u91CF","Maximum number of cards to review each day":"\u6BCF\u5929\u590D\u4E60\u7684\u5361\u7247\u6700\u5927\u6570\u91CF","Target retention":"\u76EE\u6807\u8BB0\u5FC6\u4FDD\u6301\u7387","Target memory retention rate (0.8 = 80%)":"\u76EE\u6807\u8BB0\u5FC6\u4FDD\u6301\u7387\uFF080.8 = 80%\uFF09","Maximum interval":"\u6700\u5927\u95F4\u9694","Maximum interval in days between reviews":"\u590D\u4E60\u4E4B\u95F4\u7684\u6700\u5927\u95F4\u9694\u5929\u6570","Reset daily stats":"\u91CD\u7F6E\u4ECA\u65E5\u7EDF\u8BA1","Reset today's learning statistics":"\u91CD\u7F6E\u4ECA\u5929\u7684\u5B66\u4E60\u7EDF\u8BA1\u6570\u636E",Reset:"\u91CD\u7F6E","Daily statistics have been reset":"\u4ECA\u65E5\u7EDF\u8BA1\u5DF2\u91CD\u7F6E","No statistics to reset for today":"\u4ECA\u5929\u6CA1\u6709\u53EF\u91CD\u7F6E\u7684\u7EDF\u8BA1\u6570\u636E",Advanced:"\u9AD8\u7EA7\u8BBE\u7F6E","These settings control the FSRS algorithm parameters. Only change them if you understand the algorithm.":"\u8FD9\u4E9B\u8BBE\u7F6E\u63A7\u5236FSRS\u7B97\u6CD5\u53C2\u6570\u3002\u4EC5\u5728\u7406\u89E3\u7B97\u6CD5\u7684\u60C5\u51B5\u4E0B\u66F4\u6539\u5B83\u4EEC\u3002","Reset algorithm parameters":"\u91CD\u7F6E\u7B97\u6CD5\u53C2\u6570","Reset the FSRS algorithm parameters to default values":"\u5C06FSRS\u7B97\u6CD5\u53C2\u6570\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u503C","Reset to default":"\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u503C","FSRS parameters have been reset to default values":"FSRS\u53C2\u6570\u5DF2\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u503C",days:"\u5929","FSRS weight parameter. The default value is obtained from a smaller sample; if adjustment is needed, please use the FSRS optimizer for calculation.":"\u7B97\u6CD5\u6743\u91CD\u53C2\u6570\u3002\u9ED8\u8BA4\u503C\u4E3A\u8F83\u5C0F\u6837\u672C\u83B7\u5F97\uFF0C\u5982\u679C\u9700\u8981\u8C03\u6574\u8BF7\u4F7F\u7528 FSRS \u4F18\u5316\u5668\u8BA1\u7B97","FSRS parameters":"FSRS \u53C2\u6570","Edit the 17 FSRS algorithm weights. Format: JSON array of numbers.":"\u7F16\u8F91 17 \u4E2A FSRS \u7B97\u6CD5\u6743\u91CD\u3002\u683C\u5F0F\uFF1A\u6570\u5B57\u6570\u7EC4\u7684 JSON \u683C\u5F0F\u3002","FSRS parameters updated successfully":"FSRS \u53C2\u6570\u66F4\u65B0\u6210\u529F","Activate HiCard":"\u6FC0\u6D3B HiCard","Enter your license key to activate HiCard feature.":"\u8F93\u5165\u60A8\u7684\u8BB8\u53EF\u8BC1\u5BC6\u94A5\u4EE5\u6FC0\u6D3B HiCard \u529F\u80FD\u3002","Get your license key from":"\u4ECE\u4EE5\u4E0B\u7F51\u7AD9\u83B7\u53D6\u8BB8\u53EF\u8BC1\u5BC6\u94A5\uFF1A","HiNote official website":"HiNote \u5B98\u65B9\u7F51\u7AD9","Enter license key":"\u8F93\u5165\u8BB8\u53EF\u8BC1\u5BC6\u94A5",Activate:"\u6FC0\u6D3B","Please enter a license key":"\u8BF7\u8F93\u5165\u8BB8\u53EF\u8BC1\u5BC6\u94A5","HiCard activated successfully!":"HiCard \u6FC0\u6D3B\u6210\u529F\uFF01","Invalid license key":"\u65E0\u6548\u7684\u8BB8\u53EF\u8BC1\u5BC6\u94A5","Use global settings":"\u4F7F\u7528\u5168\u5C40\u8BBE\u7F6E","New cards per day:":"\u6BCF\u65E5\u65B0\u5361\u6570\u91CF:","Reviews per day:":"\u6BCF\u65E5\u590D\u4E60\u6570\u91CF:","Create group":"\u521B\u5EFA\u5206\u7EC4",Create:"\u521B\u5EFA",Again:"\u91CD\u6765",Hard:"\u56F0\u96BE",Good:"\u826F\u597D",Easy:"\u7B80\u5355",Card:"\u5361\u7247",of:"\u5171",Settings:"\u8BBE\u7F6E","Are you sure you want to delete this group?":"\u786E\u5B9A\u8981\u5220\u9664\u6B64\u5206\u7EC4\u5417\uFF1F",Yes:"\u662F",No:"\u5426","You've completed All cards for today!":"\u60A8\u4ECA\u5929\u5DF2\u5B8C\u6210\u6240\u6709\u5361\u7247\uFF01","No cards available.":"\u6CA1\u6709\u53EF\u7528\u7684\u5361\u7247\u3002","Return to First Card":"\u8FD4\u56DE\u7B2C\u4E00\u5F20\u5361\u7247","Edit Group":"\u7F16\u8F91\u5206\u7EC4","Create New Group":"\u521B\u5EFA\u65B0\u5206\u7EC4","Please fill in all fields":"\u8BF7\u586B\u5199\u6240\u6709\u5B57\u6BB5","Saving...":"\u4FDD\u5B58\u4E2D...","Creating...":"\u521B\u5EFA\u4E2D...","Group updated successfully":"\u5206\u7EC4\u66F4\u65B0\u6210\u529F","Failed to update group":"\u5206\u7EC4\u66F4\u65B0\u5931\u8D25","Group created successfully":"\u5206\u7EC4\u521B\u5EFA\u6210\u529F","Failed to create or update group":"\u521B\u5EFA\u6216\u66F4\u65B0\u5206\u7EC4\u5931\u8D25",Retention:"\u4FDD\u7559\u7387","Limits:":"\u9650\u5236\uFF1A","Learning completed!":"\u5B66\u4E60\u5B8C\u6210\uFF01","Group deleted":"\u5206\u7EC4\u5DF2\u5220\u9664","search-prefix-all":"\u8DE8\u6587\u4EF6\u641C\u7D22\u6240\u6709\u9AD8\u4EAE","search-prefix-hicard":"\u53EA\u641C\u7D22\u95EA\u5361\u9AD8\u4EAE","search-prefix-comment":"\u53EA\u641C\u7D22\u5E26\u6279\u6CE8\u7684\u9AD8\u4EAE","search-prefix-path":"\u6309\u6587\u4EF6\u8DEF\u5F84\u641C\u7D22\u9AD8\u4EAE","Recover data from backup":"\u4ECE\u5907\u4EFD\u6062\u590D\u6570\u636E","Starting data recovery from backup, please check console output":"\u5F00\u59CB\u4ECE\u5907\u4EFD\u6062\u590D\u6570\u636E\uFF0C\u8BF7\u67E5\u770B\u63A7\u5236\u53F0\u8F93\u51FA","Data recovery successful! Please reload the plugin to see the effects":"\u6570\u636E\u6062\u590D\u6210\u529F\uFF01\u8BF7\u91CD\u65B0\u52A0\u8F7D\u63D2\u4EF6\u67E5\u770B\u6548\u679C","Data recovery failed, please check console error messages":"\u6570\u636E\u6062\u590D\u5931\u8D25\uFF0C\u8BF7\u67E5\u770B\u63A7\u5236\u53F0\u9519\u8BEF\u4FE1\u606F","Open (double-click)":"\u53CC\u51FB\u6253\u5F00"};var Uo={en:Eo,zh:Qo};function f(y){let t=(So.moment.locale().startsWith("zh")?Uo.zh:Uo.en)[y];return t||y}var Be=require("obsidian");var ds=class{constructor(A,e){this.containerEl=A,this.fsrsManager=e}render(){this.containerEl.empty(),this.containerEl.addClass("flashcard-stats-panel"),this.renderStatsArea(),this.renderHeatmap()}renderStatsArea(){let A=this.containerEl.createDiv("flashcard-stats-area"),e=this.fsrsManager.getProgress();this.createStatItem(A,e.newCards.toString(),"New","flashcard-stat-new"),this.createStatItem(A,e.learned.toString(),"Learning","flashcard-stat-learning"),this.createStatItem(A,e.due.toString(),"Review","flashcard-stat-due")}createStatItem(A,e,t,i){let o=A.createDiv(`flashcard-stat-item ${i}`),l=o.createDiv("flashcard-stat-value");l.textContent=e;let c=o.createDiv("flashcard-stat-label");c.textContent=t}renderHeatmap(){var A;this.createHeatmap(this.containerEl,((A=this.fsrsManager.storage)==null?void 0:A.dailyStats)||[])}createHeatmap(A,e){let t=A.createDiv("flashcard-heatmap-grid"),i=new Date;new Date(i).setDate(i.getDate()-83);let l=new Map,c=new Date(i);c.setHours(0,0,0,0);let h=c.getTime(),g=`${c.getFullYear()}-${c.getMonth()+1}-${c.getDate()}`,u=!1;[...e].forEach(D=>{let O=new Date(D.date),J=O.getFullYear(),se=O.getMonth()+1,W=O.getDate(),ce=`${J}-${se}-${W}`;ce===g&&(u=!0),l.set(ce,D)}),u||l.set(g,{date:h,newCardsLearned:0,cardsReviewed:0,reviewCount:0,newCount:0,againCount:0,hardCount:0,goodCount:0,easyCount:0});let w=7,F=12;t.style.display="grid",t.style.gridTemplateRows=`repeat(${w}, 1fr)`,t.style.gridTemplateColumns=`repeat(${F}, 1fr)`;let E=i.getDay(),Q=E===0?6:E-1,H=new Date(i);H.setDate(i.getDate()-((E===0?7:E)-1));let x=new Date(H);x.setDate(x.getDate()-11*7);let P=[],M=[];for(let D=0;D<F;D++){let O=new Date(x);O.setDate(O.getDate()+D*7),M.push(O)}for(let D=0;D<F;D++){let O=[];for(let J=0;J<w;J++){let se=new Date(M[D]);se.setDate(se.getDate()+J),O.push(se)}P.push(O)}for(let D=0;D<w;D++)for(let O=0;O<F;O++){let J=P[O][D],se=J.getFullYear(),W=J.getMonth()+1,ce=J.getDate(),we=`${se}-${W}-${ce}`,Ae=l.get(we),z=t.createDiv("flashcard-heatmap-cell"),Le=we===g;if(Ae){let ve=Ae.newCardsLearned*1.5+Ae.cardsReviewed;if(Ae.reviewCount>0){let Ye=(Ae.againCount*1.5+Ae.hardCount*1.2+Ae.goodCount+Ae.easyCount*.8)/Ae.reviewCount;ve=ve*(Ye+.5)}ve=Math.min(ve,20);let $e=Math.ceil(ve/4);z.addClass(`flashcard-heatmap-level-${$e}`);let Ze=`${J.toLocaleDateString()}: Learned ${Ae.newCardsLearned} new cards, reviewed ${Ae.cardsReviewed} cards`;Ae.reviewCount>0&&(Ze+=`
Rating distribution: Again(${Ae.againCount}), Hard(${Ae.hardCount}), Good(${Ae.goodCount}), Easy(${Ae.easyCount})`),z.setAttribute("title",Ze)}else Le||J>i,z.addClass("flashcard-heatmap-level-0")}}addZoomControl(A,e){}};var gs=class{constructor(A){this.isMobileView=!1;this.isSmallScreen=!1;this.showingSidebar=!0;this.isInFlashcardMode=!1;this.component=A,this.isMobileView=Be.Platform.isMobile,this.isSmallScreen=window.innerWidth<768,this.showingSidebar=this.isMobileView,this.isInFlashcardMode=!0}renderActivation(){var m;let A=this.component.getContainer();A.empty(),A.addClass("flashcard-mode");let e=A.createEl("div",{cls:"flashcard-activation-container"}),t=e.createEl("div",{cls:"flashcard-activation-header",text:f("Activate HiCard")}),i=e.createEl("div",{cls:"flashcard-activation-description"});i.createEl("span",{text:f("Enter your license key to activate HiCard feature.")+" "}),i.createEl("br"),i.createEl("span",{text:f("Get your license key from")+" "});let l=(((m=window.moment)==null?void 0:m.locale())||"en").startsWith("zh")?"https://www.hinote.vip/index.html":"https://www.hinote.vip/en.html",c=i.createEl("a",{text:f("HiNote official website"),cls:"external-link",href:l});c.setAttr("target","_blank"),c.setAttr("rel","noopener noreferrer");let h=e.createEl("div",{cls:"flashcard-activation-input-container"}),g=h.createEl("input",{cls:"flashcard-activation-input",type:"text",placeholder:f("Enter license key")});h.createEl("button",{cls:"flashcard-activation-button",text:f("Activate")}).addEventListener("click",async()=>{let w=g.value.trim();if(!w){new Be.Notice(f("Please enter a license key"));return}await this.component.getLicenseManager().activateLicense(w)?(new Be.Notice(f("HiCard activated successfully!")),this.render()):new Be.Notice(f("Invalid license key"))})}toggleSidebar(){this.showingSidebar=!this.showingSidebar,this.render()}isShowingSidebar(){return this.showingSidebar}showSidebar(){this.showingSidebar=!0;let A=this.component.getContainer();this.isMobileView&&this.isSmallScreen&&(A.addClass("show-sidebar"),A.removeClass("show-content")),this.render()}goBack(){this.isMobileView&&this.isSmallScreen&&(this.showingSidebar?this.component&&this.component.commentView&&(this.component.commentView.isFlashcardMode=!1,this.component.commentView.isShowingFileList=!0,this.component.commentView.updateViewLayout()):(this.showingSidebar=!0,this.render()))}render(){let A=this.component.getContainer();if(A.empty(),A.addClass("flashcard-mode"),this.isMobileView&&(A.addClass("is-mobile"),this.isSmallScreen&&A.addClass("is-small-screen"),this.showingSidebar?A.addClass("show-sidebar"):A.addClass("show-content")),!this.isMobileView||this.isMobileView&&!this.showingSidebar){let M=A.createEl("div",{cls:"flashcard-progress-container"});this.component.setProgressContainer(M),this.component.updateProgress()}let e=A.createEl("div",{cls:"flashcard-main-container"}),t=e.createEl("div",{cls:"flashcard-sidebar"}),i=t.createEl("div",{cls:"flashcard-stats-container"});new ds(i,this.component.getFsrsManager()).render();let l=t.createEl("div",{cls:"flashcard-groups"}),h=l.createEl("div",{cls:"flashcard-groups-header"}).createEl("div",{cls:"flashcard-add-group",attr:{"aria-label":f("Add Group")}});(0,Be.setIcon)(h,"plus"),h.addEventListener("click",()=>this.component.getGroupManager().showCreateGroupModal());let g=l.createEl("div",{cls:"flashcard-group-list"});(this.component.getFsrsManager().getCardGroups()||[]).forEach(M=>{let D=g.createEl("div",{cls:`flashcard-group-item ${M.name===this.component.getCurrentGroupName()?"active":""}`}),O=D.createEl("div",{cls:"flashcard-group-item-header"}),J=O.createEl("div",{cls:"flashcard-group-title"}),se=J.createEl("span",{cls:"flashcard-group-icon"});(0,Be.setIcon)(se,M.filter.startsWith("#")?"hash":"gallery-horizontal-end"),J.createEl("span",{cls:"flashcard-group-name",text:M.name});let W=O.createEl("div",{cls:"flashcard-group-actions"}),ce=W.createEl("div",{cls:"flashcard-group-action",attr:{"aria-label":f("Edit Group")}});(0,Be.setIcon)(ce,"edit"),ce.addEventListener("click",z=>{z.stopPropagation(),this.component.getGroupManager().showEditGroupModal(M)});let we=W.createEl("div",{cls:"flashcard-group-action",attr:{"aria-label":f("Delete Group")}});(0,Be.setIcon)(we,"trash"),we.addEventListener("click",async z=>{if(z.stopPropagation(),confirm(f('Are you sure you want to delete group "')+M.name+f('"?')))try{if(await this.component.getFsrsManager().deleteCardGroup(M.id)){if(this.component.getCurrentGroupName()===M.name){let ve=this.component.getFsrsManager().getCardGroups()||[];ve.length>0?this.component.setCurrentGroupName(ve[0].name):this.component.setCurrentGroupName("")}new Be.Notice(f("Group deleted")),this.render()}else new Be.Notice(f("Delete group failed"))}catch(Le){console.error("Delete group failed:",Le),new Be.Notice(f("Delete group failed"))}});let Ae=this.component.getFsrsManager().getGroupProgress(M.id);if(Ae){let z=D.createEl("div",{cls:"flashcard-group-stats"}),Le=z.createEl("div",{cls:"flashcard-group-stat",attr:{"data-tooltip":f("Due Today")}}),ve=Le.createEl("span",{cls:"flashcard-stat-icon"});(0,Be.setIcon)(ve,"calendar-clock"),Le.createEl("span",{text:Ae.due.toString()});let $e=z.createEl("div",{cls:"flashcard-group-stat",attr:{"data-tooltip":f("New Cards")}}),Ze=$e.createEl("span",{cls:"flashcard-stat-icon"});(0,Be.setIcon)(Ze,"sparkle"),$e.createEl("span",{text:Ae.newCards.toString()});let Ye=z.createEl("div",{cls:"flashcard-group-stat",attr:{"data-tooltip":f("Learned")}}),HA=Ye.createEl("span",{cls:"flashcard-stat-icon"});(0,Be.setIcon)(HA,"check-small"),Ye.createEl("span",{text:Ae.learned.toString()})}D.addEventListener("click",()=>{this.component.setGroupCompletionMessage(this.component.getCurrentGroupName(),this.component.getCompletionMessage());let z={currentIndex:this.component.getCurrentIndex(),isFlipped:this.component.isCardFlipped()};this.component.setCurrentGroupName(M.name),A.querySelectorAll(".flashcard-group-item").forEach($e=>$e.classList.remove("active")),D.classList.add("active"),this.component.setCompletionMessage(this.component.getGroupCompletionMessage(M.name)||null),this.component.refreshCardList();let ve=this.component.getGroupProgress(M.name);ve&&!this.component.getCompletionMessage()?(this.component.setCurrentIndex(ve.currentIndex),this.component.setCardFlipped(ve.isFlipped)):(this.component.setCurrentIndex(0),this.component.setCardFlipped(!1)),this.isMobileView&&(this.showingSidebar=!1),this.component.saveState(),this.render()})});let w=e.createEl("div",{cls:"flashcard-content-area"}).createEl("div",{cls:"flashcard-container"}),F=this.component.getCards(),E=this.component.getCurrentIndex(),Q=F.length>0&&E<F.length?F[E]:null,H=this.component.getCurrentGroupName(),x=this.component.getGroupCompletionMessage(H),P=this.component.getFsrsManager().getCardGroups().length>0;if(!P||F.length===0){let M=this.component.getFsrsManager().getCardGroups().find(O=>O.name===H),D=M&&M.cardIds.length===0;if(P)if(D){let O=w.createEl("div",{cls:"flashcard-completion-message flashcard-empty-group"}),J=O.createEl("div",{cls:"completion-icon"});(0,Be.setIcon)(J,"circle-slash-2"),O.createEl("h3",{text:f("No Cards in This Group")}),O.createEl("p",{text:f("This group doesn't contain any flashcards yet. Add some flashcards to this group to start learning.")})}else{let O=w.createEl("div",{cls:"flashcard-completion-message"}),J=O.createEl("div",{cls:"completion-icon"});(0,Be.setIcon)(J,"check-circle"),O.createEl("h3",{text:f("Learning Completed!")});let se=x;se||(M?se=f("Group completed: ")+M.name+f(". All cards have been reviewed."):se=f("All flashcards completed for today!"),this.component.setGroupCompletionMessage(H,se)),O.createEl("p",{text:se})}else{let O=w.createEl("div",{cls:"flashcard-completion-message flashcard-no-group"}),J=O.createEl("div",{cls:"completion-icon"});(0,Be.setIcon)(J,"folder-plus"),O.createEl("h3",{text:f("No Flashcard Groups")}),O.createEl("p",{text:f("You haven't created any flashcard groups yet. Create a group to get started with your flashcards.")}),O.createEl("button",{cls:"mod-cta",text:f("Create Flashcard Group")}).addEventListener("click",()=>{this.component&&this.component.groupManager?this.component.groupManager.showCreateGroupModal():console.error("Group manager is not available")})}return}if(Q){let M=["flashcard"];this.component.isCardFlipped()&&M.push("is-flipped");let D=w.createEl("div",{cls:M.join(" ")}),se=this.component.getFsrsManager().getCardGroups().filter(be=>this.component.getFsrsManager().getCardsInGroup(be).some(fe=>fe.id===(Q==null?void 0:Q.id))).some(be=>be.isReversed),W=se?Q.answer:Q.text,ce=se?Q.text:Q.answer,Ae=D.createEl("div",{cls:"flashcard-side flashcard-front"}).createEl("div",{cls:"flashcard-content markdown-rendered"});this.renderMarkdownContent(Ae,W,Q.filePath);let Le=D.createEl("div",{cls:"flashcard-side flashcard-back"}).createEl("div",{cls:"flashcard-content markdown-rendered"});this.renderMarkdownContent(Le,ce,Q.filePath),D.addEventListener("click",()=>this.component.flipCard());let ve=w.createEl("div",{cls:"flashcard-rating"}),$e=Q?this.component.getFsrsManager().getCardPredictions(Q.id):null;this.component.getRatingButtons().forEach(be=>{let aA=ve.createEl("button",{cls:"flashcard-rating-button",attr:{"data-rating":be.ratingText,title:`${be.label} (${be.key})`}});if(aA.createSpan({text:be.label}),$e&&$e[be.rating]){let fe=new Date($e[be.rating].nextReview),Pe=new Date,Te=fe.getTime()-Pe.getTime(),je=aA.createSpan({cls:"prediction-info"}),ye="";if(Te<60*60*1e3)ye=`${Math.max(1,Math.round(Te/6e4))}m`;else if(Te<24*60*60*1e3)ye=`${Math.round(Te/36e5)}h`;else{let Ke=Math.round(Te/864e5);Ke<1?ye=`${Math.round(Ke*24)}h`:Ke<30?ye=`${Math.round(Ke)}d`:Ke<365?ye=`${Math.round(Ke/30)}mo`:ye=`${Math.round(Ke/365)}y`}je.createSpan({text:ye,cls:"days"})}else{let fe=0,Pe=(Q==null?void 0:Q.reviews)===0,Te=(Q==null?void 0:Q.lapses)>0;switch(be.rating){case ge.AGAIN:fe=Pe?.25:Te?.5:1;break;case ge.HARD:fe=Pe?24:Te?36:48;break;case ge.GOOD:fe=Pe?24*3:Te?24*5:24*7;break;case ge.EASY:fe=Pe?24*5:Te?24*9:24*14;break}let je=fe/24,ye="";fe<1?ye=`${Math.round(fe*60)}m`:fe<24?ye=`${Math.round(fe)}h`:je<1?ye=`${Math.round(je*24)}h`:je<30?ye=`${Math.round(je)}d`:je<365?ye=`${Math.round(je/30)}mo`:ye=`${Math.round(je/365)}y`,aA.createSpan({text:ye,cls:"days"})}aA.addEventListener("click",fe=>{fe.stopPropagation(),this.component.rateCard(be.rating)})}),this.component.isCardFlipped()&&D.classList.add("is-flipped");let Ze=this.component.getCurrentGroupId(),Ye=F.length,HA=this.component.getFsrsManager(),He=(Ze?HA.getCardsForStudy(Ze):[]).length,kA=Math.max(He,Ye),RA=kA-Ye+1;if(w.createEl("div",{cls:"flashcard-counter",text:`${RA}/${kA}`}),Q.filePath){let aA=w.createEl("div",{cls:"flashcard-source"}).createEl("span",{text:Q.filePath.split("/").pop()||""});this.component.getUtils().addPagePreview(aA,Q.filePath),aA.addEventListener("click",fe=>{fe.stopPropagation();let Pe=this.component.getApp().vault.getAbstractFileByPath(Q.filePath);Pe&&Pe instanceof Be.TFile&&this.component.getApp().workspace.getLeaf().openFile(Pe)})}}else w.createEl("div",{cls:"flashcard-empty-state",text:f("No cards available")})}async renderMarkdownContent(A,e,t){for(;A.firstChild;)A.removeChild(A.firstChild);if(!e){console.warn("renderMarkdownContent: content is empty or undefined"),A.textContent="Add answer";return}let i=A.closest(".flashcard-front")!==null,o=e;i?o=e.replace(/\{\{([^{}]+)\}\}/g,(l,c)=>{let g=c.split("").reduce((m,w)=>{let F=/[\u4e00-\u9fa5]/.test(w);return m+(F?3:1)},0);return c.length>5&&(g=Math.floor(g*1.2)),"_".repeat(Math.max(8,g))}):o=e.replace(/\{\{([^{}]+)\}\}/g,"$1");try{await Be.MarkdownRenderer.render(this.component.getApp(),o,A,t||"",new Be.Component),A.querySelectorAll("ul, ol").forEach(c=>{c.addClass("flashcard-markdown-list")}),i&&A.querySelectorAll("p").forEach(h=>{h.textContent&&h.textContent.includes("______")&&h.addClass("flashcard-cloze")})}catch(l){console.error("Error rendering markdown in flashcard:",l),A.textContent=o}}};var us=class{constructor(A){this.component=A}flipCard(){let A=!this.component.isCardFlipped();this.component.setCardFlipped(A);let e=document.querySelector(".flashcard");e&&(A?e.classList.add("is-flipped"):e.classList.remove("is-flipped")),this.component.saveState()}nextCard(){let A=this.component.getCards();if(A.length===0)return;let e=this.component.getCurrentIndex()+1;e>=A.length&&(e=0),this.component.setCurrentIndex(e),this.component.setCardFlipped(!1),this.component.saveState(),this.component.getRenderer().render()}rateCard(A){let e=this.component.getCards(),t=this.component.getCurrentIndex();if(e.length===0||t>=e.length)return;let i=e[t];if(i){if(this.component.getFsrsManager().trackStudyProgress(i.id,A),e.splice(t,1),e.length===0){let o=this.component.getCurrentGroupName(),l=f("No cards due for review");if(o){let c=this.component.getFsrsManager().getCardGroups().find(h=>h.name===o);c&&(l=f("Group completed: ")+c.name+f(". Add more cards in Settings, but remember: more cards = more reviews."))}else l=f("All flashcards completed for today!");this.component.setGroupCompletionMessage(o,l),this.component.updateProgress(),this.component.getRenderer().render();return}t>=e.length&&this.component.setCurrentIndex(0),this.component.setCardFlipped(!1),this.component.saveState(),this.component.updateProgress(),this.component.getRenderer().render()}}refreshCardList(){let A=this.component.getCurrentGroupName(),e=this.component.getFsrsManager(),t=this.component.getCards(),i=this.component.getCurrentGroupName();if(t.length>0&&i&&i!==A){let w=this.component.getCards(),F=this.component.getCurrentIndex(),E=w.length>0&&F<w.length?w[F].id:void 0,Q={currentIndex:F,isFlipped:this.component.isCardFlipped(),currentCardId:E},H=e.getUIState();H.groupProgress||(H.groupProgress={}),H.groupProgress[i]=Q,e.updateUIState(H)}let o=e.getCardGroups().find(w=>w.name===A);if(!o){console.error(`\u672A\u627E\u5230\u540D\u79F0\u4E3A ${A} \u7684\u5206\u7EC4`);return}let l=e.getCardsByGroupId(o.id),c=e.fsrsService,h=l.filter(w=>!!(w.reviews===0&&w.lastReview===0||c.isDue(w)));if(h.length===0){let w=f("No cards due for review");A?w=f("Group completed: ")+o.name+f(". Add more cards in Settings, but remember: more cards = more reviews."):w=f("All flashcards completed for today!"),this.component.setGroupCompletionMessage(A,w),this.component.setCards([]),this.component.updateProgress();let F=e.getUIState();F.groupProgress||(F.groupProgress={}),F.groupProgress[A]={currentIndex:0,isFlipped:!1,currentCardId:null,completionMessage:w},e.updateUIState(F),this.component.getRenderer().render(),this.component.saveState();return}let g=h,u=this.component.getGroupProgress(A),m=e.getUIState();if(m.groupProgress||(m.groupProgress={}),m.groupProgress[A]?m.groupProgress[A].completionMessage=void 0:m.groupProgress[A]={currentIndex:0,isFlipped:!1,currentCardId:void 0,completionMessage:void 0},e.updateUIState(m),this.component.setCards(g),g.length>0)if(u){let w=0;if(u.currentCardId){let F=g.findIndex(E=>E.id===u.currentCardId);F!==-1?w=F:w=Math.min(u.currentIndex,g.length-1)}else w=Math.min(u.currentIndex,g.length-1);this.component.setCurrentIndex(w),this.component.setCardFlipped(u.isFlipped)}else this.component.setCurrentIndex(0),this.component.setCardFlipped(!1);else{let w=f("No cards due for review");if(A){let F=e.getCardGroups().find(E=>E.name===A);F&&(w=f("Group completed: ")+F.name+f(". Add more cards in Settings, but remember: more cards = more reviews."))}else w=f("All flashcards completed for today!");this.component.setGroupCompletionMessage(A,w)}this.component.saveState()}};var oi=require("obsidian");var ps=class{constructor(A){this.component=A}showCreateGroupModal(){this.showEditGroupModal()}showEditGroupModal(A){var ye,Ke,Rt;let{app:e}=this.component.getApp(),t=document.createElement("div");t.className="flashcard-modal-overlay",document.body.appendChild(t);let i=document.createElement("div");i.className="flashcard-modal-container",t.appendChild(i);let o=document.createElement("div");o.className="flashcard-modal-content",i.appendChild(o);let l=document.createElement("div");l.className="flashcard-modal-header",o.appendChild(l);let c=document.createElement("h3");c.textContent=A?f("Edit group"):f("Create group"),l.appendChild(c);let h=document.createElement("div");h.className="flashcard-group-form",o.appendChild(h);let g=A?A.name:"",u=document.createElement("input");u.type="text",u.className="flashcard-modal-input",u.placeholder=f("Enter name"),u.value=g,h.appendChild(u),u.addEventListener("input",Fe=>{g=Fe.target.value});let m=A?A.filter:"",w=document.createElement("textarea");w.className="flashcard-modal-input",w.placeholder=f(`Support format: 
Folder: folder1, folder1/folder2
Note: [[note1]], [[note2]]`),w.value=m,h.appendChild(w),w.addEventListener("input",Fe=>{m=Fe.target.value});let F=A&&A.isReversed||!1,E=document.createElement("div");E.className="flashcard-modal-option",h.appendChild(E);let Q=document.createElement("input");Q.type="checkbox",Q.className="flashcard-modal-checkbox",Q.checked=F,E.appendChild(Q);let H=document.createElement("label");H.textContent=f("Reverse cards (use comments as questions)"),H.className="flashcard-modal-label",E.appendChild(H),Q.addEventListener("change",Fe=>{F=Fe.target.checked});let x=document.createElement("div");x.className="flashcard-modal-settings",h.appendChild(x);let P=document.createElement("div");P.className="flashcard-modal-settings-header",x.appendChild(P);let M=document.createElement("h4");M.textContent=f("Learning settings"),M.className="settings-title",P.appendChild(M);let D=A?((ye=A.settings)==null?void 0:ye.useGlobalSettings)!==!1:!0,O=document.createElement("div");O.className="flashcard-modal-option use-global-option",P.appendChild(O);let J=document.createElement("input");J.type="checkbox",J.className="flashcard-modal-checkbox",J.id="use-global-settings",J.checked=D,O.appendChild(J);let se=document.createElement("label");se.textContent=f("Use global settings"),se.className="flashcard-modal-label",se.htmlFor="use-global-settings",O.appendChild(se),J.addEventListener("change",Fe=>{D=Fe.target.checked,aA()});let W=A&&((Ke=A.settings)==null?void 0:Ke.newCardsPerDay)||20,ce=document.createElement("div");ce.className="flashcard-modal-option slider-option",x.appendChild(ce);let we=document.createElement("label");we.textContent=f("New cards per day: "),we.className="flashcard-modal-label",ce.appendChild(we);let Ae=document.createElement("div");Ae.className="slider-with-value",ce.appendChild(Ae);let z=document.createElement("input");z.className="flashcard-modal-slider",z.type="range",z.min="5",z.max="100",z.step="5",z.value=String(W);let Le=parseInt(z.value);Le<5?z.value="5":Le%5!==0&&(z.value=(Math.round(Le/5)*5).toString()),Ae.appendChild(z);let ve=document.createElement("span");ve.className="slider-value",ve.textContent=z.value,Ae.appendChild(ve),z.addEventListener("input",()=>{W=parseInt(z.value),ve.textContent=z.value});let $e={setDisabled:Fe=>{z.disabled=Fe,ce.classList.toggle("disabled",Fe)}},Ze=A&&((Rt=A.settings)==null?void 0:Rt.reviewsPerDay)||100,Ye=document.createElement("div");Ye.className="flashcard-modal-option slider-option",x.appendChild(Ye);let HA=document.createElement("label");HA.textContent=f("Reviews per day: "),HA.className="flashcard-modal-label",Ye.appendChild(HA);let KA=document.createElement("div");KA.className="slider-with-value",Ye.appendChild(KA);let He=document.createElement("input");He.className="flashcard-modal-slider",He.type="range",He.min="10",He.max="500",He.step="10",He.value=String(Ze);let kA=parseInt(He.value);kA<10?He.value="10":kA%10!==0&&(He.value=(Math.round(kA/10)*10).toString()),KA.appendChild(He);let RA=document.createElement("span");RA.className="slider-value",RA.textContent=He.value,KA.appendChild(RA),He.addEventListener("input",()=>{Ze=parseInt(He.value),RA.textContent=He.value});let be={setDisabled:Fe=>{He.disabled=Fe,Ye.classList.toggle("disabled",Fe)}},aA=()=>{D?($e.setDisabled(!0),be.setDisabled(!0)):($e.setDisabled(!1),be.setDisabled(!1))};aA();let fe=document.createElement("div");fe.className="button-container",o.appendChild(fe);let Pe=document.createElement("button");Pe.className="flashcard-cancel-btn",Pe.textContent=f("Cancel"),fe.appendChild(Pe);let Te=document.createElement("button");Te.className="flashcard-save-group-btn",Te.textContent=A?f("Save"):f("Create"),fe.appendChild(Te),Te.addEventListener("click",async()=>{if(!g){new oi.Notice(f("Group name cannot be empty"));return}let Fe=this.component.getFsrsManager();if(A){let BA=A.name;try{await Fe.updateCardGroup(A.id,{name:g,filter:m,isReversed:F,settings:{useGlobalSettings:D,newCardsPerDay:D?void 0:W,reviewsPerDay:D?void 0:Ze},lastUpdated:Date.now()});let xe=Fe.storage;xe&&xe.uiState&&(xe.uiState.groupCompletionMessages&&xe.uiState.groupCompletionMessages[BA]!==void 0&&(xe.uiState.groupCompletionMessages[g]=xe.uiState.groupCompletionMessages[BA],delete xe.uiState.groupCompletionMessages[BA]),xe.uiState.groupProgress&&xe.uiState.groupProgress[BA]&&(xe.uiState.groupProgress[g]=xe.uiState.groupProgress[BA],delete xe.uiState.groupProgress[BA]),xe.uiState.currentGroupName===BA&&(xe.uiState.currentGroupName=g),await Fe.saveStoragePublic()),this.component.getCurrentGroupName()===BA&&this.component.setCurrentGroupName(g),this.component.refreshCardList(),this.component.getRenderer().render(),new oi.Notice(f("Group update successful"))}catch(xe){console.error("Update group failed:",xe),new oi.Notice(f("Update group failed"))}}else await Fe.createCardGroup({name:g,filter:m,isReversed:F,createdTime:Date.now(),sortOrder:Fe.getCardGroups().length,settings:{useGlobalSettings:D,newCardsPerDay:D?void 0:W,reviewsPerDay:D?void 0:Ze}}),new oi.Notice(f("Group created")),this.component.refreshCardList(),this.component.getRenderer().render();document.body.removeChild(t),A&&this.component.getRenderer().render()});let je=Fe=>{Fe.key==="Escape"&&(document.body.removeChild(t),document.removeEventListener("keydown",je))};document.addEventListener("keydown",je),Pe.addEventListener("click",()=>{document.body.removeChild(t),A&&this.component.getRenderer().render()})}};var Io=require("obsidian"),fs=class{constructor(A){this.component=A}getGroupProgress(){let A=this.component.getCurrentGroupId(),e=[];A?e=this.component.getFsrsManager().getCardsByGroupId(A):e=(()=>{let h=this.component.getFsrsManager(),g=h.getCardGroups(),u=[],m=new Set;return g.forEach(w=>{h.getCardsByGroupId(w.id).forEach(E=>{m.has(E.id)||(m.add(E.id),u.push(E))})}),u})();let i=e.filter(h=>this.component.getFsrsManager().fsrsService.isDue(h)).length,o=e.filter(h=>h.reviews===0).length,l=e.filter(h=>h.reviews>0).length,c=this.calculateRetention(e);return{due:i,newCards:o,learned:l,retention:c}}calculateRetention(A){let e=A.filter(i=>i.reviews>0);return e.length===0?1:e.reduce((i,o)=>i+o.retrievability,0)/e.length}updateProgress(){let A=this.component.getProgressContainer();if(!A)return;A.empty();let e=this.getGroupProgress(),t=A.createEl("div",{cls:"flashcard-progress-text"});t.createSpan({text:this.component.getCurrentGroupName()||f("Groups"),cls:"group-name"}),t.createSpan({text:"|",cls:"separator"}),[{label:f("Due"),value:e.due},{label:f("New"),value:e.newCards},{label:f("Learned"),value:e.learned},{label:f("Retention"),value:`${(e.retention*100).toFixed(1)}%`}].forEach((H,x)=>{x>0&&t.createSpan({text:"|",cls:"separator"});let P=t.createEl("div",{cls:"stat"});if(P.createSpan({text:H.label+": "}),P.createSpan({text:H.value.toString(),cls:"stat-value"}),H.label===f("Retention")){let M=P.createSpan({cls:"help-icon"});(0,Io.setIcon)(M,"help-circle"),M.setAttribute("aria-label",f(`Retention = (Total Reviews - Forget Count) / Total Reviews
This metric reflects your learning effectiveness, higher means better memory retention`))}});let l=A.createEl("div",{cls:"flashcard-progress-bar-container"}).createEl("div",{cls:"flashcard-progress-bar"}),c=e.due+e.newCards,h=this.component.getCards().length,g=c>0?Math.round((c-h)/c*100):100;if(l.style.width=`${g}%`,this.component.getCurrentGroupName()){let H=this.component.getFsrsManager().getCardGroups().find(x=>x.id===this.component.getCurrentGroupName());if(H){let x=A.createEl("div",{cls:"flashcard-group-name-container"});x.createEl("div",{cls:"flashcard-group-name",text:H.name}),H.filter&&x.createEl("div",{cls:"flashcard-group-filter",text:f("Filter")+": "+H.filter})}}let u=A.createEl("div",{cls:"flashcard-index-container"}),m=this.component.getCurrentGroupId(),w=this.component.getCards().length,F=this.component.getFsrsManager(),Q=(m?F.getCardsForStudy(m):[]).length;if(Q>0||w>0){let H=Math.max(Q,w),x=H-w+1;w>0?u.textContent=`${x}/${H}`:u.textContent=`${H}/${H}`}else u.textContent="0/0"}saveState(){let A=this.component.getCurrentGroupName(),e=this.component.getFsrsManager().getUIState();e.currentGroupName=A,e.currentIndex=this.component.getCurrentIndex(),e.isFlipped=this.component.isCardFlipped(),e.completionMessage=this.component.getCompletionMessage(),e.groupProgress||(e.groupProgress={}),e.groupProgress[A]={currentIndex:this.component.getCurrentIndex(),isFlipped:this.component.isCardFlipped()},e.groupCompletionMessages||(e.groupCompletionMessages={}),e.groupCompletionMessages[A]=this.component.getGroupCompletionMessage(A),this.component.getFsrsManager().updateUIState(e)}};var ms=class{constructor(A){this.component=A}addPagePreview(A,e){if(!e)return;let t;A.addEventListener("mouseenter",i=>{t=setTimeout(()=>{let o=i.target;this.component.getApp().workspace.trigger("hover-link",{event:i,source:"hi-note",hoverParent:o,targetEl:o,linktext:e})},300)}),A.addEventListener("mouseleave",()=>{t&&clearTimeout(t)})}};var li=class extends Ho.Component{constructor(e,t){super();this.progressContainer=null;this.currentIndex=0;this.isFlipped=!1;this.cards=[];this.isActive=!1;this.currentCard=null;this.currentGroupName="";this.currentGroupId="";this.completionMessage=null;this.groupProgress={};this.ratingButtons=[{label:f("Again"),rating:ge.AGAIN,key:"1",ratingText:"again"},{label:f("Hard"),rating:ge.HARD,key:"2",ratingText:"hard"},{label:f("Good"),rating:ge.GOOD,key:"3",ratingText:"good"},{label:f("Easy"),rating:ge.EASY,key:"4",ratingText:"easy"}];this.container=e,this.app=t.app,this.fsrsManager=t.fsrsManager,this.renderer=new gs(this),this.operations=new us(this),this.groupManager=new ps(this),this.progressManager=new fs(this),this.utils=new ms(this),this.groupProgress={};let i=this.fsrsManager.getUIState()||{};if(this.currentGroupName=i.currentGroupName||"",this.currentGroupName){let o=this.fsrsManager.getCardGroups().find(l=>l.name===this.currentGroupName);o?this.currentGroupId=o.id:this.currentGroupId=""}else this.currentGroupId="";this.completionMessage=i.completionMessage||null,i.groupProgress&&(this.groupProgress={...i.groupProgress}),this.currentGroupName&&this.groupProgress[this.currentGroupName]?(this.currentIndex=this.groupProgress[this.currentGroupName].currentIndex||0,this.isFlipped=this.groupProgress[this.currentGroupName].isFlipped||!1):(this.currentIndex=0,this.isFlipped=!1),(!i||!i.groupProgress||typeof i.groupProgress!="object")&&(this.groupProgress={}),i&&"groupProgress"in i&&i.groupProgress&&typeof i.groupProgress=="object"?this.groupProgress={...i.groupProgress}:this.groupProgress={}}setLicenseManager(e){this.licenseManager=e}setCards(e){this.cards=e}cleanup(){}async activate(){if(this.isActive=!0,this.licenseManager){let e=await this.licenseManager.isActivated(),t=e?await this.licenseManager.isFeatureEnabled("flashcard"):!1;if(e&&t){this.operations.refreshCardList(),this.renderer.render();return}}this.renderer.renderActivation()}renderActivation(){this.renderer.renderActivation()}deactivate(){this.isActive=!1,this.container.empty(),this.container.removeClass("flashcard-mode")}destroy(){this.container.removeClass("flashcard-mode"),this.container.empty()}getContainer(){return this.container}getApp(){return this.app}getFsrsManager(){return this.fsrsManager}getLicenseManager(){return this.licenseManager}getCards(){return this.cards}getCurrentIndex(){return this.currentIndex}setCurrentIndex(e){this.currentIndex=e}isCardFlipped(){return this.isFlipped}setCardFlipped(e){this.isFlipped=e}getCurrentGroupName(){return this.currentGroupName}setCurrentGroupName(e){if(this.currentGroupName=e,e){let t=this.fsrsManager.getCardGroups().find(i=>i.name===e);t?this.currentGroupId=t.id:this.currentGroupId=""}else this.currentGroupId=""}getCurrentGroupId(){return this.currentGroupId}setCurrentGroupId(e){if(this.currentGroupId=e,e){let t=this.fsrsManager.getCardGroups().find(i=>i.id===e);this.currentGroupName=t?t.name:""}else this.currentGroupName=""}getCompletionMessage(){return this.completionMessage}setCompletionMessage(e){this.completionMessage=e}getGroupCompletionMessage(e){return this.groupProgress[e]&&this.groupProgress[e].completionMessage||null}setGroupCompletionMessage(e,t){if(this.groupProgress[e]||(this.groupProgress[e]={currentIndex:0,isFlipped:!1,completionMessage:null}),this.groupProgress[e].completionMessage=t,this.fsrsManager){let i=this.fsrsManager.getUIState();i.groupProgress||(i.groupProgress={}),i.groupProgress[e]||(i.groupProgress[e]={currentIndex:0,isFlipped:!1,currentCardId:void 0,completionMessage:void 0}),i.groupProgress[e].completionMessage=t,t&&(i.groupProgress[e].isFlipped=!1,i.groupProgress[e].currentCardId=void 0),this.fsrsManager.updateUIState(i)}}getGroupProgress(e){let t=e||this.currentGroupName;return this.groupProgress[t]||null}isComponentActive(){return this.isActive}getProgressContainer(){return this.progressContainer}setProgressContainer(e){this.progressContainer=e}getRatingButtons(){return this.ratingButtons}flipCard(){this.operations.flipCard()}nextCard(){this.operations.nextCard()}rateCard(e){this.operations.rateCard(e)}refreshCardList(){this.operations.refreshCardList()}saveState(){let e=this.getCurrentGroupName(),t=this.fsrsManager.getUIState();if(t.currentGroupName=e,t.completionMessage=this.completionMessage,t.groupProgress||(t.groupProgress={}),e){let i=this.cards.length>0&&this.currentIndex<this.cards.length?this.cards[this.currentIndex].id:void 0,o=this.getGroupCompletionMessage(e);t.groupProgress[e]?(t.groupProgress[e].currentIndex=this.currentIndex,t.groupProgress[e].isFlipped=this.isFlipped,t.groupProgress[e].currentCardId=i,t.groupProgress[e].completionMessage=o):t.groupProgress[e]={currentIndex:this.currentIndex,isFlipped:this.isFlipped,currentCardId:i,completionMessage:o}}this.fsrsManager.updateUIState(t)}updateProgress(){this.progressManager.updateProgress()}getRenderer(){return this.renderer}getOperations(){return this.operations}getGroupManager(){return this.groupManager}getProgressManager(){return this.progressManager}getUtils(){return this.utils}};var ci=require("obsidian");var bo={id:"default",name:f("Default Template"),description:f("Modern minimalist knowledge card style"),render:y=>{var F;let A=document.createElement("div");A.className="highlight-export-card highlight-export-card-modern";let e=document.createElement("div");e.className="highlight-export-quote-section";let t=document.createElement("div");t.className="highlight-export-quote-decoration";let i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("viewBox","0 0 24 24"),i.setAttribute("width","48"),i.setAttribute("height","48"),i.setAttribute("fill","none"),i.setAttribute("stroke","currentColor"),i.setAttribute("stroke-width","1");let o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d","M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z");let l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d","M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z"),i.appendChild(o),i.appendChild(l),t.appendChild(i),e.appendChild(t);let c=document.createElement("div");c.className="highlight-export-quote",c.textContent=y.text,e.appendChild(c),A.appendChild(e);let h=document.createElement("div");h.className="highlight-export-footer";let g=document.createElement("div");g.className="highlight-export-source",g.textContent=y.fileName||((F=y.filePath)==null?void 0:F.split("/").pop())||"Untitled",h.appendChild(g);let u=document.createElement("div");u.className="highlight-export-date";let m=new Date,w={year:"numeric",month:"long",day:"numeric"};return u.textContent=m.toLocaleDateString(void 0,w),h.appendChild(u),A.appendChild(h),A}},ou={id:"academic",name:f("Academic Template"),description:f("Formal style suitable for academic citations"),render:y=>{var l;let A=document.createElement("div");A.className="highlight-export-card highlight-export-card-academic";let e=document.createElement("div");e.className="highlight-export-quote",e.textContent=`"${y.text}"`,A.appendChild(e);let t=document.createElement("div");t.className="highlight-export-footer";let i=document.createElement("div");i.className="highlight-export-source",i.textContent=y.fileName||((l=y.filePath)==null?void 0:l.split("/").pop())||"Untitled",t.appendChild(i);let o=document.createElement("div");return o.className="highlight-export-date",o.textContent=`Retrieved: ${new Date().toLocaleDateString()}`,t.appendChild(o),A.appendChild(t),A}},lu={id:"social",name:f("Social Template"),description:f("Modern style suitable for social media sharing"),render:y=>{var m;let A=document.createElement("div");A.className="highlight-export-card highlight-export-card-social";let e=document.createElement("div");e.className="highlight-export-header";let t=document.createElement("div");t.className="highlight-export-logo";let i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("xmlns","http://www.w3.org/2000/svg"),i.setAttribute("width","24"),i.setAttribute("height","24"),i.setAttribute("viewBox","0 0 100 100"),i.setAttribute("fill","currentColor"),i.setAttribute("stroke","none");let o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d","M50,9.4L14.8,37.1l12.6,38.8l22.6,14.7l22.6-14.7l12.6-38.8L50,9.4z M50,19.5l25.5,20l-9.4,28.9L50,80.6 L33.9,68.4l-9.4-28.9L50,19.5z");let l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d","M50,19.5l-25.5,20l9.4,28.9L50,80.6V19.5z"),l.setAttribute("fill-opacity","0.3"),i.appendChild(o),i.appendChild(l),t.appendChild(i),e.appendChild(t);let c=document.createElement("div");c.className="highlight-export-app-name",c.textContent="HiNote",e.appendChild(c),A.appendChild(e);let h=document.createElement("div");h.className="highlight-export-quote",h.textContent=y.text,A.appendChild(h);let g=document.createElement("div");g.className="highlight-export-footer";let u=document.createElement("div");return u.className="highlight-export-source",u.textContent=y.fileName||((m=y.filePath)==null?void 0:m.split("/").pop())||"Untitled",g.appendChild(u),A.appendChild(g),A}},sn=[bo,ou,lu];function rn(y){return sn.find(A=>A.id===y)||bo}var xo=`
    /* \u5BFC\u51FA\u5361\u7247\u57FA\u7840\u6837\u5F0F */
    .highlight-export-card {
        transition: all 0.3s ease;
        padding: 20px;
        background-color: #ffffff;
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        
        /* \u6DFB\u52A0\u66F4\u4E25\u683C\u7684\u6587\u672C\u63A7\u5236 */
        font-size: 16px;
        line-height: 1.6;
        letter-spacing: normal;
        word-spacing: normal;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    /* \u73B0\u4EE3\u98CE\u683C\u6A21\u677F */
    .highlight-export-card-modern {
        padding: 24px;
        position: relative;
        overflow: hidden;
    }

    .highlight-export-card-modern::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: linear-gradient(to bottom right, #5871ef 0%, #4c63e6 100%);
    }

    .highlight-export-card-modern .highlight-export-quote-decoration {
        position: absolute;
        top: 24px;
        right: 24px;
        opacity: 0.06;
        transform: scale(2);
    }

    .highlight-export-card-modern .highlight-export-quote-section {
        position: relative;
        padding: 24px 0;
        /* \u786E\u4FDD\u5F15\u7528\u90E8\u5206\u7684\u6587\u672C\u6837\u5F0F\u4E00\u81F4\u6027 */
        font-size: inherit;
        line-height: inherit;
        letter-spacing: inherit;
        word-spacing: inherit;
    }

    .highlight-export-card-modern .highlight-export-quote {
        font-size: 1em;
        line-height: 1.7;
        color: #333333;
        font-weight: 400;
        margin: 0;
        position: relative;
        z-index: 1;
        /* \u786E\u4FDD\u5F15\u7528\u6587\u672C\u7684\u6837\u5F0F\u4E00\u81F4\u6027 */
        letter-spacing: normal;
        word-spacing: normal;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
    }

    /* \u786E\u4FDD\u6240\u6709\u6587\u672C\u5143\u7D20\u7EE7\u627F\u57FA\u7840\u6837\u5F0F */
    .highlight-export-card * {
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
    }

    /* \u5BFC\u51FA\u9884\u89C8\u5BB9\u5668 */
    .highlight-export-preview {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        padding: 20px;
    }

    /* \u5BFC\u51FA\u5BB9\u5668 */
    .highlight-export-container {
        padding: 20px;
        margin: 0;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        width: 480px;
    }
`;var Bs=class extends ci.Modal{constructor(e,t,i){super(e);this.selectedTemplateId="default";this.includeComments=!1;this.highlight=t,this.html2canvasInstance=i}async onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("highlight-export-modal");let t=e.createEl("div",{cls:"highlight-export-main-container"}),i=t.createEl("select",{cls:"highlight-template-select"});sn.forEach(l=>{let c=i.createEl("option",{text:l.name,value:l.id});this.selectedTemplateId===l.id&&(c.selected=!0)}),i.addEventListener("change",l=>{let c=l.target;this.selectedTemplateId=c.value,this.updatePreview()}),this.previewContainer=t.createEl("div",{cls:"highlight-export-preview-container"}),this.updatePreview();let o=e.createEl("div",{cls:"highlight-export-modal-buttons"});if(this.highlight.comments&&this.highlight.comments.length>0){let l=o.createEl("div",{cls:"highlight-export-checkbox-container"}),c=l.createEl("input",{attr:{type:"checkbox",id:"include-comments-checkbox"},cls:"highlight-export-checkbox"}),h=l.createEl("label",{text:f("Include Comments"),attr:{for:"include-comments-checkbox"},cls:"highlight-export-checkbox-label"});c.addEventListener("change",g=>{this.includeComments=g.target.checked,this.updatePreview()})}o.createEl("button",{cls:"highlight-btn",text:f("Cancel")}).addEventListener("click",()=>this.close()),o.createEl("button",{cls:"highlight-btn highlight-btn-primary",text:f("Download")}).addEventListener("click",async()=>{try{let l=document.createElement("div");l.className="highlight-export-container";let h=rn(this.selectedTemplateId).render(this.highlight);l.appendChild(h),this.includeComments&&this.highlight.comments&&this.highlight.comments.length>0&&this.addCommentsToContainer(l),document.body.appendChild(l);let u=(await this.html2canvasInstance(l,{backgroundColor:null,scale:window.devicePixelRatio*2,useCORS:!0,allowTaint:!0,logging:!1,imageTimeout:0,removeContainer:!0,onclone:async w=>{let F=w.createElement("style");F.textContent=this.getExportStyles(),w.head.appendChild(F),await new Promise(E=>setTimeout(E,100))}})).toDataURL("image/png",1),m=document.createElement("a");m.download=`highlight-${this.selectedTemplateId}-${Date.now()}.png`,m.href=u,m.click(),this.close(),new ci.Notice(f("Export successful!"))}catch(l){new ci.Notice(f("Export failed, please try again"))}})}updatePreview(){this.previewContainer.empty(),this.previewContainer.className="highlight-export-preview";let t=rn(this.selectedTemplateId).render(this.highlight);this.previewContainer.appendChild(t),this.includeComments&&this.highlight.comments&&this.highlight.comments.length>0&&this.addCommentsToContainer(this.previewContainer)}addCommentsToContainer(e){let t=e.querySelector(".highlight-export-card");if(!t)return;let i=t.querySelector(".highlight-export-footer");if(!i)return;let o=document.createElement("div");o.className="highlight-export-comments-section";let l=document.createElement("div");l.className="highlight-export-comments-list",o.appendChild(l),this.highlight.comments&&this.highlight.comments.forEach(c=>{let h=document.createElement("div");h.className="highlight-export-comment-item";let g=document.createElement("div");if(g.className="highlight-export-comment-content",g.textContent=c.content,h.appendChild(g),c.createdAt){let u=document.createElement("div");u.className="highlight-export-comment-time",u.textContent=new Date(c.createdAt).toLocaleString(),h.appendChild(u)}l.appendChild(h)}),t.insertBefore(o,i)}getExportStyles(){return`
            body {
                margin: 0;
                background: none;
            }
            ${xo}
        `}onClose(){let{contentEl:e}=this;e.empty()}};var di=require("obsidian");var hi=class extends di.Component{constructor(e,t,i,o=window.app){super();this.highlight=t;this.onHighlightClick=i;this.app=o;this.render(e).catch(l=>{console.error("Error rendering highlight content:",l)})}async render(e){this.container=e.createEl("div",{cls:"highlight-content"}),await this.renderText()}async renderText(){this.textContainer=this.container.createEl("div",{cls:"highlight-text-container"});let e=this.textContainer.createEl("div",{cls:"highlight-text-decorator"});this.highlight.backgroundColor&&(e.style.backgroundColor=this.highlight.backgroundColor);let i=this.textContainer.createEl("div",{cls:"highlight-text"}).createEl("div",{cls:`highlight-text-content ${this.highlight.isVirtual?"virtual-highlight":""} markdown-rendered`}),o=(this.highlight.isVirtual?this.highlight.displayText:this.highlight.text)||"";try{await di.MarkdownRenderer.render(this.app,o,i,this.highlight.filePath||"",new di.Component),i.querySelectorAll("ul, ol").forEach(c=>{c.addClass("highlight-markdown-list")}),await this.activateInternalLinks(i,this.highlight.filePath||"")}catch(l){console.error("Error rendering markdown in highlight:",l);let c=o.split(`
`);c.forEach((h,g)=>{let u=i.createEl("p",{text:h,cls:"highlight-text-line"});g<c.length-1&&u.addClass("highlight-text-line-spacing")})}this.highlight.isGlobalSearch?(i.addClass("global-search-highlight"),i.removeAttribute("aria-label"),i.style.cursor="default"):(i.setAttribute("aria-label",f("Jump to highlight")),i.addEventListener("mousedown",async l=>{l.target.closest("a")||(l.preventDefault(),l.stopPropagation(),await this.onHighlightClick(this.highlight))}))}async activateInternalLinks(e,t){e.querySelectorAll("a.internal-link").forEach(l=>{let c=l.getAttribute("data-href")||l.getAttribute("href");c&&(l.addEventListener("click",h=>{h.preventDefault(),h.stopPropagation(),this.app.metadataCache.getFirstLinkpathDest(c,t)&&this.app.workspace.openLinkText(c,t,!1)}),l.addEventListener("mouseenter",h=>{this.app.workspace.trigger("hover-link",{event:h,source:"hi-note",hoverParent:e,targetEl:l,linktext:c,sourcePath:t})}))}),e.querySelectorAll("a.tag").forEach(l=>{let c=l.getAttribute("href");c&&l.addEventListener("click",h=>{h.preventDefault(),h.stopPropagation(),this.app.workspace.trigger("search:open",c)})})}getContainer(){return this.container}};hi.dragPreview=null;var vs=require("obsidian"),Mo=/#[\w\u4e00-\u9fa5]+/g,ws=/^\s*(#[\w\u4e00-\u9fa5]+(\s+#[\w\u4e00-\u9fa5]+)*\s*)$/,Cs=class extends vs.Component{constructor(e,t,i){super();this.highlight=t;this.onCommentEdit=i;this.app=window.app,this.render(e)}render(e){if((this.highlight.comments||[]).length===0)return;let i=e.createEl("div",{cls:"hi-notes-section"});this.container=i.createEl("div",{cls:"hi-notes-list"}),this.renderComments().catch(o=>{console.error("Error rendering comments:",o)})}async renderComments(){let e=this.highlight.comments||[];for(e.sort((t,i)=>{let o=ws.test(t.content),l=ws.test(i.content);return o&&!l?-1:!o&&l?1:i.updatedAt-t.updatedAt});this.container.firstChild;)this.container.removeChild(this.container.firstChild);for(let t of e){let i=ws.test(t.content),o=this.container.createEl("div",{cls:`hi-note${i?" pure-tags-comment":""}`,attr:{"data-comment-id":t.id}}),l=o.createEl("div",{cls:"hi-note-content markdown-rendered"}),c=t.content;if(ws.test(c)){let g=c,u=c.match(Mo)||[];for(;l.firstChild;)l.removeChild(l.firstChild);if(u.length>0){let m=g.split(Mo),w=0;m.forEach((F,E)=>{if(F&&l.appendChild(document.createTextNode(F)),E<u.length){let Q=document.createElement("span");Q.className="highlight-tag",Q.textContent=u[E],l.appendChild(Q)}})}else l.textContent=c}else try{await vs.MarkdownRenderer.renderMarkdown(c,l,this.highlight.filePath||"",this),l.querySelectorAll("ul, ol").forEach(u=>{u.addClass("comment-markdown-list")}),await this.activateInternalLinks(l,this.highlight.filePath||"")}catch(g){console.error("Error rendering markdown in comment:",g),l.textContent=c}l.addEventListener("dblclick",g=>{g.target.closest("a")||(g.stopPropagation(),g.preventDefault(),this.onCommentEdit(t))}),l.addEventListener("click",g=>{g.target.closest("a")||g.stopPropagation()});let h=o.createEl("div",{cls:"hi-note-footer"});h.createEl("div",{text:new Date(t.updatedAt).toLocaleString(),cls:"hi-note-time"}),h.createEl("span",{text:"Double click to edit",cls:"hi-note-edit-hint"}),h.createEl("div",{cls:"hi-note-actions"})}}async activateInternalLinks(e,t){e.querySelectorAll("a.internal-link").forEach(l=>{let c=l.getAttribute("data-href")||l.getAttribute("href");c&&(l.addEventListener("click",h=>{h.preventDefault(),h.stopPropagation(),this.app.metadataCache.getFirstLinkpathDest(c,t)&&this.app.workspace.openLinkText(c,t,!1)}),l.addEventListener("mouseenter",h=>{this.app.workspace.trigger("hover-link",{event:h,source:"hi-note",hoverParent:e,targetEl:l,linktext:c,sourcePath:t})}))}),e.querySelectorAll("a.tag").forEach(l=>{let c=l.getAttribute("href");c&&l.addEventListener("click",h=>{h.preventDefault(),h.stopPropagation(),this.app.workspace.trigger("search:open",c)})})}};var Fs=class{constructor(A,e,t){this.parent=A;this.highlight=e;this.onClick=t;this.render()}render(){this.container=this.parent.createEl("div",{cls:"unfocused-comment-input"}),this.container.createEl("div",{cls:"unfocused-input-area",attr:{placeholder:f("Add comment...")}}).addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.onClick()})}remove(){this.container.remove()}hide(){this.container.style.display="none"}};var ee=require("obsidian");var ut=class ut{static start(A,e,t={}){var h;let{showIcon:i=!0,maxLength:o=30}=t;this.clear(),this.instance=document.createElement("div"),this.instance.className="highlight-dragging";let l=document.createElement("div");l.className="highlight-dragging-content";let c=e.length>o?e.slice(0,o)+"...":e;l.textContent=c,this.instance.appendChild(l),document.body.appendChild(this.instance),this.updatePosition(A.clientX,A.clientY),(h=A.dataTransfer)==null||h.setDragImage(this.dragImage,0,0),document.addEventListener("dragover",this.handleDragOver)}static updatePosition(A,e){this.instance&&this.instance.setAttribute("style",`left: ${A+10}px; top: ${e+10}px;`)}static clear(){this.instance&&(this.instance.remove(),this.instance=null),document.removeEventListener("dragover",this.handleDragOver)}};ut.instance=null,ut.dragImage=new Image,ut.dragImage.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",ut.handleDragOver=A=>{A.preventDefault(),ut.updatePosition(A.clientX,A.clientY)};var gi=ut;var Lo=require("obsidian"),ui=class{constructor(A,e){this.highlight=A;this.plugin=e}generateSync(){var e,t,i,o;let A=[];if(this.highlight.isVirtual){let l=((t=(e=this.highlight.filePath)==null?void 0:e.split("/").pop())==null?void 0:t.replace(".md",""))||"File";A.push(`> [!note] [[${l}]]`),A.push("> ")}else{A.push("> [!quote] HiNote");let l=!1;if(this.highlight.blockId){let c=this.highlight.filePath;if(!c){let h=this.plugin.app.workspace.getActiveFile();h&&(c=h.path)}if(c){let h=(i=c.split("/").pop())==null?void 0:i.replace(".md","");if(h){let g=`> ![[${h}#^${this.highlight.blockId}]]`;A.push(g),A.push("> "),l=!0}}}else if(this.highlight.filePath&&typeof this.highlight.position=="number"){let c=this.plugin.app.vault.getAbstractFileByPath(this.highlight.filePath);if(c instanceof Lo.TFile){let h=this.plugin.app.metadataCache.getFileCache(c);if(h!=null&&h.sections){let g=this.highlight.position,u=h.sections.find(m=>m.position.start.offset<=g&&m.position.end.offset>=g);if(u!=null&&u.id){let m=(o=this.highlight.filePath.split("/").pop())==null?void 0:o.replace(".md","");if(m){let w=`> ![[${m}#^${u.id}]]`;A.push(w),A.push("> "),l=!0}}}}}!l&&this.highlight.text&&(A.push(`> ${this.highlight.text}`),A.push("> "))}if(this.highlight.comments&&this.highlight.comments.length>0)for(let l of this.highlight.comments)A.push(...this.formatComment(l,!1));return A.join(`
`)}async generate(){return this.generateSync()}formatComment(A,e){let t=[],i=e?">":">>";if(!e){let l=A.updatedAt?window.moment(A.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"";t.push(`>> [!note]+ ${l}`)}let o=A.content.split(`
`).map(l=>(l=l.trim(),l?`${i} ${l}`:i)).join(`
`);return t.push(o),t.push(">"),t}};var DA=require("obsidian");var It=[{id:"deepseek-chat",name:"Deepseek Chat"},{id:"deepseek-reasoner",name:"Deepseek Reasoner"}],zA=[{id:"gemini-2.5-flash",name:"Gemini 2.5 Flash"},{id:"gemini-2.5-pro",name:"Gemini 2.5 Pro"},{id:"gemini-2.5-flash-lite",name:"Gemini 2.5 Flash Lite"},{id:"gemini-1.5-flash",name:"Gemini 1.5 Flash (Legacy)"},{id:"gemini-1.5-pro",name:"Gemini 1.5 Pro (Legacy)"},{id:"gemini-2.0-flash",name:"Gemini 2.0 Flash (Legacy)"}],SA=[{id:"deepseek-ai/DeepSeek-V3",name:"DeepSeek V3",isCustom:!1},{id:"Qwen/Qwen2.5-7B-Instruct",name:"Qwen2.5 7B",isCustom:!1},{id:"Qwen/Qwen2.5-14B-Instruct",name:"Qwen2.5 14B",isCustom:!1},{id:"Pro/Qwen/Qwen2-7B-Instruct",name:"Qwen2 7B",isCustom:!1},{id:"Pro/THUDM/glm-4-9b-chat",name:"GLM-4 9B",isCustom:!1},{id:"google/gemma-2-9b-it",name:"Gemma2 9B",isCustom:!1}],oe={excludePatterns:"",useCustomPattern:!1,regexRules:[{id:"default-md",name:"Default Highlight",pattern:"==\\s*([\\s\\S]*?)\\s*==",color:"#ffeb3b",enabled:!0},{id:"default-mark",name:"Mark format",pattern:"<mark[^>]*>([\\s\\S]*?)</mark>",color:"#ffeb3b",enabled:!0},{id:"default-span",name:"Span format",pattern:"<span[^>]*>([\\s\\S]*?)</span>",color:"#ffeb3b",enabled:!0}],ai:{provider:"ollama",ollama:{host:"http://localhost:11434",model:""},gemini:{apiKey:"",model:"gemini-pro",baseUrl:"",isCustomModel:!1},openai:{apiKey:"",model:"gpt-4o",baseUrl:""},anthropic:{apiKey:"",model:"claude-2",apiAddress:"",isCustomModel:!1,lastCustomModel:""},deepseek:{apiKey:"",model:"deepseek-chat",baseUrl:""},prompts:{"\u{1F914} Key Insight":"{{highlight}}.Please reinterpret the above content from a fresh perspective and summarize its core idea within 200 characters."}},export:{exportPath:""},contextOptions:{strategy:"smart",includeTitle:!0,maxLength:2e3,surroundingLines:3},showCommentWidget:!0};var Ht=require("obsidian"),bt=class{constructor(A="http://localhost:11434"){this.retryAttempts=3;this.retryDelay=1e3;!A.startsWith("http://")&&!A.startsWith("https://")&&(A="http://"+A),this.baseUrl=A.replace(/\/$/,"")}async listModels(){try{await this.ensureConnection();let A=await this.makeRequest({endpoint:"/api/tags",method:"GET"});if(!A||!A.models)throw new Error("Invalid API response format");return A.models.map(e=>e.name)}catch(A){throw this.handleError(A)}}async generateCompletion(A,e){try{await this.ensureConnection();let t=await this.makeRequest({endpoint:"/api/generate",method:"POST",body:JSON.stringify({model:A,prompt:e,stream:!1})});if(!t||!t.response)throw new Error("Invalid API response format");return t.response}catch(t){throw this.handleError(t)}}async pullModel(A){try{new Ht.Notice(`Downloading model ${A}...`);let e=await this.makeRequest({endpoint:"/api/pull",method:"POST",body:JSON.stringify({name:A})});if(!e.ok)throw new Error(`Failed to download model: ${e.status}`);new Ht.Notice(`Model ${A} downloaded successfully`)}catch(e){throw new Error(`Failed to download model: ${e.message}`)}}async chat(A,e){var t;try{await this.ensureConnection();let i=await this.makeRequest({endpoint:"/api/chat",method:"POST",body:JSON.stringify({model:A,messages:e,stream:!1})});if(!i||!((t=i.message)!=null&&t.content))throw new Error("Invalid API response format");return i.message.content}catch(i){throw this.handleError(i)}}async ensureConnection(){if(!this.baseUrl)throw new Error("Ollama service not configured. Please set the host in settings.");if(!await this.testConnection())throw new Error("Unable to connect to Ollama service. Please ensure the service is running.")}async testConnection(){if(!this.baseUrl)return!1;try{let A=await this.makeRequest({endpoint:"/api/version",method:"GET"});return!!(A!=null&&A.version)}catch(A){return!1}}async makeRequest(A){let e=null;for(let t=1;t<=this.retryAttempts;t++)try{let i=new URL(A.endpoint,this.baseUrl).toString(),o=await(0,Ht.requestUrl)({url:i,method:A.method,headers:{"Content-Type":"application/json",Accept:"application/json"},body:A.body,throw:!1});if(o.status===200)try{return o.text?JSON.parse(o.text):{}}catch(c){throw new Error("Invalid JSON response from server")}let l=`HTTP error! status: ${o.status}`;try{let c=JSON.parse(o.text);c.error&&(l=c.error)}catch(c){o.text&&(l=o.text)}throw new Error(l)}catch(i){if(e=i,t<this.retryAttempts){await this.delay(this.retryDelay*t);continue}break}throw e}handleError(A){return A.message.includes("ECONNREFUSED")?(new Ht.Notice("Ollama service is not running. Please start the service."),new Error("Unable to connect to Ollama service. Please ensure the service is running.")):A instanceof TypeError&&A.message.includes("Invalid URL")?new Error(`Invalid Ollama service URL: ${this.baseUrl}`):A}delay(A){return new Promise(e=>setTimeout(e,A))}};var nn=require("obsidian"),xt=class{constructor(A,e,t){this.apiKey=A,this.apiAddress=e||"https://api.anthropic.com",this.model=t||"claude-opus-4-1-20250805"}async generateResponse(A){try{let e=await(0,nn.requestUrl)({url:`${this.apiAddress}/v1/messages`,method:"POST",headers:{"x-api-key":this.apiKey,"anthropic-version":"2023-06-01","content-type":"application/json"},body:JSON.stringify({model:this.model,max_tokens:4096,messages:[{role:"user",content:A}]})});if(e.status!==200)throw new Error(`Anthropic API error: ${e.text}`);return e.json.content[0].text}catch(e){throw new Error("Failed to generate response from Anthropic API")}}async testConnection(){try{return(await(0,nn.requestUrl)({url:`${this.apiAddress}/v1/messages`,method:"POST",headers:{"x-api-key":this.apiKey,"anthropic-version":"2023-06-01","content-type":"application/json"},body:JSON.stringify({model:this.model,max_tokens:1,messages:[{role:"user",content:"Hi"}]})})).status===200}catch(A){return!1}}};var ys=require("obsidian"),Es=class{constructor(A,e="gemini-2.5-flash",t){this.apiKey=A,this.model=e,this.baseUrl=t||"https://generativelanguage.googleapis.com"}updateModel(A){this.model=A}async generateResponse(A,e){var t,i,o,l,c;try{let h=`${this.baseUrl}/v1/models/${this.model}:generateContent?key=${this.apiKey}`,g={contents:[{parts:[{text:A}]}],generationConfig:{maxOutputTokens:(e==null?void 0:e.maxOutputTokens)||2048,temperature:(e==null?void 0:e.temperature)||.7,...(e==null?void 0:e.responseMimeType)&&{responseMimeType:e.responseMimeType},...(e==null?void 0:e.responseSchema)&&{responseSchema:e.responseSchema}}},u=await(0,ys.requestUrl)({url:h,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)});if(u.status!==200)throw new Error(`Gemini API error (${u.status}): ${u.text}`);let m=u.json;if(!((c=(l=(o=(i=(t=m.candidates)==null?void 0:t[0])==null?void 0:i.content)==null?void 0:o.parts)==null?void 0:l[0])!=null&&c.text))throw new Error("Invalid response format from Gemini API");return m.candidates[0].content.parts[0].text}catch(h){throw h instanceof Error?h:new Error("Failed to generate response from Gemini API")}}async chat(A,e){var t,i,o,l,c;try{let h=`${this.baseUrl}/v1/models/${this.model}:generateContent?key=${this.apiKey}`,u={contents:A.map(F=>({role:F.role==="assistant"?"model":"user",parts:[{text:F.content}]})),generationConfig:{maxOutputTokens:(e==null?void 0:e.maxOutputTokens)||2048,temperature:(e==null?void 0:e.temperature)||.7,...(e==null?void 0:e.responseMimeType)&&{responseMimeType:e.responseMimeType},...(e==null?void 0:e.responseSchema)&&{responseSchema:e.responseSchema}}},m=await(0,ys.requestUrl)({url:h,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});if(m.status!==200)throw new Error(`Gemini Chat API error (${m.status}): ${m.text}`);let w=m.json;if(!((c=(l=(o=(i=(t=w.candidates)==null?void 0:t[0])==null?void 0:i.content)==null?void 0:o.parts)==null?void 0:l[0])!=null&&c.text))throw new Error("Invalid response format from Gemini Chat API");return w.candidates[0].content.parts[0].text}catch(h){throw h instanceof Error?h:new Error("Failed to chat with Gemini API")}}async generateJSONResponse(A,e){return this.generateResponse(A,{responseMimeType:"application/json",responseSchema:e})}async chatJSON(A,e){return this.chat(A,{responseMimeType:"application/json",responseSchema:e})}async testConnection(){try{let A=`${this.baseUrl}/v1/models/${this.model}?key=${this.apiKey}`,e=await(0,ys.requestUrl)({url:A,method:"GET"});return e.status,e.status===200}catch(A){return!1}}};var an=require("obsidian"),Qs=class{constructor(A){var e;if(!((e=A.siliconflow)!=null&&e.apiKey))throw new Error("SiliconFlow API key is required");this.settings=A,this.baseUrl=A.siliconflow.baseUrl||"https://api.siliconflow.cn/v1"}async chat(A,e){var t,i;try{let o=((t=this.settings.siliconflow)==null?void 0:t.model)||"deepseek-ai/DeepSeek-V3",l=await(0,an.requestUrl)({url:`${this.baseUrl}/chat/completions`,method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(i=this.settings.siliconflow)==null?void 0:i.apiKey}`},body:JSON.stringify({model:o,messages:A.map(h=>({role:h.role,content:h.content})),stream:!1})});if(l.status!==200)throw new Error(`SiliconFlow API request failed: ${l.text}`);let c=l.json;if(!c.choices||!c.choices[0]||!c.choices[0].message)throw new Error("Unexpected API response format");return c.choices[0].message.content}catch(o){throw o}}async listModels(){var A;try{let e=await(0,an.requestUrl)({url:`${this.baseUrl}/models`,method:"GET",headers:{Authorization:`Bearer ${(A=this.settings.siliconflow)==null?void 0:A.apiKey}`}});if(e.status!==200)throw new Error(`Failed to list models: ${e.text}`);return e.json.data.map(t=>({id:t.id,name:t.id.split("/").pop()||t.id,isCustom:!1}))}catch(e){throw e}}};var on=require("obsidian"),Us=class{constructor(A,e="deepseek-chat",t){this.apiKey=A;this.model=e,this.baseUrl=t||"https://api.deepseek.com/v1"}updateModel(A){this.model=A}async generateResponse(A){let e=[{role:"user",content:A}];return await this.chat(e)}async chat(A){var e,t,i;try{let o=await(0,on.requestUrl)({url:`${this.baseUrl}/chat/completions`,method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`},body:JSON.stringify({model:this.model,messages:A,temperature:.7,max_tokens:4096,frequency_penalty:0,presence_penalty:0})});if(o.status!==200)throw new Error(`Deepseek API error (${o.status}): ${o.text}`);let l=o.json;if(!((i=(t=(e=l.choices)==null?void 0:e[0])==null?void 0:t.message)!=null&&i.content))throw new Error("Invalid response format from Deepseek API");return l.choices[0].message.content}catch(o){throw o instanceof Error?o:new Error("Failed to generate response from Deepseek API")}}async testConnection(){try{return(await(0,on.requestUrl)({url:`${this.baseUrl}/chat/completions`,method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:this.model,messages:[{role:"user",content:"test"}],max_tokens:10})})).status===200}catch(A){return!1}}};var To=require("obsidian"),ZA=class{constructor(A){this.settings=A;this.anthropicService=null;this.geminiService=null;this.deepseekService=null;this.siliconflowService=null;this.currentState={provider:"",model:""};var e,t,i,o,l,c,h,g;switch((e=A.ollama)!=null&&e.host&&(this.ollamaService=new bt(A.ollama.host)),(t=A.anthropic)!=null&&t.apiKey&&(this.anthropicService=new xt(A.anthropic.apiKey,A.anthropic.apiAddress,A.anthropic.model)),(i=A.gemini)!=null&&i.apiKey&&(this.geminiService=new Es(A.gemini.apiKey,A.gemini.model,A.gemini.baseUrl)),(o=A.deepseek)!=null&&o.apiKey&&(this.deepseekService=new Us(A.deepseek.apiKey,A.deepseek.model,A.deepseek.baseUrl)),(l=A.siliconflow)!=null&&l.apiKey&&(this.siliconflowService=new Qs(this.settings)),this.currentState.provider=A.provider,A.provider){case"gemini":this.currentState.model=((c=A.gemini)==null?void 0:c.model)||"";break;case"deepseek":this.currentState.model=((h=A.deepseek)==null?void 0:h.model)||"deepseek-chat";break;case"siliconflow":this.currentState.model=((g=A.siliconflow)==null?void 0:g.model)||"internlm/internlm2_5-7b-chat";break}}updateModel(A,e){switch(this.currentState.provider=A,this.currentState.model=e,A){case"gemini":this.geminiService&&this.geminiService.updateModel(e);break;case"deepseek":this.deepseekService&&this.deepseekService.updateModel(e);break}}async generateResponse(A,e,t){let i=A.replace("{{highlight}}",e);switch(t&&(i=i.replace("{{comment}}",t)),this.settings.provider){case"openai":return await this.callOpenAI(i);case"anthropic":return await this.callAnthropic(i);case"ollama":return await this.callOllama(i);case"gemini":return await this.callGemini(i);case"deepseek":return await this.callDeepseek(i);case"siliconflow":return await this.callSiliconFlow(i);default:throw new Error("AI service not configured")}}async chat(A){switch(this.settings.provider){case"openai":return await this.chatWithOpenAI(A);case"anthropic":return await this.chatWithAnthropic(A);case"ollama":return await this.chatWithOllama(A);case"gemini":return await this.chatWithGemini(A);case"deepseek":return await this.chatWithDeepseek(A);case"siliconflow":return await this.chatWithSiliconFlow(A);default:throw new Error("AI service not configured")}}async chatWithOpenAI(A){var i;if(!((i=this.settings.openai)!=null&&i.apiKey))throw new Error("OpenAI API Key not configured");let e=await(0,To.requestUrl)({url:this.settings.openai.baseUrl||"https://api.openai.com/v1/chat/completions",method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.settings.openai.apiKey}`},body:JSON.stringify({model:this.settings.openai.model,messages:A,temperature:.7})});if(e.status!==200)throw new Error(`OpenAI API request failed: ${e.text}`);return e.json.choices[0].message.content}async chatWithAnthropic(A){if(!this.anthropicService)throw new Error("Anthropic service not configured");let e=A[A.length-1];return await this.anthropicService.generateResponse(e.content)}async chatWithOllama(A){var e;if(!this.ollamaService)throw new Error("Ollama service not configured");if(!((e=this.settings.ollama)!=null&&e.model))throw new Error("Ollama model not configured");return await this.ollamaService.chat(this.settings.ollama.model,A)}async chatWithGemini(A){if(!this.geminiService)throw new Error("Gemini service not configured");return await this.geminiService.chat(A)}async chatWithSiliconFlow(A){if(!this.siliconflowService)throw new Error("SiliconFlow service not configured");try{return await this.siliconflowService.chat(A)}catch(e){throw e}}async chatWithDeepseek(A){if(!this.deepseekService)throw new Error("Deepseek service not configured");return await this.deepseekService.chat(A)}async callOpenAI(A){return await this.chatWithOpenAI([{role:"user",content:A}])}async callAnthropic(A){if(!this.anthropicService)throw new Error("Anthropic service not configured");return await this.anthropicService.generateResponse(A)}async callOllama(A){var e;if(!this.ollamaService)throw new Error("Ollama service not configured");if(!((e=this.settings.ollama)!=null&&e.model))throw new Error("Ollama model not configured");return await this.ollamaService.generateCompletion(this.settings.ollama.model,A)}async callGemini(A){if(!this.geminiService)throw new Error("Gemini service not configured");return await this.geminiService.generateResponse(A)}async callSiliconFlow(A){if(!this.siliconflowService)throw new Error("SiliconFlow service not configured");try{return await this.siliconflowService.chat([{role:"user",content:A}])}catch(e){throw e}}async callDeepseek(A){if(!this.deepseekService)throw new Error("Deepseek service not configured");return await this.deepseekService.generateResponse(A)}async testConnection(){switch(this.settings.provider){case"openai":try{return await this.chatWithOpenAI([{role:"user",content:"test"}]),!0}catch(A){return!1}case"anthropic":return this.anthropicService?await this.anthropicService.testConnection():!1;case"ollama":return this.ollamaService?await this.ollamaService.testConnection():!1;case"gemini":return this.geminiService?await this.geminiService.testConnection():!1;case"deepseek":return this.deepseekService?await this.deepseekService.testConnection():!1;default:return!1}}async listOllamaModels(){if(!this.ollamaService)throw new Error("Ollama service not configured");return await this.ollamaService.listModels()}async listGeminiModels(){if(!this.geminiService)throw new Error("Gemini service not configured");return Promise.resolve(zA)}async listDeepseekModels(){if(!this.deepseekService)throw new Error("Deepseek service not configured");return Promise.resolve([{id:"deepseek-chat",name:"Deepseek Chat"},{id:"deepseek-coder",name:"Deepseek Coder"}])}async listSiliconFlowModels(){return SA}async listOpenAIModels(){var e,t;let A=[{id:"gpt-4o",name:"GPT-4o",isCustom:!1},{id:"gpt-4o-mini",name:"GPT-4o Mini",isCustom:!1},{id:"gpt-o1",name:"GPT-o1",isCustom:!1},{id:"gpt-4",name:"GPT-4",isCustom:!1},{id:"gpt-4-turbo",name:"GPT-4 Turbo",isCustom:!1}];return(e=this.settings.openai)!=null&&e.isCustomModel&&((t=this.settings.openai)!=null&&t.model)&&A.push({id:this.settings.openai.model,name:this.settings.openai.model,isCustom:!0}),A}};var Ss=class{constructor(A,e,t,i){var c;this.plugin=t,this.container=A,this.contentProvider=e,this.options={...i},this.initButton();let o=(c=this.plugin.app.workspace.getLeavesOfType("comment-view")[0])==null?void 0:c.view,l=o instanceof pA?o:null;l!=null&&l.registerAIButton&&l.registerAIButton(this)}destroy(){var t;document.removeEventListener("click",this.boundClickHandler);let A=(t=this.plugin.app.workspace.getLeavesOfType("comment-view")[0])==null?void 0:t.view,e=A instanceof pA?A:null;e!=null&&e.unregisterAIButton&&e.unregisterAIButton(this)}initButton(){let A=this.container.createEl("div",{cls:"highlight-ai-container"});this.options.position&&A.addClass(`highlight-ai-container-${this.options.position}`);let e=A.createEl("div",{cls:this.options.buttonClass,attr:{"aria-label":this.options.buttonLabel}});(0,DA.setIcon)(e,this.options.buttonIcon),e.addEventListener("click",t=>{t.stopPropagation(),this.toggleDropdown()}),this.aiButton=e}toggleDropdown(){let A=new DA.Menu,e=Object.entries(this.plugin.settings.ai.prompts||{});e.length>0?e.forEach(([i])=>{A.addItem(o=>o.setTitle(i).onClick(async()=>{await this.handleAIAnalysis(i)}))}):A.addItem(i=>i.setTitle(f("Please add Prompt in the settings first")).setDisabled(!0));let t=this.aiButton.getBoundingClientRect();A.showAtPosition({x:t.left-92,y:t.bottom+8})}async handleAIAnalysis(A){try{this.setLoading(!0);let e=new ZA(this.plugin.settings.ai),t=this.plugin.settings.ai.prompts[A];if(!t)throw new Error(f(`Not found named "${A}" Prompt`));let i=this.contentProvider.getText(),o=this.contentProvider.getComments(),l=await e.generateResponse(t,i,o);await this.options.onResponse(l),new DA.Notice(f("AI comments added"))}catch(e){new DA.Notice(f(`AI comments failed: ${e.message}`))}finally{this.setLoading(!1)}}setLoading(A){A?(this.aiButton.addClass("loading"),(0,DA.setIcon)(this.aiButton,"loader")):(this.aiButton.removeClass("loading"),(0,DA.setIcon)(this.aiButton,this.options.buttonIcon||"bot-message-square"))}getButtonElement(){return this.aiButton}};var ln=require("obsidian"),jA=class{constructor(A){this.STORAGE_KEY="flashcard-license";this.VAULT_ID_KEY="vault-id";this.API_URL="https://hi-note-license-server-production.up.railway.app";this.FEATURES=["flashcard"];this.VERIFICATION_INTERVAL_DAYS=7;this.licenseToken=null;this.plugin=A}async generateVaultId(){try{let A=await this.plugin.loadData()||{};if(A[this.VAULT_ID_KEY])return A[this.VAULT_ID_KEY];let e=this.plugin.app.vault.adapter,t=this.plugin.app.vault.getName();e&&"basePath"in e&&(t=e.basePath+"/"+t);let i=navigator.platform||"",o=[t,i].join("|"),c=new TextEncoder().encode(o),h=await crypto.subtle.digest("SHA-256",c),u=Array.from(new Uint8Array(h)).map(m=>m.toString(16).padStart(2,"0")).join("");return await this.saveVaultId(u),u}catch(A){let e=this.plugin.app.vault.getName(),i=new TextEncoder().encode(e),o=await crypto.subtle.digest("SHA-256",i),c=Array.from(new Uint8Array(o)).map(h=>h.toString(16).padStart(2,"0")).join("");return await this.saveVaultId(c),c}}async saveVaultId(A){let e=await this.plugin.loadData()||{};await this.plugin.saveData({...e,[this.VAULT_ID_KEY]:A})}async activateLicense(A){try{let e=await this.generateVaultId(),t=`${this.API_URL}/api/verify`,l=(await(0,ln.requestUrl)({url:t,method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({licenseKey:A,deviceId:e})})).json;if(l.valid){let c=await this.plugin.loadData()||{};return await this.plugin.saveData({...c,[this.STORAGE_KEY]:{key:A,token:l.token,features:l.features,vaultId:e,lastVerified:Date.now()}}),this.licenseToken=l.token,!0}return!1}catch(e){let t=e instanceof Error?e.message:"Unknown error";return!1}}async isFeatureEnabled(A){var i;let e=await this.plugin.loadData(),t=e==null?void 0:e[this.STORAGE_KEY];return((i=t==null?void 0:t.features)==null?void 0:i.includes(A))||!1}async isActivated(){try{let A=await this.plugin.loadData(),e=A==null?void 0:A[this.STORAGE_KEY];return e!=null&&e.token?this.shouldVerifyLicense(e.lastVerified)?this.verifyWithServer(e):(this.licenseToken||(this.licenseToken=e.token),!0):!1}catch(A){return!1}}shouldVerifyLicense(A){return A?(Date.now()-A)/(1e3*60*60*24)>=this.VERIFICATION_INTERVAL_DAYS:!0}async verifyWithServer(A){try{let e=await this.generateVaultId(),t=A.vaultId,i=t&&t!==e,l=(await(0,ln.requestUrl)({url:`${this.API_URL}/api/verify`,method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${A.token}`},body:JSON.stringify({licenseKey:A.key,deviceId:e,isDeviceChanged:i})})).json;if(!l)return!!this.licenseToken;if(l.valid){let c=await this.plugin.loadData()||{};return await this.plugin.saveData({...c,[this.STORAGE_KEY]:{...A,token:l.token||A.token,vaultId:e,lastVerified:Date.now()}}),this.licenseToken=l.token||A.token,!0}return!1}catch(e){return!!this.licenseToken}}};var q=class q{constructor(A,e,t,i,o=!1,l){this.container=A;this.highlight=e;this.plugin=t;this.options=i;this.isInMainView=o;this.isEditing=!1;this.aiButtonInstance=null;this.moreActionsDropdown=null;this.unfocusedInput=null;this.hasFlashcard=!1;this.isShowingRealInput=!1;var c;this.fileName=l,this.highlight=e,this.plugin=t,this.options=i,this.fileName=(c=this.highlight.filePath)==null?void 0:c.split("/").pop(),q.cardInstances.add(this),this.setupCommentInputEventListeners(),this.render()}static getSelectedCards(){return q.selectedCards}static clearSelection(){q.selectedCards.forEach(A=>{A.removeClass("selected")}),q.selectedCards.clear(),q.lastSelectedCard=null}static clearAllInstances(){q.cardInstances.forEach(A=>{typeof A.destroy=="function"&&A.destroy()}),q.cardInstances.clear(),q.selectedCards.clear(),q.lastSelectedCard=null}static findCardInstanceByHighlightId(A){for(let e of q.cardInstances)if(e.highlight.id===A)return e;return null}static updateCardUIByHighlightId(A){let e=q.findCardInstanceByHighlightId(A);e&&e.updateIconsAfterCardCreation()}static clearAllUnfocusedInputs(){q.cardInstances.forEach(A=>{A.unfocusedInput&&(A.unfocusedInput.remove(),A.unfocusedInput=null)})}setupCommentInputEventListeners(){let A=t=>{var i;((i=t.detail)==null?void 0:i.highlightId)===this.highlight.id&&(this.isShowingRealInput=!0,this.unfocusedInput&&(this.unfocusedInput.remove(),this.unfocusedInput=null))},e=t=>{var i;((i=t.detail)==null?void 0:i.highlightId)===this.highlight.id&&(this.isShowingRealInput=!1)};document.addEventListener("comment-input-shown",A),document.addEventListener("comment-input-closed",e),this.plugin.register(()=>{document.removeEventListener("comment-input-shown",A),document.removeEventListener("comment-input-closed",e)})}render(){this.card=this.container.createEl("div",{cls:`highlight-card ${this.highlight.isVirtual?"virtual-highlight-card":""}`,attr:{"data-highlight":JSON.stringify(this.highlight)}}),this.card.addEventListener("click",c=>{if(this.isEditing||this.isShowingRealInput)return;let h=c.target;h.closest(".hi-note-input")||h.closest(".hi-note-actions-hint")||this.selectCard(c)});let A=this.card.createEl("div",{cls:"highlight-card-title-bar"}),e=A.createEl("div",{cls:"highlight-card-title-left"}),t=A.createEl("div",{cls:"highlight-card-title-right"});if((this.isInMainView||this.highlight.isGlobalSearch)&&this.fileName){let c=e.createEl("div",{cls:"highlight-card-icon",attr:{"aria-label":f("Open (DoubleClick)")}});this.checkHasFlashcard()?((0,ee.setIcon)(c,"book-heart"),c.addClass("has-flashcard")):(0,ee.setIcon)(c,"file-text"),c.addEventListener("dblclick",async m=>{m.stopPropagation();let w=this.highlight.filePath||this.fileName;if(!w)return;let F=this.plugin.app.vault.getAbstractFileByPath(w);if(!F||!(F instanceof ee.TFile))return;let E=this.plugin.app.workspace.getLeavesOfType("markdown"),Q=this.plugin.app.workspace.activeLeaf,H=E.find(x=>x!==Q);if(H||(H=this.plugin.app.workspace.getLeaf("split","vertical")),await H.openFile(F),this.highlight.position!==void 0){let x=H.view;if(x.getViewType()==="markdown"){let P=x.getViewType()==="markdown"?x.editor:null;if(P){let M=P.offsetToPos(this.highlight.position);P.setCursor(M),P.scrollIntoView({from:M,to:M},!0)}}}});let g=this.fileName?this.fileName.replace(/\.md$/,""):"",u=e.createEl("span",{text:g,cls:"highlight-card-title-text"});this.setupDragFunctionality(e),this.addPagePreview(u,this.highlight.filePath||this.fileName)}else{let c=e.createEl("div",{cls:"highlight-card-icon"});if(this.checkHasFlashcard()?((0,ee.setIcon)(c,"book-heart"),c.addClass("has-flashcard")):(0,ee.setIcon)(c,"highlighter"),this.highlight.filePath&&typeof this.highlight.position=="number"){let g=this.plugin.app.vault.getAbstractFileByPath(this.highlight.filePath);if(g instanceof ee.TFile&&!this.highlight.isGlobalSearch){let u=this.plugin.app.workspace.getLeavesOfType("markdown").find(m=>{let w=m.view;return w instanceof ee.MarkdownView&&w.file&&w.file.path===g.path});if(u){let m=u.view;if(m.editor){let F=m.editor.offsetToPos(this.highlight.position).line+1;e.createEl("div",{cls:"highlight-line-number-badge"}).createEl("span",{text:`L${F}`,cls:"highlight-line-number"})}}}}this.setupDragFunctionality(e)}this.aiButtonInstance=new Ss(t,{getText:()=>this.highlight.text,getComments:()=>(this.highlight.comments||[]).map(c=>c.content||"").join(`
`)},this.plugin,{onResponse:async c=>{await this.options.onAIResponse(c)},buttonClass:"highlight-title-btn highlight-ai-btn",buttonIcon:"sparkles",buttonLabel:f("AI comment"),position:"titlebar"});let o=t.createEl("div",{cls:"highlight-more-actions-container"}).createEl("div",{cls:"highlight-title-btn highlight-more-btn",attr:{"aria-label":f("More")}});(0,ee.setIcon)(o,"ellipsis-vertical"),o.addEventListener("click",c=>{c.stopPropagation(),this.toggleMoreActionsDropdown(o)}),this.isInMainView&&this.fileName&&this.highlight&&this.highlight.filePath&&typeof this.highlight.position=="number"&&this.plugin.app.vault.getAbstractFileByPath(this.highlight.filePath)instanceof ee.TFile&&this.generateDragContent().catch(h=>{console.error("[HighlightCard] Error pre-generating block ID:",h)});let l=this.card.createEl("div",{cls:"highlight-content"});new hi(l,this.highlight,this.options.onHighlightClick),new Cs(this.card,this.highlight,c=>{this.isEditing=!0,this.selectCard(),this.options.onCommentEdit(this.highlight,c)})}showUnfocusedCommentInput(){if(this.unfocusedInput&&(this.unfocusedInput.remove(),this.unfocusedInput=null),this.isEditing||this.isShowingRealInput)return;let A=this.card.querySelector(".highlight-content");A&&(this.unfocusedInput=new Fs(A,this.highlight,()=>{this.unfocusedInput&&(this.unfocusedInput.remove(),this.unfocusedInput=null),this.options.onCommentAdd(this.highlight)}))}static findCardInstanceByElement(A){for(let e of q.cardInstances)if(e.card===A||e.card.contains(A))return e;return null}showCommentInput(){q.clearAllUnfocusedInputs(),this.unfocusedInput&&(this.unfocusedInput.remove(),this.unfocusedInput=null),this.options.onCommentAdd(this.highlight)}selectCard(A){if(q.clearAllUnfocusedInputs(),A&&A.shiftKey&&q.lastSelectedCard){this.card.hasClass("selected")?(this.card.removeClass("selected"),q.selectedCards.delete(this.card)):(q.selectedCards.add(q.lastSelectedCard),q.selectedCards.add(this.card),this.card.addClass("selected"));let i=new CustomEvent("highlight-multi-select",{detail:{selectedCards:Array.from(q.selectedCards),lastSelected:this.card},bubbles:!0});this.card.dispatchEvent(i)}else document.querySelectorAll(".highlight-card.selected").forEach(i=>{i!==this.card&&i.removeClass("selected")}),q.selectedCards.forEach(i=>{i!==this.card&&i.removeClass("selected")}),q.selectedCards.clear(),q.selectedCards.add(this.card),this.card.addClass("selected");let e=new CustomEvent("highlight-multi-select",{detail:{selectedCards:Array.from(q.selectedCards),lastSelected:this.card},bubbles:!0});this.card.dispatchEvent(e),A!=null&&A.shiftKey||this.showUnfocusedCommentInput(),q.lastSelectedCard=this.card}getElement(){return this.card}addPagePreview(A,e){if(!e)return;let t=this.plugin.app.vault.getAbstractFileByPath(e);if(!(t instanceof ee.TFile))return;let i;A.addEventListener("mouseenter",o=>{i=setTimeout(async()=>{let l=o.target;this.plugin.app.workspace.trigger("hover-link",{event:o,source:"hi-note",hoverParent:l,targetEl:l,linktext:t.path})},300)}),A.addEventListener("mouseleave",()=>{i&&clearTimeout(i)})}update(A){this.highlight=A,this.isEditing=!1,this.card.empty(),this.render()}generateDragContentSync(){return new ui(this.highlight,this.plugin).generateSync()}async generateDragContent(){return new ui(this.highlight,this.plugin).generate()}setupDragFunctionality(A){A.setAttribute("draggable","true"),this.highlight&&this.highlight.filePath&&typeof this.highlight.position=="number"&&this.plugin.app.vault.getAbstractFileByPath(this.highlight.filePath)instanceof ee.TFile&&this.generateDragContent().catch(t=>{console.error("[HighlightCard] Error pre-generating block ID:",t)}),A.addEventListener("dragstart",async e=>{var t,i;try{if(!this.highlight||!this.highlight.text)throw new Error("Invalid highlight data");let o;try{let c=new Promise((h,g)=>{setTimeout(()=>g(new Error("Block ID generation timeout")),300)});o=await Promise.race([this.generateDragContent(),c])}catch(c){console.debug("[HighlightCard] Using sync fallback for drag content:",c),o=this.generateDragContentSync()}(t=e.dataTransfer)==null||t.setData("text/plain",o);let l=JSON.stringify(this.highlight);(i=e.dataTransfer)==null||i.setData("application/highlight",l),A.addClass("dragging"),gi.start(e,this.highlight.text)}catch(o){console.error("[HighlightCard] Error during drag start:",o),e.preventDefault(),e.stopPropagation()}}),A.addEventListener("dragend",()=>{A.removeClass("dragging"),gi.clear()})}copyHighlightContent(){try{let A=`> [!quote] HiNote
`;if(A+=`> ${this.highlight.text}`,this.highlight.filePath){let e=this.fileName||this.highlight.filePath.split("/").pop()||this.highlight.filePath;A+=`
> 
`,A+=`> From: [[${e}]]`}A+=`

`,navigator.clipboard.writeText(A).then(()=>{new ee.Notice("Copied")}).catch(e=>{console.error("\u590D\u5236\u5185\u5BB9\u5931\u8D25:",e),new ee.Notice("Failed to copy content")})}catch(A){console.error("\u590D\u5236\u9AD8\u4EAE\u5185\u5BB9\u65F6\u51FA\u9519:",A),new ee.Notice("Failed to copy content")}}handleExportAsImage(){this.options.onExport(this.highlight)}toggleMoreActionsDropdown(A){let e=new ee.Menu;this.hasFlashcard=this.checkHasFlashcard(),e.addItem(i=>i.setTitle(this.hasFlashcard?f("Delete HiCard"):f("Create HiCard")).onClick(()=>this.handleCreateHiCard())),e.addItem(i=>i.setTitle(f("Copy Highlight")).onClick(()=>this.copyHighlightContent())),e.addItem(i=>i.setTitle(f("Export as Image")).onClick(()=>this.handleExportAsImage())),e.addItem(i=>i.setTitle(f("Delete")).onClick(()=>this.handleDeleteHighlight()));let t=A.getBoundingClientRect();e.showAtPosition({x:t.left-100,y:t.bottom+8})}hasVisibleMoreDropdown(){return q.visibleDropdowns.size>0}static addVisibleDropdown(A){q.isGlobalListenerAdded||(document.addEventListener("click",q.handleDocumentClick,!0),q.isGlobalListenerAdded=!0),q.visibleDropdowns.add(A)}static removeVisibleDropdown(A){q.visibleDropdowns.delete(A)}checkHasFlashcard(){let A=this.plugin.fsrsManager;if(!A||!this.highlight.id)return!1;let e=A.findCardsBySourceId(this.highlight.id,"highlight");return e&&e.length>0}async handleCreateHiCard(){try{let A=new jA(this.plugin),e=await A.isActivated(),t=e?await A.isFeatureEnabled("flashcard"):!1;if(!e||!t){new ee.Notice(f("Only HiNote Pro"));return}if(!this.plugin.fsrsManager){new ee.Notice(f("FSRS \u7BA1\u7406\u5668\u672A\u521D\u59CB\u5316"));return}let o=this.checkHasFlashcard();this.hasFlashcard=o,o?await this.handleDeleteHiCard():await this.handleCreateNewHiCard()}catch(A){console.error("\u5904\u7406\u95EA\u5361\u64CD\u4F5C\u65F6\u51FA\u9519:",A),new ee.Notice(f(`\u64CD\u4F5C\u5931\u8D25: ${A.message}`))}}async deleteHiCardForHighlight(A=!1){try{return await this.handleDeleteHiCard(A),!0}catch(e){return console.error("\u5220\u9664\u95EA\u5361\u65F6\u51FA\u9519:",e),!1}}async handleDeleteHiCard(A=!1){try{let e=this.plugin.fsrsManager;if(!e){A||new ee.Notice(f("FSRS \u7BA1\u7406\u5668\u672A\u521D\u59CB\u5316"));return}if(e.deleteCardsBySourceId(this.highlight.id||"","highlight")>0){this.hasFlashcard=!1;let i=e.cleanupInvalidCardReferences();!(this.highlight.comments&&this.highlight.comments.length>0)&&!A?(await this.deleteHighlightCompletely(),A||new ee.Notice(f("Flashcard and highlight deleted"))):A||new ee.Notice(f("Flashcard deleted, highlight and comments preserved")),this.updateIconsAfterCardDeletion(),A||this.plugin.eventManager.emitFlashcardChanged()}else A||new ee.Notice(f("Flashcard not found"))}catch(e){console.error("\u5220\u9664\u95EA\u5361\u65F6\u51FA\u9519:",e),A||new ee.Notice(f(`Failed to delete flashcard: ${e.message}`))}}async deleteHighlightCompletely(){try{if(this.highlight.filePath){let A=this.plugin.app.vault.getAbstractFileByPath(this.highlight.filePath);if(A instanceof ee.TFile){let e=window.app.plugins.plugins["hi-note"];e&&e.commentStore?await e.commentStore.removeComment(A,this.highlight):console.warn("\u65E0\u6CD5\u8BBF\u95EE commentStore"),this.plugin.eventManager.emitHighlightDelete(this.highlight.filePath,this.highlight.text||"",this.highlight.id||"")}}}catch(A){throw console.error("\u5220\u9664\u9AD8\u4EAE\u65F6\u51FA\u9519:",A),A}}async createHiCardForHighlight(A=!1){try{return await this.handleCreateNewHiCard(A),!0}catch(e){return console.error("\u521B\u5EFA\u95EA\u5361\u65F6\u51FA\u9519:",e),!1}}async handleCreateNewHiCard(A=!1){let e=this.plugin.fsrsManager;if(!e){new ee.Notice(f("FSRS \u7BA1\u7406\u5668\u672A\u521D\u59CB\u5316"));return}if(this.highlight.id||(console.warn("\u9AD8\u4EAE\u7F3A\u5C11 ID\uFF0C\u6B63\u5728\u751F\u6210..."),this.highlight.id=`highlight-${Date.now()}-${Math.random().toString(36).substr(2,9)}`),this.highlight.filePath)try{let u=this.plugin.app.vault.getAbstractFileByPath(this.highlight.filePath);if(u instanceof ee.TFile){let m={id:this.highlight.id,text:this.highlight.text||"",position:this.highlight.position||0,comments:this.highlight.comments||[],createdAt:this.highlight.createdAt||Date.now(),updatedAt:this.highlight.updatedAt||Date.now(),isVirtual:this.highlight.isVirtual,filePath:this.highlight.filePath,fileType:this.highlight.fileType,displayText:this.highlight.displayText,paragraphOffset:this.highlight.paragraphOffset,backgroundColor:this.highlight.backgroundColor,isCloze:this.highlight.isCloze},w=window.app.plugins.plugins["hi-note"];w&&w.commentStore?await w.commentStore.addComment(u,m):console.warn("\u65E0\u6CD5\u8BBF\u95EE commentStore")}}catch(u){console.error("\u4FDD\u5B58\u9AD8\u4EAE\u65F6\u51FA\u9519:",u)}else console.warn("\u9AD8\u4EAE\u5BF9\u8C61\u7F3A\u5C11\u6587\u4EF6\u8DEF\u5F84");let t=this.highlight.text||"",i="",o=/\{\{([^{}]+)\}\}/g,l,c=[];for(;(l=o.exec(t))!==null;)c.push(l[1]);let h=[];if(c.length>0&&h.push(c.join(`
`)),this.highlight.comments&&this.highlight.comments.length>0&&h.push(this.highlight.comments.map(u=>u.content||"").join(`
`)),i=h.length>0?h.join(`

`):f("Add answer"),!e.addCard(t,i,this.highlight.filePath||this.fileName,this.highlight.id,"highlight")){new ee.Notice(f("Failed to create flashcard, please check highlight content"));return}this.plugin.eventManager.emitFlashcardChanged(),A||new ee.Notice(f("Flashcard created successfully!")),this.hasFlashcard=!0,this.updateIconsAfterCardCreation()}updateIconsAfterCardDeletion(){this.card.querySelectorAll(".highlight-card-icon").forEach(e=>{(0,ee.setIcon)(e,"file-text"),e.removeClass("has-flashcard")})}updateIconsAfterCardCreation(){this.card.querySelectorAll(".highlight-card-icon").forEach(e=>{(0,ee.setIcon)(e,"book-heart"),e.addClass("has-flashcard")})}updateCreateHiCardButtonText(){let A=this.card.querySelector(".create-hicard-btn");A&&(A.textContent=this.hasFlashcard?f("Delete HiCard"):f("Create HiCard"))}async handleDeleteHighlight(A=!1,e=!1){try{if(!A&&!confirm(f("Delete this highlight and all its data, including Comments and HiCards? Can't undo.")))return;if(this.hasFlashcard&&await this.handleDeleteHiCard(!0),this.highlight.filePath){let t=this.plugin.app.vault.getAbstractFileByPath(this.highlight.filePath);if(t instanceof ee.TFile){let i=window.app.plugins.plugins["hi-note"];i&&i.commentStore?await i.commentStore.removeComment(t,this.highlight):console.warn("\u65E0\u6CD5\u8BBF\u95EE commentStore"),await this.removeHighlightFormatFromEditor(t),this.plugin.eventManager.emitHighlightDelete(this.highlight.filePath,this.highlight.text||"",this.highlight.id||""),e||new ee.Notice(f("Successfully deleted")),this.card.remove(),q.cardInstances.delete(this)}}else console.warn("\u9AD8\u4EAE\u5BF9\u8C61\u7F3A\u5C11\u6587\u4EF6\u8DEF\u5F84"),new ee.Notice(f("\u5220\u9664\u9AD8\u4EAE\u5931\u8D25\uFF1A\u7F3A\u5C11\u6587\u4EF6\u8DEF\u5F84"))}catch(t){console.error("\u5220\u9664\u9AD8\u4EAE\u65F6\u51FA\u9519:",t),new ee.Notice(f(`\u5220\u9664\u9AD8\u4EAE\u5931\u8D25: ${t.message}`))}}async removeHighlightFormatFromEditor(A){let e=null,t="",i=this.plugin.app.workspace.getActiveViewOfType(ee.MarkdownView);if(i&&i.file&&i.file.path===A.path&&(e=i.editor),e?t=e.getValue():t=await this.plugin.app.vault.read(A),typeof this.highlight.position=="number"){let o=this.highlight.position,l=this.highlight.text,c=t.substring(Math.max(0,o-100),o),h=t.substring(o+l.length,Math.min(t.length,o+l.length+100)),g=[new RegExp(`==\\s*(${this.escapeRegExp(l)})\\s*==`,"g"),new RegExp(`<mark[^>]*>(${this.escapeRegExp(l)})</mark>`,"g"),new RegExp(`<span[^>]*>(${this.escapeRegExp(l)})</span>`,"g")],u=t,m=!1,w=t;for(let F of g)if(w.match(F)){u=w.replace(F,l),m=!0;break}if(!m){let F=window.app.plugins.plugins["hi-note"];if(F&&F.settings&&F.settings.customHighlightRegex)try{let E=new RegExp(F.settings.customHighlightRegex,"g"),Q=w.match(E);if(Q)for(let H of Q)H.includes(l)&&(u=u||w,u=u.replace(H,l),m=!0)}catch(E){console.error("\u81EA\u5B9A\u4E49\u6B63\u5219\u8868\u8FBE\u5F0F\u9519\u8BEF:",E)}}if(!m){let F=this.escapeRegExp(l),E=new RegExp(`==\\s*(${F})\\s*==`,"g");u=t.replace(E,l);let Q=new RegExp(`<mark[^>]*>(${F})</mark>`,"g");u=u.replace(Q,l);let H=new RegExp(`<span[^>]*>(${F})</span>`,"g");u=u.replace(H,l)}e?e.setValue(u):await this.plugin.app.vault.modify(A,u)}else{let o=this.highlight.text,l=this.escapeRegExp(o),c=[new RegExp(`==\\s*(${l})\\s*==`,"g"),new RegExp(`<mark[^>]*>(${l})</mark>`,"g"),new RegExp(`<span[^>]*>(${l})</span>`,"g")],h=t,g=!1;for(let u of c){let m=h.replace(u,o);if(m!==h){h=m,g=!0;break}}if(!g){let u=window.app.plugins.plugins["hi-note"];if(u&&u.settings&&u.settings.customHighlightRegex)try{let m=new RegExp(u.settings.customHighlightRegex,"g"),w=h.replace(m,(F,...E)=>{for(let Q of E)if(typeof Q=="string"&&Q.includes(o))return o;return F});w!==h&&(h=w,g=!0)}catch(m){console.error("\u81EA\u5B9A\u4E49\u6B63\u5219\u8868\u8FBE\u5F0F\u9519\u8BEF:",m)}}if(!g){let u=new RegExp(`==\\s*${l}\\s*==`,"g");h=t.replace(u,o)}e?e.setValue(h):await this.plugin.app.vault.modify(A,h)}}escapeRegExp(A){return A.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}destroy(){this.unfocusedInput&&(this.unfocusedInput.remove(),this.unfocusedInput=null),this.moreActionsDropdown&&(this.moreActionsDropdown.remove(),this.moreActionsDropdown=null),q.cardInstances.delete(this)}};window.HighlightCard={findCardInstanceByHighlightId:q.findCardInstanceByHighlightId},q.selectedCards=new Set,q.lastSelectedCard=null,q.cardInstances=new Set,q.visibleDropdowns=new Set,q.isGlobalListenerAdded=!1,q.handleDocumentClick=A=>{for(let e of q.visibleDropdowns){let t=e.closest(".highlight-card");t&&!t.contains(A.target)&&!e.contains(A.target)&&(e.classList.add("hi-note-hidden"),q.visibleDropdowns.delete(e))}};var Ie=q;var fi=require("obsidian");var Is=class{static shouldExclude(A,e){if(!e||e.trim().length===0)return!1;let t=e.split(",").map(l=>l.trim()).filter(l=>l.length>0),i=A.path,o=A.basename;return t.some(l=>{if(l=l.trim(),!l)return!1;if(l.startsWith("[[")&&l.endsWith("]]")){let g=l.slice(2,-2);return o===g}if(l.startsWith("*.")){let g=l.slice(2);return A.extension===g||i.endsWith(g)}let c=l.replace(/^\/+/,""),h=i.replace(/^\/+/,"");return h.startsWith(c+"/")||h===c})}};var pi=class{extractColorFromStyle(A){if(!A)return null;let e=A.match(/background(?:-color)?:\s*((?:rgba?\(.*?\)|#[0-9a-fA-F]{3,8}|var\(--[^)]+\)))/);return e?e[1]:null}extractColorFromElement(A){let e=A.match(/style=["']([^"']*)["']/);return e?this.extractColorFromStyle(e[1]):null}};pi.COLOR_PATTERNS=[/rgba?\(\d+,\s*\d+,\s*\d+(?:,\s*[0-9.]+)?\)/,/#[0-9a-fA-F]{3,8}/,/var\(--[^)]+\)/];var Do=require("obsidian"),et=class{constructor(A){this.app=A;this.events=new Do.Events}emitHighlightUpdate(A,e,t,i){this.events.trigger("highlight:update",A,e,t,i)}emitHighlightDelete(A,e,t){this.events.trigger("highlight:delete",A,e,t)}emitCommentUpdate(A,e,t,i){this.events.trigger("comment:update",A,e,t,i)}emitCommentDelete(A,e,t){this.events.trigger("comment:delete",A,e,t)}emitFlashcardChanged(){this.events.trigger("flashcard:changed")}on(A,e){return this.events.on(A,e)}off(A,e){this.events.off(A,e)}};var PA=class PA{constructor(A){this.app=A}getOrCreateBlockId(A,e){let t=A.getLine(e),i=t.match(PA.BLOCK_ID_REGEX);if(i)return i[1];let o="";for(let c=0;c<7;c++)o+=PA.BLOCK_ID_CHARS.charAt(Math.floor(Math.random()*PA.BLOCK_ID_CHARS.length));let l=t.trimEnd();return A.setLine(e,`${l} ^${o}`),o}extractBlockId(A){let e=A.match(PA.BLOCK_ID_REGEX);return e?e[1]:void 0}getParagraphBlockId(A,e){let t=this.app.metadataCache.getFileCache(A);if(!(t!=null&&t.sections))return;let i=t.sections.find(o=>o.position.start.offset<=e&&o.position.end.offset>=e);return i!=null&&i.id?`${A.path}#^${i.id}`:void 0}async createParagraphBlockId(A,e,t){let i=this.getParagraphBlockId(A,e);if(i)return i;let o=this.app.workspace.getLeaf();await o.openFile(A,{active:!1});let c=o.view.editor,g=c.offsetToPos(e).line,u=this.app.metadataCache.getFileCache(A);if(u!=null&&u.sections){let w=t||e,F=u.sections.find(E=>E.position.start.offset<=w&&E.position.end.offset>=w);F&&(g=c.offsetToPos(F.position.end.offset).line,console.debug(`[BlockIdService] \u627E\u5230\u5305\u542B\u9AD8\u4EAE\u7684\u6BB5\u843D\uFF0C\u7ED3\u675F\u884C: ${g}`))}let m=this.getOrCreateBlockId(c,g);return await this.app.vault.modify(A,c.getValue()),`${A.path}#^${m}`}hasValidBlockId(A){return PA.BLOCK_ID_REGEX.test(A)}};PA.BLOCK_ID_REGEX=/\^([a-zA-Z0-9-]+)$/,PA.BLOCK_ID_CHARS="abcdefghijklmnopqrstuvwxyz0123456789";var Mt=PA;var Hs=class Hs{constructor(A){this.app=A;this.fileIndex={wordToFiles:new Map,fileToHighlights:new Map,lastUpdated:0};this.isIndexing=!1;let e=A.plugins,t=e&&e.plugins?e.plugins["hi-note"]:void 0;this.settings=t==null?void 0:t.settings,this.colorExtractor=new pi,this.eventManager=new et(A),this.blockIdService=new Mt(A)}async initialize(){this.registerFileEventHandlers(),setTimeout(()=>{this.buildFileIndex().then(()=>{})},3e3)}destroy(){this.unregisterFileEventHandlers(),this.fileIndex={wordToFiles:new Map,fileToHighlights:new Map,lastUpdated:0}}registerFileEventHandlers(){this.fileCreateEventRef=this.app.vault.on("create",A=>{A instanceof fi.TFile&&A.extension==="md"&&this.updateFileInIndex(A)}),this.fileModifyEventRef=this.app.vault.on("modify",A=>{A instanceof fi.TFile&&A.extension==="md"&&this.updateFileInIndex(A)}),this.fileDeleteEventRef=this.app.vault.on("delete",A=>{A instanceof fi.TFile&&A.extension==="md"&&this.removeFileFromIndex(A.path)}),this.fileRenameEventRef=this.app.vault.on("rename",(A,e)=>{A instanceof fi.TFile&&A.extension==="md"&&(this.removeFileFromIndex(e),this.updateFileInIndex(A))})}unregisterFileEventHandlers(){this.app.vault.offref(this.fileCreateEventRef),this.app.vault.offref(this.fileModifyEventRef),this.app.vault.offref(this.fileDeleteEventRef),this.app.vault.offref(this.fileRenameEventRef)}shouldProcessFile(A){var e;return!Is.shouldExclude(A,((e=this.settings)==null?void 0:e.excludePatterns)||"")}extractHighlights(A,e){var i;let t=[];if(this.settings.useCustomPattern&&((i=this.settings.regexRules)==null?void 0:i.length)>0)for(let o of this.settings.regexRules.filter(l=>l.enabled))try{let l=new RegExp(o.pattern,"g");this.processRegexMatches(A,l,t,e,o.color)}catch(l){console.error(`[HighlightService] \u6B63\u5219\u89C4\u5219 "${o.name}" \u9519\u8BEF:`,l)}else this.processRegexMatches(A,Hs.DEFAULT_HIGHLIGHT_PATTERN,t,e,"#ffeb3b");return t.sort((o,l)=>{var c,h;return((c=o.position)!=null?c:0)-((h=l.position)!=null?h:0)})}processRegexMatches(A,e,t,i,o){let l=[];if(i){let g=this.app.metadataCache.getFileCache(i);g!=null&&g.sections&&(l=g.sections.filter(m=>["code","codeblock","fenced_code","pre"].includes(m.type)).map(m=>[m.position.start.offset,m.position.end.offset]))}function c(g,u,m){return m.some(([w,F])=>Math.max(g,w)<Math.min(u,F))}let h;for(;(h=e.exec(A))!==null;){let g=h,u=g[0],m=g.index,w=m+u.length;if(c(m,w,l))continue;let F=g.slice(1).find(H=>H!==void 0);F||(F=u);let E=null;if(u.includes("style=")&&(E=this.colorExtractor.extractColorFromElement(u)),!t.some(H=>typeof H.position=="number"&&Math.abs(H.position-g.index)<10&&H.text===F)&&F&&i){let H=this.app.metadataCache.getFileCache(i);if(H!=null&&H.sections){let x=H.sections.find(O=>O.position.start.offset<=g.index&&O.position.end.offset>=g.index),P=x==null?void 0:x.id;if(!P){let O=this.blockIdService.getParagraphBlockId(i,g.index);if(O){let J=O.match(/#\^([a-zA-Z0-9-]+)/);J&&J[1]&&(P=J[1])}}let M=/\{\{([^{}]+)\}\}/.test(F),D={text:F,position:g.index,paragraphOffset:this.getParagraphOffset(A,g.index),backgroundColor:E||o,id:`highlight-${Date.now()}-${g.index}`,comments:[],createdAt:Date.now(),updatedAt:Date.now(),originalLength:u.length,blockId:P,isCloze:M,filePath:i.path};t.push(D)}}}}getParagraphOffset(A,e){let t=A.substring(0,e),i=t.split(/\n\s*\n/);return t.length-i[i.length-1].length}async getFilesWithHighlights(){let A=this.app.vault.getMarkdownFiles(),e=[],t=0;for(let i of A){if(!this.shouldProcessFile(i))continue;let o=await this.app.vault.read(i),l=this.extractHighlights(o,i);l.length>0&&(e.push(i),t+=l.length)}return e}async getAllHighlights(){let A=this.app.vault.getMarkdownFiles(),e=[];for(let t of A){if(!this.shouldProcessFile(t))continue;let i=await this.app.vault.read(t),o=this.extractHighlights(i,t);o.length>0&&e.push({file:t,highlights:o})}return e}async buildFileIndex(){var e,t;if(this.isIndexing)return;this.isIndexing=!0;let A=Date.now();try{let i=await this.getAllHighlights(),o=new Map,l=new Map;for(let{file:c,highlights:h}of i){let g=h.map(m=>({...m,fileName:c.basename,filePath:c.path}));l.set(c.path,g);let u=new Set;for(let m of h){let w=this.tokenizeText(m.text);for(let F of w)u.add(F);if((e=m.comments)!=null&&e.length)for(let F of m.comments){let E=this.tokenizeText(F.content);for(let Q of E)u.add(Q)}}for(let m of u)o.has(m)||o.set(m,new Set),(t=o.get(m))==null||t.add(c.path)}this.fileIndex={wordToFiles:o,fileToHighlights:l,lastUpdated:Date.now()}}catch(i){console.error("\u6784\u5EFA\u7D22\u5F15\u65F6\u51FA\u9519:",i)}finally{this.isIndexing=!1}}tokenizeText(A){return A?A.toLowerCase().split(/\s+/).filter(t=>t.length>=2).map(t=>t.replace(/[.,;:!?()\[\]{}'"`~]/g,"")).filter(t=>t.length>=2):[]}removeFileFromIndex(A){if(!(this.fileIndex.lastUpdated===0||Date.now()-this.fileIndex.lastUpdated>36e5))try{if(this.fileIndex.fileToHighlights.has(A)){for(let[e,t]of this.fileIndex.wordToFiles.entries())t.delete(A),t.size===0&&this.fileIndex.wordToFiles.delete(e);this.fileIndex.fileToHighlights.delete(A)}}catch(e){console.error(`[HighlightService] \u79FB\u9664\u6587\u4EF6 ${A} \u7D22\u5F15\u65F6\u51FA\u9519:`,e)}}async updateFileInIndex(A){var e,t;if(!(this.fileIndex.lastUpdated===0||Date.now()-this.fileIndex.lastUpdated>36e5))try{if(this.removeFileFromIndex(A.path),this.shouldProcessFile(A)){let i=await this.app.vault.read(A),o=this.extractHighlights(i,A);if(o.length>0){let l=o.map(h=>({...h,fileName:A.basename,filePath:A.path}));this.fileIndex.fileToHighlights.set(A.path,l);let c=new Set;for(let h of o){let g=this.tokenizeText(h.text);for(let u of g)c.add(u);if((e=h.comments)!=null&&e.length)for(let u of h.comments){let m=this.tokenizeText(u.content);for(let w of m)c.add(w)}}for(let h of c)this.fileIndex.wordToFiles.has(h)||this.fileIndex.wordToFiles.set(h,new Set),(t=this.fileIndex.wordToFiles.get(h))==null||t.add(A.path)}}}catch(i){console.error(`\u66F4\u65B0\u6587\u4EF6 ${A.path} \u7684\u7D22\u5F15\u65F6\u51FA\u9519:`,i)}}async searchHighlightsFromIndex(A){var c;if((Date.now()-this.fileIndex.lastUpdated>36e5||this.fileIndex.fileToHighlights.size===0)&&await this.buildFileIndex(),!A.trim()){let h=[];for(let g of this.fileIndex.fileToHighlights.values())h.push(...g);return h}let t=this.tokenizeText(A);if(t.length===0){let h=[];for(let g of this.fileIndex.fileToHighlights.values())h.push(...g);return h}let i=[];for(let h of t){let g=new Set;for(let[u,m]of this.fileIndex.wordToFiles.entries())if(u.includes(h))for(let w of m)g.add(w);i.push(g)}let o;if(i.length>0){o=i[0];for(let h=1;h<i.length;h++)o=new Set([...o].filter(g=>i[h].has(g)))}else o=new Set;let l=[];for(let h of o){let g=this.fileIndex.fileToHighlights.get(h)||[];for(let u of g){let m=u.text.toLowerCase(),w=((c=u.comments)==null?void 0:c.map(E=>E.content.toLowerCase()))||[];t.every(E=>m.includes(E)||w.some(Q=>Q.includes(E)))&&l.push(u)}}return l}async createBlockIdForHighlight(A,e,t){try{let i=this.blockIdService.getParagraphBlockId(A,e);if(i)return i;let o=t?e+t:e;return await this.blockIdService.createParagraphBlockId(A,e,o)}catch(i){throw console.error("[HighlightService] Error creating block ID for highlight:",i),i}}};Hs.DEFAULT_HIGHLIGHT_PATTERN=/==\s*([\s\S]*?)\s*==|<mark[^>]*>([\s\S]*?)<\/mark>|<span[^>]*>([\s\S]*?)<\/span>/g;var cA=Hs;var mi=require("obsidian");var CA=class{constructor(A){this.app=A;this.SIMILARITY_THRESHOLD=.7;this.MAX_SEARCH_RANGE=5e3;this.POSITION_WEIGHT=.3;this.POSITION_TOLERANCE=100}levenshteinDistance(A,e){if(A===e)return 0;if(A.length===0)return e.length;if(e.length===0)return A.length;let t=[];for(let i=0;i<=A.length;i++)t[i]=[i];for(let i=0;i<=e.length;i++)t[0][i]=i;for(let i=1;i<=A.length;i++)for(let o=1;o<=e.length;o++)A[i-1]===e[o-1]?t[i][o]=t[i-1][o-1]:t[i][o]=Math.min(t[i-1][o-1]+1,t[i][o-1]+1,t[i-1][o]+1);return t[A.length][e.length]}calculateSimilarity(A,e){let t=this.levenshteinDistance(A,e),i=Math.max(A.length,e.length);return i===0?1:1-t/i}findBestMatch(A,e,t,i){if(A.length<10){if(t!==void 0&&t>=0){let F=Math.max(0,t-this.POSITION_TOLERANCE),E=Math.min(e.length,t+this.POSITION_TOLERANCE),H=e.substring(F,E).indexOf(A);if(H!==-1)return{text:A,position:F+H}}let w=e.indexOf(A);return w!==-1?{text:A,position:w}:null}let o=i||this.SIMILARITY_THRESHOLD,l=e,c=0;if(t!==void 0&&t>=0){let w=this.MAX_SEARCH_RANGE/2,F=Math.max(0,t-w),E=Math.min(e.length,t+w);l=e.substring(F,E),c=F}let h=this.extractPossibleMatches(l,A.length),g=null,u=0,m=-1;for(let w of h){let F=this.calculateSimilarity(A,w.text);if(F<o)continue;let E=1;if(t!==void 0&&t>=0){let x=w.position+c,P=Math.abs(x-t);E=Math.max(0,1-P/(this.POSITION_TOLERANCE*2))}let Q=F*(1-this.POSITION_WEIGHT)+E*this.POSITION_WEIGHT,H=F===1?F*.5+E*.5:Q;H>u&&(u=H,g=w.text,m=w.position)}return g&&m!==-1?{text:g,position:m+c}:null}extractPossibleMatches(A,e){let t=[],i=new Set,o=Math.max(3,Math.floor(e*.9)),l=Math.ceil(e*1.1);for(let g=o;g<=l;g++){let u=Math.max(1,Math.floor(g/4));for(let m=0;m<A.length-g+1;m+=u){let w=A.substring(m,m+g),F=`${m}:${w.length}`;i.has(F)||(t.push({text:w,position:m}),i.add(F))}}let c=A.split(/[.!?。！？;；:\n\r]+/),h=0;for(let g of c){let u=g.trim();if(u.length>=o&&u.length<=l*2&&(h=A.indexOf(u,h),h!==-1)){let m=`${h}:${u.length}`;i.has(m)||(t.push({text:u,position:h}),i.add(m)),h+=u.length}}return t}};var bs=class{constructor(A){this.app=A;this.textSimilarityService=new CA(A)}async jumpToHighlight(A,e){let t=await this.openOrActivateFile(e);t&&await this.locateAndHighlightText(t,A.text,A.position)}async openOrActivateFile(A){let t=this.app.workspace.getLeavesOfType("markdown").find(i=>{var l;return((l=i.view.file)==null?void 0:l.path)===A});if(!t)try{let i=this.app.vault.getAbstractFileByPath(A);if(!i)return new mi.Notice("\u672A\u627E\u5230\u6587\u4EF6"),null;t=await this.app.workspace.getLeaf("tab"),await t.openFile(i)}catch(i){return new mi.Notice("\u6253\u5F00\u6587\u4EF6\u5931\u8D25"),null}return await this.app.workspace.setActiveLeaf(t,{focus:!1}),t}async locateAndHighlightText(A,e,t){await new Promise(E=>setTimeout(E,300));let o=A.view.editor,l=o.getValue(),c=-1,h=[],g=e,u=0,m=-1;for(;(m=l.indexOf(e,u))!==-1;)h.push(m),u=m+1;if(t!==void 0&&t>=0){if(l.substring(t,t+e.length)===e)c=t;else if(h.length>0){let E=h[0],Q=Math.abs(t-E);for(let H of h){let x=Math.abs(t-H);x<Q&&(Q=x,E=H)}c=E}}if(c===-1)if(h.length>0)c=h[0];else{let E=this.textSimilarityService.findBestMatch(e,l,t);if(E)c=E.position,g=E.text,new mi.Notice("\u4F7F\u7528\u6A21\u7CCA\u5339\u914D\u627E\u5230\u4E86\u76F8\u4F3C\u5185\u5BB9");else{new mi.Notice("\u672A\u627E\u5230\u9AD8\u4EAE\u5185\u5BB9");return}}let w=o.offsetToPos(c),F=o.offsetToPos(c+g.length);o.setSelection(w,F),o.scrollIntoView({from:w,to:F},!0),this.app.workspace.setActiveLeaf(A,{focus:!0})}};var cn=require("obsidian");var Je=class{static generateHighlightId(A,e,t){let i=`${A}:${e}:${t}`,o=this.hashCode(i);return`highlight-${Math.abs(o)}-${e}`}static generateCommentId(){let A=Date.now(),e=Math.random().toString(36).substr(2,9);return`comment-${A}-${e}`}static generateCardId(){let A=Date.now(),e=Math.random().toString(36).substr(2,9);return`card-${A}-${e}`}static generateGroupId(){let A=Date.now(),e=Math.random().toString(36).substr(2,7);return`group-${A}-${e}`}static hashCode(A){let e=0;if(A.length===0)return e;for(let t=0;t<A.length;t++){let i=A.charCodeAt(t);e=(e<<5)-e+i,e=e&e}return e}static isValidHighlightId(A){return/^highlight-\d+-\d+$/.test(A)}static isValidCommentId(A){return/^comment-\d+-[a-z0-9]+$/.test(A)}static isValidCardId(A){return/^card-\d+-[a-z0-9]+$/.test(A)}static extractPositionFromHighlightId(A){let e=A.match(/^highlight-\d+-(\d+)$/);return e?parseInt(e[1],10):null}};var xs=class{constructor(A,e){this.app=A;this.commentStore=e;this.highlightService=new cA(A)}async exportHighlightsAsMarkdown(A){var m,w,F,E;if(!A||A.length===0)return null;let e=this.app.plugins,t=e&&e.plugins?e.plugins["hi-note"]:void 0,i={};for(let Q of A)Q.filePath&&(i[Q.filePath]||(i[Q.filePath]=[]),i[Q.filePath].push(Q));let o=[];for(let Q in i){let H=this.app.vault.getAbstractFileByPath(Q);if(!(H instanceof cn.TFile))continue;o.push(`## ${H.basename}`),o.push("");let x=i[Q],P=(w=(m=t==null?void 0:t.settings)==null?void 0:m.export)==null?void 0:w.exportTemplate;if(P&&P.trim()!==""){let M=await this.generateContentFromTemplate(H,x,P);M.trim()!==""&&o.push(M)}else{let M=await this.generateDefaultContent(H,x);o.push(M)}}let l=o.join(`
`),c=((E=(F=t==null?void 0:t.settings)==null?void 0:F.export)==null?void 0:E.exportPath)||"",h=`Selected Highlights ${window.moment().format("YYYYMMDDHHmm")}`,g=h;return c&&(this.app.vault.getAbstractFileByPath(c)||await this.app.vault.createFolder(c),g=`${c}/${h}`),await this.app.vault.create(`${g}.md`,l)}async generateContentForMultipleHighlights(A){let e=[];e.push(`# ${f("Selected Highlights")}`),e.push(""),e.push(`*${f("Exported on")} ${window.moment().format("YYYY-MM-DD HH:mm:ss")}*`),e.push("");let t={};for(let i of A)i.filePath&&(t[i.filePath]||(t[i.filePath]=[]),t[i.filePath].push(i));for(let i in t){let o=this.app.vault.getAbstractFileByPath(i);if(!(o instanceof cn.TFile))continue;e.push(`## ${o.basename}`),e.push("");let l=t[i];for(let c of l){if(e.push(`> ${c.text}`),e.push("> "),c.comments&&c.comments.length>0){e.push("> ---"),e.push("> ");for(let h of c.comments){e.push(">> [!note] Comment");let g=h.content.split(`
`).map(u=>(u=u.trim(),u?`>> ${u}`:">>")).join(`
`);if(e.push(g),h.updatedAt){let u=window.moment(h.updatedAt);e.push(`>> *${u.format("YYYY-MM-DD HH:mm:ss")}*`)}e.push(">")}}e.push("")}}return e.join(`
`)}async exportHighlightsToNote(A){var u,m;let e=await this.getFileHighlights(A);if(!e||e.length===0)throw new Error(f("No highlights found in the current file."));let t=await this.generateExportContent(A,e),i=this.app.plugins,o=i&&i.plugins?i.plugins["hi-note"]:void 0,l=((m=(u=o==null?void 0:o.settings)==null?void 0:u.export)==null?void 0:m.exportPath)||"",c=`${A.basename} - HiNote ${window.moment().format("YYYYMMDDHHmm")}`,h=c;return l&&(this.app.vault.getAbstractFileByPath(l)||await this.app.vault.createFolder(l),h=`${l}/${c}`),await this.app.vault.create(`${h}.md`,t)}async getFileHighlights(A){let e=await this.app.vault.read(A),t=this.highlightService.extractHighlights(e,A),i=this.commentStore.getFileComments(A),o=i.filter(h=>h.isVirtual&&h.comments&&h.comments.length>0),l=i.filter(h=>!h.isVirtual),c=t.map(h=>{var u,m,w,F;let g=l.find(E=>{let Q=E.text===h.text;return Q&&typeof E.position=="number"&&typeof h.position=="number"?Math.abs(E.position-h.position)<1e3:Q});return g?{...g,position:(u=h.position)!=null?u:0,paragraphOffset:(m=h.paragraphOffset)!=null?m:0}:{id:Je.generateHighlightId(A.path,h.position||0,h.text),...h,position:(w=h.position)!=null?w:0,paragraphOffset:(F=h.paragraphOffset)!=null?F:0,comments:[],createdAt:Date.now(),updatedAt:Date.now()}});return[...o,...c]}async generateExportContent(A,e){var l,c;let t=this.app.plugins,i=t&&t.plugins?t.plugins["hi-note"]:void 0,o=(c=(l=i==null?void 0:i.settings)==null?void 0:l.export)==null?void 0:c.exportTemplate;return o&&o.trim()!==""?this.generateContentFromTemplate(A,e,o):this.generateDefaultContent(A,e)}async generateContentFromTemplate(A,e,t){let i=[];for(let o of e){let l=await this.generateStructuredContent(o,A,t);i.push(...l),i.push("")}return i.join(`
`)}replaceVariables(A,e){let t=A;for(let[i,o]of Object.entries(e))t=t.replace(new RegExp(`{{${i}}}`,"g"),o||"");return t}formatComment(A,e=!1){let t=[],i=e?">":">>";if(!e){let l=A.updatedAt?window.moment(A.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"";t.push(`>> [!note]+ ${l}`)}let o=A.content.split(`
`).map(l=>(l=l.trim(),l?`${i} ${l}`:i)).join(`
`);return t.push(o),t.push(">"),t}async generateStructuredContent(A,e,t){let i=[];if(A.isVirtual)i.push(`> [!note] [[${e.basename}]]`),i.push("> ");else if(t&&(t.includes("{{highlightText}}")||t.includes("{{highlightBlockRef}}"))){let o=this.extractHighlightTemplate(t),l="";if(typeof A.position=="number"&&t.includes("{{highlightBlockRef}}"))try{let h=A.originalLength||A.text.length;l=await this.highlightService.createBlockIdForHighlight(e,A.position,h)||""}catch(h){console.error("[ExportService] Error creating block ID:",h)}let c=this.replaceVariables(o,{sourceFile:e.basename,highlightText:A.text||"",highlightBlockRef:l,highlightType:"HiNote",commentContent:"",commentDate:""});i.push(...c.split(`
`))}else i.push("> [!quote] HiNote"),i.push(`> ${A.text||""}`),i.push("> ");if(A.comments&&A.comments.length>0)for(let o of A.comments)i.push(...this.formatComment(o,A.isVirtual));return i}extractHighlightTemplate(A){let e=A,t=/\n>>\s*\[!note\]\+[\s\S]*?(?=\n>\s*$|\n\s*$|$)/g;return e=e.replace(t,""),e=e.replace(/\{\{commentContent\}\}/g,""),e=e.replace(/\{\{commentDate\}\}/g,""),e=e.replace(/\n{3,}/g,`

`),e=e.replace(/\n>\s*\n\s*$/g,`
`),e.trim()}async generateDefaultContent(A,e){return this.generateContentFromTemplate(A,e,`> [!quote] HiNote
> {{highlightText}}
> 
>> [!note]+ {{commentDate}}
>> {{commentContent}}`)}getParagraphOffset(A,e){let i=A.substring(0,e).lastIndexOf(`
`);return i===-1?e:e-i}generateHighlightId(A,e){return Je.generateHighlightId(e,A.position||0,A.text)}};var IA=require("obsidian");var cu=/#[\w\u4e00-\u9fa5]+/g,hu=/^\s*(#[\w\u4e00-\u9fa5]+(\s+#[\w\u4e00-\u9fa5]+)*\s*)$/,Ms=class{constructor(A,e,t,i,o){this.card=A;this.highlight=e;this.existingComment=t;this.plugin=i;this.options=o;this.cancelEdit=()=>{};this.isProcessing=!1;this.isAIProcessing=!1;this.originalContent="";if(this.boundHandleOutsideClick=this.handleOutsideClick.bind(this),document.addEventListener("click",this.boundHandleOutsideClick),this.findHighlightCardInstance()){let c=new CustomEvent("comment-input-shown",{detail:{highlightId:this.highlight.id}});document.dispatchEvent(c)}}findHighlightCardInstance(){var A,e;try{return(e=(A=window.HighlightCard)==null?void 0:A.findCardInstanceByHighlightId)==null?void 0:e.call(A,this.highlight.id)}catch(t){return null}}show(){this.existingComment?this.showEditMode():this.showCreateMode()}showEditMode(){var o;let A=this.card.querySelector(`[data-comment-id="${this.existingComment.id}"]`);if(!A)return;let e=A.querySelector(".hi-note-content");if(!e)return;let t=((o=this.existingComment)==null?void 0:o.content)||"";this.textarea=document.createElement("textarea"),this.textarea.value=t,this.textarea.className="hi-note-input",this.textarea.style.minHeight=`${e.offsetHeight}px`,this.textarea.addEventListener("input",()=>{this.processTagsInInput(),this.autoResizeTextarea()}),this.textarea.addEventListener("click",l=>{l.stopPropagation()}),e.replaceWith(this.textarea);let i=A.querySelector(".hi-note-footer");if(i&&i.addClass("hi-note-hidden"),this.actionHint=A.createEl("div",{cls:"hi-note-actions-hint"}),this.actionHint.addEventListener("click",l=>{l.stopPropagation()}),!IA.Platform.isMobile)this.actionHint.createEl("span",{cls:"hi-note-hint",text:f("Tab AI, Shift + Enter Wrap, Enter Save")});else{let l=this.actionHint.createEl("button",{cls:"hi-note-save-button",text:f("Submit")});l.addEventListener("click",async c=>{if(c.stopPropagation(),this.isProcessing)return;let h=this.textarea.value.trim();if(h){this.isProcessing=!0,this.textarea.disabled=!0,l.disabled=!0;try{await this.options.onSave(h),requestAnimationFrame(()=>{document.removeEventListener("click",this.boundHandleOutsideClick),this.isProcessing=!1,this.textarea.disabled=!1})}catch(g){this.isProcessing=!1,this.textarea.disabled=!1,l.disabled=!1}}})}this.options.onDelete&&this.actionHint.createEl("div",{cls:"hi-note-delete-link",text:f("Delete comment")}).addEventListener("click",async c=>{var h,g;c.stopPropagation(),await((g=(h=this.options).onDelete)==null?void 0:g.call(h))}),this.setupKeyboardEvents(e,i||void 0),setTimeout(()=>{this.textarea.focus(),this.textarea.setSelectionRange(this.textarea.value.length,this.textarea.value.length)},50)}showCreateMode(){let A=document.createElement("div");A.className="hi-note-input",this.textarea=A.createEl("textarea"),this.textarea.addEventListener("input",()=>{this.processTagsInInput(),this.autoResizeTextarea()}),A.addEventListener("click",i=>{i.stopPropagation()}),this.textarea.addEventListener("click",i=>{i.stopPropagation()});let e=this.card.querySelector(".hi-notes-section");e||(e=this.card.createEl("div",{cls:"hi-notes-section"}),e.createEl("div",{cls:"hi-notes-list"}));let t=e.querySelector(".hi-notes-list");if(t&&t.insertBefore(A,t.firstChild),this.actionHint=A.createEl("div",{cls:"hi-note-actions-hint"}),this.actionHint.addEventListener("click",i=>{i.stopPropagation()}),!IA.Platform.isMobile)this.actionHint.createEl("span",{cls:"hi-note-hint",text:f("Tab AI, Shift + Enter Wrap, Enter Save")});else{let i=this.actionHint.createEl("button",{cls:"hi-note-save-button",text:f("Submit")});i.addEventListener("click",async o=>{if(o.stopPropagation(),this.isProcessing)return;let l=this.textarea.value.trim();if(l){this.isProcessing=!0,this.textarea.disabled=!0,i.disabled=!0;try{await this.options.onSave(l),requestAnimationFrame(()=>{this.destroy(),this.isProcessing=!1})}catch(c){this.isProcessing=!1,this.textarea.disabled=!1,i.disabled=!1}}})}this.setupKeyboardEvents(),setTimeout(()=>{this.textarea.focus()},50)}setupKeyboardEvents(A,e){this.cancelEdit=()=>{this.existingComment?A&&e&&requestAnimationFrame(()=>{this.textarea.replaceWith(A),this.actionHint.remove(),e.removeClass("hi-note-hidden"),document.removeEventListener("click",this.boundHandleOutsideClick)}):requestAnimationFrame(()=>{var t,i;(t=this.textarea.closest(".hi-note-input"))==null||t.remove(),this.card.querySelector(".hi-note")||(i=this.card.querySelector(".hi-notes-section"))==null||i.remove(),document.removeEventListener("click",this.boundHandleOutsideClick)}),this.options.onCancel()},this.textarea.onkeydown=async t=>{if(t.key==="Tab"){t.preventDefault(),await this.handleInlineAI();return}if(t.key==="Enter"){if(IA.Platform.isMobile)return;if(t.shiftKey||(t.preventDefault(),this.isProcessing))return;let i=this.textarea.value.trim();if(!i)return;this.isProcessing=!0,this.textarea.disabled=!0;try{await this.options.onSave(i),requestAnimationFrame(()=>{document.removeEventListener("click",this.boundHandleOutsideClick),this.isProcessing=!1,this.textarea.disabled=!1})}catch(o){this.textarea.disabled=!1,this.isProcessing=!1}}}}autoResizeTextarea(){if(!this.textarea)return;let A=window.pageYOffset||document.documentElement.scrollTop;this.textarea.style.height="auto";let e=this.textarea.scrollHeight;this.textarea.style.height=`${e}px`,window.scrollTo(0,A)}processTagsInInput(){var e,t,i,o;let A=this.textarea.value;if(hu.test(A)){let l=A.match(cu)||[];if(l.length>0){let c=(e=this.textarea.parentElement)==null?void 0:e.querySelector(".highlight-tags-preview");if(c||(c=document.createElement("div"),c.className="highlight-tags-preview",(t=this.textarea.parentElement)==null||t.insertBefore(c,this.textarea)),c){for(;c.firstChild;)c.removeChild(c.firstChild);let h=c;l.forEach(g=>{let u=document.createElement("span");u.className="highlight-tag",u.textContent=g,h.appendChild(u)})}}}else(o=(i=this.textarea.parentElement)==null?void 0:i.querySelector(".highlight-tags-preview"))==null||o.remove()}handleOutsideClick(A){if(!this.textarea||this.isProcessing)return;let e=A.target;if(!this.textarea.contains(e)&&!e.closest(".hi-note-actions-hint")){this.isProcessing=!0;let i=this.textarea.value.trim();if(i){A.preventDefault(),A.stopPropagation();let o=i;this.textarea.disabled=!0,this.options.onSave(o).then(()=>{requestAnimationFrame(()=>{this.destroy(),this.isProcessing=!1})}).catch(()=>{this.textarea.disabled=!1,this.isProcessing=!1})}else requestAnimationFrame(()=>{this.cancelEdit(),this.destroy(),this.isProcessing=!1})}}async handleInlineAI(){var e;let A=this.textarea.value.trim();if(!A){new IA.Notice(f("Please enter AI instruction"));return}if(!this.isAIProcessing){this.originalContent=A;try{this.setAILoading(!0);let t=this.highlight.text||"",i=`${A}

\u9AD8\u4EAE\u6587\u672C\uFF1A${t}`,l=await new ZA(this.plugin.settings.ai).generateResponse(i,t,((e=this.existingComment)==null?void 0:e.content)||"");this.textarea.value=l,this.autoResizeTextarea(),new IA.Notice(f("AI response generated"))}catch(t){console.error("AI\u5185\u8054\u751F\u6210\u5931\u8D25:",t),this.textarea.value=this.originalContent,new IA.Notice(f(`AI generation failed: ${t.message}`))}finally{this.setAILoading(!1)}}}setAILoading(A){if(this.isAIProcessing=A,A){if(this.textarea.disabled=!0,this.textarea.style.opacity="0.6",this.actionHint&&!this.actionHint.querySelector(".ai-loading-hint")){let i=this.actionHint.createEl("span",{cls:"ai-loading-hint"}).createEl("span",{cls:"ai-loading-icon"});(0,IA.setIcon)(i,"loader")}}else if(this.textarea.disabled=!1,this.textarea.style.opacity="1",this.actionHint){let e=this.actionHint.querySelector(".ai-loading-hint");e&&e.remove()}}destroy(){document.removeEventListener("click",this.boundHandleOutsideClick),this.isProcessing=!1;let A=new CustomEvent("comment-input-closed",{detail:{highlightId:this.highlight.id}});document.dispatchEvent(A)}};var de=require("obsidian");var Po=require("obsidian");var Ls=class{constructor(A){this.plugin=A;this.aiService=new ZA(this.plugin.settings.ai)}updateModel(A,e){this.aiService&&this.aiService.updateModel(A,e)}async sendMessage(A,e=[]){try{let t=e.map(o=>({role:o.role,content:o.content}));return t.push({role:"user",content:A}),{content:await this.aiService.chat(t),type:"assistant",timestamp:Date.now()}}catch(t){throw new Po.Notice("\u83B7\u53D6 AI \u54CD\u5E94\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u670D\u52A1\u914D\u7F6E\u548C\u7F51\u7EDC\u8FDE\u63A5"),t}}async testConnection(){return await this.aiService.testConnection()}};var Ko=require("obsidian"),Ts=class{constructor(A){this.app=A}async getContextForHighlight(A,e={strategy:"paragraph",includeTitle:!0,maxLength:2e3}){if(!A.filePath)return null;let t=this.app.vault.getAbstractFileByPath(A.filePath);if(!t||!(t instanceof Ko.TFile))return null;let i=await this.app.vault.read(t),o=this.app.metadataCache.getFileCache(t);switch(e.strategy){case"paragraph":return this.getParagraphContext(i,A,t,o,e);case"section":return this.getSectionContext(i,A,t,o,e);case"surrounding":return this.getSurroundingContext(i,A,t,e);case"smart":return this.getSmartContext(i,A,t,o,e);default:return this.getParagraphContext(i,A,t,o,e)}}getParagraphContext(A,e,t,i,o){let l=A.split(`
`),c=e.text,h=-1;for(let Q=0;Q<l.length;Q++)if(l[Q].includes(c)){h=Q;break}if(h===-1)return this.createContextInfo("","",t,A);let g=h,u=h;for(;g>0&&l[g-1].trim()!=="";)g--;for(;u<l.length-1&&l[u+1].trim()!=="";)u++;let m=l.slice(g,h).join(`
`),w=l.slice(h+1,u+1).join(`
`),F=l.slice(g,u+1).join(`
`),E=this.findSectionTitle(l,h);return this.createContextInfo(m,w,t,F,E,o.maxLength)}getSectionContext(A,e,t,i,o){if(!(i!=null&&i.sections))return this.getParagraphContext(A,e,t,i,o);let l=A.split(`
`),c=e.text,h=A.indexOf(c);if(h===-1)return this.createContextInfo("","",t,A);let g=i.sections.find(E=>E.position.start.offset<=h&&E.position.end.offset>=h);if(!g)return this.getParagraphContext(A,e,t,i,o);let u=A.substring(g.position.start.offset,g.position.end.offset),m=A.substring(g.position.start.offset,h),w=A.substring(h+c.length,g.position.end.offset),F=this.findSectionTitle(l,this.getLineFromOffset(A,h));return this.createContextInfo(m,w,t,u,F,o.maxLength)}getSurroundingContext(A,e,t,i){let o=A.split(`
`),l=e.text,c=i.surroundingLines||3,h=-1;for(let Q=0;Q<o.length;Q++)if(o[Q].includes(l)){h=Q;break}if(h===-1)return this.createContextInfo("","",t,A);let g=Math.max(0,h-c),u=Math.min(o.length-1,h+c),m=o.slice(g,h).join(`
`),w=o.slice(h+1,u+1).join(`
`),F=o.slice(g,u+1).join(`
`),E=this.findSectionTitle(o,h);return this.createContextInfo(m,w,t,F,E,i.maxLength)}getSmartContext(A,e,t,i,o){let l=this.getSectionContext(A,e,t,i,o);return l.fullContext.length>(o.maxLength||2e3)?this.getParagraphContext(A,e,t,i,o):l}findSectionTitle(A,e){for(let t=e;t>=0;t--){let i=A[t].trim();if(i.startsWith("#"))return i}}getLineFromOffset(A,e){return A.substring(0,e).split(`
`).length-1}createContextInfo(A,e,t,i,o,l){let c=i;if(l&&i.length>l){let h=Math.floor(l/2),g=i.substring(0,h),u=i.substring(i.length-h);c=`${g}

... [\u5185\u5BB9\u5DF2\u622A\u65AD] ...

${u}`}return{beforeContext:A,afterContext:e,sectionTitle:o,filePath:t.path,fileName:t.name,fullContext:c}}async getContextForMultipleHighlights(A,e={strategy:"paragraph"}){let t=[];for(let i of A){let o=await this.getContextForHighlight(i,e);o&&t.push(o)}return t}};var qe=class qe extends de.Component{constructor(e,t){var M,D,O,J,se;super();this.plugin=t;this.isProcessing=!1;this.draggedContents=[];this.chatHistory=[];this.currentPreviewContainer=null;this.textarea=null;this.chatModelState={provider:"",model:""};if(qe.instance)return qe.instance;this.app=e,this.chatService=new Ls(this.plugin),this.contextService=new Ts(e),this.contextOptions={strategy:((M=this.plugin.settings.contextOptions)==null?void 0:M.strategy)||"smart",includeTitle:(O=(D=this.plugin.settings.contextOptions)==null?void 0:D.includeTitle)!=null?O:!0,maxLength:((J=this.plugin.settings.contextOptions)==null?void 0:J.maxLength)||2e3,surroundingLines:((se=this.plugin.settings.contextOptions)==null?void 0:se.surroundingLines)||3},this.floatingButton=document.querySelector(".highlight-floating-button"),this.containerEl=document.createElement("div"),this.containerEl.addClass("highlight-chat-window");let i=this.containerEl.createEl("div",{cls:"highlight-chat-header"}),o=i.createEl("div",{cls:"highlight-chat-title"});o.createEl("span",{text:f("Chat")});let l=o.createEl("div",{cls:"highlight-chat-model",text:this.getCurrentModelName()});l.addEventListener("click",W=>{W.stopPropagation(),this.showModelSelector(l,W)});let c=i.createEl("div",{cls:"highlight-chat-buttons"}),h=c.createEl("div",{cls:"highlight-chat-clear"});(0,de.setIcon)(h,"eraser"),h.addEventListener("click",()=>this.clearChat());let g=c.createEl("div",{cls:"highlight-chat-close"});(0,de.setIcon)(g,"x"),g.addEventListener("click",()=>this.close());let u=this.containerEl.createEl("div",{cls:"highlight-chat-history"}),m=this.containerEl.createEl("div",{cls:"highlight-chat-input-container"});this.setupChatInput(m);let w=this.containerEl.createEl("div",{cls:"highlight-chat-resize-handle"});this.setupResizeHandle(w);let F={text:"",position:0,paragraphOffset:0,paragraphId:"chat",createdAt:Date.now(),updatedAt:Date.now()};u.addEventListener("dragenter",W=>{W.preventDefault(),u.addClass("drag-over")}),u.addEventListener("dragover",W=>{W.preventDefault(),W.stopPropagation(),u.addClass("drag-over");let ce=u.getBoundingClientRect(),we=u.scrollTop,Ae=ce.height;u.addClass("highlight-chat-history-drag-guide"),u.style.setProperty("--drag-guide-top",`${we+12}px`),u.style.setProperty("--drag-guide-height",`${Ae-24}px`);let z=document.querySelector(".highlight-dragging");z&&(z.addClass("highlight-chat-preview"),z.style.left=`${W.clientX+10}px`,z.style.top=`${W.clientY+10}px`)}),u.addEventListener("dragleave",W=>{u.contains(W.relatedTarget)||u.removeClass("drag-over")}),u.addEventListener("drop",async W=>{var we;W.preventDefault(),u.removeClass("drag-over");let ce=(we=W.dataTransfer)==null?void 0:we.getData("application/highlight");if(ce)try{let Ae=JSON.parse(ce);if(!Ae.text)return;this.draggedContents.some(Le=>Le.text===Ae.text)||(this.draggedContents.push(Ae),this.showDraggedPreviewsInChat(u))}catch(Ae){}});let E=!1,Q,H,x,P;if(i.addEventListener("mousedown",W=>{W.target===g||W.target===h||(E=!0,x=W.clientX-this.containerEl.offsetLeft,P=W.clientY-this.containerEl.offsetTop,i.addClass("dragging"))}),document.addEventListener("mousemove",W=>{if(!E)return;W.preventDefault(),Q=W.clientX-x,H=W.clientY-P;let ce=window.innerWidth-this.containerEl.offsetWidth,we=window.innerHeight-this.containerEl.offsetHeight;Q=Math.max(0,Math.min(Q,ce)),H=Math.max(0,Math.min(H,we)),this.containerEl.addClass("highlight-chat-window"),this.containerEl.style.left=`${Q}px`,this.containerEl.style.top=`${H}px`}),document.addEventListener("mouseup",()=>{E=!1,i.removeClass("dragging")}),qe.savedState){this.chatHistory=qe.savedState.chatHistory,this.draggedContents=qe.savedState.draggedContents;let W=this.containerEl.querySelector(".highlight-chat-history");if(W){for(;W.firstChild;)W.removeChild(W.firstChild);this.chatHistory.forEach(ce=>{this.addMessage(W,ce.content,ce.role,!1)}),this.draggedContents.length>0&&this.showDraggedPreviewsInChat(W),qe.savedState.currentPreviewContainer&&(this.currentPreviewContainer=W.querySelector(".highlight-chat-preview-cards"))}}qe.instance=this}async saveContextOptions(){this.plugin.settings.contextOptions||(this.plugin.settings.contextOptions={}),this.plugin.settings.contextOptions.strategy=this.contextOptions.strategy,this.plugin.settings.contextOptions.includeTitle=this.contextOptions.includeTitle,this.plugin.settings.contextOptions.maxLength=this.contextOptions.maxLength,this.plugin.settings.contextOptions.surroundingLines=this.contextOptions.surroundingLines,await this.plugin.saveSettings()}showDraggedPreviewsInChat(e){var c;if(!this.currentPreviewContainer){let g=e.createEl("div",{cls:"highlight-chat-message highlight-chat-message-preview"}).createEl("div",{cls:"highlight-chat-previews"}),u=g.createEl("div",{cls:"highlight-chat-preview-header"}),m=u.createEl("div",{cls:"highlight-chat-preview-header-left"});m.createEl("span",{cls:"highlight-chat-preview-count",text:String(this.draggedContents.length)}),m.createSpan({text:f("highlighted notes")});let F=u.createEl("div",{cls:"highlight-chat-preview-header-right"}).createEl("div",{cls:"highlight-chat-preview-btn",attr:{title:"Preview"}});(0,de.setIcon)(F,"eye"),F.addEventListener("click",()=>{this.showContextPreviewWithSettings()});let E=g.createEl("div",{cls:"highlight-chat-preview-cards"});this.currentPreviewContainer=E}let t=this.currentPreviewContainer.createEl("div",{cls:"highlight-chat-preview-card"}),i=this.draggedContents[this.draggedContents.length-1];t.createEl("div",{cls:"highlight-chat-preview-content",text:i.text});let o=t.createEl("div",{cls:"highlight-chat-preview-delete"});(0,de.setIcon)(o,"x"),o.addEventListener("click",()=>{var g;let h=this.draggedContents.indexOf(i);if(h>-1)if(this.draggedContents.splice(h,1),t.remove(),this.draggedContents.length===0){let u=(g=this.currentPreviewContainer)==null?void 0:g.closest(".highlight-chat-message-preview");u&&(u.remove(),this.currentPreviewContainer=null)}else this.updatePreviewCount()});let l=(c=this.currentPreviewContainer.closest(".highlight-chat-message-preview"))==null?void 0:c.querySelector(".highlight-chat-preview-count");l&&(l.textContent=String(this.draggedContents.length)),e.scrollTop=e.scrollHeight}show(){document.body.contains(this.containerEl)?this.containerEl.removeClass("highlight-chat-hidden"):(this.containerEl.addClass("highlight-chat-window"),this.containerEl.addClass("highlight-chat-window-position"),document.body.appendChild(this.containerEl)),document.querySelectorAll(".highlight-floating-button").forEach(e=>{e.style.display="none"}),requestAnimationFrame(()=>{var e;(e=this.textarea)==null||e.focus()})}close(){this.containerEl.addClass("highlight-chat-hidden"),document.querySelectorAll(".highlight-floating-button").forEach(e=>{e.style.display=""})}addMessage(e,t,i,o=!0){let l=e.createEl("div",{cls:"highlight-chat-message"}),c=l.createEl("div",{cls:"highlight-chat-message-content markdown-rendered"});l.addClass(`highlight-chat-message-${i}`),c.addClass(`highlight-chat-message-content-${i}`),i==="assistant"&&o?this.typeWriter(c,t):this.renderMarkdownContent(c,t),e.scrollTop=e.scrollHeight}async typeWriter(e,t,i=30){let o=0;e.textContent="";let l=e.createEl("span",{cls:"highlight-chat-cursor"}),c=()=>{o<t.length?(e.insertBefore(document.createTextNode(t.charAt(o)),l),o++,setTimeout(c,i)):(l.remove(),this.renderMarkdownContent(e,t))};c()}static getInstance(e,t){return qe.instance||(qe.instance=new qe(e,t)),qe.instance}async renderMarkdownContent(e,t){for(;e.firstChild;)e.removeChild(e.firstChild);try{await de.MarkdownRenderer.render(this.app,t,e,"",new de.Component),e.querySelectorAll("ul, ol").forEach(o=>{o.addClass("chat-markdown-list")})}catch(i){console.error("Error rendering markdown in chat:",i),e.textContent=t}}setupResizeHandle(e){let t=!1,i=0,o=0,l=0,c=0;e.addEventListener("mousedown",u=>{u.preventDefault(),u.stopPropagation(),t=!0,i=u.clientX,o=u.clientY;let m=this.containerEl.getBoundingClientRect();l=m.width,c=m.height,document.addEventListener("mousemove",h),document.addEventListener("mouseup",g),this.containerEl.addClass("resizing")});let h=u=>{if(!t)return;let m=u.clientX-i,w=u.clientY-o,F=Math.max(300,l+m),E=Math.max(300,c+w),Q=Math.min(F,window.innerWidth*.9),H=Math.min(E,window.innerHeight*.9);this.containerEl.style.width=`${Q}px`,this.containerEl.style.height=`${H}px`},g=()=>{t=!1,document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",g),this.containerEl.removeClass("resizing")}}setupChatInput(e){let t=e.createEl("div",{cls:"highlight-chat-input-wrapper"});this.textarea=t.createEl("textarea",{cls:"highlight-chat-input",attr:{placeholder:f("Input message..."),rows:"1"}});let i=()=>{this.textarea&&(this.textarea.addClass("highlight-chat-input"),this.textarea.style.height=`${Math.min(this.textarea.scrollHeight,150)}px`)};return this.textarea.addEventListener("input",()=>{i()}),this.textarea.addEventListener("keydown",o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),this.textarea&&this.handleSendMessage(this.textarea))}),this.textarea}async handleSendMessage(e){let t=e.value.trim();if(!(!t||this.isProcessing))try{this.isProcessing=!0;let i=t,o=t;if(this.draggedContents.length>0){let c=this.draggedContents.map(u=>this.contextService.getContextForHighlight(u,this.contextOptions)),g=(await Promise.all(c)).map((u,m)=>{let w=this.draggedContents[m];if(!u)return`**\u9AD8\u4EAE\u5185\u5BB9 ${m+1}:**
${w.text}`;let F=`**Highlight ${m+1}** (from: ${u.fileName}):
`;return u.sectionTitle&&(F+=`**Section:** ${u.sectionTitle}

`),u.beforeContext.trim()&&(F+=`**Before:**
${u.beforeContext.trim()}

`),F+=`**Highlight:**
${w.text}

`,u.afterContext.trim()&&(F+=`**After:**
${u.afterContext.trim()}`),F}).join(`

---

`);if(this.chatHistory.push({role:"user",content:`\u4EE5\u4E0B\u662F\u9700\u8981\u5206\u6790\u7684\u5185\u5BB9\uFF08\u5305\u542B\u4E0A\u4E0B\u6587\uFF09\uFF1A

${g}`}),i=t,o=`\u7528\u6237\u63D0\u793A\uFF1A${t}`,this.currentPreviewContainer){let u=this.currentPreviewContainer.closest(".highlight-chat-message-preview");u&&u.addClass("sent"),this.currentPreviewContainer=null,this.draggedContents=[]}}this.chatHistory.push({role:"user",content:o}),requestAnimationFrame(()=>{e.value="",e.addClass("highlight-chat-input"),e.dispatchEvent(new Event("input"))});let l=this.containerEl.querySelector(".highlight-chat-history");if(l){this.addMessage(l,t,"user",!0);let c=await this.chatService.sendMessage(i,this.chatHistory);this.chatHistory.push({role:"assistant",content:c.content}),this.addMessage(l,c.content,"assistant",!0)}}catch(i){console.error("\u53D1\u9001\u6D88\u606F\u65F6\u51FA\u9519:",i),new de.Notice("Failed to send message, please try again")}finally{this.isProcessing=!1}}updatePreviewCount(){if(this.currentPreviewContainer){let e=this.currentPreviewContainer.closest(".highlight-chat-message-preview"),t=e==null?void 0:e.querySelector(".highlight-chat-preview-count");t&&(t.textContent=String(this.draggedContents.length),this.draggedContents.length===0&&e&&(e.remove(),this.currentPreviewContainer=null))}}setupContextControls(e){let t=e.createEl("select",{cls:"highlight-chat-context-strategy",attr:{title:"\u9009\u62E9\u4E0A\u4E0B\u6587\u83B7\u53D6\u7B56\u7565"}});[{value:"smart",label:"\u667A\u80FD\u4E0A\u4E0B\u6587"},{value:"paragraph",label:"\u6BB5\u843D\u4E0A\u4E0B\u6587"},{value:"section",label:"\u7AE0\u8282\u4E0A\u4E0B\u6587"},{value:"surrounding",label:"\u90BB\u8FD1\u884C\u6570"}].forEach(m=>{let w=t.createEl("option",{value:m.value,text:m.label});m.value===this.contextOptions.strategy&&(w.selected=!0)}),t.addEventListener("change",()=>{this.contextOptions.strategy=t.value});let o=e.createEl("div",{cls:"highlight-chat-context-length"}),l=o.createEl("span",{cls:"highlight-chat-context-length-label",text:"\u957F\u5EA6:"}),c=o.createEl("input",{type:"range",cls:"highlight-chat-context-length-slider",attr:{min:"500",max:"5000",step:"500",value:String(this.contextOptions.maxLength||2e3),title:"\u8C03\u6574\u4E0A\u4E0B\u6587\u6700\u5927\u957F\u5EA6"}}),h=o.createEl("span",{cls:"highlight-chat-context-length-value",text:String(this.contextOptions.maxLength||2e3)});c.addEventListener("input",()=>{let m=parseInt(c.value);this.contextOptions.maxLength=m,h.textContent=String(m)}),e.createEl("button",{cls:"highlight-chat-context-preview",text:"\u9884\u89C8",attr:{title:"\u9884\u89C8\u5C06\u8981\u53D1\u9001\u7ED9AI\u7684\u5185\u5BB9"}}).addEventListener("click",()=>{this.showContextPreview()});let u=e.createEl("button",{cls:"highlight-chat-context-settings",attr:{title:"\u4E0A\u4E0B\u6587\u8BBE\u7F6E"}});(0,de.setIcon)(u,"settings"),u.addEventListener("click",m=>{this.showContextSettingsMenu(u,m)})}async showContextPreviewWithSettings(){if(this.draggedContents.length===0){new de.Notice("\u6CA1\u6709\u9AD8\u4EAE\u5185\u5BB9\u53EF\u9884\u89C8");return}let e=this.app.workspace.containerEl.createEl("div",{cls:"highlight-chat-context-modal"}),t=e.createEl("div",{cls:"highlight-chat-context-overlay"}),i=e.createEl("div",{cls:"highlight-chat-context-content"}),o=i.createEl("div",{cls:"highlight-chat-context-header"});o.createEl("h3",{text:"Context Preview & Settings"});let l=o.createEl("div",{cls:"highlight-chat-context-close"});(0,de.setIcon)(l,"x");let c=i.createEl("div",{cls:"highlight-chat-context-body"}),h,g=()=>{clearTimeout(h),h=setTimeout(()=>{M()},300)},u=c.createEl("div",{cls:"highlight-chat-context-settings-panel"});this.createSettingsPanel(u,g);let m=c.createEl("div",{cls:"highlight-chat-context-preview-panel"});m.createEl("div",{cls:"highlight-chat-context-preview-panel-header"}).createEl("h4",{text:"Preview Content (Auto-update)"});let F=m.createEl("div",{cls:"highlight-chat-context-preview-content"}),E=i.createEl("div",{cls:"highlight-chat-context-footer"}),Q=E.createEl("div",{cls:"highlight-chat-context-stats"}),H=E.createEl("div",{cls:"highlight-chat-context-buttons"}),x=H.createEl("button",{cls:"highlight-chat-context-cancel",text:"Cancel"}),P=H.createEl("button",{cls:"highlight-chat-context-confirm",text:"Apply"}),M=async()=>{try{F.empty(),F.createEl("div",{cls:"highlight-chat-context-loading",text:"Generating preview..."});let J=await this.generateContextPreview();F.empty(),this.renderMarkdownContent(F,J.content),Q.textContent=`Characters: ${J.content.length} | Highlights: ${this.draggedContents.length}`}catch(J){F.empty(),F.createEl("div",{cls:"highlight-chat-context-error",text:"Preview generation failed"})}},D=()=>{e.remove()};l.addEventListener("click",D),x.addEventListener("click",D),t.addEventListener("click",D),P.addEventListener("click",()=>{D(),new de.Notice("Context settings applied")});let O=J=>{J.key==="Escape"&&(D(),document.removeEventListener("keydown",O))};document.addEventListener("keydown",O),await M()}createSettingsPanel(e,t){let i=e.createEl("div",{cls:"highlight-chat-settings-section"});i.createEl("h5",{text:"Context Strategy"});let o=i.createEl("select",{cls:"highlight-chat-settings-select"});[{value:"smart",label:"Smart Context - Auto-select best strategy"},{value:"paragraph",label:"Paragraph Context - Get complete paragraphs"},{value:"section",label:"Section Context - Get entire sections"},{value:"surrounding",label:"Surrounding Lines - Specify before/after lines"}].forEach(M=>{let D=o.createEl("option",{value:M.value,text:M.label});M.value===this.contextOptions.strategy&&(D.selected=!0)}),o.addEventListener("change",async()=>{this.contextOptions.strategy=o.value,await this.saveContextOptions(),this.updateSurroundingLinesVisibility(e),t()});let c=e.createEl("div",{cls:"highlight-chat-settings-section"});c.createEl("h5",{text:"Context Length"});let h=c.createEl("div",{cls:"highlight-chat-settings-slider-container"}),g=h.createEl("input",{type:"range",cls:"highlight-chat-settings-slider",attr:{min:"500",max:"5000",step:"500",value:String(this.contextOptions.maxLength||2e3)}}),u=h.createEl("span",{cls:"highlight-chat-settings-value",text:`${this.contextOptions.maxLength||2e3} chars`});g.addEventListener("input",async()=>{let M=parseInt(g.value);this.contextOptions.maxLength=M,u.textContent=`${M} chars`,await this.saveContextOptions(),t()});let m=e.createEl("div",{cls:"highlight-chat-settings-section highlight-chat-surrounding-section"});m.createEl("h5",{text:"Surrounding Lines"});let w=m.createEl("div",{cls:"highlight-chat-settings-slider-container"}),F=w.createEl("input",{type:"range",cls:"highlight-chat-settings-slider",attr:{min:"1",max:"10",step:"1",value:String(this.contextOptions.surroundingLines||3)}}),E=w.createEl("span",{cls:"highlight-chat-settings-value",text:`${this.contextOptions.surroundingLines||3} lines`});F.addEventListener("input",async()=>{let M=parseInt(F.value);this.contextOptions.surroundingLines=M,E.textContent=`${M} lines`,await this.saveContextOptions(),t()});let Q=e.createEl("div",{cls:"highlight-chat-settings-section"});Q.createEl("h5",{text:"Other Options"});let H=Q.createEl("label",{cls:"highlight-chat-settings-checkbox"}),x=H.createEl("input",{type:"checkbox"});x.checked=this.contextOptions.includeTitle||!1,H.createSpan({text:" Include section titles"}),x.addEventListener("change",async()=>{this.contextOptions.includeTitle=x.checked,await this.saveContextOptions(),t()}),this.updateSurroundingLinesVisibility(e),e.createEl("button",{cls:"highlight-chat-settings-reset",text:"Reset to defaults"}).addEventListener("click",async()=>{this.contextOptions={strategy:"smart",includeTitle:!0,maxLength:2e3,surroundingLines:3},o.value="smart",g.value="2000",u.textContent="2000 chars",F.value="3",E.textContent="3 lines",x.checked=!0,await this.saveContextOptions(),this.updateSurroundingLinesVisibility(e),new de.Notice("Reset to default settings"),t()})}updateSurroundingLinesVisibility(e){let t=e.querySelector(".highlight-chat-surrounding-section");t&&(this.contextOptions.strategy==="surrounding"?t.style.display="block":t.style.display="none")}async generateContextPreview(){let e=this.draggedContents.map(o=>this.contextService.getContextForHighlight(o,this.contextOptions));return{content:(await Promise.all(e)).map((o,l)=>{let c=this.draggedContents[l];if(!o)return`**Highlight ${l+1}:**
${c.text}`;let h=`**Highlight ${l+1}** (from: ${o.fileName}):
`;return o.sectionTitle&&(h+=`**Section:** ${o.sectionTitle}

`),o.beforeContext.trim()&&(h+=`**Before:**
${o.beforeContext.trim()}

`),h+=`**Highlight:**
${c.text}

`,o.afterContext.trim()&&(h+=`**After:**
${o.afterContext.trim()}`),h}).join(`

---

`)}}async showContextPreview(){if(this.draggedContents.length===0){new de.Notice("\u6CA1\u6709\u9AD8\u4EAE\u5185\u5BB9\u53EF\u9884\u89C8");return}try{let e=this.draggedContents.map(H=>this.contextService.getContextForHighlight(H,this.contextOptions)),i=(await Promise.all(e)).map((H,x)=>{let P=this.draggedContents[x];if(!H)return`**\u9AD8\u4EAE\u5185\u5BB9 ${x+1}:**
${P.text}`;let M=`**\u9AD8\u4EAE\u5185\u5BB9 ${x+1}** (\u6765\u81EA: ${H.fileName}):
`;return H.sectionTitle&&(M+=`**\u7AE0\u8282:** ${H.sectionTitle}

`),H.beforeContext.trim()&&(M+=`**\u524D\u6587:**
${H.beforeContext.trim()}

`),M+=`**\u9AD8\u4EAE\u5185\u5BB9:**
${P.text}

`,H.afterContext.trim()&&(M+=`**\u540E\u6587:**
${H.afterContext.trim()}`),M}).join(`

---

`),o=this.app.workspace.containerEl.createEl("div",{cls:"highlight-chat-context-preview-modal"}),l=o.createEl("div",{cls:"highlight-chat-context-preview-overlay"}),c=o.createEl("div",{cls:"highlight-chat-context-preview-content"}),h=c.createEl("div",{cls:"highlight-chat-context-preview-header"});h.createEl("h3",{text:"\u4E0A\u4E0B\u6587\u9884\u89C8"});let g=h.createEl("button",{cls:"highlight-chat-context-preview-close"});(0,de.setIcon)(g,"x");let m=c.createEl("div",{cls:"highlight-chat-context-preview-body"}).createEl("div",{cls:"highlight-chat-context-preview-text"});this.renderMarkdownContent(m,i);let F=c.createEl("div",{cls:"highlight-chat-context-preview-footer"}).createEl("div",{cls:"highlight-chat-context-preview-stats",text:`\u5B57\u7B26\u6570: ${i.length} | \u9AD8\u4EAE\u6570: ${this.draggedContents.length}`}),E=()=>{o.remove()};g.addEventListener("click",E),l.addEventListener("click",E);let Q=H=>{H.key==="Escape"&&(E(),document.removeEventListener("keydown",Q))};document.addEventListener("keydown",Q)}catch(e){console.error("\u9884\u89C8\u4E0A\u4E0B\u6587\u65F6\u51FA\u9519:",e),new de.Notice("\u9884\u89C8\u4E0A\u4E0B\u6587\u5931\u8D25")}}showContextSettingsMenu(e,t){let i=new de.Menu;i.addItem(l=>{l.setTitle("\u5305\u542B\u7AE0\u8282\u6807\u9898").setChecked(this.contextOptions.includeTitle||!1).onClick(()=>{this.contextOptions.includeTitle=!this.contextOptions.includeTitle})}),i.addSeparator(),this.contextOptions.strategy==="surrounding"&&i.addItem(l=>{l.setTitle(`\u90BB\u8FD1\u884C\u6570: ${this.contextOptions.surroundingLines||3}`).onClick(()=>{let c=prompt("\u8BF7\u8F93\u5165\u90BB\u8FD1\u884C\u6570 (1-10):",String(this.contextOptions.surroundingLines||3));if(c){let h=parseInt(c);h>=1&&h<=10&&(this.contextOptions.surroundingLines=h)}})}),i.addSeparator(),i.addItem(l=>{l.setTitle("\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u8BBE\u7F6E").onClick(()=>{var u,m,w;this.contextOptions={strategy:"smart",includeTitle:!0,maxLength:2e3};let c=(u=e.parentElement)==null?void 0:u.querySelector(".highlight-chat-context-strategy"),h=(m=e.parentElement)==null?void 0:m.querySelector(".highlight-chat-context-length-slider"),g=(w=e.parentElement)==null?void 0:w.querySelector(".highlight-chat-context-length-value");c&&(c.value="smart"),h&&(h.value="2000"),g&&(g.textContent="2000"),new de.Notice("\u5DF2\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u8BBE\u7F6E")})});let o=e.getBoundingClientRect();i.showAtPosition({x:o.left,y:o.bottom})}clearChat(){if(this.chatHistory=[],this.draggedContents=[],this.currentPreviewContainer){let t=this.currentPreviewContainer.closest(".highlight-chat-message-preview");t&&t.remove(),this.currentPreviewContainer=null}let e=this.containerEl.querySelector(".highlight-chat-history");if(e)for(;e.firstChild;)e.removeChild(e.firstChild);this.textarea&&(this.textarea.value="",this.textarea.addClass("highlight-chat-input"))}getCurrentModelName(){var i,o,l,c,h,g,u,m;let e=this.plugin.settings.ai;switch(this.chatModelState.provider||e.provider){case"openai":return this.chatModelState.model||((i=e.openai)==null?void 0:i.model)||"GPT-4";case"anthropic":return this.chatModelState.model||((o=e.anthropic)==null?void 0:o.model)||"Claude-3";case"ollama":return this.chatModelState.model||((l=e.ollama)==null?void 0:l.model)||"Ollama";case"gemini":return this.chatModelState.model||((c=e.gemini)==null?void 0:c.model)||"Gemini Pro";case"deepseek":return this.chatModelState.model||((h=e.deepseek)==null?void 0:h.model)||"Deepseek Chat";case"siliconflow":return(g=e.siliconflow)!=null&&g.isCustomModel&&((u=e.siliconflow)!=null&&u.model)?e.siliconflow.model:this.chatModelState.model?this.chatModelState.model:((m=e.siliconflow)==null?void 0:m.model)||"SiliconFlow";default:return"Unknown model"}}async showModelSelector(e,t){var c,h,g,u,m,w;let i=new de.Menu,o=this.plugin.settings.ai;switch(o.provider){case"siliconflow":try{if(SA.forEach(Q=>{i.addItem(H=>{var P,M;let x=!((P=o.siliconflow)!=null&&P.isCustomModel)&&(this.chatModelState.model===Q.id||((M=o.siliconflow)==null?void 0:M.model)===Q.id);H.setTitle(Q.name).setChecked(x).onClick(async()=>{o.siliconflow?(o.siliconflow.model=Q.id,o.siliconflow.isCustomModel=!1):o.siliconflow={model:Q.id,isCustomModel:!1},this.chatModelState.provider="siliconflow",this.chatModelState.model=Q.id,this.chatService.updateModel("siliconflow",Q.id),await this.plugin.saveSettings(),e.textContent=Q.name})})}),(c=o.siliconflow)!=null&&c.isCustomModel&&((h=o.siliconflow)!=null&&h.model)){i.addSeparator();let Q=o.siliconflow.model;i.addItem(H=>{var P,M;let x=((P=o.siliconflow)==null?void 0:P.isCustomModel)&&(this.chatModelState.model===Q||((M=o.siliconflow)==null?void 0:M.model)===Q);H.setTitle(Q).setChecked(x).onClick(async()=>{o.siliconflow?(o.siliconflow.model=Q,o.siliconflow.isCustomModel=!0):o.siliconflow={model:Q,isCustomModel:!0},this.chatModelState.provider="siliconflow",this.chatModelState.model=Q,this.chatService.updateModel("siliconflow",Q),await this.plugin.saveSettings(),e.textContent=Q})})}}catch(E){new de.Notice(f("Unable to get SiliconFlow model list, please check API Key and network connection."))}break;case"openai":try{let E=await this.chatService.aiService.listOpenAIModels(),Q=E.filter(x=>!x.isCustom),H=E.filter(x=>x.isCustom);Q.forEach(x=>{i.addItem(P=>{P.setTitle(x.name).setChecked(this.chatModelState.model===x.id).onClick(async()=>{this.chatModelState.provider="openai",this.chatModelState.model=x.id,this.chatService.updateModel("openai",x.id),e.textContent=this.getCurrentModelName()})})}),H.length>0&&(i.addSeparator(),H.forEach(x=>{i.addItem(P=>{P.setTitle(x.name).setChecked(this.chatModelState.model===x.id).onClick(async()=>{this.chatModelState.provider="openai",this.chatModelState.model=x.id,this.chatService.updateModel("openai",x.id),e.textContent=this.getCurrentModelName()})})}))}catch(E){new de.Notice(f("Unable to get OpenAI model list, please check API Key and network connection."))}break;case"anthropic":["claude-3-opus-20240229","claude-3-sonnet-20240229","claude-3-haiku-20240307"].forEach(E=>{i.addItem(Q=>{var H;Q.setTitle(E).setChecked(((H=o.anthropic)==null?void 0:H.model)===E).onClick(async()=>{o.anthropic||(o.anthropic={apiKey:"",model:E}),o.anthropic.model=E,await this.plugin.saveSettings(),e.textContent=this.getCurrentModelName()})})});break;case"ollama":try{(await this.chatService.aiService.listOllamaModels()).forEach(Q=>{i.addItem(H=>{var x;H.setTitle(Q).setChecked(((x=o.ollama)==null?void 0:x.model)===Q).onClick(async()=>{o.ollama||(o.ollama={host:"http://localhost:11434",model:Q}),o.ollama.model=Q,await this.plugin.saveSettings(),e.textContent=this.getCurrentModelName()})})})}catch(E){new de.Notice(f("Unable to access the Ollama model, please check the service."))}break;case"gemini":try{(await this.chatService.aiService.listGeminiModels()).forEach(Q=>{i.addItem(H=>{var x;H.setTitle(Q.name).setChecked(((x=o.gemini)==null?void 0:x.model)===Q.id).onClick(async()=>{this.chatModelState.provider="gemini",this.chatModelState.model=Q.id,this.chatService.updateModel("gemini",Q.id),e.textContent=this.getCurrentModelName()})})}),(g=o.gemini)!=null&&g.isCustomModel&&((u=o.gemini)!=null&&u.model)&&(i.addSeparator(),i.addItem(Q=>{var x,P;let H={id:((x=o.gemini)==null?void 0:x.model)||"",name:(P=o.gemini)==null?void 0:P.model,isCustom:!0};Q.setTitle(H.name).setChecked(this.chatModelState.model===H.id).onClick(async()=>{this.chatModelState.provider="gemini",this.chatModelState.model=H.id,this.chatService.updateModel("gemini",H.id),e.textContent=this.getCurrentModelName()})}))}catch(E){new de.Notice(f("Unable to get Gemini model list, please check API Key and network connection."))}break;case"deepseek":try{(await this.chatService.aiService.listDeepseekModels()).forEach(Q=>{i.addItem(H=>{var x;H.setTitle(Q.name).setChecked(((x=o.deepseek)==null?void 0:x.model)===Q.id).onClick(async()=>{this.chatModelState.provider="deepseek",this.chatModelState.model=Q.id,this.chatService.updateModel("deepseek",Q.id),e.textContent=this.getCurrentModelName()})})}),(m=o.deepseek)!=null&&m.isCustomModel&&((w=o.deepseek)!=null&&w.model)&&(i.addSeparator(),i.addItem(Q=>{var x,P;let H={id:((x=o.deepseek)==null?void 0:x.model)||"",name:(P=o.deepseek)==null?void 0:P.model,isCustom:!0};Q.setTitle(H.name).setChecked(this.chatModelState.model===H.id).onClick(async()=>{this.chatModelState.provider="deepseek",this.chatModelState.model=H.id,this.chatService.updateModel("deepseek",H.id),e.textContent=this.getCurrentModelName()})}))}catch(E){new de.Notice(f("Unable to get Deepseek model list, please check API Key and network connection."))}break;default:new de.Notice(f("Unknown AI provider"));break}let l=e.getBoundingClientRect();i.showAtPosition({x:l.left,y:l.bottom})}};qe.instance=null,qe.savedState=null;var At=qe;var sA="comment-view",pA=class extends X.ItemView{constructor(e,t){super(e);this.searchHintsEventHandlers=null;this.handleGlobalClick=e=>{if(this.isSelectionMode||this.selectedHighlights.size<=1||!this.multiSelectActionsContainer||this.multiSelectActionsContainer.style.display==="none")return;let t=e.target;t.closest(".multi-select-actions")||t.closest(".highlight-card.selected")||t.closest(".highlight-container")||this.clearSelection()};this.handleSelectionStart=e=>{e.target.closest(".highlight-card")||e.target.closest(".flashcard-mode")||e.target.closest(".flashcard-add-group")||e.target.closest(".flashcard-group-action")||e.target.closest(".highlight-floating-button")||(this.selectionStartX=e.clientX,this.selectionStartY=e.clientY,this.mouseMoved=!1,document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp))};this.handleMouseMove=e=>{let t=e.clientX-this.selectionStartX,i=e.clientY-this.selectionStartY;Math.sqrt(t*t+i*i)>=this.mouseMoveThreshold&&(this.mouseMoved=!0,document.removeEventListener("mousemove",this.handleMouseMove),this.startSelection(e))};this.handleMouseUp=e=>{document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),this.mouseMoved||this.clearSelection()};this.handleSelectionMove=e=>{if(!this.isSelectionMode||!this.selectionBox)return;let t=e.clientX-this.selectionStartX,i=e.clientY-this.selectionStartY;t<0?(this.selectionBox.style.left=`${e.clientX}px`,this.selectionBox.style.width=`${-t}px`):this.selectionBox.style.width=`${t}px`,i<0?(this.selectionBox.style.top=`${e.clientY}px`,this.selectionBox.style.height=`${-i}px`):this.selectionBox.style.height=`${i}px`,this.selectCardsInBox()};this.handleSelectionEnd=e=>{this.isSelectionMode&&(this.selectionBox&&(this.selectionBox.remove(),this.selectionBox=null),this.isSelectionMode=!1,document.removeEventListener("mousemove",this.handleSelectionMove),document.removeEventListener("mouseup",this.handleSelectionEnd),this.updateSelectedHighlights())};this.selectedHighlights=new Set;this.currentFile=null;this.isFlashcardMode=!1;this.highlights=[];this.highlightsWithFlashcards=new Set;this.searchDebounceTimer=null;this.localSearchDebounceTime=200;this.globalSearchDebounceTime=500;this.isSearching=!1;this.isDraggedToMainView=!1;this.isMobileView=!1;this.isSmallScreen=!1;this.isShowingFileList=!0;this.currentBatch=0;this.isLoading=!1;this.BATCH_SIZE=20;this.floatingButton=null;this.aiButtons=[];this.currentEditingHighlightId=null;this.flashcardComponent=null;this.isSelectionMode=!1;this.selectionBox=null;this.selectionStartX=0;this.selectionStartY=0;this.mouseMoveThreshold=5;this.mouseMoved=!1;this.handleSearchInputWithDebounce=e=>{this.searchDebounceTimer!==null&&(window.clearTimeout(this.searchDebounceTimer),this.searchDebounceTimer=null);let t=this.searchInput.value.toLowerCase().trim(),i=t.startsWith("all:"),o=i?this.globalSearchDebounceTime:this.localSearchDebounceTime;i&&t.length>4&&this.showSearchLoadingIndicator(),this.searchDebounceTimer=window.setTimeout(()=>{this.updateHighlightsList(),this.searchDebounceTimer=null},o)};this.commentStore=t;let i=this.app.plugins;if(i&&i.plugins&&i.plugins["hi-note"])this.plugin=i.plugins["hi-note"];else throw new Error("Hi-Note plugin not found");this.locationService=new bs(this.app),this.exportService=new xs(this.app,this.commentStore),this.highlightService=new cA(this.app),this.licenseManager=new jA(this.plugin),this.canvasService=new hs(this.app.vault),this.registerEvent(this.app.workspace.on("file-open",l=>{var c,h,g;if(l&&!this.isDraggedToMainView){this.currentFile=l;let u=this.app.workspace.activeLeaf,m=((h=(c=u==null?void 0:u.getViewState())==null?void 0:c.state)==null?void 0:h.file)!==l.path&&((g=u==null?void 0:u.view)==null?void 0:g.getViewType())==="canvas";this.updateHighlights(m)}})),this.registerEvent(this.app.vault.on("modify",l=>{var c,h,g;if(l===this.currentFile&&!this.isDraggedToMainView){let u=this.app.workspace.activeLeaf,m=((h=(c=u==null?void 0:u.getViewState())==null?void 0:c.state)==null?void 0:h.file)!==l.path&&((g=u==null?void 0:u.view)==null?void 0:g.getViewType())==="canvas";this.updateHighlights(m)}}));let o=l=>{let{highlightId:c,text:h}=l.detail;setTimeout(()=>{this.highlightContainer.querySelectorAll(".highlight-card").forEach(u=>{u.removeClass("selected")});let g=Ie.findCardInstanceByHighlightId(c);if(!g){let u=Array.from(this.highlightContainer.querySelectorAll(".highlight-card")).find(m=>{var F;return((F=m.querySelector(".highlight-text-content"))==null?void 0:F.textContent)===h});u&&(u.addClass("selected"),g=Ie.findCardInstanceByElement(u),u.scrollIntoView({behavior:"smooth"}))}g&&g.showCommentInput()},100)};window.addEventListener("open-comment-input",o),this.register(()=>window.removeEventListener("open-comment-input",o)),this.registerEvent(this.app.workspace.on("layout-change",()=>{this.checkViewPosition()})),this.loadingIndicator=createEl("div",{cls:"highlight-loading-indicator",text:f("Loading...")}),this.loadingIndicator.addClass("highlight-display-none")}clearSelection(){this.highlightContainer.querySelectorAll(".highlight-card.selected").forEach(e=>{e.removeClass("selected")}),Ie&&typeof Ie.clearSelection=="function"&&Ie.clearSelection(),this.selectedHighlights.clear(),this.hideMultiSelectActions(),this.isSelectionMode=!1}handleMultiSelect(e){let t=e.detail;t&&t.selectedCards&&this.updateSelectedHighlights()}updateSelectedHighlights(){this.selectedHighlights.clear(),Array.from(this.highlightContainer.querySelectorAll(".highlight-card.selected")).forEach(t=>{let i=t.getAttribute("data-highlight");if(i)try{let o=JSON.parse(i);this.selectedHighlights.add(o)}catch(o){console.error("Error parsing highlight data:",o)}}),this.selectedHighlights.size>1?this.showMultiSelectActions():this.hideMultiSelectActions()}async showMultiSelectActions(){this.hideMultiSelectActions(),this.multiSelectActionsContainer||(this.multiSelectActionsContainer=this.containerEl.createEl("div",{cls:"multi-select-actions"})),this.multiSelectActionsContainer.show(),this.multiSelectActionsContainer.empty();let e=this.multiSelectActionsContainer.createEl("div",{cls:"selected-count",text:`selected ${this.selectedHighlights.size}`}),t=this.multiSelectActionsContainer.createEl("div",{cls:"multi-select-action-button"});t.setAttribute("aria-label",f("Export")),(0,X.setIcon)(t,"file-input"),t.addEventListener("click",()=>{this.exportSelectedHighlights()});let i=this.plugin.fsrsManager;if(!i){this.createDefaultFlashcardButton(this.multiSelectActionsContainer);return}let o=0;for(let c of this.selectedHighlights)if(c.id){let h=i.findCardsBySourceId(c.id,"highlight");h&&h.length>0&&o++}if(o===0){let c=this.multiSelectActionsContainer.createEl("div",{cls:"multi-select-action-button"});c.setAttribute("aria-label",f("Create HiCard")),(0,X.setIcon)(c,"book-plus"),(async()=>{let g=await this.licenseManager.isActivated(),u=g?await this.licenseManager.isFeatureEnabled("flashcard"):!1;return g&&u})().then(g=>{g||(c.addClass("disabled-button"),c.setAttribute("aria-label",f("Only HiNote Pro")))}),c.addEventListener("click",async()=>{if(c.hasClass("disabled-button")){new X.Notice(f("Only HiNote Pro"));return}await this.createMissingFlashcards()})}else if(o===this.selectedHighlights.size){let c=this.multiSelectActionsContainer.createEl("div",{cls:"multi-select-action-button delete-flashcard-button"});c.setAttribute("aria-label",f("Delete HiCard")),(0,X.setIcon)(c,"book-x"),c.addEventListener("click",()=>{this.deleteFlashcardsFromSelected()})}else{let c=this.multiSelectActionsContainer.createEl("div",{cls:"multi-select-action-button"});c.setAttribute("aria-label",f("Manage HiCard")),(0,X.setIcon)(c,"book-heart"),c.addEventListener("click",h=>{this.showFlashcardManageMenu(h)})}let l=this.multiSelectActionsContainer.createEl("div",{cls:"multi-select-action-button"});l.setAttribute("aria-label",f("Delete")),(0,X.setIcon)(l,"trash"),l.addEventListener("click",()=>{this.deleteSelectedHighlights()})}hideMultiSelectActions(){this.multiSelectActionsContainer&&(this.multiSelectActionsContainer.empty(),this.multiSelectActionsContainer.hide())}createDefaultFlashcardButton(e){let t=e.createEl("div",{cls:"multi-select-action-button"});t.setAttribute("aria-label",f("Create HiCard")),(0,X.setIcon)(t,"plus-circle"),t.addEventListener("click",()=>{new X.Notice(f("HiCard function is not initialized, please enable FSRS function"))})}showFlashcardManageMenu(e){let t=new X.Menu;t.addItem(o=>{o.setTitle(f("Create missing HiCard")).setIcon("plus-circle").onClick(async()=>{await this.createMissingFlashcards()})}),t.addItem(o=>{o.setTitle(f("Delete existing HiCards")).setIcon("trash").onClick(()=>{this.deleteFlashcardsFromSelected()})});let i=e.currentTarget;if(i){let o=i.getBoundingClientRect();t.showAtPosition({x:o.left-85,y:o.top-60})}else t.showAtMouseEvent(e)}async createMissingFlashcards(){let e=await this.licenseManager.isActivated(),t=e?await this.licenseManager.isFeatureEnabled("flashcard"):!1;if(!e||!t){new X.Notice(f("Only HiNote Pro"));return}let i=this.plugin.fsrsManager;if(!i){new X.Notice(f("HiCard function is not initialized, please enable FSRS function"));return}let o=0,l=0;for(let c of this.selectedHighlights)try{if(c.id){let h=i.findCardsBySourceId(c.id,"highlight");if(h&&h.length>0)continue;let g=Ie.findCardInstanceByHighlightId(c.id),u=!1;if(g)u=await g.createHiCardForHighlight(!0);else{let m=document.createElement("div");g=new Ie(m,c,this.plugin,{onHighlightClick:async()=>{},onCommentAdd:()=>{},onExport:()=>{},onCommentEdit:()=>{},onAIResponse:async()=>{}},!1),u=await g.createHiCardForHighlight(!0)}u?o++:(l++,console.error(`Create HiCard failed: ${c.text}`))}}catch(h){l++,console.error("Create HiCard failed:",h)}o>0&&this.plugin.eventManager.emitFlashcardChanged(),o>0&&l===0?new X.Notice(f(`Successfully created ${o} HiCard`)):o>0&&l>0?new X.Notice(f(`Successfully created ${o} HiCard, ${l} failed`)):o===0&&l===0?new X.Notice(f("No HiCard to create")):new X.Notice(f("Failed to create HiCard! Please check the selected highlight content")),this.clearSelection(),this.renderHighlights(this.highlights)}async exportSelectedHighlights(){if(this.selectedHighlights.size===0){new X.Notice(f("Please select highlights to export"));return}try{let e=Array.from(this.selectedHighlights),t=await this.exportService.exportHighlightsAsMarkdown(e);t?(new X.Notice(f("Successfully exported selected highlights to: ")+t.path),this.clearSelection()):new X.Notice(f("No highlights to export"))}catch(e){console.error("Failed to export highlights:",e),new X.Notice(f("Failed to export highlights: ")+(e instanceof Error?e.message:String(e)))}}deleteFlashcardsFromSelected(){let e=new X.Modal(this.app);e.titleEl.setText(f("Confirm delete HiCard"));let t=e.contentEl;t.empty(),t.createEl("p",{text:f("Are you sure you want to delete the HiCards of the selected highlights? This action cannot be undone.")});let i=t.createEl("div",{cls:"modal-button-container"});i.createEl("button",{text:f("Cancel")}).addEventListener("click",()=>{e.close()}),i.createEl("button",{cls:"mod-warning",text:f("Delete")}).addEventListener("click",async()=>{e.close(),await this.deleteExistingFlashcards()}),e.open()}deleteSelectedHighlights(){if(this.selectedHighlights.size===0){new X.Notice(f("No highlights selected"));return}let e=new X.Modal(this.app);e.titleEl.setText(f("Confirm delete highlights"));let t=e.contentEl;t.empty(),t.createEl("p",{text:f(`Are you sure you want to delete ${this.selectedHighlights.size} highlights and all their data, including Comments and HiCards? This action cannot be undone.`)});let i=t.createEl("div",{cls:"modal-button-container"});i.createEl("button",{text:f("Cancel")}).addEventListener("click",()=>{e.close()}),i.createEl("button",{cls:"mod-warning",text:f("Delete")}).addEventListener("click",async()=>{e.close(),await this.performDeleteSelectedHighlights()}),e.open()}async performDeleteSelectedHighlights(){if(this.selectedHighlights.size===0){new X.Notice(f("No highlights selected"));return}let e=0,t=0,i=Array.from(this.highlightContainer.querySelectorAll(".highlight-card.selected"));for(let o of i)try{let l=o.getAttribute("data-highlight");if(!l)continue;let c=JSON.parse(l);if(!c.id)continue;let h=Ie.findCardInstanceByHighlightId(c.id);h?(await h.handleDeleteHighlight(!0,!0),e++):(t++,console.error(`\u65E0\u6CD5\u627E\u5230\u9AD8\u4EAE\u5361\u7247\u5B9E\u4F8B: ${c.id}`))}catch(l){console.error("\u5220\u9664\u9AD8\u4EAE\u65F6\u51FA\u9519:",l),t++}this.clearSelection(),e>0&&t===0?new X.Notice(f(`\u6210\u529F\u5220\u9664 ${e} \u4E2A\u9AD8\u4EAE`)):e>0&&t>0?new X.Notice(f(`\u6210\u529F\u5220\u9664 ${e} \u4E2A\u9AD8\u4EAE\uFF0C${t} \u4E2A\u5220\u9664\u5931\u8D25`)):e===0&&t>0&&new X.Notice(f("\u5220\u9664\u9AD8\u4EAE\u5931\u8D25"))}async deleteExistingFlashcards(){let e=this.plugin.fsrsManager;if(!e){new X.Notice(f("HiCard function is not initialized, please enable FSRS function"));return}let t=0,i=0;for(let o of this.selectedHighlights)try{if(o.id){let l=e.findCardsBySourceId(o.id,"highlight");if(!l||l.length===0)continue;let c=Ie.findCardInstanceByHighlightId(o.id),h=!1;if(c)h=await c.deleteHiCardForHighlight(!0);else{let g=document.createElement("div");c=new Ie(g,o,this.plugin,{onHighlightClick:async()=>{},onCommentAdd:()=>{},onExport:()=>{},onCommentEdit:()=>{},onAIResponse:async()=>{}},!1),h=await c.deleteHiCardForHighlight(!0)}h?t++:(i++,console.error(`Failed to delete HiCard: ${o.text}`))}}catch(l){i++,console.error("Failed to delete HiCard:",l)}t>0&&this.plugin.eventManager.emitFlashcardChanged(),t>0&&i===0?new X.Notice(f(`Successfully deleted ${t} HiCard`)):t>0&&i>0?new X.Notice(f(`Successfully deleted ${t} HiCard, ${i} failed`)):t===0&&i===0?new X.Notice(f("No HiCard to delete")):new X.Notice(f("Failed to delete HiCard! Please check the selected highlight content")),this.clearSelection(),this.renderHighlights(this.highlights)}setupSelectionBox(){this.highlightContainer.removeEventListener("mousedown",this.handleSelectionStart),this.highlightContainer.addEventListener("mousedown",this.handleSelectionStart)}startSelection(e){let t=this.highlightContainer.querySelectorAll(".highlight-card.selected").length>0,i=window.HighlightCard,o=i&&i.selectedCards&&i.selectedCards.size>0;(this.selectedHighlights.size>0||t||o)&&this.clearSelection(),this.selectionBox=document.createElement("div"),this.selectionBox.className="selection-box",this.selectionBox.style.left=`${this.selectionStartX}px`,this.selectionBox.style.top=`${this.selectionStartY}px`,document.body.appendChild(this.selectionBox),this.isSelectionMode=!0,document.addEventListener("mousemove",this.handleSelectionMove),document.addEventListener("mouseup",this.handleSelectionEnd)}selectCardsInBox(){if(!this.selectionBox)return;let e=this.selectionBox.getBoundingClientRect(),t=this.highlightContainer.querySelectorAll(".highlight-card"),i=window.HighlightCard;t.forEach(o=>{let l=o.getBoundingClientRect();!(e.right<l.left||e.left>l.right||e.bottom<l.top||e.top>l.bottom)?(o.addClass("selected"),i&&i.selectedCards&&i.selectedCards.add(o)):document.querySelector(".multi-select-mode")||(o.removeClass("selected"),i&&i.selectedCards&&i.selectedCards.delete(o))})}getViewType(){return sA}getDisplayText(){return"HiNote"}getIcon(){return"highlighter"}async onOpen(){let e=this.containerEl.children[1];e.empty(),e.addClass("comment-view-container"),e.addEventListener("highlight-multi-select",w=>{this.handleMultiSelect(w)}),document.addEventListener("click",this.handleGlobalClick);let t=e.createEl("div",{cls:"highlight-main-container"});this.fileListContainer=t.createEl("div",{cls:"highlight-file-list-container"}),this.mainContentContainer=t.createEl("div",{cls:"highlight-content-container"});let o=this.mainContentContainer.createEl("div",{cls:"highlight-back-button-container"}).createEl("div",{cls:"highlight-back-button"});(0,X.setIcon)(o,"arrow-left"),o.createEl("span",{text:f("BACK"),cls:"highlight-back-button-text"}),o.addEventListener("click",()=>{if(this.isMobileView&&this.isSmallScreen&&this.isDraggedToMainView){if(this.isFlashcardMode&&this.flashcardComponent){let w=this.flashcardComponent.getRenderer();if(w&&!w.isShowingSidebar()){w.showSidebar();return}}this.isShowingFileList=!0,this.updateViewLayout()}}),this.searchContainer=this.mainContentContainer.createEl("div",{cls:"highlight-search-container"}),this.searchInput=this.searchContainer.createEl("input",{cls:"highlight-search-input",attr:{type:"text",placeholder:f("Search...")}}),this.searchInput.addEventListener("focus",()=>{this.searchContainer.addClass("focused"),this.showSearchPrefixHints()}),this.searchInput.addEventListener("blur",w=>{this.searchContainer.removeClass("focused"),setTimeout(()=>{let F=document.querySelector(".search-prefix-hints");F&&F.remove()},200)}),this.searchLoadingIndicator=this.searchContainer.createEl("div",{cls:"highlight-search-loading"}),this.searchLoadingIndicator.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="loading-spinner"><circle cx="12" cy="12" r="10"></circle><path d="M12 6v6l4 2"></path></svg>',this.searchLoadingIndicator.style.display="none";let l=this.searchContainer.createEl("div",{cls:"highlight-search-icons"}),c=l.createEl("div",{cls:"highlight-icon-button"});(0,X.setIcon)(c,"message-square-plus"),c.setAttribute("aria-label",f("Add File Comment")),c.addEventListener("click",async()=>{if(!this.currentFile){new X.Notice(f("Please open a file first."));return}let w=Date.now(),E={id:`file-comment-${w}`,text:`__virtual_highlight_${w}__`,filePath:this.currentFile.path,fileType:this.currentFile.extension,displayText:f("File Comment"),isVirtual:!0,position:0,paragraphOffset:0,paragraphId:`${this.currentFile.path}#^virtual-${w}`,createdAt:w,updatedAt:w,comments:[]};await this.commentStore.addComment(this.currentFile,E),this.highlights.unshift(E),this.renderHighlights(this.highlights),setTimeout(()=>{let Q=this.highlightContainer.querySelector(".highlight-card");Q&&(this.showCommentInput(Q,E),this.highlightContainer.scrollTo({top:0,behavior:"smooth"}))},100)});let h=l.createEl("div",{cls:"highlight-icon-button"});(0,X.setIcon)(h,"file-symlink"),h.setAttribute("aria-label",f("Export as notes")),h.addEventListener("click",async()=>{if(!this.currentFile){new X.Notice(f("Please open a file first."));return}try{let w=await this.exportService.exportHighlightsToNote(this.currentFile);new X.Notice(f("Successfully exported highlights to: ")+w.path),await this.app.workspace.getLeaf().openFile(w)}catch(w){new X.Notice(f("Failed to export highlights: ")+w.message)}}),this.searchInput.addEventListener("input",this.handleSearchInputWithDebounce),this.highlightContainer=this.mainContentContainer.createEl("div",{cls:"highlight-container"}),this.registerDomEvent(document,"keydown",w=>{w.key==="Shift"&&this.highlightContainer.addClass("multi-select-mode")}),this.registerDomEvent(document,"keyup",w=>{w.key==="Shift"&&this.highlightContainer.removeClass("multi-select-mode")});let g=this.app.workspace.getActiveFile();g&&(this.currentFile=g,await this.updateHighlights()),this.updateViewLayout(),this.highlightContainer.empty();let u=this.searchInput.value.toLowerCase().trim(),m=this.highlights.filter(w=>{var F,E;return!!(w.text.toLowerCase().includes(u)||(F=w.comments)!=null&&F.some(Q=>Q.content.toLowerCase().includes(u))||this.currentFile===null&&((E=w.fileName)!=null&&E.toLowerCase().includes(u)))});this.renderHighlights(m)}renderHighlights(e,t=!1){if(t||(typeof Ie.clearAllInstances=="function"?Ie.clearAllInstances():Ie.clearSelection(),this.highlightContainer.empty(),this.currentBatch=0,this.selectedHighlights.clear(),this.isSelectionMode=!1),e.length===0){let o=this.searchInput&&this.searchInput.value.trim()!=="",l=this.highlightContainer.createEl("div",{cls:"highlight-empty-state",text:o?f("No matching highlights found for your search."):f("The current document has no highlighted content.")});return}this.setupSelectionBox();let i=this.highlightContainer.querySelector(".highlight-list");i||(i=this.highlightContainer.createEl("div",{cls:"highlight-list"})),e.forEach(o=>{let l;this.currentFile&&!o.filePath&&(o.filePath=this.currentFile.path),l=new Ie(i,o,this.plugin,{onHighlightClick:async h=>await this.jumpToHighlight(h),onCommentAdd:h=>this.showCommentInput(l.getElement(),h),onExport:h=>this.exportHighlightAsImage(h),onCommentEdit:(h,g)=>this.showCommentInput(l.getElement(),h,g),onAIResponse:async h=>{await this.addComment(o,h),await this.updateHighlights()}},this.isDraggedToMainView,this.currentFile===null?o.fileName:this.currentFile.basename),o.id&&this.highlightsWithFlashcards.has(o.id)&&setTimeout(()=>{o.id&&Ie.updateCardUIByHighlightId(o.id)},0);let c=l.getElement();if(this.isDraggedToMainView){c.classList.add("in-main-view");let h=c.querySelector(".highlight-text-content");h&&h.removeAttribute("title")}else{c.classList.remove("in-main-view");let h=c.querySelector(".highlight-text-content");h&&h.setAttribute("aria-label","Jump to highlight")}})}async addComment(e,t){var l;let i=await this.getFileForHighlight(e);if(!i){new X.Notice(f("No corresponding file found."));return}e.id||(e.id=Je.generateHighlightId(((l=this.currentFile)==null?void 0:l.path)||"",e.position||0,e.text)),e.comments||(e.comments=[]);let o={id:Je.generateCommentId(),content:t,createdAt:Date.now(),updatedAt:Date.now()};e.comments.push(o),e.updatedAt=Date.now(),await this.commentStore.addComment(i,e),window.dispatchEvent(new CustomEvent("comment-updated",{detail:{text:e.text,comments:e.comments}})),await this.refreshView()}async updateComment(e,t,i){let o=await this.getFileForHighlight(e);if(!o||!e.comments)return;let l=e.comments.find(c=>c.id===t);if(l){let c=l.content;l.content=i,l.updatedAt=Date.now(),e.updatedAt=Date.now(),await this.commentStore.addComment(o,e),window.dispatchEvent(new CustomEvent("comment-updated",{detail:{text:e.text,comments:e.comments}})),e.id&&this.plugin.eventManager.emitCommentUpdate(o.path,c,i,e.id),await this.refreshView()}}checkHasFlashcard(e){let i=this.plugin.fsrsManager;if(!i||!e)return!1;let o=i.findCardsBySourceId(e,"highlight");return o&&o.length>0}async deleteComment(e,t){let i=await this.getFileForHighlight(e);if(!(!i||!e.comments)){if(e.comments=e.comments.filter(o=>o.id!==t),e.updatedAt=Date.now(),e.comments.length===0){let o=e.id?this.checkHasFlashcard(e.id):!1;e.isVirtual||!o?(await this.commentStore.removeComment(i,e),this.highlights=this.highlights.filter(l=>l.id!==e.id)):await this.commentStore.addComment(i,e)}else await this.commentStore.addComment(i,e);window.dispatchEvent(new CustomEvent("comment-updated",{detail:{text:e.text,comments:e.comments}})),await this.refreshView()}}async getFileForHighlight(e){if(this.currentFile)return this.currentFile;if(e.filePath){let t=this.app.vault.getAbstractFileByPath(e.filePath);if(t instanceof X.TFile)return t}if(e.fileName){let i=this.app.vault.getFiles().find(o=>o.basename===e.fileName||o.name===e.fileName);if(i)return i}return null}generateHighlightId(e){var t;return Je.generateHighlightId(((t=this.currentFile)==null?void 0:t.path)||"",e.position||0,e.text)}async jumpToHighlight(e){if(!this.isDraggedToMainView&&!e.isGlobalSearch){if(!this.currentFile){new X.Notice(f("No corresponding file found."));return}await this.locationService.jumpToHighlight(e,this.currentFile.path)}}async exportHighlightAsImage(e){try{let t=(await Promise.resolve().then(()=>yo(gn()))).default;new Bs(this.app,e,t).open()}catch(t){new X.Notice(f("Export failed: Failed to load necessary components."))}}async showCommentInput(e,t,i){this.currentEditingHighlightId=t.id,new Ms(e,t,i,this.plugin,{onSave:async o=>{i?await this.updateComment(t,i.id,o):await this.addComment(t,o),await this.updateHighlights()},onDelete:i?async()=>{await this.deleteComment(t,i.id)}:void 0,onCancel:async()=>{let o=this.highlights.find(l=>l.id===this.currentEditingHighlightId);if(o!=null&&o.isVirtual&&(!o.comments||o.comments.length===0)){let l=await this.getFileForHighlight(o);l&&(await this.commentStore.removeComment(l,o),this.highlights=this.highlights.filter(c=>c.id!==o.id),await this.refreshView())}}}).show()}async onload(){}async checkViewPosition(){let e=this.app.workspace.rootSplit;if(!e)return;let t=this.isViewInMainArea(this.leaf,e);if(this.isDraggedToMainView!==t){let i=this.isInAllHighlightsView(),o=[...this.highlights];if(this.isDraggedToMainView=t,t){this.checkIfMobile()&&this.checkIfSmallScreen()&&(this.isShowingFileList=!0);let l=this.app.workspace.getActiveFile();l?(this.currentFile=l,await this.updateHighlights()):(this.currentFile=null,await this.updateAllHighlights()),this.updateFileListSelection()}else{this.isFlashcardMode&&(this.isFlashcardMode=!1,this.flashcardComponent&&(this.flashcardComponent.deactivate(),this.flashcardComponent=null),this.updateFileListSelection());let l=this.app.workspace.getActiveFile();l?i?(this.currentFile=l,this.highlightContainer.empty(),this.highlightContainer.appendChild(this.loadingIndicator),setTimeout(()=>{this.updateHighlights()},10)):(this.currentFile=l,this.updateHighlights()):(this.highlights=[],this.renderHighlights([]))}this.updateViewLayout(),this.searchInput&&this.searchInput.value.trim()!==""&&this.updateHighlightsList()}}isViewInMainArea(e,t){return t&&t.children?t.children.some(i=>i===e?!0:this.isViewInMainArea(e,i)):!1}checkIfMobile(){return X.Platform.isMobile}checkIfSmallScreen(){return window.innerWidth<768}async updateViewLayout(){this.isMobileView=this.checkIfMobile(),this.isSmallScreen=this.checkIfSmallScreen(),this.fileListContainer.removeClass("highlight-display-block"),this.fileListContainer.removeClass("highlight-display-none"),this.mainContentContainer.removeClass("highlight-display-none");let e=this.containerEl.children[1];if(this.isDraggedToMainView?e.addClass("is-in-main-view"):e.removeClass("is-in-main-view"),this.isSmallScreen?e.addClass("is-small-screen"):e.removeClass("is-small-screen"),this.isDraggedToMainView)await this.updateFileList(),this.createFloatingButton(),this.isMobileView&&this.isSmallScreen?this.isShowingFileList?(this.fileListContainer.addClass("highlight-display-block"),this.mainContentContainer.addClass("highlight-display-none"),this.fileListContainer.addClass("highlight-full-width")):(this.fileListContainer.addClass("highlight-display-none"),this.mainContentContainer.removeClass("highlight-display-none"),this.fileListContainer.removeClass("highlight-full-width")):(this.fileListContainer.addClass("highlight-display-block"),this.mainContentContainer.removeClass("highlight-display-none"),this.fileListContainer.removeClass("highlight-full-width"));else if(this.fileListContainer.addClass("highlight-display-none"),this.removeFloatingButton(),!this.isFlashcardMode){this.searchContainer.removeClass("highlight-display-none");let t=this.searchContainer.querySelector(".highlight-search-icons");t&&t.removeClass("highlight-display-none")}}async updateFileList(){var E;if(this.fileListContainer.children.length>0){this.updateFileListSelection();return}this.fileListContainer.empty(),this.fileListContainer.createEl("div",{cls:"highlight-file-list-header"}).createEl("div",{text:"HiNote",cls:"highlight-file-list-title"});let t=this.fileListContainer.createEl("div",{cls:"highlight-file-list"}),i=t.createEl("div",{cls:`highlight-file-item highlight-file-item-all ${this.currentFile===null?"is-active":""}`});i.addEventListener("click",()=>{this.currentFile=null,this.isFlashcardMode=!1,this.updateHighlights(),this.updateFileListSelection(),this.searchContainer.removeClass("highlight-display-none");let Q=this.searchContainer.querySelector(".highlight-search-icons");Q&&Q.addClass("highlight-display-none")});let o=i.createEl("div",{cls:"highlight-file-item-left"}),l=o.createEl("span",{cls:"highlight-file-item-icon"});(0,X.setIcon)(l,"square-library"),o.createEl("span",{text:f("All Highlight"),cls:"highlight-file-item-name"});let c=t.createEl("div",{cls:"highlight-file-item highlight-file-item-flashcard"});c.addEventListener("click",async()=>{this.currentFile=null,this.isFlashcardMode=!0,this.updateFileListSelection(),this.searchContainer.addClass("highlight-display-none"),this.highlightContainer.empty(),this.flashcardComponent||(this.flashcardComponent=new li(this.highlightContainer,this.plugin),this.flashcardComponent.setLicenseManager(this.licenseManager)),this.isMobileView&&this.isSmallScreen&&this.isDraggedToMainView&&(this.isShowingFileList=!1,this.updateViewLayout()),await this.flashcardComponent.activate()});let h=c.createEl("div",{cls:"highlight-file-item-left"}),g=h.createEl("span",{cls:"highlight-file-item-icon"});(0,X.setIcon)(g,"book-heart"),h.createEl("span",{text:f("HiCard"),cls:"highlight-file-item-name"});let u=c.createEl("span",{cls:"highlight-file-item-count"}),m=async()=>{let Q=this.plugin.fsrsManager.getTotalCardsCount();u.textContent=`${Q}`};m(),this.registerEvent(this.plugin.eventManager.on("flashcard:changed",()=>{m()})),h.addEventListener("click",async()=>{let Q=this.plugin.fsrsManager.getCardGroups(),H=[];if(Q&&Q.length>0){let x=Q[0].id;H=this.plugin.fsrsManager.getCardsForStudy(x),this.highlightContainer.empty(),this.flashcardComponent||(this.flashcardComponent=new li(this.highlightContainer,this.plugin),this.flashcardComponent.setLicenseManager(this.licenseManager)),await this.flashcardComponent.activate(),this.updateFileListSelection()}});let w=await this.getTotalHighlightsCount();i.createEl("span",{text:`${w}`,cls:"highlight-file-item-count"}),t.createEl("div",{cls:"highlight-file-list-separator"}),i.addEventListener("click",async()=>{this.currentFile=null,this.isFlashcardMode=!1,this.flashcardComponent&&(this.flashcardComponent.deactivate(),this.flashcardComponent=null),this.updateFileListSelection(),this.isMobileView&&this.isSmallScreen&&this.isDraggedToMainView&&(this.isShowingFileList=!1,this.updateViewLayout()),await this.updateAllHighlights()});let F=await this.getFilesWithHighlights();for(let Q of F){let H=t.createEl("div",{cls:`highlight-file-item ${((E=this.currentFile)==null?void 0:E.path)===Q.path?"is-active":""}`});H.setAttribute("data-path",Q.path);let x=H.createEl("div",{cls:"highlight-file-item-left"}),P=x.createEl("span",{cls:"highlight-file-item-icon",attr:{"aria-label":f("Open (DoubleClick)")}});(0,X.setIcon)(P,"file-text"),P.addEventListener("dblclick",async O=>{O.stopPropagation(),await this.getPreferredLeaf().openFile(Q)});let M=x.createEl("span",{text:Q.basename,cls:"highlight-file-item-name"});this.addPagePreview(M,Q);let D=await this.getFileHighlightsCount(Q);H.createEl("span",{text:`${D}`,cls:"highlight-file-item-count"}),H.addEventListener("click",async()=>{this.currentFile=Q,this.isFlashcardMode=!1,this.flashcardComponent&&(this.flashcardComponent.deactivate(),this.flashcardComponent=null),this.updateFileListSelection(),this.searchContainer.removeClass("highlight-display-none");let O=this.searchContainer.querySelector(".highlight-search-icons");O&&O.removeClass("highlight-display-none"),this.isMobileView&&this.isSmallScreen&&this.isDraggedToMainView&&(this.isShowingFileList=!1,this.updateViewLayout()),await this.updateHighlights()})}}updateFileListSelection(){let e=this.fileListContainer.querySelector(".highlight-file-item-all");e&&e.classList.toggle("is-active",this.currentFile===null&&!this.isFlashcardMode);let t=this.fileListContainer.querySelector(".highlight-file-item-flashcard");t&&t.classList.toggle("is-active",this.isFlashcardMode),this.fileListContainer.querySelectorAll(".highlight-file-item:not(.highlight-file-item-all):not(.highlight-file-item-flashcard)").forEach(o=>{var c;let l=((c=this.currentFile)==null?void 0:c.path)===o.getAttribute("data-path");o.classList.toggle("is-active",l)})}async getFilesWithHighlights(){let t=(await this.app.vault.getMarkdownFiles()).filter(o=>this.highlightService.shouldProcessFile(o)),i=[];for(let o of t){let l=await this.app.vault.read(o);this.highlightService.extractHighlights(l,o).length>0&&i.push(o)}return i}async updateAllHighlights(e="",t=""){this.currentBatch=0,this.highlights=[],this.highlightContainer.empty(),this.highlightContainer.appendChild(this.loadingIndicator);try{if(t==="path"){let h=await this.highlightService.getAllHighlights(),g=new Map,u=this.app.vault.getMarkdownFiles();for(let m of u){let w=this.commentStore.getFileComments(m);w&&w.length>0&&g.set(m.path,w)}this.highlights=[];for(let{file:m,highlights:w}of h){if(e&&!m.path.toLowerCase().includes(e.toLowerCase()))continue;let F=g.get(m.path)||[],E=new Set,Q=w.map(x=>{let P=F.find(M=>!E.has(M.id)&&M.id===x.id);if(P||(P=F.find(M=>{if(E.has(M.id))return!1;let D=M.text===x.text;return D&&x.position!==void 0&&M.position!==void 0?Math.abs(M.position-x.position)<1e3:D})),!P&&x.position!==void 0){let M=x.position;P=F.find(D=>!E.has(D.id)&&D.position!==void 0&&Math.abs(D.position-M)<50)}return P?(E.add(P.id),{...x,id:P.id,comments:P.comments||[],createdAt:P.createdAt,updatedAt:P.updatedAt,fileName:m.basename,filePath:m.path,fileIcon:"file-text"}):{...x,comments:x.comments||[],fileName:m.basename,filePath:m.path,fileIcon:"file-text"}});this.highlights.push(...Q),F.filter(x=>x.isVirtual&&x.comments&&x.comments.length>0&&!E.has(x.id)).forEach(x=>{E.add(x.id),this.highlights.push({...x,fileName:m.basename,filePath:m.path,fileIcon:"file-text",position:x.position||0})})}await this.loadMoreHighlights();return}if(e){let h=Date.now(),g=await this.highlightService.searchHighlightsFromIndex(e);this.highlights=g.map(u=>{var m;return{...u,comments:u.comments||[],fileName:u.fileName||(u.filePath?(m=u.filePath.split("/").pop())==null?void 0:m.replace(".md",""):""),filePath:u.filePath||"",fileIcon:"file-text"}}),await this.loadMoreHighlights();return}let i=await this.highlightService.getAllHighlights(),o=new Map,l=this.app.vault.getMarkdownFiles();for(let h of l){let g=this.commentStore.getFileComments(h);g&&g.length>0&&o.set(h.path,g)}this.highlights=[];for(let{file:h,highlights:g}of i){let u=o.get(h.path)||[],m=new Set,w=g.map(E=>{let Q=u.find(H=>!m.has(H.id)&&H.id===E.id);if(Q||(Q=u.find(H=>{if(m.has(H.id))return!1;let x=H.text===E.text;return x&&E.position!==void 0&&H.position!==void 0?Math.abs(H.position-E.position)<1e3:x})),!Q&&E.position!==void 0){let H=E.position;Q=u.find(x=>!m.has(x.id)&&x.position!==void 0&&Math.abs(x.position-H)<50)}return Q?(m.add(Q.id),{...E,id:Q.id,comments:Q.comments||[],createdAt:Q.createdAt,updatedAt:Q.updatedAt,fileName:h.basename,filePath:h.path,fileIcon:"file-text"}):{...E,comments:E.comments||[],fileName:h.basename,filePath:h.path,fileIcon:"file-text"}});this.highlights.push(...w),u.filter(E=>E.isVirtual&&E.comments&&E.comments.length>0&&!m.has(E.id)).forEach(E=>{m.add(E.id),this.highlights.push({...E,fileName:h.basename,filePath:h.path,fileIcon:"file-text",position:E.position||0})})}await this.loadMoreHighlights();let c=(0,X.debounce)(async h=>{let g=h.target,{scrollTop:u,scrollHeight:m,clientHeight:w}=g;m-u-w<300&&await this.loadMoreHighlights()},100);this.highlightContainer.addEventListener("scroll",c),this.register(()=>this.highlightContainer.removeEventListener("scroll",c))}catch(i){console.error("[CommentView] Error in updateAllHighlights:",i),new X.Notice(f("Error loading all highlights")),this.highlightContainer.empty(),this.highlightContainer.createEl("div",{cls:"highlight-empty-state",text:f("Error loading highlights. Please try again.")})}finally{this.loadingIndicator.removeClass("highlight-display-block")}}async loadMoreHighlights(){if(!this.isLoading){this.isLoading=!0,this.loadingIndicator.addClass("highlight-display-block");try{let e=this.currentBatch*this.BATCH_SIZE,t=this.highlights.slice(e,e+this.BATCH_SIZE);if(t.length===0){this.loadingIndicator.remove();return}await this.renderHighlights(t,!0),this.currentBatch++}catch(e){new X.Notice("\u52A0\u8F7D\u9AD8\u4EAE\u5185\u5BB9\u65F6\u51FA\u9519")}finally{this.isLoading=!1,this.loadingIndicator.addClass("highlight-display-none")}}}async getFileHighlightsCount(e){let t=await this.app.vault.read(e);return this.highlightService.extractHighlights(t,e).length}async getTotalHighlightsCount(){let e=await this.getFilesWithHighlights(),t=0;for(let i of e)t+=await this.getFileHighlightsCount(i);return t}createFloatingButton(){if(this.floatingButton)return;this.floatingButton=document.createElement("div"),this.floatingButton.className="highlight-floating-button";let e=document.createElement("span");(0,X.setIcon)(e,"bot-message-square"),this.floatingButton.appendChild(e),this.floatingButton.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation();try{let i=At.getInstance(this.app,this.plugin);setTimeout(()=>{i.show()},0)}catch(i){console.error("\u521B\u5EFAChatView\u5931\u8D25:",i)}}),document.body.appendChild(this.floatingButton),this.registerActiveLeafChangeHandler()}removeFloatingButton(){this.floatingButton&&(this.floatingButton.remove(),this.floatingButton=null),this.unregisterActiveLeafChangeHandler()}registerActiveLeafChangeHandler(){this.unregisterActiveLeafChangeHandler(),this.activeLeafChangeHandler=()=>{this.updateFloatingButtonVisibility(),typeof Ie.clearAllInstances=="function"&&Ie.clearAllInstances(),this.updateHighlights()},this.app.workspace.on("active-leaf-change",this.activeLeafChangeHandler),this.updateFloatingButtonVisibility()}unregisterActiveLeafChangeHandler(){this.activeLeafChangeHandler&&(this.app.workspace.off("active-leaf-change",this.activeLeafChangeHandler),this.activeLeafChangeHandler=void 0)}updateFloatingButtonVisibility(){if(!this.floatingButton)return;let e=this.app.workspace.activeLeaf;e&&e.view&&e.view.getViewType()===sA?this.floatingButton.style.display="flex":this.floatingButton.style.display="none"}onunload(){this.removeFloatingButton(),this.unregisterActiveLeafChangeHandler()}updateAIDropdowns(){this.aiButtons.forEach(e=>{}),this.app.workspace.trigger("comment-view:update-ai-dropdowns")}registerAIButton(e){this.aiButtons.push(e)}unregisterAIButton(e){let t=this.aiButtons.indexOf(e);t!==-1&&this.aiButtons.splice(t,1)}isInAllHighlightsView(){return this.currentFile===null}filterHighlightsByTerm(e,t=""){if(t==="path")return this.highlights.forEach(i=>{if(i.filePath&&!i.fileName){let o=i.filePath.split("/");i.fileName=o[o.length-1]}}),!e||e.trim()===""?this.highlights.filter(i=>!!i.filePath):this.highlights.filter(i=>i.filePath?i.filePath.toLowerCase().includes(e.toLowerCase()):!1);if(t==="hicard"){let i=this.plugin.fsrsManager;return i?this.highlights.filter(o=>{var c,h;return(o.id?i.findCardsBySourceId(o.id,"highlight").length>0:!1)?e?!!(o.text.toLowerCase().includes(e)||(c=o.comments)!=null&&c.some(g=>g.content.toLowerCase().includes(e))||this.currentFile===null&&((h=o.fileName)!=null&&h.toLowerCase().includes(e))):!0:!1}):[]}return t==="comment"?this.highlights.filter(i=>{var l;return i.comments&&i.comments.length>0?e?!!(i.text.toLowerCase().includes(e)||i.comments&&i.comments.some(c=>c.content.toLowerCase().includes(e))||this.currentFile===null&&((l=i.fileName)!=null&&l.toLowerCase().includes(e))):!0:!1}):this.highlights.filter(i=>{var o,l;return!!(i.text.toLowerCase().includes(e)||(o=i.comments)!=null&&o.some(c=>c.content.toLowerCase().includes(e))||this.currentFile===null&&((l=i.fileName)!=null&&l.toLowerCase().includes(e)))})}showSearchPrefixHints(){let e=document.querySelector(".search-prefix-hints");e&&e.remove();let t=document.body.createDiv({cls:"search-prefix-hints show"});[{prefix:"all:",description:f("search-prefix-all")},{prefix:"path:",description:f("search-prefix-path")},{prefix:"hicard:",description:f("search-prefix-hicard")},{prefix:"comment:",description:f("search-prefix-comment")}].forEach(({prefix:h,description:g})=>{let u=t.createDiv({cls:"search-prefix-hint-item"}),m=u.createSpan({cls:"search-prefix-tag",text:h}),w=u.createSpan({cls:"search-prefix-description",text:g});u.addEventListener("click",()=>{this.searchInput.value=h+" ",this.searchInput.focus(),t.remove();let F=new Event("input",{bubbles:!0});this.searchInput.dispatchEvent(F)})}),this.positionSearchHints(t);let o=()=>{this.searchInput.value.trim()===""?document.body.contains(t)||(document.body.appendChild(t),this.positionSearchHints(t)):t&&document.body.contains(t)&&t.remove()};this.searchInput.addEventListener("input",o);let l=h=>{t&&!t.contains(h.target)&&h.target!==this.searchInput&&(t.remove(),document.removeEventListener("click",l))},c=()=>{setTimeout(()=>{(!document.activeElement||document.activeElement!==this.searchInput&&!t.contains(document.activeElement))&&t.remove()},200)};this.searchInput.addEventListener("blur",c),setTimeout(()=>{document.addEventListener("click",l)},10),this.searchHintsEventHandlers={input:o,blur:c,click:l}}positionSearchHints(e){let t=this.searchInput.getBoundingClientRect();e.addClass("search-hints-container"),e.style.top=t.bottom+4+"px",e.style.left=t.left+"px",e.style.width=t.width+"px"}showSearchLoadingIndicator(){this.isSearching||(this.isSearching=!0,this.searchLoadingIndicator.style.display="flex")}hideSearchLoadingIndicator(){this.isSearching&&(this.isSearching=!1,this.searchLoadingIndicator.style.display="none")}async updateHighlightsList(){try{let e=this.searchInput.value.toLowerCase().trim(),t=e.startsWith("all:"),i=e.startsWith("hicard:"),o=e.startsWith("comment:"),l=e.startsWith("path:"),c="";t?c="all":i?c="hicard":o?c="comment":l&&(c="path");let h=e;if(t?h=e.substring(4).trim():i?h=e.substring(7).trim():o?h=e.substring(8).trim():l&&(h=e.substring(5).trim()),this.highlights.some(u=>u.isGlobalSearch)&&!t&&this.currentFile){this.highlightContainer.empty(),this.highlightContainer.appendChild(this.loadingIndicator),await this.updateHighlights(),this.highlights.forEach(m=>{m.isGlobalSearch=!1});let u=this.filterHighlightsByTerm(h,c);this.renderHighlights(u);return}if((t||l)&&this.currentFile!==null){this.highlightContainer.empty(),this.highlightContainer.appendChild(this.loadingIndicator);let u=this.currentFile;try{this.currentFile=null,await this.updateAllHighlights(h,c),this.highlights.forEach(m=>{m.isGlobalSearch=!0}),this.renderHighlights(this.highlights)}finally{this.currentFile=u,this.hideSearchLoadingIndicator()}}else{this.highlights.forEach(m=>{m.isGlobalSearch=!1});let u=this.filterHighlightsByTerm(h,c);this.renderHighlights(u),this.hideSearchLoadingIndicator()}}catch(e){console.error("[\u9AD8\u4EAE\u641C\u7D22] \u641C\u7D22\u8FC7\u7A0B\u4E2D\u51FA\u9519:",e),this.hideSearchLoadingIndicator()}}async refreshView(){this.isInAllHighlightsView()?await this.updateAllHighlights():await this.updateHighlights()}async updateHighlights(e=!1){if(this.isInAllHighlightsView()){await this.updateAllHighlights();return}if(!this.currentFile){this.renderHighlights([]);return}if(this.currentFile.extension==="canvas"){await this.handleCanvasFile(this.currentFile);return}if(!this.highlightService.shouldProcessFile(this.currentFile)){this.renderHighlights([]);return}let t=await this.app.vault.read(this.currentFile),i=this.highlightService.extractHighlights(t,this.currentFile),o=this.commentStore.getFileComments(this.currentFile),l=new Set;this.highlights=i.map(g=>{var m;let u=o.find(w=>{if(l.has(w.id))return!1;let F=w.text===g.text;return F&&g.position!==void 0&&w.position!==void 0?Math.abs(w.position-g.position)<1e3:F});if(!u&&g.position!==void 0&&(u=o.find(w=>!l.has(w.id)&&w.position!==void 0&&g.position!==void 0&&Math.abs(w.position-g.position)<50)),!u&&this.plugin.highlightMatchingService){let w={id:g.id||Je.generateHighlightId(((m=this.currentFile)==null?void 0:m.path)||"",g.position||0,g.text),text:g.text,position:g.position||0,comments:[],createdAt:g.createdAt||Date.now(),updatedAt:g.updatedAt||Date.now(),blockId:g.blockId,paragraphId:g.paragraphId,paragraphOffset:g.paragraphOffset||0,isVirtual:!1};if(this.currentFile){let F=this.plugin.highlightMatchingService.findMatchingHighlight(this.currentFile,w);F&&!l.has(F.id)&&(u=F)}}return u?(l.add(u.id),{...g,id:u.id,comments:u.comments,createdAt:u.createdAt,updatedAt:u.updatedAt}):g});let h=o.filter(g=>g.isVirtual&&g.comments&&g.comments.length>0&&!l.has(g.id)).filter(g=>!this.highlights.some(u=>u.text===g.text));if(h.forEach(g=>l.add(g.id)),this.highlights.unshift(...h),e&&this.currentFile&&this.highlights.forEach(g=>{var u;g.isFromCanvas=!0,g.isGlobalSearch=!0,g.fileName=(u=this.currentFile)==null?void 0:u.name}),this.highlightsWithFlashcards=new Set,this.plugin&&this.plugin.fsrsManager){let g=this.plugin.fsrsManager;for(let u of this.highlights)if(u.id){let m=g.findCardsBySourceId(u.id,"highlight");m&&m.length>0&&this.highlightsWithFlashcards.add(u.id)}}this.searchInput&&this.searchInput.value.trim()!==""?this.updateHighlightsList():this.renderHighlights(this.highlights)}async handleCanvasFile(e){this.highlightContainer.empty(),this.loadingIndicator&&(this.highlightContainer.appendChild(this.loadingIndicator),this.loadingIndicator.removeClass("highlight-display-none"));try{let t=await this.canvasService.parseCanvasFile(e);if(t.length===0){this.highlightContainer.empty();let i=this.highlightContainer.createDiv({cls:"no-highlights-message",text:"There are no file nodes in the current Canvas."});return}await this.updateAllHighlights("","path"),this.highlights=this.highlights.filter(i=>i.filePath?t.includes(i.filePath):!1),this.highlights.forEach(i=>{i.isFromCanvas=!0,i.canvasSource=e.path,i.isGlobalSearch=!0}),this.renderHighlights(this.highlights)}catch(t){console.error("\u5904\u7406 Canvas \u6587\u4EF6\u5931\u8D25:",t),this.highlightContainer.empty();let i=this.highlightContainer.createDiv({cls:"error-message",text:"\u5904\u7406 Canvas \u6587\u4EF6\u65F6\u51FA\u9519"})}finally{this.loadingIndicator&&this.loadingIndicator.addClass("highlight-display-none")}}addPagePreview(e,t){let i;e.addEventListener("mouseenter",o=>{i=setTimeout(async()=>{let l=o.target;this.app.workspace.trigger("hover-link",{event:o,source:"hi-note",hoverParent:l,targetEl:l,linktext:t.path})},300)}),e.addEventListener("mouseleave",()=>{i&&clearTimeout(i)})}getPreferredLeaf(){let e=this.app.workspace.getLeavesOfType("markdown");if(this.isDraggedToMainView){let t=e.find(i=>i!==this.leaf);if(t)return t}return this.app.workspace.getLeaf("split","vertical")}};var pn=require("obsidian");Ds();var Ps=class{constructor(A,e){this.MIGRATION_VERSION="2.0";this.plugin=A,this.app=A.app,this.dataManager=e}async needsMigration(){try{let A=await this.getMigrationStatus();if(A.isCompleted&&A.version===this.MIGRATION_VERSION)return!1;let e=await this.plugin.loadData();return!!(e!=null&&e.comments||e!=null&&e.fsrs)}catch(A){return console.error("\u68C0\u67E5\u8FC1\u79FB\u72B6\u6001\u5931\u8D25:",A),!1}}async migrate(){let A={totalFiles:0,migratedFiles:0,totalHighlights:0,migratedHighlights:0,totalFlashcards:0,migratedFlashcards:0,errors:[]};try{let e=await this.backupOriginalData(),t=await this.plugin.loadData();if(!t)throw new Error("\u65E0\u6CD5\u52A0\u8F7D\u539F\u59CB\u6570\u636E");return await this.dataManager.initialize(),t.comments&&await this.migrateHighlightsAndComments(t.comments,A),t.fsrs&&await this.migrateFlashcardData(t.fsrs,A),await this.cleanupDataJson(t),await this.markMigrationComplete(e),A}catch(e){throw A.errors.push(`\u8FC1\u79FB\u5931\u8D25: ${e.message}`),console.error("\u6570\u636E\u8FC1\u79FB\u5931\u8D25:",e),e}}async migrateHighlightsAndComments(A,e){e.totalFiles=Object.keys(A).length;for(let[t,i]of Object.entries(A))try{let o=Object.values(i).map(l=>{let c={id:l.id,text:l.text,position:l.position||0,createdAt:l.createdAt||Date.now(),updatedAt:l.updatedAt||Date.now(),filePath:t,comments:l.comments||[]};return l.backgroundColor&&(c.backgroundColor=l.backgroundColor),l.blockId&&(c.blockId=l.blockId),l.isCloze!==void 0&&(c.isCloze=l.isCloze),l.paragraphOffset!==void 0&&(c.paragraphOffset=l.paragraphOffset),c});await this.dataManager.saveFileHighlights(t,o),e.migratedFiles++,e.totalHighlights+=o.length,e.migratedHighlights+=o.length}catch(o){let l=`\u8FC1\u79FB\u6587\u4EF6 ${t} \u5931\u8D25: ${o.message}`;e.errors.push(l),console.error(l)}}async migrateFlashcardData(A,e){try{await this.dataManager.saveFlashcardData(A),A.cards&&(e.totalFlashcards=Object.keys(A.cards).length,e.migratedFlashcards=e.totalFlashcards)}catch(t){let i=`\u8FC1\u79FB\u95EA\u5361\u6570\u636E\u5931\u8D25: ${t.message}`;e.errors.push(i),console.error(i)}}async backupOriginalData(){let e=`.hinote/backup/data-backup-${new Date().toISOString().replace(/[:.]/g,"-")}.json`;try{await this.app.vault.adapter.mkdir(".hinote/backup")}catch(i){}let t=await this.plugin.loadData();return await this.app.vault.adapter.write(e,JSON.stringify(t,null,2)),e}async cleanupDataJson(A){let{comments:e,fsrs:t,...i}=A;await this.plugin.saveData(i)}async markMigrationComplete(A){let e={isCompleted:!0,version:this.MIGRATION_VERSION,migratedAt:Date.now(),backupPath:A};await this.app.vault.adapter.write(".hinote/metadata/migration-status.json",JSON.stringify(e,null,2))}async getMigrationStatus(){let A=".hinote/metadata/migration-status.json";try{let e=await this.app.vault.adapter.read(A);return JSON.parse(e)}catch(e){return{isCompleted:!1,version:"1.0"}}}async validateMigration(){let A=[];try{(await this.getMigrationStatus()).isCompleted||A.push("\u8FC1\u79FB\u672A\u5B8C\u6210"),(await this.dataManager.getAllHighlightFiles()).length===0&&A.push("\u672A\u627E\u5230\u4EFB\u4F55\u9AD8\u4EAE\u6570\u636E\u6587\u4EF6"),await this.dataManager.getFlashcardData()||A.push("\u95EA\u5361\u6570\u636E\u4E22\u5931");let o=await this.plugin.loadData();(o!=null&&o.comments||o!=null&&o.fsrs)&&A.push("data.json\u672A\u6B63\u786E\u6E05\u7406")}catch(e){A.push(`\u9A8C\u8BC1\u8FC7\u7A0B\u51FA\u9519: ${e.message}`)}return{valid:A.length===0,issues:A}}async rollbackMigration(){try{let A=await this.getMigrationStatus();if(!A.backupPath)throw new Error("\u672A\u627E\u5230\u5907\u4EFD\u6587\u4EF6\u8DEF\u5F84");let e=await this.app.vault.adapter.read(A.backupPath),t=JSON.parse(e);await this.plugin.saveData(t);try{await this.app.vault.adapter.remove(".hinote/metadata/migration-status.json")}catch(i){}}catch(A){throw console.error("\u56DE\u6EDA\u8FC1\u79FB\u5931\u8D25:",A),A}}};var Ks=class{constructor(A){this.data={};this.comments=new Map;this.commentCache=new Map;this.maxCacheSize=100;this.PERFORMANCE_THRESHOLD=100;this.useNewStorage=!1;this.plugin=A,this.eventManager=new et(A.app),this.blockIdService=new Mt(A.app),this.highlightService=new cA(A.app),this.dataManager=new tt(A.app),this.migrationManager=new Ps(A,this.dataManager)}async loadComments(){if(await this.migrationManager.needsMigration())try{let e=await this.migrationManager.migrate();this.useNewStorage=!0}catch(e){console.error("\u6570\u636E\u8FC1\u79FB\u5931\u8D25\uFF0C\u56DE\u9000\u5230\u65E7\u5B58\u50A8\u65B9\u5F0F:",e),this.useNewStorage=!1}else{let e=await this.migrationManager.getMigrationStatus();this.useNewStorage=e.isCompleted}this.useNewStorage?(await this.dataManager.initialize(),await this.loadCommentsFromNewStorage()):await this.loadCommentsFromLegacyStorage()}async loadCommentsFromNewStorage(){this.data={},this.comments=new Map;let A=await this.dataManager.getAllHighlightFiles();for(let e of A){let t=await this.dataManager.getFileHighlights(e);if(t.length>0){let i={};t.forEach(o=>{i[o.id]=o}),this.data[e]=i,this.comments.set(e,t)}}}async loadCommentsFromLegacyStorage(){let A=await this.plugin.loadData();this.data=(A==null?void 0:A.comments)||{},this.migrateDataToBlockId(),this.comments=new Map(Object.entries(this.data).map(([e,t])=>[e,Object.values(t)]))}migrateDataToBlockId(){let A=0;for(let e in this.data){let t=this.data[e];for(let i in t){let o=t[i];if(o.paragraphId&&!o.blockId){let l=o.paragraphId.match(/#\^([a-zA-Z0-9-]+)/);l&&l[1]&&(o.blockId=l[1],A++)}}}}async saveComments(){this.useNewStorage?await this.saveCommentsToNewStorage():await this.saveCommentsToLegacyStorage()}async saveCommentsToNewStorage(){for(let[A,e]of this.comments.entries())await this.dataManager.saveFileHighlights(A,e)}async saveCommentsToLegacyStorage(){let e={...await this.plugin.loadData()||{},comments:this.data};await this.plugin.saveData(e);let t=await this.plugin.loadData()}async checkOrphanedDataCount(){let A=0,e=new Set;for(let t in this.data){let i=this.plugin.app.vault.getAbstractFileByPath(t);if(!i||!(i instanceof pn.TFile)){e.add(t),A+=Object.keys(this.data[t]||{}).length;continue}try{let o=await this.plugin.app.vault.read(i),l=this.highlightService.extractHighlights(o,i),c=new Set(l.map(u=>u.text)),h=this.data[t]||{},g=!1;for(let u in h){let m=h[u];m.isVirtual||c.has(m.text)||(A++,g=!0)}g&&e.add(t)}catch(o){}}return{orphanedHighlights:A,affectedFiles:e.size}}async cleanOrphanedData(){let A=0,e=new Set;for(let t in this.data){let i=this.plugin.app.vault.getAbstractFileByPath(t);if(!i||!(i instanceof pn.TFile)){delete this.data[t],this.comments.delete(t),e.add(t),A+=Object.keys(this.data[t]||{}).length;continue}try{let o=await this.plugin.app.vault.read(i),l=this.highlightService.extractHighlights(o,i),c=new Set(l.map(u=>u.text)),h=this.data[t]||{},g=!1;for(let u in h){let m=h[u];m.isVirtual||c.has(m.text)||(delete h[u],A++,g=!0)}g&&(e.add(t),this.comments.set(t,Object.values(h)),Object.keys(h).length===0&&(delete this.data[t],this.comments.delete(t)))}catch(o){}}return A>0&&await this.saveComments(),{removedHighlights:A,affectedFiles:e.size}}async updateFilePath(A,e){if(this.useNewStorage){await this.dataManager.handleFileRename(A,e),this.data[A]&&(this.data[e]=this.data[A],delete this.data[A]);let t=this.comments.get(A)||[];t.forEach(i=>{i.filePath=e}),this.comments.set(e,t),this.comments.delete(A)}else{this.data[A]&&(this.data[e]=this.data[A],delete this.data[A]);let t=this.comments.get(A)||[];this.comments.set(e,t),this.comments.delete(A),await this.saveComments()}}getHiNotes(A){let e=this.plugin.app.workspace.getActiveFile();if(!e)return[];let t=this.data[e.path]||{};return Object.values(t).filter(i=>{let o=i.text===A.text;return o&&typeof i.position=="number"&&typeof A.position=="number"?Math.abs(i.position-A.position)<1e3:o})}getFileComments(A){if(!A)return[];let e=this.data[A.path]||{};return Object.values(e)}async addComment(A,e){e.id||(e.id=Je.generateHighlightId(A.path,e.position||0,e.text));let t=Date.now();e.createdAt||(e.createdAt=t),e.updatedAt=t;let i=A.path;this.data[i]||(this.data[i]={}),this.data[i][e.id]=e,this.comments.has(i)||this.comments.set(i,[]);let o=this.comments.get(i)||[],l=o.findIndex(c=>c.id===e.id);if(l>=0?o[l]=e:o.push(e),await this.saveComments(),this.eventManager)if(e.comments&&e.comments.length>0){let c=e.comments[e.comments.length-1];this.eventManager.emitCommentUpdate(i,e.text,c.content,e.id)}else this.eventManager.emitHighlightUpdate(i,e.text,e.text,e.id);return e}async removeComment(A,e){let t=A.path;if(!this.data[t]||!this.data[t][e.id])return!1;if(delete this.data[t][e.id],Object.keys(this.data[t]).length===0&&delete this.data[t],this.comments.has(t)){let o=(this.comments.get(t)||[]).filter(l=>l.id!==e.id);o.length>0?this.comments.set(t,o):this.comments.delete(t)}if(await this.saveComments(),this.eventManager)if(e.comments&&e.comments.length>0){let i=e.comments[e.comments.length-1];this.eventManager.emitCommentDelete(t,i.content,e.id)}else this.eventManager.emitHighlightDelete(t,e.text,e.id);return!0}getCommentsByBlockId(A,e){if(!A||!e)return[];let t=A.path;return this.data[t]?Object.values(this.data[t]).filter(o=>o.blockId===e):[]}};var it=require("@codemirror/view"),fn=require("obsidian");var No=require("@codemirror/view"),Tt=require("obsidian");var ks=class y extends No.WidgetType{constructor(e,t,i,o){super();this.plugin=e;this.highlight=t;this.highlightItems=i;this.onClick=o;this.app=this.plugin.app,this.textSimilarityService=new CA(this.plugin.app)}eq(e){return!(e instanceof y)||this.highlight.id!==e.highlight.id?!1:(this.textSimilarityService.calculateSimilarity(this.highlight.text,e.highlight.text)>.7||this.highlight.text===e.highlight.text)&&this.highlight.comments.length===e.highlight.comments.length}get estimatedHeight(){return 0}get lineBreaks(){return 0}toDOM(){let e=document.createElement("span");e.addClass("hi-note-widget"),e.setAttribute("data-highlight-id",this.highlight.id);let t=(this.highlight.comments||[]).length>0;return this.createButton(e),e}createButton(e){let t=(this.highlight.comments||[]).length>0,i=e.createEl("button",{cls:`hi-note-button clickable-icon ${t?"":"hi-note-button-hidden"}`}),o=this.createIconContainer(i),l=this.createTooltip(e);this.setupEventListeners(e,i,l)}createIconContainer(e){let t=e.createEl("span",{cls:"hi-note-icon-container"});(0,Tt.setIcon)(t,"message-circle");let o=(this.highlight.comments||[]).length;return o>0&&t.createEl("span",{cls:"hi-note-count",text:o.toString()}),t}createTooltip(e){let t=document.createElement("div");t.addClass("hi-note-tooltip","hi-note-tooltip-hidden"),t.setAttribute("data-highlight-id",this.highlight.id);let i=t.createEl("div",{cls:"hi-note-tooltip-list"}),o=this.highlight.comments||[];return this.renderTooltipContent(i,o,t),document.body.appendChild(t),{tooltip:t,updateTooltipPosition:()=>{let c=e.getBoundingClientRect();t.style.position="fixed",t.style.top=`${c.bottom+4}px`,t.style.left=`${c.right-t.offsetWidth}px`}}}renderTooltipContent(e,t,i){t.length!==0&&(t.slice(0,3).forEach(o=>{let l=e.createEl("div",{cls:"hi-note-tooltip-item"}),c=l.createEl("div",{cls:"hi-note-tooltip-content markdown-rendered"});this.renderMarkdownContent(c,o.content),l.createEl("div",{cls:"hi-note-tooltip-time",text:new Date(o.createdAt).toLocaleString()})}),t.length>3&&i.createEl("div",{cls:"hi-note-tooltip-more",text:`\u8FD8\u6709 ${t.length-3} \u6761\u8BC4\u8BBA...`}))}setupEventListeners(e,t,i){let{tooltip:o,updateTooltipPosition:l}=i;(this.highlight.comments||[]).length>0?(t.removeClass("hi-note-button-hidden"),t.addEventListener("mouseenter",()=>{o.removeClass("hi-note-tooltip-hidden"),l()}),t.addEventListener("mouseleave",()=>{o.addClass("hi-note-tooltip-hidden")})):(t.addClass("hi-note-button-hidden"),e.addEventListener("mouseenter",()=>{t.removeClass("hi-note-button-hidden")}),e.addEventListener("mouseleave",()=>{t.addClass("hi-note-button-hidden")})),t.addEventListener("click",g=>{g.preventDefault(),g.stopPropagation(),this.onClick(),o.addClass("hi-note-tooltip-hidden");let u=new CustomEvent("open-comment-input",{detail:{highlightId:this.highlight.id,text:this.highlight.text}});window.dispatchEvent(u)}),window.addEventListener("resize",l)}async renderMarkdownContent(e,t){try{await Tt.MarkdownRenderer.render(this.app,t,e,"",new Tt.Component),e.querySelectorAll("ul, ol").forEach(o=>{o.addClass("tooltip-markdown-list")})}catch(i){console.error("Error rendering markdown in tooltip:",i),e.textContent=t}}destroy(e){let t=document.querySelector(`.hi-note-tooltip[data-highlight-id="${this.highlight.id}"]`);t&&t.remove(),e.remove()}updateDOM(e){return!1}ignoreEvent(){return!0}};var Rs=class{constructor(A,e){this.plugin=A,this.commentStore=e,this.highlightService=new cA(this.plugin.app),this.textSimilarityService=new CA(this.plugin.app)}refreshDecorations(){let A=this.getActiveMarkdownView();if(!(A!=null&&A.editor))return;let e=A.editor.cm;e&&e.dispatch({changes:[],effects:[]})}findMatchingHighlight(A,e,t){if(!t||t.length===0)return null;let i=t.find(o=>o.text===e.text&&(typeof o.position!="number"||typeof e.position!="number"||Math.abs(o.position-e.position)<10))||null;if(!i&&typeof e.position=="number"&&(i=t.find(o=>typeof o.position=="number"&&Math.abs(o.position-e.position)<30)||null),!i){let o=null,l=0;for(let c of t){if(!c.comments||c.comments.length===0)continue;let h=this.textSimilarityService.calculateSimilarity(c.text,e.text);h>l&&h>.6&&(l=h,o=c)}o&&(i=o)}return i}getActiveMarkdownView(){return this.plugin.app.workspace.getActiveViewOfType(fn.MarkdownView)}enable(){let A=this.plugin,e=this.commentStore,t=this.highlightService,i=this.textSimilarityService,o=this.findMatchingHighlight.bind(this);this.plugin.registerEvent(this.plugin.eventManager.on("comment:update",()=>{this.refreshDecorations()})),this.plugin.registerEvent(this.plugin.eventManager.on("comment:delete",()=>{this.refreshDecorations()})),this.plugin.registerEvent(this.plugin.eventManager.on("highlight:update",()=>{this.refreshDecorations()})),this.plugin.registerEvent(this.plugin.eventManager.on("highlight:delete",()=>{this.refreshDecorations()}));let l=it.ViewPlugin.fromClass(class{constructor(c){this.plugin=A,this.commentStore=e,this.highlightService=new cA(this.plugin.app),this.textSimilarityService=new CA(this.plugin.app),this.decorations=this.buildDecorations(c)}createHiNoteFromHighlight(c){return{...c,id:c.id||`highlight-${Date.now()}-${c.position}`,comments:c.comments||[],position:c.position,paragraphOffset:c.paragraphOffset||0,blockId:c.blockId,paragraphId:c.paragraphId||`p-${c.paragraphOffset||0}`,createdAt:c.createdAt||Date.now(),updatedAt:c.updatedAt||Date.now(),text:c.text}}findExactMatchingHighlight(c,h){return h.find(g=>g.text===c.text&&(typeof g.position!="number"||typeof c.position!="number"||Math.abs(g.position-c.position)<10))||null}handleTextChanges(c,h,g){h.text!==g.text&&A.highlightMatchingService.recoverHighlight(c,h,g.text).then(u=>{u&&A.eventManager.emitHighlightUpdate(c.path,h.text,g.text)})}getCommentsForHighlight(c,h,g=!0){let u=[];if(h.blockId){let m=e.getCommentsByBlockId(c,h.blockId);if(m&&m.length>0){let w=m.find(F=>F.text===h.text);if(w)u=w.comments||[];else{let F=this.findExactMatchingHighlight(h,m);if(F)u=F.comments||[];else if(g){let E=o(c,h,m);E&&(this.handleTextChanges(c,E,h),u=E.comments||[])}}}}else{let m=e.getHiNotes(h);if(m&&m.length>0){let w=m.find(F=>F.text===h.text);if(w)u=w.comments||[];else{let F=this.findExactMatchingHighlight(h,m);if(F)u=F.comments||[];else if(g){let E=o(c,h,m);E&&(this.handleTextChanges(c,E,h),u=E.comments||[])}}}}return u}calculateHighlightPosition(c,h){var F;let g=(F=h.originalLength)!=null?F:h.text.length+4,u=c.slice(h.position,h.position+g),m=u.startsWith("<"),w;if(m){let E=/<[^>]+>/.exec(u),Q=/<\/[^>]+>/.exec(u);w=h.position+g}else w=h.position+h.text.length+4;return{highlightEndPos:w,isHtmlTag:m,originalText:u,originalLength:g}}findMatchingHighlight(c,h,g){if(!g||g.length===0)return null;let u=g.find(m=>m.text===h.text&&(typeof m.position!="number"||typeof h.position!="number"||Math.abs(m.position-h.position)<10))||null;if(!u&&typeof h.position=="number"&&(u=g.find(m=>typeof m.position=="number"&&Math.abs(m.position-h.position)<30)||null),!u){let m=null,w=0;for(let F of g){if(!F.comments||F.comments.length===0)continue;let E=this.textSimilarityService.calculateSimilarity(F.text,h.text);E>w&&E>.6&&(w=E,m=F)}m&&(u=m)}return u}update(c){(c.docChanged||c.viewportChanged||c.transactions.length>0)&&(this.decorations=this.buildDecorations(c.view))}buildDecorations(c){var F,E;let h=[],u=c.state.doc.toString(),m=this.plugin.app.workspace.getActiveViewOfType(fn.MarkdownView);if(!m||!m.file)return it.Decoration.none;if(!this.highlightService.shouldProcessFile(m.file))return it.Decoration.none;let w=this.highlightService.extractHighlights(u,m.file);for(let Q of w){if(Q.position===void 0)continue;let H=this.createHiNoteFromHighlight(Q);if(m.file){let J=this.getCommentsForHighlight(m.file,H,!0);H.comments=J}let{highlightEndPos:x,isHtmlTag:P,originalText:M,originalLength:D}=this.calculateHighlightPosition(u,Q),O=this.isAtParagraphEnd(u,x);if(this.plugin.settings.showCommentWidget!==!1){let J=this.createCommentWidget(H,[H]);h.push(J.range(x))}if(P){let J=/<[^>]+>/.exec(M),se=/<\/[^>]+>/.exec(M);if(J&&se){let W=Q.position+J[0].length,ce=Q.position+D-se[0].length,we=m.file?this.getCommentsForHighlight(m.file,H,!1):[],Ae=we.length>0?(F=we[0])==null?void 0:F.content:"",z=it.Decoration.mark({class:"cm-highlight",attributes:{title:Ae||"","data-highlight-type":"html",style:Q.backgroundColor?`background-color: ${Q.backgroundColor}`:""}});h.push(z.range(W,ce))}}else{let se=Q.position+Q.text.length+4,W=m.file?this.getCommentsForHighlight(m.file,H,!1):[],ce=W.length>0?(E=W[0])==null?void 0:E.content:""}}return it.Decoration.set(h.sort((Q,H)=>Q.from-H.from))}createCommentWidget(c,h){return it.Decoration.widget({widget:new ks(this.plugin,c,h,()=>this.openCommentPanel(c)),side:2,stopEvent:g=>!0})}openCommentPanel(c){let h=this.plugin.app.workspace,g=h.getLeavesOfType("comment-view");if(g.length)h.revealLeaf(g[0]);else{let u=h.getRightLeaf(!1);u&&u.setViewState({type:"comment-view",active:!0})}}isAtParagraphEnd(c,h){if(h>=c.length)return!0;let g=c.charAt(h),u=c.substr(h,2),m=g===`
`||g==="\r"||u===`\r
`,w=m;if(m){let F=h+(u===`\r
`?2:1);if(F>=c.length)w=!0;else{let E=c.charAt(F),Q=c.substr(F,2);w=E===`
`||E==="\r"||Q===`\r
`}}return w}},{decorations:c=>c.decorations});this.highlightPlugin=l,this.plugin.registerEditorExtension([l])}disable(){if(this.highlightPlugin){let A=this.getActiveMarkdownView();A!=null&&A.editor&&A.editor.refresh()}document.querySelectorAll(".hi-note-widget").forEach(A=>A.remove())}updateTooltipContent(A,e){let t=A.querySelector(".hi-note-tooltip-list");t&&(t.empty(),e.slice(0,3).forEach(i=>{let o=t.createEl("div",{cls:"hi-note-tooltip-item"});o.createEl("div",{cls:"hi-note-tooltip-content",text:i.content}),o.createEl("div",{cls:"hi-note-tooltip-time",text:new Date(i.createdAt).toLocaleString()})}))}};var _o=require("obsidian");var rA=require("obsidian");var st=require("obsidian");var Os=class{constructor(A,e){this.containerEl=A,this.plugin=e,this.rules=e.settings.regexRules||[],this.rulesContainer=A.createDiv({cls:"regex-rules-container"}),this.display()}display(){this.rulesContainer.empty();let A=this.rulesContainer.createDiv({cls:"regex-rule-warning"});A.innerHTML=f("Use regex with caution. If there are capture groups (), the first capture group will be used as the highlight text; if there are no capture groups, the entire match will be used."),this.rules.length===0?this.rulesContainer.createDiv().setText(f('No custom regex rules. Click "+" to add a new rule.')):this.rules.forEach((i,o)=>{this.createRuleItem(i,o)});let e=this.rulesContainer.createDiv({cls:"regex-rule-add"});e.createSpan({cls:"regex-rule-add-text"}).setText(f("Add new rule")),e.addEventListener("click",()=>{let i={id:`rule-${Date.now()}`,name:"",pattern:"",color:"#ffeb3b",enabled:!0};this.rules.push(i),this.saveRules(),this.display()})}createRuleItem(A,e){let t=this.rulesContainer.createDiv({cls:"regex-rule-item"}),i=new st.TextComponent(t);i.setPlaceholder(f("Rule name")),i.setValue(A.name),i.onChange(u=>{A.name=u,this.saveRules()});let o=new st.TextComponent(t);o.setPlaceholder(f("Regular expression with capture groups")),o.setValue(A.pattern),o.onChange(u=>{A.pattern=u,this.saveRules()});let l=t.createDiv(),c=new st.TextComponent(l);c.setPlaceholder("#ffeb3b"),c.setValue(A.color),c.inputEl.addClass("color-input"),c.onChange(u=>{let m=u.trim();m&&(m.startsWith("#")||m.startsWith("rgb")||m.startsWith("rgba"))&&(A.color=m,this.saveRules())});let h=t.createDiv({cls:"regex-rule-delete"});(0,st.setIcon)(h,"trash-2"),h.setAttr("aria-label",f("Delete rule")),h.addEventListener("click",()=>{this.rules.splice(e,1),this.saveRules(),this.display()});let g=new st.ToggleComponent(t);g.setValue(A.enabled),g.onChange(u=>{A.enabled=u,this.saveRules()}),g.toggleEl.addClass("regex-rule-toggle")}async saveRules(){this.plugin.settings.regexRules=this.rules,await this.plugin.saveSettings()}};var Ns=class{constructor(A,e){this.plugin=A,this.containerEl=e}async updateOrphanedDataCount(A){try{let e=A.querySelector(".orphaned-data-count, .no-orphaned-data");e&&e.remove();let t=await this.plugin.commentStore.checkOrphanedDataCount(),i=document.createElement("div");t.orphanedHighlights>0?(i.className="orphaned-data-count",i.textContent=`Found ${t.orphanedHighlights} orphaned highlights in ${t.affectedFiles} files.`):(i.className="no-orphaned-data",i.textContent="No orphaned data found."),A.appendChild(i)}catch(e){console.error("[HiNote] Error updating orphaned data count:",e)}}display(){let A=this.containerEl.createEl("div",{cls:"general-settings-container"});new rA.Setting(A).setName(f("Export Path")).setDesc(f("Set the path for exported highlight notes. Leave empty to use vault root. The path should be relative to your vault root.")).addText(h=>h.setPlaceholder("Example: folder 1/folder 2").setValue(this.plugin.settings.export.exportPath||"").onChange(async g=>{g=g.replace(/^\/+/,""),g=g.replace(/\/+$/,""),this.plugin.settings.export.exportPath=g,await this.plugin.saveSettings()})),new rA.Setting(A).setName(f("Exclusions")).setDesc(f("Comma separated list of paths, tags, note titles or file extensions that will be excluded from highlighting. e.g. folder1, folder1/folder2, [[note1]], [[note2]], *.excalidraw.md")).addTextArea(h=>{h.setPlaceholder("folder1, folder1/folder2, [[note1]], [[note2]], *.excalidraw.md").setValue(this.plugin.settings.excludePatterns||"").onChange(async g=>{let u=g.split(",").map(m=>m.trim()).filter(m=>m.length>0);this.plugin.settings.excludePatterns=g,await this.plugin.saveSettings()}),h.inputEl.rows=4,h.inputEl.cols=40}),new rA.Setting(A).setName(f("Export template")).setDesc(f("Customize the format of exported highlights and comments using variables. Available variables: {{highlightText}}, {{highlightBlockRef}}, {{commentContent}}, {{commentDate}}. Leave empty to use default template.")).addTextArea(h=>{h.setPlaceholder(`> [!quote] HiNote
> {{highlightText}}
> 
>> [!note]+ {{commentDate}}
>> {{commentContent}}`).setValue(this.plugin.settings.export.exportTemplate||"").onChange(async u=>{this.plugin.settings.export.exportTemplate=u,await this.plugin.saveSettings()}),h.inputEl.rows=5,h.inputEl.cols=40}),new rA.Setting(A).setName(f("Show Comment Widget")).setDesc(f("Show or hide the comment widget next to highlights. Disabling this can reduce visual clutter while reading.")).addToggle(h=>{var g;return h.setValue((g=this.plugin.settings.showCommentWidget)!=null?g:!0).onChange(async u=>{this.plugin.settings.showCommentWidget=u,await this.plugin.saveSettings(),this.plugin.highlightDecorator&&this.plugin.highlightDecorator.refreshDecorations()})}),new rA.Setting(A).setName(f("Custom text extraction")).setHeading(),new rA.Setting(A).setName(f("Use custom rules")).setDesc(f("Enable to use custom regex rules to extract highlight text.")).addToggle(h=>h.setValue(this.plugin.settings.useCustomPattern).onChange(async g=>{this.plugin.settings.useCustomPattern=g,await this.plugin.saveSettings()}));let e=A.createDiv({cls:"regex-editor-container"});new Os(e,this.plugin),new rA.Setting(A).setName(f("Data management")).setHeading();let t=new rA.Setting(A).setName(f("Clean orphaned data")).setDesc(f("Remove highlights and comments that no longer exist in your documents. This is useful if you have deleted highlights but their comments are still stored in the data file.")),i=0,o=0,l=!1,c=t.addButton(h=>{h.setButtonText(f("Check")),h.onClick(async()=>{h.setButtonText(f("Checking...")),h.setDisabled(!0);try{let g=await this.plugin.commentStore.checkOrphanedDataCount();i=g.orphanedHighlights,o=g.affectedFiles,l=!0;let u=t.descEl,m=u.querySelector(".orphaned-data-count, .no-orphaned-data");m&&m.remove();let w=document.createElement("div");i>0?(w.className="orphaned-data-count",w.textContent=`Found ${i} orphaned highlights in ${o} files.`,h.setButtonText(f("Clean data")),h.setDisabled(!1),h.onClick(async()=>{h.setButtonText(f("Cleaning...")),h.setDisabled(!0);try{let F=await this.plugin.commentStore.cleanOrphanedData();F.removedHighlights>0?new rA.Notice(`Cleaned ${F.removedHighlights} orphaned highlights from ${F.affectedFiles} files.`):new rA.Notice("No orphaned data found."),h.setButtonText(f("Check")),l=!1,w&&w.parentElement&&w.parentElement.removeChild(w)}catch(F){console.error("[HiNote] Error cleaning orphaned data:",F),new rA.Notice("Error cleaning orphaned data. Check console for details."),h.setButtonText(f("Check"))}finally{h.setDisabled(!1)}})):(w.className="no-orphaned-data",w.textContent="No orphaned data found.",h.setButtonText(f("Check")),h.setDisabled(!1)),u.appendChild(w)}catch(g){console.error("[HiNote] Error checking orphaned data:",g),new rA.Notice("Error checking orphaned data. Check console for details."),h.setButtonText(f("Check")),h.setDisabled(!1)}})})}};var Vo=require("obsidian");var Ge=require("obsidian");var Go=require("obsidian");var nA=class{constructor(A,e){this.plugin=A,this.containerEl=e}createModelDropdown(A,e,t){new Go.Setting(A).setName(f("Model")).setDesc(f("Select the AI model to use")).addDropdown(i=>{let o=Object.fromEntries(e.map(l=>[l.id,l.name]));return i.addOptions(o).setValue(this.plugin.settings.ai.model||t.id).onChange(async l=>{this.plugin.settings.ai.model=l,await this.plugin.saveSettings()})})}};var Bi=[{id:"gpt-4o",name:"GPT-4o"},{id:"gpt-4o-mini",name:"GPT-4o Mini"},{id:"gpt-o1",name:"GPT-o1"},{id:"gpt-4",name:"GPT-4"},{id:"gpt-4-turbo",name:"GPT-4 Turbo"}],Gs=class extends nA{constructor(e,t){super(e,t);this.modelSelectEl=null;this.customModelContainer=null;this.modelState=this.initializeModelState()}initializeModelState(){this.plugin.settings.ai.openai||(this.plugin.settings.ai.openai={apiKey:"",model:Bi[0].id,apiAddress:"",isCustomModel:!1,lastCustomModel:""});let e=this.plugin.settings.ai.openai,t;if(e.isCustomModel)t={id:e.model,name:e.model,isCustom:!0};else{let i=Bi.find(o=>o.id===e.model);t=i||Bi[0],i||(e.model=t.id)}return{selectedModel:t,apiKey:e.apiKey||""}}async saveModelState(){this.plugin.settings.ai.openai||(this.plugin.settings.ai.openai={});let e=this.plugin.settings.ai.openai,t=this.modelState.selectedModel;e.model=t.id,e.isCustomModel=!!t.isCustom,e.apiKey=this.modelState.apiKey||"",t.isCustom&&t.id&&(e.lastCustomModel=t.id),await this.plugin.saveSettings()}display(e){let t=e.createEl("div",{cls:"ai-service-settings"});new Ge.Setting(t).setName(f("OpenAI service")).setHeading(),new Ge.Setting(t).setName(f("API Key")).setDesc(f("Please enter your API Key.")).addText(g=>g.setPlaceholder("sk-...").setValue(this.modelState.apiKey).onChange(async u=>{this.modelState.apiKey=u,await this.saveModelState()})).addButton(g=>g.setButtonText(f("Check")).onClick(async()=>{if(!this.modelState.apiKey){new Ge.Notice(f("Please enter an API Key first"));return}g.setDisabled(!0),g.setButtonText(f("Checking..."));try{(await this.fetchAvailableModels(this.modelState.apiKey)).length>0?new Ge.Notice(f("API Key is valid!")):new Ge.Notice(f("No models available. Please check your API Key."))}catch(u){new Ge.Notice(f("Failed to validate API Key. Please check your key and try again."))}finally{g.setDisabled(!1),g.setButtonText(f("Check"))}}));let i=new Ge.Setting(t).setName(f("Model")).setDesc(f("Select a model or enter a custom one.")).addDropdown(g=>{Bi.forEach(m=>{g.addOption(m.id,m.name)}),g.addOption("custom",f("Custom Model"));let u=this.modelState.selectedModel.isCustom?"custom":this.modelState.selectedModel.id;return g.setValue(u),this.modelSelectEl=g.selectEl,g.onChange(async m=>{if(m==="custom")await this.showCustomModelInput();else{let w=Bi.find(F=>F.id===m);if(w){if(this.modelState.selectedModel.isCustom){let F=this.plugin.settings.ai.openai;F.lastCustomModel=this.modelState.selectedModel.id,await this.plugin.saveSettings()}this.modelState.selectedModel=w,await this.saveModelState(),await this.hideCustomModelInput()}}}),g});this.customModelContainer=i.settingEl.createDiv("custom-model-container"),this.customModelContainer.addClass("custom-model-container");let o=i.settingEl.querySelector(".setting-item-control");o&&(o.addClass("openai-dropdown-container"),o.insertBefore(this.customModelContainer,o.firstChild));let c=new Ge.Setting(this.customModelContainer).addText(g=>g.setPlaceholder("model-id").setValue(this.modelState.selectedModel.isCustom?this.modelState.selectedModel.id:"").onChange(async u=>{let m=u.trim();if(m){if(!/^[a-zA-Z0-9-_.]+$/.test(m)){new Ge.Notice(f("Model ID can only contain letters, numbers, underscores, dots and hyphens.")),g.setValue(this.modelState.selectedModel.id);return}this.modelState.selectedModel={id:m,name:m,isCustom:!0},await this.saveModelState()}})).settingEl;c.addClass("openai-setting-no-border");let h=c.querySelector(".setting-item-control");h&&h.addClass("openai-setting-no-margin"),this.modelState.selectedModel.isCustom&&this.showCustomModelInput(),new Ge.Setting(t).setName(f("Provider URL")).setDesc(f("Leave it blank, unless you are using a proxy.")).addText(g=>{var u;return g.setPlaceholder("https://api.openai.com/v1").setValue(((u=this.plugin.settings.ai.openai)==null?void 0:u.apiAddress)||"").onChange(async m=>{this.plugin.settings.ai.openai||(this.plugin.settings.ai.openai={}),this.plugin.settings.ai.openai.apiAddress=m,await this.plugin.saveSettings()})})}async validateModel(e,t,i){try{let o=await(0,Ge.requestUrl)({url:`${i}/models/${t}`,method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(o.status!==200){let c=await o.json.catch(()=>null);return new Ge.Notice(f("Custom model unavailable. Please check the model ID and your access permissions.")),!1}let l=await(0,Ge.requestUrl)({url:`${i}/chat/completions`,method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({model:t,messages:[{role:"user",content:"Hello"}],max_tokens:1})});if(l.status!==200){let c=await l.json.catch(()=>null);return!1}return!0}catch(o){return!1}}async fetchAvailableModels(e){var t;try{let i=((t=this.plugin.settings.ai.openai)==null?void 0:t.apiAddress)||"https://api.openai.com/v1";if(this.modelState.selectedModel.isCustom){let l=this.modelState.selectedModel.id;if(!await this.validateModel(e,l,i))throw new Error(`Custom model not available: ${l}`);return[this.modelState.selectedModel]}let o=await(0,Ge.requestUrl)({url:`${i}/models`,method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});return o.status===200?o.json.data.map(h=>({id:h.id,name:h.id})):[]}catch(i){throw i}}async showCustomModelInput(){if(this.customModelContainer&&this.modelSelectEl){this.customModelContainer.addClass("visible"),this.modelSelectEl.value="custom";let e=this.plugin.settings.ai.openai;if(!this.modelState.selectedModel.isCustom){let i=e.lastCustomModel||"";this.modelState.selectedModel={id:i,name:i,isCustom:!0},e.model=i,e.isCustomModel=!0,await this.plugin.saveSettings();let o=this.customModelContainer.querySelector("input");o&&(o.value=i)}}}async hideCustomModelInput(){this.customModelContainer&&this.customModelContainer.removeClass("visible")}};var fA=require("obsidian");var wi=[{id:"claude-opus-4-1-20250805",name:"Claude Opus 4.1"},{id:"claude-opus-4-20250514",name:"Claude Opus 4"},{id:"claude-sonnet-4-20250514",name:"Claude Sonnet 4"},{id:"claude-3-7-sonnet-20250219",name:"Claude Sonnet 3.7"},{id:"claude-3-5-haiku-20241022",name:"Claude Haiku 3.5"},{id:"claude-3-haiku-20240307",name:"Claude Haiku 3"}],Vs=class extends nA{constructor(e,t){super(e,t);this.modelSelectEl=null;this.customModelContainer=null;this.modelState=this.initializeModelState()}initializeModelState(){this.plugin.settings.ai.anthropic||(this.plugin.settings.ai.anthropic={apiKey:"",model:wi[0].id,apiAddress:"",isCustomModel:!1,lastCustomModel:""});let e=this.plugin.settings.ai.anthropic,t;if(e.isCustomModel)t={id:e.model,name:e.model,isCustom:!0};else{let i=wi.find(o=>o.id===e.model);t=i||wi[0],i||(e.model=t.id)}return{selectedModel:t,apiKey:e.apiKey||""}}async saveModelState(){this.plugin.settings.ai.anthropic||(this.plugin.settings.ai.anthropic={});let e=this.plugin.settings.ai.anthropic,t=this.modelState.selectedModel;e.model=t.id,e.isCustomModel=!!t.isCustom,e.apiKey=this.modelState.apiKey||"",t.isCustom&&t.id&&(e.lastCustomModel=t.id),await this.plugin.saveSettings()}display(e){let t=e.createEl("div",{cls:"ai-service-settings"});new fA.Setting(t).setName(f("Anthropic service")).setHeading(),new fA.Setting(t).setName(f("API Key")).setDesc(f("Please enter your API Key.")).addText(g=>g.setPlaceholder("sk-ant-...").setValue(this.modelState.apiKey).onChange(async u=>{this.modelState.apiKey=u,await this.saveModelState()})).addButton(g=>g.setButtonText(f("Check")).onClick(async()=>{var u;try{let m=this.modelState.apiKey;if(!m){new fA.Notice(f("Please enter an API Key first"));return}g.setDisabled(!0),g.setButtonText(f("Checking..."));let w=((u=this.plugin.settings.ai.anthropic)==null?void 0:u.apiAddress)||"https://api.anthropic.com",F=this.modelState.selectedModel.id;await new xt(m,w,F).testConnection()?new fA.Notice(f("API Key is valid!")):new fA.Notice(f("Failed to validate API Key. Please check your key and try again."))}catch(m){console.error("Anthropic API validation error:",m),new fA.Notice(f("Failed to validate API Key. Please check your key and try again."))}finally{g.setDisabled(!1),g.setButtonText(f("Check"))}}));let i=new fA.Setting(t).setName(f("Model")).setDesc(f("Select a model or enter a custom one.")).addDropdown(g=>{wi.forEach(m=>{g.addOption(m.id,m.name)}),g.addOption("custom",f("Custom Model"));let u=this.modelState.selectedModel.isCustom?"custom":this.modelState.selectedModel.id;return g.setValue(u),this.modelSelectEl=g.selectEl,g.onChange(async m=>{if(m==="custom")await this.showCustomModelInput();else{let w=wi.find(F=>F.id===m);if(w){if(this.modelState.selectedModel.isCustom){let F=this.plugin.settings.ai.anthropic;F.lastCustomModel=this.modelState.selectedModel.id,await this.plugin.saveSettings()}this.modelState.selectedModel=w,await this.saveModelState(),await this.hideCustomModelInput()}}}),g});this.customModelContainer=i.settingEl.createDiv("custom-model-container"),this.customModelContainer.addClass("custom-model-container");let o=i.settingEl.querySelector(".setting-item-control");o&&(o.addClass("openai-dropdown-container"),o.insertBefore(this.customModelContainer,o.firstChild));let c=new fA.Setting(this.customModelContainer).addText(g=>g.setPlaceholder("model-id").setValue(this.modelState.selectedModel.isCustom?this.modelState.selectedModel.id:"").onChange(async u=>{let m=u.trim();if(m){if(!/^[a-zA-Z0-9-_.]+$/.test(m)){new fA.Notice(f("Model ID can only contain letters, numbers, underscores, dots and hyphens.")),g.setValue(this.modelState.selectedModel.id);return}this.modelState.selectedModel={id:m,name:m,isCustom:!0},await this.saveModelState()}})).settingEl;c.addClass("openai-setting-no-border");let h=c.querySelector(".setting-item-control");h&&h.addClass("openai-setting-no-margin"),this.modelState.selectedModel.isCustom&&this.showCustomModelInput(),new fA.Setting(t).setName(f("Provider URL")).setDesc(f("Leave it blank, unless you are using a proxy.")).addText(g=>{var u;return g.setPlaceholder("https://api.anthropic.com").setValue(((u=this.plugin.settings.ai.anthropic)==null?void 0:u.apiAddress)||"").onChange(async m=>{this.plugin.settings.ai.anthropic||(this.plugin.settings.ai.anthropic={}),this.plugin.settings.ai.anthropic.apiAddress=m,await this.plugin.saveSettings()})})}async showCustomModelInput(){if(this.customModelContainer&&this.modelSelectEl){this.customModelContainer.addClass("visible"),this.modelSelectEl.value="custom";let e=this.plugin.settings.ai.anthropic;if(!this.modelState.selectedModel.isCustom){let i=e.lastCustomModel||"";this.modelState.selectedModel={id:i,name:i,isCustom:!0},e.model=i,e.isCustomModel=!0,await this.plugin.saveSettings();let o=this.customModelContainer.querySelector("input");o&&(o.value=i)}}}async hideCustomModelInput(){this.customModelContainer&&this.customModelContainer.removeClass("visible")}};var We=require("obsidian");var _s=class extends nA{constructor(e,t){super(e,t);this.modelSelectEl=null;this.customModelContainer=null;this.modelState=this.initializeModelState()}initializeModelState(){this.plugin.settings.ai.deepseek||(this.plugin.settings.ai.deepseek={apiKey:"",model:It[0].id,apiAddress:"",isCustomModel:!1,lastCustomModel:""});let e=this.plugin.settings.ai.deepseek,t;if(e.isCustomModel)t={id:e.model,name:e.model,isCustom:!0};else{let i=It.find(o=>o.id===e.model);t=i||It[0],i||(e.model=t.id)}return{selectedModel:t,apiKey:e.apiKey||""}}async saveModelState(){this.plugin.settings.ai.deepseek||(this.plugin.settings.ai.deepseek={});let e=this.plugin.settings.ai.deepseek,t=this.modelState.selectedModel;e.model=t.id,e.isCustomModel=!!t.isCustom,e.apiKey=this.modelState.apiKey||"",e.apiAddress=e.apiAddress||"",t.isCustom&&t.id&&(e.lastCustomModel=t.id),await this.plugin.saveSettings()}async validateApiKey(e){var t;try{let i="https://api.deepseek.com",o=(t=this.plugin.settings.ai.deepseek)==null?void 0:t.apiAddress,l=o&&o.trim()?o:i,c=this.modelState.selectedModel.id,h=`${l}/models/${c}`,g=await(0,We.requestUrl)({url:h,headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!g.status||g.status<200||g.status>=300){if(this.modelState.selectedModel.isCustom)return new We.Notice(f("\u81EA\u5B9A\u4E49\u6A21\u578B\u4E0D\u53EF\u7528\uFF0C\u8BF7\u68C0\u67E5\u6A21\u578B ID \u548C API \u5730\u5740")),!1;if(c!=="deepseek-chat"){let w=`${l}/models/deepseek-chat`,F=await(0,We.requestUrl)({url:w,headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(F.status&&F.status>=200&&F.status<300)return new We.Notice(f("\u5F53\u524D\u9009\u62E9\u7684\u6A21\u578B\u4E0D\u53EF\u7528\uFF0C\u4F46 API Key \u662F\u6709\u6548\u7684")),!1}return new We.Notice(f("Failed to validate API Key. Please check your key and try again.")),!1}let u=g.json,m=!!(u&&u.id);return m&&new We.Notice(f("API Key and model available.")),m}catch(i){return new We.Notice(f("Failed to validate API Key. Please check your key and try again.")),!1}}display(e){let t=e.createEl("div",{cls:"ai-service-settings"});new We.Setting(t).setName(f("Deepseek service")).setHeading(),new We.Setting(t).setName(f("API Key")).setDesc(f("Please enter your API Key.")).addText(l=>l.setPlaceholder("dsk-...").setValue(this.modelState.apiKey).onChange(async c=>{this.modelState.apiKey=c,await this.saveModelState()})).addButton(l=>l.setButtonText(f("Check")).onClick(async()=>{if(!this.modelState.apiKey){new We.Notice(f("Please enter an API Key first"));return}l.setDisabled(!0),l.setButtonText(f("Checking..."));try{await this.validateApiKey(this.modelState.apiKey)}finally{l.setDisabled(!1),l.setButtonText(f("Check"))}}));let i=new We.Setting(t).setName(f("Model")).setDesc(f("Select a model or enter a custom one.")).addDropdown(l=>{It.forEach(h=>{l.addOption(h.id,h.name)}),l.addOption("custom",f("Custom Model"));let c=this.modelState.selectedModel.isCustom?"custom":this.modelState.selectedModel.id;return l.setValue(c),this.modelSelectEl=l.selectEl,l.onChange(async h=>{if(h==="custom")await this.showCustomModelInput();else{let g=It.find(u=>u.id===h);if(g){if(this.modelState.selectedModel.isCustom){let u=this.plugin.settings.ai.deepseek;u.lastCustomModel=this.modelState.selectedModel.id,await this.plugin.saveSettings()}this.modelState.selectedModel=g,await this.saveModelState(),await this.hideCustomModelInput()}}}),l});this.customModelContainer=i.settingEl.createDiv("custom-model-container"),this.customModelContainer.addClass("custom-model-container");let o=i.settingEl.querySelector(".setting-item-control");o&&(o.addClass("openai-dropdown-container"),o.insertBefore(this.customModelContainer,o.firstChild)),this.modelState.selectedModel.isCustom&&this.showCustomModelInput(),new We.Setting(t).setName(f("Provider URL")).setDesc(f("Leave it blank, unless you are using a proxy.")).addText(l=>{var c;return l.setPlaceholder("https://api.deepseek.com/v1").setValue(((c=this.plugin.settings.ai.deepseek)==null?void 0:c.apiAddress)||"").onChange(async h=>{this.plugin.settings.ai.deepseek||(this.plugin.settings.ai.deepseek={}),this.plugin.settings.ai.deepseek.apiAddress=h,await this.plugin.saveSettings()})})}async showCustomModelInput(){if(!this.customModelContainer)return;this.customModelContainer.addClass("visible"),this.customModelContainer.empty();let e=document.createElement("input");e.type="text",e.className="custom-model-input",e.placeholder="model-id",e.value=this.modelState.selectedModel.isCustom?this.modelState.selectedModel.id:"",e.addEventListener("input",async()=>{let t=e.value.trim();if(t){if(!/^[a-zA-Z0-9-_.]+$/.test(t)){new We.Notice(f("Model ID can only contain letters, numbers, underscores, dots and hyphens.")),e.value=this.modelState.selectedModel.id;return}this.modelState.selectedModel={id:t,name:t,isCustom:!0},await this.saveModelState()}}),this.customModelContainer.appendChild(e)}hideCustomModelInput(){this.customModelContainer&&(this.customModelContainer.removeClass("visible"),this.customModelContainer.empty())}};var Ve=require("obsidian");var Xs=class extends nA{constructor(e,t){super(e,t);this.modelSelectEl=null;this.customModelContainer=null;this.modelState=this.initializeModelState()}initializeModelState(){this.plugin.settings.ai.gemini||(this.plugin.settings.ai.gemini={apiKey:"",model:zA[0].id,baseUrl:"",isCustomModel:!1,lastCustomModel:""});let e=this.plugin.settings.ai.gemini,t;if(e.isCustomModel)t={id:e.model,name:e.model,isCustom:!0};else{let i=zA.find(o=>o.id===e.model);t=i||zA[0],i||(e.model=t.id)}return{selectedModel:t,apiKey:e.apiKey||""}}async saveModelState(){this.plugin.settings.ai.gemini||(this.plugin.settings.ai.gemini={});let e=this.plugin.settings.ai.gemini,t=this.modelState.selectedModel;e.model=t.id,e.isCustomModel=!!t.isCustom,e.apiKey=this.modelState.apiKey||"",e.baseUrl=e.baseUrl||"",t.isCustom&&t.id&&(e.lastCustomModel=t.id),await this.plugin.saveSettings()}async validateApiKey(e){var t;try{let i="https://generativelanguage.googleapis.com",o=(t=this.plugin.settings.ai.gemini)==null?void 0:t.baseUrl,l=o&&o.trim()?o:i,c=this.modelState.selectedModel.id,h=`${l}/v1/models/${c}?key=${e}`,g=await(0,Ve.requestUrl)({url:h,method:"GET"});if(g.status===200){let u=g.json;if(u&&u.name)return new Ve.Notice(f("API Key and the current model are both available!")),!0}if(c!=="gemini-2.5-flash"){let u=`${l}/v1/models/gemini-2.5-flash?key=${e}`;if((await(0,Ve.requestUrl)({url:u,method:"GET"})).status===200)return this.modelState.selectedModel.isCustom?new Ve.Notice(f("API Key is valid, but the custom model is not available. Please check the model ID and your access permissions.")):new Ve.Notice(f("API Key is valid, but the selected model is not available. The model may not be released yet or you may not have access permissions.")),!1}return new Ve.Notice(f("Invalid API Key or server error. Please verify your API Key.")),!1}catch(i){return new Ve.Notice(f("Failed to validate API Key. Please check your key and try again.")),!1}}display(e){let t=e.createEl("div",{cls:"ai-service-settings"});new Ve.Setting(t).setName(f("Gemini service")).setHeading(),new Ve.Setting(t).setName(f("API Key")).setDesc(f("Please enter your API Key.")).addText(g=>g.setPlaceholder("Enter your API key").setValue(this.modelState.apiKey).onChange(async u=>{this.modelState.apiKey=u,await this.saveModelState()})).addButton(g=>g.setButtonText(f("Check")).onClick(async()=>{if(!this.modelState.apiKey){new Ve.Notice(f("Please enter an API Key first"));return}g.setDisabled(!0),g.setButtonText(f("Checking..."));try{await this.validateApiKey(this.modelState.apiKey)}finally{g.setDisabled(!1),g.setButtonText(f("Check"))}}));let i=new Ve.Setting(t).setName(f("Model")).setDesc(f("Select a model or enter a custom one.")).addDropdown(g=>{zA.forEach(m=>{g.addOption(m.id,m.name)}),g.addOption("custom",f("Custom Model"));let u=this.modelState.selectedModel.isCustom?"custom":this.modelState.selectedModel.id;return g.setValue(u),this.modelSelectEl=g.selectEl,g.onChange(async m=>{if(m==="custom")await this.showCustomModelInput();else{let w=zA.find(F=>F.id===m);if(w){if(this.modelState.selectedModel.isCustom){let F=this.plugin.settings.ai.gemini;F.lastCustomModel=this.modelState.selectedModel.id,await this.plugin.saveSettings()}this.modelState.selectedModel=w,await this.saveModelState(),await this.hideCustomModelInput()}}}),g});this.customModelContainer=i.settingEl.createDiv("custom-model-container"),this.customModelContainer.addClass("custom-model-container");let o=i.settingEl.querySelector(".setting-item-control");o&&(o.addClass("openai-dropdown-container"),o.insertBefore(this.customModelContainer,o.firstChild));let c=new Ve.Setting(this.customModelContainer).addText(g=>g.setPlaceholder("model-id").setValue(this.modelState.selectedModel.isCustom?this.modelState.selectedModel.id:"").onChange(async u=>{let m=u.trim();if(m){if(!/^[a-zA-Z0-9-_.]+$/.test(m)){new Ve.Notice(f("Model ID can only contain letters, numbers, underscores, dots and hyphens.")),g.setValue(this.modelState.selectedModel.id);return}this.modelState.selectedModel={id:m,name:m,isCustom:!0},await this.saveModelState()}})).settingEl;c.addClass("openai-setting-no-border");let h=c.querySelector(".setting-item-control");h&&h.addClass("openai-setting-no-margin"),this.modelState.selectedModel.isCustom&&this.showCustomModelInput(),new Ve.Setting(t).setName(f("Provider URL")).setDesc(f("Leave it blank, unless you are using a proxy.")).addText(g=>{var w;let u="https://generativelanguage.googleapis.com",m=(w=this.plugin.settings.ai.gemini)==null?void 0:w.baseUrl;return g.setPlaceholder(u).setValue(m||"").onChange(async F=>{this.plugin.settings.ai.gemini||(this.plugin.settings.ai.gemini={}),this.plugin.settings.ai.gemini.baseUrl=F||"",await this.plugin.saveSettings()}),g})}async showCustomModelInput(){if(this.customModelContainer&&this.modelSelectEl){this.customModelContainer.addClass("visible"),this.modelSelectEl.value="custom";let e=this.plugin.settings.ai.gemini;if(!this.modelState.selectedModel.isCustom){let i=e.lastCustomModel||"";this.modelState.selectedModel={id:i,name:i,isCustom:!0},e.model=i,e.isCustomModel=!0,await this.plugin.saveSettings();let o=this.customModelContainer.querySelector("input");o&&(o.value=i)}}}async hideCustomModelInput(){if(this.customModelContainer){this.customModelContainer.removeClass("visible");let e=this.plugin.settings.ai.gemini,t=this.modelState.selectedModel;if(t.isCustom&&t.id){e.lastCustomModel=t.id;let i=this.customModelContainer.querySelector("input");i&&(i.value=t.id)}e.isCustomModel=!1,await this.plugin.saveSettings()}}};var rt=require("obsidian");var Js=class extends nA{async display(A){var l,c,h;let e=A.createEl("div",{cls:"ai-service-settings"});new rt.Setting(e).setName(f("Ollama service")).setHeading();let t="http://localhost:11434";(l=this.plugin.settings.ai.ollama)!=null&&l.host||(this.plugin.settings.ai.ollama||(this.plugin.settings.ai.ollama={}),this.plugin.settings.ai.ollama.host=t,await this.plugin.saveSettings());let i=new rt.Setting(e).setName(f("Server URL")).setDesc(f("Ollama server URL (default: http://localhost:11434)")).addText(g=>{var u;return g.setPlaceholder(t).setValue(((u=this.plugin.settings.ai.ollama)==null?void 0:u.host)||t).onChange(async m=>{this.plugin.settings.ai.ollama||(this.plugin.settings.ai.ollama={}),this.plugin.settings.ai.ollama.host=m||t,await this.plugin.saveSettings()}),g}),o;i.addButton(g=>(o=g.buttonEl,g.setButtonText(f("Check")).onClick(async()=>{var F;let u=((F=this.plugin.settings.ai.ollama)==null?void 0:F.host)||t;o.disabled=!0;let m=o.textContent;o.textContent=f("Checking...");let w=new bt(u);try{let E=await w.listModels();o.disabled=!1,o.textContent=m,E&&E.length>0?(this.plugin.settings.ai.ollama.availableModels=E,await this.plugin.saveSettings(),this.displayOllamaModelDropdown(e,E),new rt.Notice(f("Successfully connected to Ollama service"))):new rt.Notice(f("No models found. Please download models using ollama"))}catch(E){o.disabled=!1,o.textContent=m,new rt.Notice(f("Failed to connect to Ollama service. Please check the server address."))}}))),(h=(c=this.plugin.settings.ai.ollama)==null?void 0:c.availableModels)!=null&&h.length&&this.displayOllamaModelDropdown(e,this.plugin.settings.ai.ollama.availableModels)}displayOllamaModelDropdown(A,e){let t=A.querySelector(".model-setting");t&&t.remove(),new rt.Setting(A).setName(f("Model")).setDesc(f("Select a Ollama model.")).addDropdown(o=>{var g;let l=Object.fromEntries(e.map(u=>[u,u])),c=(g=this.plugin.settings.ai.ollama)==null?void 0:g.model,h=e.includes(c)?c:e[0];return o.addOptions(l).setValue(h).onChange(async u=>{this.plugin.settings.ai.ollama||(this.plugin.settings.ai.ollama={}),this.plugin.settings.ai.ollama.model=u,await this.plugin.saveSettings()})}).settingEl.addClass("model-setting")}};var mA=require("obsidian");var Ws=class extends nA{constructor(e,t){super(e,t);this.modelSelectEl=null;this.customModelContainer=null;this.modelState=this.initializeModelState()}initializeModelState(){this.plugin.settings.ai.siliconflow||(this.plugin.settings.ai.siliconflow={apiKey:"",model:SA[0].id,baseUrl:"",isCustomModel:!1,lastCustomModel:""});let e=this.plugin.settings.ai.siliconflow,t;if(e.isCustomModel)t={id:e.model,name:e.model,isCustom:!0};else{let i=SA.find(o=>o.id===e.model);t=i||SA[0],i||(e.model=t.id)}return{selectedModel:t,apiKey:e.apiKey||""}}async saveModelState(){if(!this.plugin.settings.ai.siliconflow)this.plugin.settings.ai.siliconflow={apiKey:this.modelState.apiKey||"",model:this.modelState.selectedModel.id,baseUrl:"",isCustomModel:!!this.modelState.selectedModel.isCustom,lastCustomModel:this.modelState.selectedModel.isCustom?this.modelState.selectedModel.id:void 0};else{let e=this.plugin.settings.ai.siliconflow,t=this.modelState.selectedModel;e.model=t.id,e.isCustomModel=!!t.isCustom,e.apiKey=this.modelState.apiKey||"",t.isCustom&&t.id&&(e.lastCustomModel=t.id)}await this.plugin.saveSettings()}async validateApiKey(e){var t;try{let i="https://api.siliconflow.cn/v1",o=(t=this.plugin.settings.ai.siliconflow)==null?void 0:t.baseUrl,l=o&&o.trim()?o:i,c=this.modelState.selectedModel.id,h=`${l}/chat/completions`,g=await(0,mA.requestUrl)({url:h,method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({model:c,messages:[{role:"user",content:"Hello"}],max_tokens:1})});if(!g.status||g.status<200||g.status>=300){let u=g.json||null;return{isValid:!1,message:f("API Key \u65E0\u6548\u6216\u6A21\u578B\u4E0D\u53EF\u7528\u3002\u8BF7\u68C0\u67E5\u4F60\u7684 API Key \u548C\u6A21\u578B ID \u662F\u5426\u6B63\u786E\u3002")}}return{isValid:!0,message:f("API Key and model available.")}}catch(i){return{isValid:!1,message:f("API Key \u65E0\u6548\u6216\u670D\u52A1\u5668\u9519\u8BEF\u3002")}}}async showCustomModelInput(){this.customModelContainer&&this.modelSelectEl&&this.customModelContainer.addClass("visible")}async hideCustomModelInput(){this.customModelContainer&&this.modelSelectEl&&this.customModelContainer.removeClass("visible")}display(e){let t=e.createEl("div",{cls:"ai-service-settings"});new mA.Setting(t).setName(f("SiliconFlow service")).setHeading();let i=new mA.Setting(t).setName(f("API key")).setDesc(f("Please enter your API Key.")).addText(u=>u.setPlaceholder("sk-...").setValue(this.modelState.apiKey).onChange(async m=>{this.modelState.apiKey=m,await this.saveModelState()})).addButton(u=>u.setButtonText(f("Check")).onClick(async()=>{let m=this.modelState.apiKey;if(!m){new mA.Notice(f("Please input API Key"));return}u.setButtonText(f("Checking...")),u.setDisabled(!0);let w=await this.validateApiKey(m);u.setButtonText(f("Check")),u.setDisabled(!1),w.message&&new mA.Notice(w.message)})),o=new mA.Setting(t).setName(f("Model")).setDesc(f("Select a model or enter a custom one.")).addDropdown(u=>{SA.forEach(w=>{u.addOption(w.id,w.name)}),u.addOption("custom","Custom Model");let m=this.modelState.selectedModel;return u.setValue(m.isCustom?"custom":m.id),this.modelSelectEl=u.selectEl,u.onChange(async w=>{var F;if(w==="custom"){let E=(F=this.plugin.settings.ai.siliconflow)==null?void 0:F.lastCustomModel;this.modelState.selectedModel={id:E||"",name:E||"",isCustom:!0},await this.saveModelState(),await this.showCustomModelInput()}else{let E=SA.find(Q=>Q.id===w);E&&(this.modelState.selectedModel.isCustom&&this.plugin.settings.ai.siliconflow&&(this.plugin.settings.ai.siliconflow.lastCustomModel=this.modelState.selectedModel.id,await this.plugin.saveSettings()),this.modelState.selectedModel=E,await this.saveModelState(),await this.hideCustomModelInput())}}),u});this.customModelContainer=o.settingEl.createDiv("custom-model-container"),this.customModelContainer.addClass("custom-model-container");let l=o.settingEl.querySelector(".setting-item-control");l&&(l.addClass("openai-dropdown-container"),l.insertBefore(this.customModelContainer,l.firstChild));let h=new mA.Setting(this.customModelContainer).addText(u=>u.setPlaceholder("model-id").setValue(this.modelState.selectedModel.isCustom?this.modelState.selectedModel.id:"").onChange(async m=>{let w=m.trim();if(w){if(!/^[a-zA-Z0-9-_./]+$/.test(w)){new mA.Notice("Model ID can only contain letters, numbers, underscores, dots and hyphens."),u.setValue(this.modelState.selectedModel.id);return}this.modelState.selectedModel={id:w,name:w,isCustom:!0},await this.saveModelState()}})).settingEl;h.addClass("openai-setting-no-border");let g=h.querySelector(".setting-item-control");g&&g.addClass("openai-setting-no-margin"),this.modelState.selectedModel.isCustom&&this.showCustomModelInput(),new mA.Setting(t).setName(f("Provider URL")).setDesc(f("Leave it blank, unless you are using a proxy.")).addText(u=>{var F;let m="https://api.siliconflow.cn/v1",w=(F=this.plugin.settings.ai.siliconflow)==null?void 0:F.baseUrl;return u.setPlaceholder(m).setValue(w||"").onChange(async E=>{this.plugin.settings.ai.siliconflow?this.plugin.settings.ai.siliconflow.baseUrl=E||"":this.plugin.settings.ai.siliconflow={apiKey:this.modelState.apiKey||"",model:this.modelState.selectedModel.id,baseUrl:E||"",isCustomModel:!!this.modelState.selectedModel.isCustom,lastCustomModel:this.modelState.selectedModel.isCustom?this.modelState.selectedModel.id:void 0},await this.plugin.saveSettings()}),u})}};var Dt=require("obsidian"),$s=require("obsidian");var Ys=class{constructor(A,e){this.plugin=A,this.containerEl=e}display(){let A=this.containerEl.createEl("div",{cls:"prompt-settings-container"}),e=A.createEl("div",{cls:"prompt-settings-header setting-item-heading"});e.createEl("h4",{text:f("Prompt settings"),cls:"prompt-settings-title"});let t=e.createEl("button",{cls:"prompt-add-btn",attr:{"aria-label":f("Add prompt")}});(0,$s.setIcon)(t,"plus"),t.onclick=()=>{if(A.querySelector(".new-prompt-section"))return;let i=A.querySelector(".prompt-list");i&&this.createNewPromptForm(A,i)},this.displayPromptList(A)}createNewPromptForm(A,e){var g;let t=A.createEl("div",{cls:"new-prompt-section"});(g=e.parentElement)==null||g.insertBefore(t,e);let i=t.createEl("input",{cls:"prompt-name-input",attr:{placeholder:f("Input Prompt Name"),type:"text"}}),o=new Dt.TextAreaComponent(t);o.setPlaceholder(f(`Input Prompt Content
Available parameters:
{{highlight}} - Current highlighted text
{{comment}} - Existing comment`)).setValue(""),o.inputEl.addClass("prompt-textarea");let l=t.createEl("div",{cls:"prompt-buttons"}),c=l.createEl("button",{cls:"prompt-save-btn",text:f("Save")});c.onclick=async()=>{var w;let u=i.value,m=o.getValue();if(u&&m){this.plugin.settings.ai.prompts||(this.plugin.settings.ai.prompts={}),this.plugin.settings.ai.prompts[u]=m,await this.plugin.saveSettings(),t.remove(),this.displayPromptList(A),new Dt.Notice(f("Prompt added"));let F=(w=this.plugin.app.workspace.getLeavesOfType("comment-view")[0])==null?void 0:w.view;F&&F.updateAIDropdowns()}};let h=l.createEl("button",{cls:"prompt-cancel-btn",text:f("Cancel")});h.onclick=()=>{t.remove()}}displayPromptList(A){let e=A.querySelector(".prompt-list");e&&e.remove();let t=A.createEl("div",{cls:"prompt-list"}),i=this.plugin.settings.ai.prompts||{};for(let[o,l]of Object.entries(i)){let c=t.createEl("div",{cls:"prompt-item"}),h=c.createEl("div",{cls:"prompt-display-mode"}),g=h.createEl("div",{cls:"prompt-info"});g.createEl("div",{cls:"prompt-name",text:o});let u=l.replace(/\n/g," ");g.createEl("div",{cls:"prompt-content-preview",text:u});let w=h.createEl("div",{cls:"prompt-buttons"}).createEl("button",{cls:"prompt-edit-btn",attr:{"aria-label":f("Edit")}});(0,$s.setIcon)(w,"square-pen");let F=c.createEl("div",{cls:"prompt-edit-mode hi-note-hidden"}),E=F.createEl("input",{cls:"prompt-name-input",attr:{value:o,type:"text"}}),Q=new Dt.TextAreaComponent(F);Q.setValue(l),Q.inputEl.classList.add("prompt-content-input"),Q.inputEl.addClass("prompt-textarea");let H=F.createEl("div",{cls:"prompt-edit-buttons"}),x=H.createEl("button",{cls:"prompt-save-btn",text:f("Save")}),P=H.createEl("button",{cls:"prompt-cancel-btn",text:f("Cancel")}),M=H.createEl("button",{cls:"prompt-delete-btn",attr:{"aria-label":f("Delete")}});(0,$s.setIcon)(M,"trash-2"),w.onclick=()=>{h.addClass("hi-note-hidden"),F.removeClass("hi-note-hidden")},M.onclick=async()=>{var O;delete this.plugin.settings.ai.prompts[o],await this.plugin.saveSettings(),c.remove();let D=(O=this.plugin.app.workspace.getLeavesOfType("comment-view")[0])==null?void 0:O.view;D&&D.updateAIDropdowns()},x.onclick=async()=>{var J;let D=E.value,O=Q.getValue();if(D&&O){D!==o&&delete this.plugin.settings.ai.prompts[o],this.plugin.settings.ai.prompts[D]=O,await this.plugin.saveSettings(),this.displayPromptList(A),new Dt.Notice(f("Prompt updated"));let se=(J=this.plugin.app.workspace.getLeavesOfType("comment-view")[0])==null?void 0:J.view;se&&se.updateAIDropdowns()}},P.onclick=()=>{h.removeClass("hi-note-hidden"),F.addClass("hi-note-hidden")}}}};var qs=class{constructor(A,e){this.plugin=A,this.containerEl=e}display(){switch(new Vo.Setting(this.containerEl).setName("AI service").setDesc(f("Select the AI service provider")).addDropdown(A=>{let e={openai:"OpenAI",gemini:"Gemini",anthropic:"Anthropic",deepseek:"Deepseek",siliconflow:"SiliconFlow",ollama:"Ollama (Local)"};return A.addOptions(e).setValue(this.plugin.settings.ai.provider).onChange(async t=>{this.plugin.settings.ai.provider=t,await this.plugin.saveSettings(),this.containerEl.empty(),this.display()})}),this.plugin.settings.ai.provider){case"openai":new Gs(this.plugin,this.containerEl).display(this.containerEl);break;case"gemini":new Xs(this.plugin,this.containerEl).display(this.containerEl);break;case"anthropic":new Vs(this.plugin,this.containerEl).display(this.containerEl);break;case"ollama":new Js(this.plugin,this.containerEl).display(this.containerEl);break;case"deepseek":new _s(this.plugin,this.containerEl).display(this.containerEl);break;case"siliconflow":new Ws(this.plugin,this.containerEl).display(this.containerEl);break}new Ys(this.plugin,this.containerEl).display()}};var _e=require("obsidian");var Ci=class{constructor(A,e){this.plugin=A,this.containerEl=e,this.fsrsService=A.fsrsManager.fsrsService}display(){let A=this.containerEl.createEl("div",{cls:"flashcard-settings-container"});new _e.Setting(A).setName(f("Flashcard learning")).setHeading(),new _e.Setting(A).setName(f("New cards per day")).setDesc(f("Maximum number of new cards to learn each day")).addSlider(o=>{var h;let l=this.fsrsService.getParameters();o.setLimits(1,200,1).setValue(l.newCardsPerDay).setDynamicTooltip().onChange(async g=>{let u=this.fsrsService.getParameters();u.newCardsPerDay=g,this.fsrsService.setParameters(u),await this.plugin.saveSettings()});let c=createEl("span",{cls:"slider-value",text:String(l.newCardsPerDay)});(h=o.sliderEl.parentElement)==null||h.appendChild(c),o.sliderEl.addEventListener("input",()=>{c.textContent=String(o.getValue())})}),new _e.Setting(A).setName(f("Reviews per day")).setDesc(f("Maximum number of cards to review each day")).addSlider(o=>{var h;let l=this.fsrsService.getParameters();o.setLimits(10,500,10).setValue(l.reviewsPerDay).setDynamicTooltip().onChange(async g=>{let u=this.fsrsService.getParameters();u.reviewsPerDay=g,this.fsrsService.setParameters(u),await this.plugin.saveSettings()});let c=createEl("span",{cls:"slider-value",text:String(l.reviewsPerDay)});(h=o.sliderEl.parentElement)==null||h.appendChild(c),o.sliderEl.addEventListener("input",()=>{c.textContent=String(o.getValue())})}),new _e.Setting(A).setName(f("Target retention")).setDesc(f("Target memory retention rate (0.8 = 80%)")).addSlider(o=>{var h;let l=this.fsrsService.getParameters();o.setLimits(.7,.95,.01).setValue(l.request_retention).setDynamicTooltip().onChange(async g=>{let u=this.fsrsService.getParameters();u.request_retention=g,this.fsrsService.setParameters(u),await this.plugin.saveSettings()});let c=createEl("span",{cls:"slider-value",text:`${Math.round(l.request_retention*100)}%`});(h=o.sliderEl.parentElement)==null||h.appendChild(c),o.sliderEl.addEventListener("input",()=>{c.textContent=`${Math.round(o.getValue()*100)}%`})}),new _e.Setting(A).setName(f("Maximum interval")).setDesc(f("Maximum interval in days between reviews")).addText(o=>{let l=this.fsrsService.getParameters();o.setValue(l.maximum_interval.toString()).setPlaceholder("365").onChange(async g=>{let u=parseInt(g);if(!isNaN(u)&&u>0){let m=this.fsrsService.getParameters();m.maximum_interval=u,this.fsrsService.setParameters(m),await this.plugin.saveSettings()}});let c=o.inputEl;c.type="number",c.min="1",c.style.width="80px";let h=createEl("span",{text:` ${f("days")}`,cls:"setting-item-suffix"});c.after(h)}),new _e.Setting(A).setName(f("Reset daily stats")).setDesc(f("Reset today's learning statistics")).addButton(o=>o.setButtonText(f("Reset")).onClick(async()=>{let l=new Date;l.setHours(0,0,0,0);let c=this.plugin.fsrsManager.storage.dailyStats,h=c.findIndex(g=>g.date===l.getTime());h>=0?(c.splice(h,1),await this.plugin.fsrsManager.saveStorage(),new _e.Notice(f("Daily statistics have been reset"))):new _e.Notice(f("No statistics to reset for today"))})),new _e.Setting(A).setName(f("Advanced")).setHeading(),A.createEl("p",{text:f("These settings control the FSRS algorithm parameters. Only change them if you understand the algorithm."),cls:"setting-item-description"}),new _e.Setting(A).setName(f("Reset algorithm parameters")).setDesc(f("Reset the FSRS algorithm parameters to default values")).addButton(o=>o.setButtonText(f("Reset to default")).onClick(async()=>{this.fsrsService.resetParameters(),await this.plugin.saveSettings();let l=this.fsrsService.getParameters(),c=this.containerEl.querySelector(".setting-item:nth-child(4) .slider"),h=this.containerEl.querySelector(".setting-item:nth-child(4) .slider-value");c&&h&&(c.value=String(l.request_retention),h.textContent=`${Math.round(l.request_retention*100)}%`);let g=this.containerEl.querySelector('.setting-item:nth-child(5) input[type="number"]');g&&(g.value=String(l.maximum_interval));let u=this.containerEl.querySelector(".setting-item:nth-child(2) .slider"),m=this.containerEl.querySelector(".setting-item:nth-child(2) .slider-value");u&&m&&(u.value=String(l.newCardsPerDay),m.textContent=String(l.newCardsPerDay));let w=this.containerEl.querySelector(".setting-item:nth-child(3) .slider"),F=this.containerEl.querySelector(".setting-item:nth-child(3) .slider-value");w&&F&&(w.value=String(l.reviewsPerDay),F.textContent=String(l.reviewsPerDay));let E=this.containerEl.querySelector(".fsrs-weights-textarea");E&&(E.value=JSON.stringify(l.w)),new _e.Notice(f("FSRS parameters have been reset to default values"))}));let e=A.createEl("div",{cls:"fsrs-params-container"});e.createEl("p",{text:f("FSRS weight parameter. The default value is obtained from a smaller sample; if adjustment is needed, please use the FSRS optimizer for calculation."),cls:"setting-item-description"});let t=this.fsrsService.getParameters(),i=JSON.stringify(t.w);new _e.Setting(e).setName(f("FSRS parameters")).setDesc(f("Edit the 17 FSRS algorithm weights. Format: JSON array of numbers.")).addTextArea(o=>{o.setValue(i).setPlaceholder("[0.4872, 1.4003, ...]").onChange(async l=>{try{let c=JSON.parse(l);if(Array.isArray(c)&&c.length===17&&c.every(h=>typeof h=="number")){let h=this.fsrsService.getParameters();h.w=c,this.fsrsService.setParameters(h),await this.plugin.saveSettings(),new _e.Notice(f("FSRS weights updated successfully"))}else new _e.Notice(f("Invalid format. Must be an array of 17 numbers."),5e3)}catch(c){new _e.Notice(f("Invalid JSON format. Please check your input."),5e3)}}),o.inputEl.rows=2,o.inputEl.cols=32,o.inputEl.addClass("fsrs-weights-textarea")})}};var zs=class extends _o.PluginSettingTab{constructor(A,e){super(A,e),this.plugin=e,this.DEFAULT_SETTINGS=e.DEFAULT_SETTINGS,this.licenseManager=new jA(this.plugin)}async display(){let{containerEl:A}=this;A.empty();let e=A.createEl("div",{cls:"setting-tabs"}),t=A.createEl("div",{cls:"setting-tab-content"}),i=e.createEl("div",{text:f("General"),cls:"setting-tab-btn active",attr:{role:"button",tabindex:"0"}}),o=e.createEl("div",{text:f("AI service"),cls:"setting-tab-btn",attr:{role:"button",tabindex:"0"}}),l=null,c=t.createEl("div",{cls:"setting-tab-pane active"}),h=t.createEl("div",{cls:"setting-tab-pane"}),g=null,u=(m,w)=>{e.findAll(".setting-tab-btn").forEach(F=>F.removeClass("active")),t.findAll(".setting-tab-pane").forEach(F=>F.removeClass("active")),m.addClass("active"),w.addClass("active")};i.onclick=()=>u(i,c),o.onclick=()=>u(o,h),new Ns(this.plugin,c).display(),new qs(this.plugin,h).display(),l=e.createEl("div",{text:"HiCard",cls:"setting-tab-btn",attr:{role:"button",tabindex:"0"}}),g=t.createEl("div",{cls:"setting-tab-pane"}),l.onclick=async()=>{var w;if(u(l,g),g.empty(),await this.licenseManager.isActivated())new Ci(this.plugin,g).display();else{let F=g.createEl("div",{cls:"flashcard-activation-container"});F.createEl("div",{cls:"flashcard-activation-header",text:f("Activate HiCard")});let E=F.createEl("div",{cls:"flashcard-activation-description"});E.createEl("span",{text:f("Enter your license key to activate HiCard feature.")+" "}),E.createEl("br"),E.createEl("span",{text:f("Get your license key from")+" "});let H=(((w=window.moment)==null?void 0:w.locale())||"en").startsWith("zh")?"https://www.hinote.vip/index.html":"https://www.hinote.vip/en.html",x=E.createEl("a",{text:f("HiNote official website"),cls:"external-link",href:H});x.setAttr("target","_blank"),x.setAttr("rel","noopener noreferrer");let P=F.createEl("div",{cls:"flashcard-activation-input-container"}),M=P.createEl("input",{cls:"flashcard-activation-input",type:"text",placeholder:f("Enter license key")}),D=P.createEl("button",{cls:"flashcard-activation-button",text:f("Activate")}),O=F.createEl("div",{cls:"activation-msg"});D.onclick=async()=>{D.setAttr("disabled","true"),O.textContent=f("Verifying..."),await this.licenseManager.activateLicense(M.value)?(O.textContent=f("Activation successful!"),g.empty(),new Ci(this.plugin,g).display()):(O.textContent=f("Activation failed. Please check your license key."),D.removeAttribute("disabled"))}}}}};var zo=yo(gn());var ie=(y=>(y[y.New=0]="New",y[y.Learning=1]="Learning",y[y.Review=2]="Review",y[y.Relearning=3]="Relearning",y))(ie||{}),T=(y=>(y[y.Manual=0]="Manual",y[y.Again=1]="Again",y[y.Hard=2]="Hard",y[y.Good=3]="Good",y[y.Easy=4]="Easy",y))(T||{}),te=class y{static card(A){return{...A,state:y.state(A.state),due:y.time(A.due),last_review:A.last_review?y.time(A.last_review):void 0}}static rating(A){if(typeof A=="string"){let e=A.charAt(0).toUpperCase(),t=A.slice(1).toLowerCase(),i=T[`${e}${t}`];if(i===void 0)throw new Error(`Invalid rating:[${A}]`);return i}else if(typeof A=="number")return A;throw new Error(`Invalid rating:[${A}]`)}static state(A){if(typeof A=="string"){let e=A.charAt(0).toUpperCase(),t=A.slice(1).toLowerCase(),i=ie[`${e}${t}`];if(i===void 0)throw new Error(`Invalid state:[${A}]`);return i}else if(typeof A=="number")return A;throw new Error(`Invalid state:[${A}]`)}static time(A){if(typeof A=="object"&&A instanceof Date)return A;if(typeof A=="string"){let e=Date.parse(A);if(isNaN(e))throw new Error(`Invalid date:[${A}]`);return new Date(e)}else if(typeof A=="number")return new Date(A);throw new Error(`Invalid date:[${A}]`)}static review_log(A){return{...A,due:y.time(A.due),rating:y.rating(A.rating),state:y.state(A.state),review:y.time(A.review)}}};Date.prototype.scheduler=function(y,A){return vA(this,y,A)},Date.prototype.diff=function(y,A){return Pt(this,y,A)},Date.prototype.format=function(){return du(this)},Date.prototype.dueFormat=function(y,A,e){return gu(this,y,A,e)};function vA(y,A,e){return new Date(e?te.time(y).getTime()+A*24*60*60*1e3:te.time(y).getTime()+A*60*1e3)}function Pt(y,A,e){if(!y||!A)throw new Error("Invalid date");let t=te.time(y).getTime()-te.time(A).getTime(),i=0;switch(e){case"days":i=Math.floor(t/(24*60*60*1e3));break;case"minutes":i=Math.floor(t/(60*1e3));break}return i}function du(y){let A=te.time(y),e=A.getFullYear(),t=A.getMonth()+1,i=A.getDate(),o=A.getHours(),l=A.getMinutes(),c=A.getSeconds();return`${e}-${vi(t)}-${vi(i)} ${vi(o)}:${vi(l)}:${vi(c)}`}function vi(y){return y<10?`0${y}`:`${y}`}var mn=[60,60,24,31,12],Bn=["second","min","hour","day","month","year"];function gu(y,A,e,t=Bn){y=te.time(y),A=te.time(A),t.length!==Bn.length&&(t=Bn);let i=y.getTime()-A.getTime(),o;for(i/=1e3,o=0;o<mn.length&&!(i<mn[o]);o++)i/=mn[o];return`${Math.floor(i)}${e?t[o]:""}`}var uu=Object.freeze([T.Again,T.Hard,T.Good,T.Easy]),pu=[{start:2.5,end:7,factor:.15},{start:7,end:20,factor:.1},{start:20,end:1/0,factor:.05}];function fu(y,A,e){let t=1;for(let l of pu)t+=l.factor*Math.max(Math.min(y,l.end)-l.start,0);y=Math.min(y,e);let i=Math.max(2,Math.round(y-t)),o=Math.min(Math.round(y+t),e);return y>A&&(i=Math.max(i,A+1)),i=Math.min(i,o),{min_ivl:i,max_ivl:o}}function ze(y,A,e){return Math.min(Math.max(y,A),e)}function mu(y,A){let e=Date.UTC(y.getUTCFullYear(),y.getUTCMonth(),y.getUTCDate()),t=Date.UTC(A.getUTCFullYear(),A.getUTCMonth(),A.getUTCDate());return Math.floor((t-e)/864e5)}var Bu="5.2.0",wu=.9,Cu=36500,vu=!1,Fu=!0,yu=Object.freeze(["1m","10m"]),Eu=Object.freeze(["10m"]),Bw=`v${Bu} using FSRS-6.0`,FA=.001;var Zs=100,Xo=.5,Qu=.1542,Jo=Object.freeze([.212,1.2931,2.3065,8.2956,6.4133,.8334,3.0194,.001,1.8722,.1666,.796,1.4835,.0614,.2629,1.6483,.6014,1.8729,.5425,.0912,.0658,Qu]),Uu=2,Su=y=>[[FA,Zs],[FA,Zs],[FA,Zs],[FA,Zs],[1,10],[.001,4],[.001,4],[.001,.75],[0,4.5],[0,.8],[.001,3.5],[.001,5],[.001,.25],[.001,.9],[0,4],[0,1],[1,6],[0,y],[0,y],[0,.8],[.1,.8]],En=(y,A)=>{let e=Uu;if(Math.max(0,A)>1){let t=-(Math.log(y[11])+Math.log(Math.pow(2,y[13])-1)+y[14]*.3)/A;e=ze(+t.toFixed(8),.01,2)}return Su(e).map(([t,i],o)=>ze(y[o],t,i))};var Qn=y=>{if(y===void 0)return[...Jo];switch(y.length){case 21:return[...y];case 19:return console.debug("[FSRS-6]auto fill w from 19 to 21 length"),[...y,0,Xo];case 17:{let A=[...y];return A[4]=+(A[5]*2+A[4]).toFixed(8),A[5]=+(Math.log(A[5]*3+1)/3).toFixed(8),A[6]=+(A[6]+.5).toFixed(8),console.debug("[FSRS-6]auto fill w from 17 to 21 length"),A.concat([0,0,0,Xo])}default:return console.warn("[FSRS]Invalid parameters length, using default parameters"),[...Jo]}},js=y=>{var i,o;let A=Array.isArray(y==null?void 0:y.learning_steps)?y.learning_steps:yu,e=Array.isArray(y==null?void 0:y.relearning_steps)?y.relearning_steps:Eu,t=En(Qn(y==null?void 0:y.w),e.length);return{request_retention:(y==null?void 0:y.request_retention)||wu,maximum_interval:(y==null?void 0:y.maximum_interval)||Cu,w:t,enable_fuzz:(i=y==null?void 0:y.enable_fuzz)!=null?i:vu,enable_short_term:(o=y==null?void 0:y.enable_short_term)!=null?o:Fu,learning_steps:A,relearning_steps:e}};function Kt(y,A){let e={due:y?te.time(y):new Date,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:0,lapses:0,learning_steps:0,state:ie.New,last_review:void 0};return A&&typeof A=="function"?A(e):e}var wn=class{constructor(A){Se(this,"c");Se(this,"s0");Se(this,"s1");Se(this,"s2");let e=Iu();this.c=1,this.s0=e(" "),this.s1=e(" "),this.s2=e(" "),A==null&&(A=+new Date),this.s0-=e(A),this.s0<0&&(this.s0+=1),this.s1-=e(A),this.s1<0&&(this.s1+=1),this.s2-=e(A),this.s2<0&&(this.s2+=1)}next(){let A=2091639*this.s0+this.c*23283064365386963e-26;return this.s0=this.s1,this.s1=this.s2,this.s2=A-(this.c=A|0),this.s2}set state(A){this.c=A.c,this.s0=A.s0,this.s1=A.s1,this.s2=A.s2}get state(){return{c:this.c,s0:this.s0,s1:this.s1,s2:this.s2}}};function Iu(){let y=4022871197;return function(A){A=String(A);for(let e=0;e<A.length;e++){y+=A.charCodeAt(e);let t=.02519603282416938*y;y=t>>>0,t-=y,t*=y,y=t>>>0,t-=y,y+=t*4294967296}return(y>>>0)*23283064365386963e-26}}function Hu(y){let A=new wn(y),e=()=>A.next();return e.int32=()=>A.next()*4294967296|0,e.double=()=>e()+(e()*2097152|0)*11102230246251565e-32,e.state=()=>A.state,e.importState=t=>(A.state=t,e),e}var Wo=y=>{let A=typeof y=="number"?-y:-y[20],e=Math.exp(Math.pow(A,-1)*Math.log(.9))-1;return{decay:A,factor:+e.toFixed(8)}};function Cn(y,A,e){let{decay:t,factor:i}=Wo(y);return+Math.pow(1+i*A/e,t).toFixed(8)}var vn=class{constructor(A){Se(this,"param");Se(this,"intervalModifier");Se(this,"_seed");Se(this,"forgetting_curve");this.param=new Proxy(js(A),this.params_handler_proxy()),this.intervalModifier=this.calculate_interval_modifier(this.param.request_retention),this.forgetting_curve=Cn.bind(this,this.param.w)}get interval_modifier(){return this.intervalModifier}set seed(A){this._seed=A}calculate_interval_modifier(A){if(A<=0||A>1)throw new Error("Requested retention rate should be in the range (0,1]");let{decay:e,factor:t}=Wo(this.param.w);return+((Math.pow(A,1/e)-1)/t).toFixed(8)}get parameters(){return this.param}set parameters(A){this.update_parameters(A)}params_handler_proxy(){let A=this;return{set:function(e,t,i){return t==="request_retention"&&Number.isFinite(i)?A.intervalModifier=A.calculate_interval_modifier(Number(i)):t==="w"&&(i=En(Qn(i),e.relearning_steps.length),A.forgetting_curve=Cn.bind(this,i),A.intervalModifier=A.calculate_interval_modifier(Number(e.request_retention))),Reflect.set(e,t,i),!0}}}update_parameters(A){let e=js(A);for(let t in e)if(t in this.param){let i=t;this.param[i]=e[i]}}init_stability(A){return Math.max(this.param.w[A-1],.1)}init_difficulty(A){return+(this.param.w[4]-Math.exp((A-1)*this.param.w[5])+1).toFixed(8)}apply_fuzz(A,e){if(!this.param.enable_fuzz||A<2.5)return Math.round(A);let t=Hu(this._seed)(),{min_ivl:i,max_ivl:o}=fu(A,e,this.param.maximum_interval);return Math.floor(t*(o-i+1)+i)}next_interval(A,e){let t=Math.min(Math.max(1,Math.round(A*this.intervalModifier)),this.param.maximum_interval);return this.apply_fuzz(t,e)}linear_damping(A,e){return+(A*(10-e)/9).toFixed(8)}next_difficulty(A,e){let t=-this.param.w[6]*(e-3),i=A+this.linear_damping(t,A);return ze(this.mean_reversion(this.init_difficulty(T.Easy),i),1,10)}mean_reversion(A,e){return+(this.param.w[7]*A+(1-this.param.w[7])*e).toFixed(8)}next_recall_stability(A,e,t,i){let o=T.Hard===i?this.param.w[15]:1,l=T.Easy===i?this.param.w[16]:1;return+ze(e*(1+Math.exp(this.param.w[8])*(11-A)*Math.pow(e,-this.param.w[9])*(Math.exp((1-t)*this.param.w[10])-1)*o*l),FA,36500).toFixed(8)}next_forget_stability(A,e,t){return+ze(this.param.w[11]*Math.pow(A,-this.param.w[12])*(Math.pow(e+1,this.param.w[13])-1)*Math.exp((1-t)*this.param.w[14]),FA,36500).toFixed(8)}next_short_term_stability(A,e){let t=Math.pow(A,-this.param.w[19])*Math.exp(this.param.w[17]*(e-3+this.param.w[18])),i=e>=3?Math.max(t,1):t;return+ze(A*i,FA,36500).toFixed(8)}next_state(A,e,t){let{difficulty:i,stability:o}=A!=null?A:{difficulty:0,stability:0};if(e<0)throw new Error(`Invalid delta_t "${e}"`);if(t<0||t>4)throw new Error(`Invalid grade "${t}"`);if(i===0&&o===0)return{difficulty:ze(this.init_difficulty(t),1,10),stability:this.init_stability(t)};if(t===0)return{difficulty:i,stability:o};if(i<1||o<FA)throw new Error(`Invalid memory state { difficulty: ${i}, stability: ${o} }`);let l=this.forgetting_curve(e,o),c=this.next_recall_stability(i,o,l,t),h=this.next_forget_stability(i,o,l),g=this.next_short_term_stability(o,t),u=c;if(t===1){let[m,w]=[0,0];this.param.enable_short_term&&(m=this.param.w[17],w=this.param.w[18]);let F=o/Math.exp(m*w);u=ze(+F.toFixed(8),FA,h)}return e===0&&this.param.enable_short_term&&(u=g),{difficulty:this.next_difficulty(i,t),stability:u}}};function bu(){let y=this.review_time.getTime(),A=this.current.reps,e=this.current.difficulty*this.current.stability;return`${y}_${A}_${e}`}var xu=y=>{let A=y.slice(-1),e=parseInt(y.slice(0,-1),10);if(isNaN(e)||!Number.isFinite(e)||e<0)throw new Error(`Invalid step value: ${y}`);switch(A){case"m":return e;case"h":return e*60;case"d":return e*1440;default:throw new Error(`Invalid step unit: ${y}, expected m/h/d`)}},Mu=(y,A,e)=>{let t=A===ie.Relearning||A===ie.Review?y.relearning_steps:y.learning_steps,i=t.length;if(i===0||e>=i)return{};let o=t[0],l=xu,c=()=>l(o),h=()=>{if(i===1)return Math.round(l(o)*1.5);let F=t[1];return Math.round((l(o)+l(F))/2)},g=F=>F<0||F>=i?null:t[F],u=F=>l(F),m={},w=g(Math.max(0,e));if(A===ie.Review)return m[T.Again]={scheduled_minutes:l(w),next_step:0},m;{m[T.Again]={scheduled_minutes:c(),next_step:0},m[T.Hard]={scheduled_minutes:h(),next_step:e};let F=g(e+1);if(F){let E=u(F);E&&(m[T.Good]={scheduled_minutes:Math.round(E),next_step:e+1})}}return m},ir=(y=>(y.SCHEDULER="Scheduler",y.LEARNING_STEPS="LearningSteps",y.SEED="Seed",y))(ir||{}),er=class{constructor(A,e,t,i){Se(this,"last");Se(this,"current");Se(this,"review_time");Se(this,"next",new Map);Se(this,"algorithm");Se(this,"strategies");Se(this,"elapsed_days",0);this.algorithm=t,this.last=te.card(A),this.current=te.card(A),this.review_time=te.time(e),this.strategies=i,this.init()}checkGrade(A){if(!Number.isFinite(A)||A<0||A>4)throw new Error(`Invalid grade "${A}",expected 1-4`)}init(){let{state:A,last_review:e}=this.current,t=0;A!==ie.New&&e&&(t=mu(e,this.review_time)),this.current.last_review=this.review_time,this.elapsed_days=t,this.current.elapsed_days=t,this.current.reps+=1;let i=bu;if(this.strategies){let o=this.strategies.get(ir.SEED);o&&(i=o)}this.algorithm.seed=i.call(this)}preview(){return{[T.Again]:this.review(T.Again),[T.Hard]:this.review(T.Hard),[T.Good]:this.review(T.Good),[T.Easy]:this.review(T.Easy),[Symbol.iterator]:this.previewIterator.bind(this)}}*previewIterator(){for(let A of uu)yield this.review(A)}review(A){let{state:e}=this.last,t;switch(this.checkGrade(A),e){case ie.New:t=this.newState(A);break;case ie.Learning:case ie.Relearning:t=this.learningState(A);break;case ie.Review:t=this.reviewState(A);break}return t}buildLog(A){let{last_review:e,due:t,elapsed_days:i}=this.last;return{rating:A,state:this.current.state,due:e||t,stability:this.current.stability,difficulty:this.current.difficulty,elapsed_days:this.elapsed_days,last_elapsed_days:i,scheduled_days:this.current.scheduled_days,learning_steps:this.current.learning_steps,review:this.review_time}}},Ar=class extends er{constructor(e,t,i,o){super(e,t,i,o);Se(this,"learningStepsStrategy");let l=Mu;if(this.strategies){let c=this.strategies.get(ir.LEARNING_STEPS);c&&(l=c)}this.learningStepsStrategy=l}getLearningInfo(e,t){var h,g,u,m;let i=this.algorithm.parameters;e.learning_steps=e.learning_steps||0;let o=this.learningStepsStrategy(i,e.state,this.current.state===ie.Learning?e.learning_steps+1:e.learning_steps),l=Math.max(0,(g=(h=o[t])==null?void 0:h.scheduled_minutes)!=null?g:0),c=Math.max(0,(m=(u=o[t])==null?void 0:u.next_step)!=null?m:0);return{scheduled_minutes:l,next_steps:c}}applyLearningSteps(e,t,i){let{scheduled_minutes:o,next_steps:l}=this.getLearningInfo(this.current,t);if(o>0&&o<1440)e.learning_steps=l,e.scheduled_days=0,e.state=i,e.due=vA(this.review_time,Math.round(o),!1);else if(e.state=ie.Review,o>=1440)e.learning_steps=l,e.due=vA(this.review_time,Math.round(o),!1),e.scheduled_days=Math.floor(o/1440);else{e.learning_steps=0;let c=this.algorithm.next_interval(e.stability,this.elapsed_days);e.scheduled_days=c,e.due=vA(this.review_time,c,!0)}}newState(e){let t=this.next.get(e);if(t)return t;let i=te.card(this.current);i.difficulty=ze(this.algorithm.init_difficulty(e),1,10),i.stability=this.algorithm.init_stability(e),this.applyLearningSteps(i,e,ie.Learning);let o={card:i,log:this.buildLog(e)};return this.next.set(e,o),o}learningState(e){let t=this.next.get(e);if(t)return t;let{state:i,difficulty:o,stability:l}=this.last,c=te.card(this.current);c.difficulty=this.algorithm.next_difficulty(o,e),c.stability=this.algorithm.next_short_term_stability(l,e),this.applyLearningSteps(c,e,i);let h={card:c,log:this.buildLog(e)};return this.next.set(e,h),h}reviewState(e){let t=this.next.get(e);if(t)return t;let i=this.elapsed_days,{difficulty:o,stability:l}=this.last,c=this.algorithm.forgetting_curve(i,l),h=te.card(this.current),g=te.card(this.current),u=te.card(this.current),m=te.card(this.current);this.next_ds(h,g,u,m,o,l,c),this.next_interval(g,u,m,i),this.next_state(g,u,m),this.applyLearningSteps(h,T.Again,ie.Relearning),h.lapses+=1;let w={card:h,log:this.buildLog(T.Again)},F={card:g,log:super.buildLog(T.Hard)},E={card:u,log:super.buildLog(T.Good)},Q={card:m,log:super.buildLog(T.Easy)};return this.next.set(T.Again,w),this.next.set(T.Hard,F),this.next.set(T.Good,E),this.next.set(T.Easy,Q),this.next.get(e)}next_ds(e,t,i,o,l,c,h){e.difficulty=this.algorithm.next_difficulty(l,T.Again);let g=c/Math.exp(this.algorithm.parameters.w[17]*this.algorithm.parameters.w[18]),u=this.algorithm.next_forget_stability(l,c,h);e.stability=ze(+g.toFixed(8),FA,u),t.difficulty=this.algorithm.next_difficulty(l,T.Hard),t.stability=this.algorithm.next_recall_stability(l,c,h,T.Hard),i.difficulty=this.algorithm.next_difficulty(l,T.Good),i.stability=this.algorithm.next_recall_stability(l,c,h,T.Good),o.difficulty=this.algorithm.next_difficulty(l,T.Easy),o.stability=this.algorithm.next_recall_stability(l,c,h,T.Easy)}next_interval(e,t,i,o){let l,c;l=this.algorithm.next_interval(e.stability,o),c=this.algorithm.next_interval(t.stability,o),l=Math.min(l,c),c=Math.max(c,l+1);let h=Math.max(this.algorithm.next_interval(i.stability,o),c+1);e.scheduled_days=l,e.due=vA(this.review_time,l,!0),t.scheduled_days=c,t.due=vA(this.review_time,c,!0),i.scheduled_days=h,i.due=vA(this.review_time,h,!0)}next_state(e,t,i){e.state=ie.Review,e.learning_steps=0,t.state=ie.Review,t.learning_steps=0,i.state=ie.Review,i.learning_steps=0}},tr=class extends er{newState(A){let e=this.next.get(A);if(e)return e;this.current.scheduled_days=0,this.current.elapsed_days=0;let t=te.card(this.current),i=te.card(this.current),o=te.card(this.current),l=te.card(this.current);return this.init_ds(t,i,o,l),this.next_interval(t,i,o,l,0),this.next_state(t,i,o,l),this.update_next(t,i,o,l),this.next.get(A)}init_ds(A,e,t,i){A.difficulty=ze(this.algorithm.init_difficulty(T.Again),1,10),A.stability=this.algorithm.init_stability(T.Again),e.difficulty=ze(this.algorithm.init_difficulty(T.Hard),1,10),e.stability=this.algorithm.init_stability(T.Hard),t.difficulty=ze(this.algorithm.init_difficulty(T.Good),1,10),t.stability=this.algorithm.init_stability(T.Good),i.difficulty=ze(this.algorithm.init_difficulty(T.Easy),1,10),i.stability=this.algorithm.init_stability(T.Easy)}learningState(A){return this.reviewState(A)}reviewState(A){let e=this.next.get(A);if(e)return e;let t=this.elapsed_days,{difficulty:i,stability:o}=this.last,l=this.algorithm.forgetting_curve(t,o),c=te.card(this.current),h=te.card(this.current),g=te.card(this.current),u=te.card(this.current);return this.next_ds(c,h,g,u,i,o,l),this.next_interval(c,h,g,u,t),this.next_state(c,h,g,u),c.lapses+=1,this.update_next(c,h,g,u),this.next.get(A)}next_ds(A,e,t,i,o,l,c){A.difficulty=this.algorithm.next_difficulty(o,T.Again);let h=this.algorithm.next_forget_stability(o,l,c);A.stability=ze(l,FA,h),e.difficulty=this.algorithm.next_difficulty(o,T.Hard),e.stability=this.algorithm.next_recall_stability(o,l,c,T.Hard),t.difficulty=this.algorithm.next_difficulty(o,T.Good),t.stability=this.algorithm.next_recall_stability(o,l,c,T.Good),i.difficulty=this.algorithm.next_difficulty(o,T.Easy),i.stability=this.algorithm.next_recall_stability(o,l,c,T.Easy)}next_interval(A,e,t,i,o){let l,c,h,g;l=this.algorithm.next_interval(A.stability,o),c=this.algorithm.next_interval(e.stability,o),h=this.algorithm.next_interval(t.stability,o),g=this.algorithm.next_interval(i.stability,o),l=Math.min(l,c),c=Math.max(c,l+1),h=Math.max(h,c+1),g=Math.max(g,h+1),A.scheduled_days=l,A.due=vA(this.review_time,l,!0),e.scheduled_days=c,e.due=vA(this.review_time,c,!0),t.scheduled_days=h,t.due=vA(this.review_time,h,!0),i.scheduled_days=g,i.due=vA(this.review_time,g,!0)}next_state(A,e,t,i){A.state=ie.Review,A.learning_steps=0,e.state=ie.Review,e.learning_steps=0,t.state=ie.Review,t.learning_steps=0,i.state=ie.Review,i.learning_steps=0}update_next(A,e,t,i){let o={card:A,log:this.buildLog(T.Again)},l={card:e,log:super.buildLog(T.Hard)},c={card:t,log:super.buildLog(T.Good)},h={card:i,log:super.buildLog(T.Easy)};this.next.set(T.Again,o),this.next.set(T.Hard,l),this.next.set(T.Good,c),this.next.set(T.Easy,h)}},Fn=class{constructor(A){Se(this,"fsrs");this.fsrs=A}replay(A,e,t){return this.fsrs.next(A,e,t)}handleManualRating(A,e,t,i,o,l,c){if(typeof e>"u")throw new Error("reschedule: state is required for manual rating");let h,g;if(e===ie.New)h={rating:T.Manual,state:e,due:c!=null?c:t,stability:A.stability,difficulty:A.difficulty,elapsed_days:i,last_elapsed_days:A.elapsed_days,scheduled_days:A.scheduled_days,learning_steps:A.learning_steps,review:t},g=Kt(t),g.last_review=t;else{if(typeof c>"u")throw new Error("reschedule: due is required for manual rating");let u=Pt(c,t,"days");h={rating:T.Manual,state:A.state,due:A.last_review||A.due,stability:A.stability,difficulty:A.difficulty,elapsed_days:i,last_elapsed_days:A.elapsed_days,scheduled_days:A.scheduled_days,learning_steps:A.learning_steps,review:t},g={...A,state:e,due:c,last_review:t,stability:o||A.stability,difficulty:l||A.difficulty,elapsed_days:i,scheduled_days:u,reps:A.reps+1}}return{card:g,log:h}}reschedule(A,e){let t=[],i=Kt(A.due);for(let o of e){let l;if(o.review=te.time(o.review),o.rating===T.Manual){let c=0;i.state!==ie.New&&i.last_review&&(c=Pt(o.review,i.last_review,"days")),l=this.handleManualRating(i,o.state,o.review,c,o.stability,o.difficulty,o.due?te.time(o.due):void 0)}else l=this.replay(i,o.review,o.rating);t.push(l),i=l.card}return t}calculateManualRecord(A,e,t,i){if(!t)return null;let{card:o,log:l}=t,c=te.card(A);return c.due.getTime()===o.due.getTime()?null:(c.scheduled_days=Pt(o.due,c.due,"days"),this.handleManualRating(c,o.state,te.time(e),l.elapsed_days,i?o.stability:void 0,i?o.difficulty:void 0,o.due))}},yn=class extends vn{constructor(e){super(e);Se(this,"strategyHandler",new Map);Se(this,"Scheduler");let{enable_short_term:t}=this.parameters;this.Scheduler=t?Ar:tr}params_handler_proxy(){let e=this;return{set:function(t,i,o){return i==="request_retention"&&Number.isFinite(o)?e.intervalModifier=e.calculate_interval_modifier(Number(o)):i==="enable_short_term"?e.Scheduler=o===!0?Ar:tr:i==="w"&&(o=En(Qn(o),t.relearning_steps.length),e.forgetting_curve=Cn.bind(this,o),e.intervalModifier=e.calculate_interval_modifier(Number(t.request_retention))),Reflect.set(t,i,o),!0}}}useStrategy(e,t){return this.strategyHandler.set(e,t),this}clearStrategy(e){return e?this.strategyHandler.delete(e):this.strategyHandler.clear(),this}getScheduler(e,t){let i=this.strategyHandler.get(ir.SCHEDULER)||this.Scheduler;return new i(e,t,this,this.strategyHandler)}repeat(e,t,i){let o=this.getScheduler(e,t).preview();return i&&typeof i=="function"?i(o):o}next(e,t,i,o){let l=this.getScheduler(e,t),c=te.rating(i);if(c===T.Manual)throw new Error("Cannot review a manual rating");let h=l.review(c);return o&&typeof o=="function"?o(h):h}get_retrievability(e,t,i=!0){let o=te.card(e);t=t?te.time(t):new Date;let l=o.state!==ie.New?Math.max(Pt(t,o.last_review,"days"),0):0,c=o.state!==ie.New?this.forgetting_curve(l,+o.stability.toFixed(8)):0;return i?`${(c*100).toFixed(2)}%`:c}rollback(e,t,i){let o=te.card(e),l=te.review_log(t);if(l.rating===T.Manual)throw new Error("Cannot rollback a manual rating");let c,h,g;switch(l.state){case ie.New:c=l.due,h=void 0,g=0;break;case ie.Learning:case ie.Relearning:case ie.Review:c=l.review,h=l.due,g=o.lapses-(l.rating===T.Again&&l.state===ie.Review?1:0);break}let u={...o,due:c,stability:l.stability,difficulty:l.difficulty,elapsed_days:l.last_elapsed_days,scheduled_days:l.scheduled_days,reps:Math.max(0,o.reps-1),lapses:Math.max(0,g),learning_steps:l.learning_steps,state:l.state,last_review:h};return i&&typeof i=="function"?i(u):u}forget(e,t,i=!1,o){let l=te.card(e);t=te.time(t);let c=l.state===ie.New?0:Pt(t,l.due,"days"),h={rating:T.Manual,state:l.state,due:l.due,stability:l.stability,difficulty:l.difficulty,elapsed_days:0,last_elapsed_days:l.elapsed_days,scheduled_days:c,learning_steps:l.learning_steps,review:t},g={card:{...l,due:t,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:i?0:l.reps,lapses:i?0:l.lapses,learning_steps:0,state:ie.New,last_review:l.last_review},log:h};return o&&typeof o=="function"?o(g):g}reschedule(e,t=[],i={}){let{recordLogHandler:o,reviewsOrderBy:l,skipManual:c=!0,now:h=new Date,update_memory_state:g=!1}=i;l&&typeof l=="function"&&t.sort(l),c&&(t=t.filter(Q=>Q.rating!==T.Manual));let u=new Fn(this),m=u.reschedule(i.first_card||Kt(),t),w=m.length,F=te.card(e),E=u.calculateManualRecord(F,h,w?m[w-1]:void 0,g);return o&&typeof o=="function"?{collections:m.map(o),reschedule_item:E?o(E):null}:{collections:m,reschedule_item:E}}},Un=y=>new yn(y||{});var sr=class{constructor(A={}){this.params=this.convertToTsFSRSParams(A),this.fsrsInstance=Un(this.params)}convertToTsFSRSParams(A){let{request_retention:e=.9,maximum_interval:t=36500,w:i=[]}=A;return js({request_retention:e,maximum_interval:t,enable_fuzz:!0,enable_short_term:!0,w:A.w||[]})}toTsFSRSCard(A){if(A.lastReview===0)return Kt(new Date(A.createdAt));let e=ie.New;return A.reviews>0&&(A.lapses>0?e=ie.Relearning:e=ie.Review),{due:new Date(A.nextReview),stability:A.stability,difficulty:A.difficulty,elapsed_days:A.lastReview?(Date.now()-A.lastReview)/(24*60*60*1e3):0,scheduled_days:A.lastReview?(A.nextReview-A.lastReview)/(24*60*60*1e3):0,reps:A.reviews,lapses:A.lapses,state:e,last_review:A.lastReview?new Date(A.lastReview):void 0,learning_steps:0}}convertRating(A){switch(A){case ge.AGAIN:return T.Again;case ge.HARD:return T.Hard;case ge.GOOD:return T.Good;case ge.EASY:return T.Easy;default:return T.Good}}fromTsFSRSCard(A,e){let{card:t,log:i}=e;return{...A,difficulty:t.difficulty,stability:t.stability,retrievability:Math.exp(Math.log(.9)*t.elapsed_days/t.stability),lastReview:i.review.getTime(),nextReview:t.due.getTime(),reviews:t.reps,lapses:t.lapses,reviewHistory:[...A.reviewHistory,{timestamp:i.review.getTime(),rating:this.convertTsFSRSRatingToFSRSRating(i.rating),elapsed:i.elapsed_days}]}}convertTsFSRSRatingToFSRSRating(A){switch(A){case T.Again:return ge.AGAIN;case T.Hard:return ge.HARD;case T.Good:return ge.GOOD;case T.Easy:return ge.EASY;default:return ge.GOOD}}initializeCard(A,e,t){let i=Date.now(),o=Kt(new Date(i));return{id:Je.generateCardId(),difficulty:o.difficulty,stability:o.stability,retrievability:1,lastReview:0,nextReview:i,reviews:0,lapses:0,reviewHistory:[],text:A,answer:e,filePath:t,createdAt:i}}reviewCard(A,e){let t=this.toTsFSRSCard(A),i=this.convertRating(e),o=new Date;if(i!==T.Manual){let l=this.fsrsInstance.next(t,o,i);return this.fromTsFSRSCard(A,l)}else return A}getSchedulingCards(A){let e=this.toTsFSRSCard(A),t=new Date,i=this.fsrsInstance.repeat(e,t);return{[ge.AGAIN]:this.fromTsFSRSCard(A,i[T.Again]),[ge.HARD]:this.fromTsFSRSCard(A,i[T.Hard]),[ge.GOOD]:this.fromTsFSRSCard(A,i[T.Good]),[ge.EASY]:this.fromTsFSRSCard(A,i[T.Easy])}}isDue(A){return Date.now()>=A.nextReview}getParameters(){return{...this.params}}setParameters(A){this.params=this.convertToTsFSRSParams(A),this.fsrsInstance=Un(this.params)}};var rr=class{constructor(A={}){this.params={...tn,...A},this.adapter=new sr(this.params)}initializeCard(A,e,t){return this.adapter.initializeCard(A,e,t)}reviewCard(A,e){return this.adapter.reviewCard(A,e)}isDue(A){return this.adapter.isDue(A)}getReviewableCards(A){return A.filter(e=>this.isDue(e)).sort((e,t)=>e.nextReview-t.nextReview)}getParameters(){return{...this.params}}setParameters(A){this.params={...this.params,...A},this.adapter.setParameters(this.params)}resetParameters(){this.params={...tn},this.adapter.setParameters(this.params)}getSchedulingCards(A){return this.adapter.getSchedulingCards(A)}};var nr=class{constructor(A,e){this.plugin=A,this.fsrsService=e}get storage(){return this.plugin.fsrsManager.storage}createCard(A,e,t){try{return this.fsrsService.initializeCard(A,e,t)}catch(i){console.error("\u521B\u5EFA\u5361\u7247\u65F6\u51FA\u9519:",i);try{return this.fsrsService.initializeCard(A,e,t)}catch(o){console.error("\u7B2C\u4E8C\u6B21\u5C1D\u8BD5\u521B\u5EFA\u5361\u7247\u5931\u8D25:",o);let l=new Date;return this.fsrsService.initializeCard(A,e,t)}}}addCard(A,e,t){let i=this.createCard(A,e,t);this.storage.cards||(this.storage.cards={}),this.storage.cards[i.id]=i;try{this.plugin.eventManager.emitFlashcardChanged()}catch(o){console.error("\u4FDD\u5B58\u5361\u7247\u65F6\u51FA\u9519:",o)}return i}getCardsByFile(A){return this.storage.cards?Object.values(this.storage.cards).filter(e=>e.filePath===A):[]}deleteCard(A){try{return!this.storage.cards||!this.storage.cards[A]?!1:(delete this.storage.cards[A],this.plugin.eventManager.emitFlashcardChanged(),!0)}catch(e){return console.error("\u5220\u9664\u5361\u7247\u65F6\u51FA\u9519:",e),!1}}};var Fi=class{constructor(A,e){this.plugin=A,this.storage=e}getCardGroups(){return this.storage.cardGroups||[]}getGroupById(A){return this.storage.cardGroups.find(e=>e.id===A)||null}async createCardGroup(A){Array.isArray(this.storage.cardGroups)||(this.storage.cardGroups=[]);let t={id:Je.generateGroupId(),name:A.name,filter:A.filter,createdTime:A.createdTime||Date.now(),sortOrder:A.sortOrder||this.storage.cardGroups.length,isReversed:A.isReversed||!1,settings:A.settings||{useGlobalSettings:!0},cardIds:[]};this.storage.cardGroups.push(t),A.filter&&A.filter.trim().length>0&&this.updateGroupCardIds(t.id);try{await this.plugin.fsrsManager.saveStoragePublic()}catch(i){console.error("\u4FDD\u5B58\u5206\u7EC4\u6570\u636E\u65F6\u51FA\u9519:",i)}return this.plugin.eventManager.emitFlashcardChanged(),t}async updateCardGroup(A,e){let t=this.storage.cardGroups.findIndex(i=>i.id===A);return t===-1?!1:(this.storage.cardGroups[t]={...this.storage.cardGroups[t],...e},e.filter&&this.updateGroupCardIds(A),this.plugin.eventManager.emitFlashcardChanged(),!0)}async deleteCardGroup(A,e=!1){let t=this.storage.cardGroups.findIndex(c=>c.id===A);if(t===-1)return!1;let i=this.storage.cardGroups[t],o=this.storage.uiState;o.currentGroupId===A&&(o.currentGroupId="",o.currentGroupName="",o.currentIndex=0,o.isFlipped=!1,o.completionMessage=null),o.groupCompletionMessages&&A in o.groupCompletionMessages&&delete o.groupCompletionMessages[A],o.groupProgress&&A in o.groupProgress&&delete o.groupProgress[A];let l=[...i.cardIds||[]];for(let c of l)this.removeCardFromGroup(c,A);return this.storage.cardGroups.splice(t,1),this.plugin.eventManager.emitFlashcardChanged(),!0}addCardToGroup(A,e){let t=this.storage.cardGroups.find(o=>o.id===e);if(!t)return!1;let i=this.storage.cards[A];return i?(t.cardIds||(t.cardIds=[]),i.groupIds||(i.groupIds=[]),t.cardIds.includes(A)||(t.cardIds.push(A),i.groupIds.includes(e)||i.groupIds.push(e)),!0):!1}removeCardFromGroup(A,e){let t=this.storage.cardGroups.find(o=>o.id===e);if(!t||!t.cardIds)return!1;let i=this.storage.cards[A];return i?(t.cardIds=t.cardIds.filter(o=>o!==A),i.groupIds&&(i.groupIds=i.groupIds.filter(o=>o!==e)),!0):!1}getCardsByGroupId(A){let e=this.getGroupById(A);if(!e)return console.error(`[getCardsByGroupId] \u9519\u8BEF: \u672A\u627E\u5230\u5206\u7EC4: ${A}`),[];let t=Object.keys(this.storage.cards||{});if(e.cardIds&&e.cardIds.length>0)return e.cardIds.filter(o=>{let l=!!this.storage.cards[o];return l||console.warn(`[getCardsByGroupId] \u5361\u7247\u4E0D\u5B58\u5728: ${o}`),l}).map(o=>this.storage.cards[o]);if(e.filter&&e.filter.trim().length>0){let i=Object.values(this.storage.cards),o=e.filter.split(",").map(h=>h.trim()).filter(h=>h.length>0),l=/\[\[([^\]]+)\]\]/;return i.filter(h=>{if(!h.filePath)return!1;let g=h.filePath.toLowerCase(),u=g.split("/").pop()||"",m=u.replace(/\.md$/i,"");for(let w of o){let F=w.toLowerCase(),E=F.match(l);if(E){let Q=E[1].toLowerCase();if(m===Q||u===Q)return!0}else if(g.includes(F)||h.text&&h.text.toLowerCase().includes(F)||h.answer&&h.answer.toLowerCase().includes(F))return!0}return!1})}return[]}getGroupProgress(A){if(!this.getGroupById(A))return null;let t=this.getCardsByGroupId(A),i=Date.now();return{due:t.filter(o=>o.nextReview<=i).length,newCards:t.filter(o=>o.lastReview===0).length,learned:t.filter(o=>o.lastReview>0).length,retention:this.calculateGroupRetention(t)}}calculateGroupRetention(A){let e=A.filter(i=>i.lastReview>0);return e.length===0?1:e.reduce((i,o)=>i+o.retrievability,0)/e.length}deleteCardReference(A){for(let e of this.storage.cardGroups)e.cardIds&&(e.cardIds=e.cardIds.filter(t=>t!==A))}getGroupsByCardId(A){let e=this.storage.cards[A];return!e||!e.groupIds?[]:e.groupIds.map(t=>this.storage.cardGroups.find(i=>i.id===t)).filter(t=>t!==void 0)}updateGroupCardIds(A){let e=this.getGroupById(A);if(!e||!e.filter||e.filter.trim().length===0)return!1;let t=Object.values(this.storage.cards||{}),i=e.filter.split(",").map(g=>g.trim()).filter(g=>g.length>0),o=/\[\[([^\]]+)\]\]/,c=t.filter(g=>{if(!g.filePath)return!1;let u=g.filePath.toLowerCase(),m=u.split("/").pop()||"",w=m.replace(/\.md$/i,"");for(let F of i){let E=F.toLowerCase(),Q=E.match(o);if(Q){let H=Q[1].toLowerCase();if(w===H||m===H)return!0}else if(u.includes(E)||g.text&&g.text.toLowerCase().includes(E)||g.answer&&g.answer.toLowerCase().includes(E))return!0}return!1}).map(g=>g.id);e.cardIds||(e.cardIds=[]);let h=!1;for(let g of c)e.cardIds.includes(g)||(e.cardIds.push(g),h=!0);return h&&this.plugin.fsrsManager.saveStorageDebounced(),h}};var $o=require("obsidian"),ar=class{constructor(A,e){this.useNewStorage=!1;this.plugin=A,this.fsrsService=new rr,this.cardFactory=new nr(A,this.fsrsService),e&&(this.dataManager=e,this.useNewStorage=!0),this.storage={version:"1.0",cards:{},globalStats:{totalReviews:0,averageRetention:1,streakDays:0,lastReviewDate:0},cardGroups:[],uiState:{currentGroupName:"",completionMessage:null,groupProgress:{}},dailyStats:[]},this.saveStorageDebounced=(0,$o.debounce)(this.saveStorage.bind(this),1e3,!0),this.loadStorage().then(t=>{this.storage=t,this.groupRepository=new Fi(A,this.storage),this.registerEventListeners()}).catch(t=>{console.error("Loading storage data failed:",t),this.groupRepository=new Fi(A,this.storage),this.registerEventListeners()})}async loadStorage(){let A={version:"1.0",cards:{},globalStats:{totalReviews:0,averageRetention:1,streakDays:0,lastReviewDate:0},cardGroups:[],uiState:{currentGroupName:"",completionMessage:null,groupProgress:{}},dailyStats:[]};try{if(this.useNewStorage&&this.dataManager)return await this.dataManager.getFlashcardData()||A;{let e=await this.plugin.loadData();if(!(e!=null&&e.fsrs))return A;let t=Array.isArray(e.fsrs.cardGroups)?e.fsrs.cardGroups:[];return{version:e.fsrs.version||A.version,cards:e.fsrs.cards||{},globalStats:e.fsrs.globalStats||A.globalStats,cardGroups:t,uiState:e.fsrs.uiState||A.uiState,dailyStats:e.fsrs.dailyStats||[]}}}catch(e){return console.error("Loading storage data failed:",e),A}}async saveStorage(){try{if(Array.isArray(this.storage.cardGroups)||(this.storage.cardGroups=[]),this.storage.cards||(this.storage.cards={}),this.useNewStorage&&this.dataManager)await this.dataManager.saveFlashcardData(this.storage);else{let e={...await this.plugin.loadData()||{},fsrs:this.storage};await this.plugin.saveData(e)}}catch(A){throw console.error("Saving data failed:",A),A}}updateGlobalStats(A,e){let t=this.storage.globalStats,i=Date.now(),o=new Date(i).setHours(0,0,0,0);if(t.totalReviews++,t.averageRetention=(t.averageRetention*(t.totalReviews-1)+e)/t.totalReviews,t.lastReviewDate===0)t.streakDays=1;else{let l=new Date(t.lastReviewDate).setHours(0,0,0,0),c=(o-l)/(24*60*60*1e3);c===1?t.streakDays++:c>1&&(t.streakDays=1)}t.lastReviewDate=i}addCard(A,e,t,i,o){let l=this.cardFactory.createCard(A,e,t);return i&&o&&(l.sourceId=i,l.sourceType=o),this.storage.cards[l.id]=l,this.checkAndAddCardToGroups(l),this.saveStorageDebounced(),l}getCardsForStudy(A){if(!A)return console.warn("No group ID specified, returning empty card list"),[];let e=this.groupRepository.getCardsByGroupId(A);if(e.length===0)return[];let t=Date.now(),i=e.filter(F=>F.reviews===0&&F.lastReview===0),o=e.filter(F=>!(F.reviews===0&&F.lastReview===0)&&F.nextReview<=t),l=this.getRemainingNewCardsToday(A),c=this.getRemainingReviewsToday(A),h=this.storage.cardGroups.find(F=>F.id===A),g=20,u=100;if(h&&h.settings)if(!h.settings.useGlobalSettings)g=h.settings.newCardsPerDay!==void 0?h.settings.newCardsPerDay:g,u=h.settings.reviewsPerDay!==void 0?h.settings.reviewsPerDay:u;else{let F=this.fsrsService.getParameters();g=F.newCardsPerDay,u=F.reviewsPerDay}let m=i.slice(0,l),w=o.slice(0,c);return[...m,...w]}trackStudyProgress(A,e){let t=this.storage.cards[A];if(!t)return console.error(`Tracking study progress failed: Card ${A} does not exist`),null;let i=t.lastReview===0,o=this.fsrsService.reviewCard(t,e);return this.storage.cards[A]=o,this.updateGlobalStats(e,o.retrievability),this.updateDailyStats(i,e),t.groupIds&&t.groupIds.length>0&&t.groupIds.forEach(l=>{let c=this.groupRepository.getGroupById(l)}),this.saveStorage(),this.plugin.eventManager.emitFlashcardChanged(),this.storage.cards[A]}getCardPredictions(A){let e=this.storage.cards[A];return e?this.fsrsService.getSchedulingCards(e):null}async generateCardsForGroup(A){return 0}checkAndAddCardToGroups(A){if(!A||!A.id)return 0;let e=this.groupRepository.getCardGroups();if(!e||e.length===0)return 0;let t=0;for(let i of e){if(!i.filter||i.filter.trim().length===0)continue;let o=[A];this.checkCardMatchesGroupFilter(A,i.filter)&&this.addCardToGroup(A.id,i.id)&&t++}return t>0,t}checkCardMatchesGroupFilter(A,e){if(!A||!A.filePath||!e||e.trim().length===0)return!1;let t=e.split(",").map(h=>h.trim()).filter(h=>h.length>0);if(t.length===0)return!1;let i=/\[\[([^\]]+)\]\]/,o=A.filePath.toLowerCase(),l=o.split("/").pop()||"",c=l.replace(/\.md$/i,"");for(let h of t){let g=h.toLowerCase(),u=g.match(i);if(u){let m=u[1].toLowerCase();if(c===m||l===m)return!0}else if(o.includes(g)||A.text&&A.text.toLowerCase().includes(g)||A.answer&&A.answer.toLowerCase().includes(g))return!0}return!1}findCardsBySourceId(A,e){return!this.storage.cards||!A?[]:Object.values(this.storage.cards).filter(t=>t.sourceId===A&&(!e||t.sourceType===e))}deleteCardsBySourceId(A,e){let t=this.findCardsBySourceId(A,e),i=0;for(let o of t){if(o.groupIds)for(let l of o.groupIds)this.removeCardFromGroup(o.id,l);delete this.storage.cards[o.id],i++}return i>0&&this.saveStorageDebounced(),i}updateCardsBySourceId(A,e,t,i){let o=this.findCardsBySourceId(A,e),l=0;for(let c of o)t!==void 0&&(c.text=t),i!==void 0&&(c.answer=i),c.updatedAt=Date.now(),l++;return l>0&&this.saveStorageDebounced(),l}getTotalCardsCount(){let A=this.getCardGroups()||[];if(A.length===0)return 0;if(A.length===1&&A[0].cardIds)return A[0].cardIds.length;let e=new Set;return A.forEach(t=>{t.cardIds&&t.cardIds.forEach(i=>{this.storage.cards[i]&&e.add(i)})}),e.size}getProgress(){let A=this.getAllGroupCards(),e=Date.now();return A.length===0?{due:0,newCards:0,learned:0,retention:this.storage.globalStats.averageRetention}:{due:A.filter(t=>t.nextReview<=e).length,newCards:A.filter(t=>t.lastReview===0).length,learned:A.filter(t=>t.lastReview>0).length,retention:this.storage.globalStats.averageRetention}}getAllGroupCards(){let A=this.groupRepository.getCardGroups();if(!A||A.length===0)return[];let e=new Set,t=[];for(let i of A){let o=this.groupRepository.getCardsByGroupId(i.id);for(let l of o)e.has(l.id)||(e.add(l.id),t.push(l))}return t}getStats(){return{...this.storage.globalStats}}getUIState(){return{...this.storage.uiState}}updateUIState(A){this.storage.uiState={...this.storage.uiState,...A},this.saveStorageDebounced()}deleteCard(A){let e=this.storage.cards[A];if(!e)return!1;if(e.groupIds)for(let t of e.groupIds)this.removeCardFromGroup(A,t);return delete this.storage.cards[A],this.saveStorageDebounced(),this.plugin.eventManager.emitFlashcardChanged(),!0}getCardsByFile(A){return this.cardFactory.getCardsByFile(A)}getPlugin(){return this.plugin}async saveStoragePublic(){return this.saveStorage()}getTodayTimestamp(){let A=new Date;return A.setHours(0,0,0,0),A.getTime()}getTodayStats(){let A=new Date;A.setHours(0,0,0,0);let e=A.getTime(),t=A.toDateString(),i=this.storage.dailyStats.find(o=>new Date(o.date).toDateString()===t);return i||(i={date:e,newCardsLearned:0,cardsReviewed:0,reviewCount:0,newCount:0,againCount:0,hardCount:0,goodCount:0,easyCount:0},this.storage.dailyStats.push(i),this.saveStorageDebounced()),i}updateTodayStats(A){let e=this.getTodayStats();A?e.newCardsLearned++:e.cardsReviewed++,this.saveStorageDebounced()}canLearnNewCardsToday(A){let e=this.getTodayStats(),t=this.fsrsService.getParameters();if(A){let i=this.storage.cardGroups.find(o=>o.id===A);if(i&&i.settings&&!i.settings.useGlobalSettings&&i.settings.newCardsPerDay!==void 0)return e.newCardsLearned<i.settings.newCardsPerDay}return e.newCardsLearned<t.newCardsPerDay}canReviewCardsToday(A){let e=this.getTodayStats(),t=this.fsrsService.getParameters();if(A){let i=this.storage.cardGroups.find(o=>o.id===A);if(i&&i.settings&&!i.settings.useGlobalSettings&&i.settings.reviewsPerDay!==void 0)return e.cardsReviewed<i.settings.reviewsPerDay}return e.cardsReviewed<t.reviewsPerDay}getRemainingNewCardsToday(A){let e=this.getTodayStats(),t=this.fsrsService.getParameters();if(A){let i=this.storage.cardGroups.find(o=>o.id===A);if(i&&i.settings&&!i.settings.useGlobalSettings&&i.settings.newCardsPerDay!==void 0)return Math.max(0,i.settings.newCardsPerDay-e.newCardsLearned)}return Math.max(0,t.newCardsPerDay-e.newCardsLearned)}getRemainingReviewsToday(A){let e=this.getTodayStats(),t=this.fsrsService.getParameters();if(A){let i=this.storage.cardGroups.find(o=>o.id===A);if(i&&i.settings&&!i.settings.useGlobalSettings&&i.settings.reviewsPerDay!==void 0)return Math.max(0,i.settings.reviewsPerDay-e.cardsReviewed)}return Math.max(0,t.reviewsPerDay-e.cardsReviewed)}async createCardGroup(A){Array.isArray(this.storage.cardGroups)||(this.storage.cardGroups=[]);let e=await this.groupRepository.createCardGroup(A),t=await this.generateCardsForGroup(e.id);return this.storage.cardGroups.some(i=>i.id===e.id)||this.storage.cardGroups.push(e),await this.saveStorage(),e}async updateCardGroup(A,e){let t=this.groupRepository.getGroupById(A),i=t==null?void 0:t.filter;if(!await this.groupRepository.updateCardGroup(A,e))return!1;if(e.filter!==void 0&&e.filter!==i){let l=this.groupRepository.getGroupById(A);if(l&&l.cardIds)for(let h of[...l.cardIds])this.removeCardFromGroup(h,A);let c=await this.generateCardsForGroup(A)}return await this.saveStorage(),!0}async deleteCardGroup(A,e=!1){if(!await this.groupRepository.deleteCardGroup(A,!1))return!1;try{return await this.saveStorage(),!0}catch(i){return!1}}getCardsInGroup(A){return A.cardIds&&A.cardIds.length>0?this.getCardsByGroupId(A.id):Object.values(this.storage.cards).filter(t=>{let i=A.filter.split(",").map(g=>g.trim().toLowerCase()),o=t.text.toLowerCase(),l=t.answer.toLowerCase(),c=(t.filePath||"").toLowerCase();return i.some(g=>{if(g.startsWith("#"))return o.includes(g)||l.includes(g);if(g.startsWith("path:")){let u=g.substring(5);return c.includes(u)}return o.includes(g)||l.includes(g)})})}addCardToGroup(A,e){let t=this.groupRepository.addCardToGroup(A,e);return t&&this.saveStorageDebounced(),t}removeCardFromGroup(A,e){let t=this.groupRepository.removeCardFromGroup(A,e);return t&&this.saveStorageDebounced(),t}getGroupProgress(A){return this.groupRepository.getGroupProgress(A)}getCardsByGroupId(A){return this.groupRepository.getCardsByGroupId(A)}getAllCards(){return Object.values(this.storage.cards)}getCardGroups(){return this.groupRepository.getCardGroups()}registerEventListeners(){if(!this.plugin.eventManager){console.error("\u4E8B\u4EF6\u7BA1\u7406\u5668\u4E0D\u5B58\u5728\uFF0C\u65E0\u6CD5\u6CE8\u518C\u4E8B\u4EF6\u76D1\u542C\u5668");return}this.plugin.eventManager.on("highlight:update",(A,e,t,i)=>{this.handleHighlightUpdate(A,e,t,i)}),this.plugin.eventManager.on("highlight:delete",(A,e,t)=>{this.handleHighlightDelete(A,e,t)}),this.plugin.eventManager.on("comment:update",(A,e,t,i)=>{this.handleCommentUpdate(A,e,t,i)}),this.plugin.eventManager.on("comment:delete",(A,e,t)=>{this.handleCommentDelete(A,e,t)})}handleHighlightUpdate(A,e,t,i){let o=this.updateCardsBySourceId(i,"highlight",t)}handleHighlightDelete(A,e,t){let i=this.deleteCardsBySourceId(t,"highlight")}handleCommentUpdate(A,e,t,i){let o=this.findCardsBySourceId(i,"highlight");if(!o||o.length===0)return;let l=0;for(let c of o){let h=c.answer||"",g=/\{\{([^{}]+)\}\}/g,u=[],m;for(;(m=g.exec(c.text))!==null;)u.push(m[1]);let F=h.split(`
`).filter(H=>H.trim()!==""&&H.trim()!==e.trim()&&!u.includes(H.trim())),E=[];u.length>0&&E.push(u.join(`
`)),F.length>0&&E.push(F.join(`
`)),t&&t.trim()!==""&&E.push(t);let Q=E.length>0?E.join(`

`):"";Q!==h&&(c.answer=Q,c.updatedAt=Date.now(),l++)}l>0&&(this.saveStorageDebounced(),this.plugin.eventManager&&this.plugin.eventManager.emitFlashcardChanged())}handleCommentDelete(A,e,t){let i=this.deleteCardsBySourceId(t,"highlight")}checkAndMaintainDailyStats(){this.storage.dailyStats||(this.storage.dailyStats=[]),this.storage.dailyStats.sort((e,t)=>t.date-e.date);let A=new Map;return this.storage.dailyStats.forEach(e=>{let t=new Date(e.date),i=`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`;A.has(i)||A.set(i,e)}),this.storage.dailyStats=Array.from(A.values()),this.storage.dailyStats.sort((e,t)=>t.date-e.date),this.storage.dailyStats.length>84&&(this.storage.dailyStats=this.storage.dailyStats.slice(0,84)),this.storage.dailyStats.length}updateDailyStats(A,e){let t=new Date;t.setHours(0,0,0,0);let i=t.getTime();this.storage.globalStats.lastReviewDate?this.storage.globalStats.lastReviewDate===i||(this.storage.globalStats.lastReviewDate===i-864e5?(this.storage.globalStats.lastReviewDate=i,this.storage.globalStats.streakDays++):this.storage.globalStats.lastReviewDate<i&&(this.storage.globalStats.lastReviewDate=i,this.storage.globalStats.streakDays=1)):(this.storage.globalStats.lastReviewDate=i,this.storage.globalStats.streakDays=1);let o=t.toDateString(),l=this.storage.dailyStats.find(c=>new Date(c.date).toDateString()===o);switch(l||(l={date:i,newCardsLearned:0,cardsReviewed:0,reviewCount:0,newCount:0,againCount:0,hardCount:0,goodCount:0,easyCount:0},this.storage.dailyStats.push(l),this.checkAndMaintainDailyStats()),l.reviewCount++,A?(l.newCount++,l.newCardsLearned++):l.cardsReviewed++,e){case ge.AGAIN:l.againCount++;break;case ge.HARD:l.hardCount++;break;case ge.GOOD:l.goodCount++;break;case ge.EASY:l.easyCount++;break}this.saveStorageDebounced()}cleanupInvalidCardReferences(){let A=0;if(!this.storage.cardGroups)return A;for(let e of this.storage.cardGroups)if(e.cardIds&&e.cardIds.length>0){let t=e.cardIds.length;e.cardIds=e.cardIds.filter(o=>this.storage.cards&&this.storage.cards[o]);let i=t-e.cardIds.length;i>0&&(A+=i,e.lastUpdated=Date.now())}return A>0&&this.saveStorageDebounced(),A}resetGroupCompletionMessage(A){if(!A)return;let e=this.groupRepository.getGroupById(A);e&&(this.storage.uiState||(this.storage.uiState={currentGroupName:"",completionMessage:null,groupProgress:{}}),this.storage.uiState.groupProgress||(this.storage.uiState.groupProgress={}),this.storage.uiState.groupProgress[e.name]&&(this.storage.uiState.groupProgress[e.name].completionMessage=null,this.saveStorageDebounced()))}};var or=class{constructor(A,e){this.app=A;this.commentStore=e;this.textSimilarityService=new CA(A)}findMatchingHighlight(A,e){let t=this.commentStore.getFileComments(A);if(!t||t.length===0)return null;let i=t.find(c=>c.text!==e.text?!1:typeof c.position=="number"&&typeof e.position=="number"?Math.abs(c.position-e.position)<10:c.blockId&&e.blockId?c.blockId===e.blockId:!1);if(i||e.position!==void 0&&(i=t.find(c=>typeof c.position=="number"&&Math.abs(c.position-e.position)<30),i))return i;let o=null,l=0;for(let c of t){if(!c.comments||c.comments.length===0)continue;let h=this.textSimilarityService.calculateSimilarity(c.text,e.text);h>l&&h>.6&&(l=h,o=c)}if(o)return o;if(e.blockId){let c=t.filter(h=>h.blockId===e.blockId);if(c.length>0)return c[0]}return null}async recoverHighlight(A,e,t){let i={...e,text:t,updatedAt:Date.now()};return await this.commentStore.addComment(A,i),i}};Ds();var lr=class extends kt.Plugin{constructor(){super(...arguments);this.DEFAULT_SETTINGS={...oe,anthropic:{apiKey:"",model:"claude-2",apiAddress:"",isCustomModel:!1,lastCustomModel:""}}}async onload(){let e=await this.loadData();this.settings=Object.assign({},oe,e),window.html2canvas=zo.default,this.dataManager=new tt(this.app),this.commentStore=new Ks(this),await this.commentStore.loadComments(),this.eventManager=new et(this.app),this.fsrsManager=new ar(this,this.dataManager),this.highlightMatchingService=new or(this.app,this.commentStore),this.highlightService=new cA(this.app),this.highlightDecorator=new Rs(this,this.commentStore),this.highlightDecorator.enable(),this.registerView(sA,t=>new pA(t,this.commentStore)),this.addRibbonIcon("highlighter","HiNote",async()=>{let{workspace:t}=this.app,i=t.getLeavesOfType(sA);if(i.length){t.revealLeaf(i[0]);return}let o=t.getRightLeaf(!1);o&&await o.setViewState({type:sA,active:!0})}),this.addCommand({id:"open-comment-window",name:f("Open in right sidebar"),callback:async()=>{let{workspace:t}=this.app,i=t.getLeavesOfType(sA);if(i.length){let l=i[0],c=l.view;if(c&&c instanceof pA&&c.isDraggedToMainView){t.detachLeavesOfType(sA);let h=t.getRightLeaf(!1);if(h){await h.setViewState({type:sA,active:!0});let g=h.view;g&&g instanceof pA&&(g.isDraggedToMainView=!1,g.updateViewLayout(),g.updateHighlights())}}else t.revealLeaf(l);return}let o=t.getRightLeaf(!1);if(o){await o.setViewState({type:sA,active:!0});let l=o.view;l&&l instanceof pA&&(l.isDraggedToMainView=!1,l.updateViewLayout())}}}),this.addSettingTab(new zs(this.app,this)),this.registerEvent(this.app.vault.on("rename",(t,i)=>{this.commentStore.updateFilePath(i,t.path)})),this.addCommand({id:"recover-data",name:f("Recover data from backup"),callback:async()=>{let{DataRecovery:t}=await Promise.resolve().then(()=>(qo(),Yo)),i=new t(this);new kt.Notice(f("Starting data recovery from backup, please check console output")),await i.autoRecover()?(new kt.Notice(f("Data recovery successful! Please reload the plugin to see the effects")),await this.commentStore.loadComments()):new kt.Notice(f("Data recovery failed, please check console error messages"))}}),this.addCommand({id:"open-chat-window",name:f("Open AI chat window"),callback:()=>{At.getInstance(this.app,this).show()}}),this.addCommand({id:"open-comment-main-window",name:f("Open in main window"),callback:async()=>{let{workspace:t}=this.app,i=t.getLeavesOfType(sA);if(i.length){let l=i[0];t.setActiveLeaf(l,{focus:!0}),t.detachLeavesOfType(sA);let c=t.getLeaf("tab");await c.setViewState({type:sA,active:!0});let h=c.view;h&&h instanceof pA&&(h.isDraggedToMainView=!0,h.updateViewLayout(),h.updateHighlights());return}let o=t.getLeaf("tab");o&&(await o.setViewState({type:sA,active:!0}),setTimeout(()=>{let l=o.view;l&&l instanceof pA&&(l.isDraggedToMainView=!0,l.updateViewLayout(),l.updateHighlights())},100))}})}async onunload(){try{await this.commentStore.saveComments();let e=await this.loadData()}catch(e){}this.highlightDecorator&&this.highlightDecorator.disable(),At.instance&&At.instance.close()}async loadSettings(){let e=await this.loadData();this.settings||(this.settings={excludePatterns:oe.excludePatterns,useCustomPattern:oe.useCustomPattern,regexRules:[...oe.regexRules],ai:{provider:oe.ai.provider,openai:oe.ai.openai?{...oe.ai.openai}:void 0,anthropic:oe.ai.anthropic?{...oe.ai.anthropic}:void 0,gemini:oe.ai.gemini?{...oe.ai.gemini}:void 0,ollama:oe.ai.ollama?{...oe.ai.ollama}:void 0,deepseek:oe.ai.deepseek?{...oe.ai.deepseek}:void 0,prompts:{...oe.ai.prompts}},export:{exportPath:oe.export.exportPath}}),(e==null?void 0:e.excludePatterns)!==void 0&&(this.settings.excludePatterns=e.excludePatterns),e!=null&&e.ai&&(e.ai.provider&&(this.settings.ai.provider=e.ai.provider),e.ai.openai&&this.settings.ai.openai&&(this.settings.ai.openai={apiKey:e.ai.openai.apiKey||this.settings.ai.openai.apiKey,model:e.ai.openai.model||this.settings.ai.openai.model,baseUrl:e.ai.openai.baseUrl}),e.ai.anthropic&&this.settings.ai.anthropic&&(this.settings.ai.anthropic={apiKey:e.ai.anthropic.apiKey||this.settings.ai.anthropic.apiKey,model:e.ai.anthropic.model||this.settings.ai.anthropic.model,availableModels:e.ai.anthropic.availableModels,apiAddress:e.ai.anthropic.apiAddress||e.ai.anthropic.baseUrl,isCustomModel:e.ai.anthropic.isCustomModel||!1,lastCustomModel:e.ai.anthropic.lastCustomModel||""}),e.ai.gemini&&this.settings.ai.gemini&&(this.settings.ai.gemini={apiKey:e.ai.gemini.apiKey||this.settings.ai.gemini.apiKey,model:e.ai.gemini.model||this.settings.ai.gemini.model,baseUrl:e.ai.gemini.baseUrl,isCustomModel:e.ai.gemini.isCustomModel||!1}),e.ai.ollama&&this.settings.ai.ollama&&(this.settings.ai.ollama={host:e.ai.ollama.host||this.settings.ai.ollama.host,model:e.ai.ollama.model||this.settings.ai.ollama.model,availableModels:e.ai.ollama.availableModels}),e.ai.deepseek&&this.settings.ai.deepseek&&(this.settings.ai.deepseek={apiKey:e.ai.deepseek.apiKey||this.settings.ai.deepseek.apiKey,model:e.ai.deepseek.model||this.settings.ai.deepseek.model,baseUrl:e.ai.deepseek.baseUrl}),e.ai.prompts&&(this.settings.ai.prompts={...this.settings.ai.prompts,...e.ai.prompts})),e!=null&&e.export&&e.export.exportPath&&(this.settings.export.exportPath=e.export.exportPath),e!=null&&e.comments&&(this.settings.comments=e.comments),e!=null&&e.comments&&(this.settings.comments=e.comments),await this.saveSettings()}async saveSettings(){var t,i,o,l,c,h,g,u,m;this.settings||(this.settings={...oe});let e=await this.loadData();e!=null&&e["flashcard-license"]&&(this.settings["flashcard-license"]=e["flashcard-license"]),this.settings.excludePatterns=(t=this.settings.excludePatterns)!=null?t:oe.excludePatterns,this.settings.useCustomPattern=(i=this.settings.useCustomPattern)!=null?i:oe.useCustomPattern,(!this.settings.regexRules||!Array.isArray(this.settings.regexRules))&&(this.settings.regexRules=[...oe.regexRules]),this.settings.ai||(this.settings.ai={...oe.ai}),this.settings.export||(this.settings.export={...oe.export}),this.settings.ai.openai||(this.settings.ai.openai={apiKey:"",model:((o=oe.ai.openai)==null?void 0:o.model)||"gpt-4o",baseUrl:(l=oe.ai.openai)==null?void 0:l.baseUrl}),this.settings.ai.anthropic||(this.settings.ai.anthropic={apiKey:"",model:"claude-opus-4-1-20250805",availableModels:(c=oe.ai.anthropic)==null?void 0:c.availableModels,apiAddress:(h=oe.ai.anthropic)==null?void 0:h.apiAddress,isCustomModel:!1,lastCustomModel:""}),this.settings.ai.gemini||(this.settings.ai.gemini={apiKey:"",model:"gemini-2.5-flash",isCustomModel:!1,baseUrl:(g=oe.ai.gemini)==null?void 0:g.baseUrl}),this.settings.ai.ollama||(this.settings.ai.ollama={host:"http://localhost:11434",model:"",availableModels:(u=oe.ai.ollama)==null?void 0:u.availableModels}),this.settings.ai.deepseek||(this.settings.ai.deepseek={apiKey:"",model:"deepseek-chat",baseUrl:(m=oe.ai.deepseek)==null?void 0:m.baseUrl}),this.settings.ai.prompts||(this.settings.ai.prompts={...oe.ai.prompts}),this.settings.export||(this.settings.export={exportPath:oe.export.exportPath}),await this.saveData(this.settings)}};
/*! Bundled license information:

html2canvas/dist/html2canvas.js:
  (*!
   * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
   * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
   * Released under MIT License
   *)
  (*! *****************************************************************************
      Copyright (c) Microsoft Corporation.
  
      Permission to use, copy, modify, and/or distribute this software for any
      purpose with or without fee is hereby granted.
  
      THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
      REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
      AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
      INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
      LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
      OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
      PERFORMANCE OF THIS SOFTWARE.
      ***************************************************************************** *)
*/

/* nosourcemap */