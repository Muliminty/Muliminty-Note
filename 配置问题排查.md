# Quartz 配置问题排查指南

## 问题：左侧目录和搜索框不显示

### 可能原因

1. **依赖未安装**
   - 需要先运行 `npm install` 安装依赖

2. **布局配置未正确导入**
   - 确保 `quartz.config.ts` 中导入了 `quartz.layout.ts`
   - 确保布局配置正确添加到 config 中

3. **构建未完成**
   - 需要运行 `npm run build` 或 `npm run dev` 构建项目

### 解决步骤

#### 1. 安装依赖

```bash
npm install
```

#### 2. 检查配置文件

确保 `quartz.config.ts` 中导入了布局配置：

```typescript
import * as Shared from "./quartz.layout"

const config: QuartzConfig = {
  // ... 其他配置
  layout: {
    sharedPageComponents: Shared.sharedPageComponents,
    defaultContentPageLayout: Shared.defaultContentPageLayout,
    defaultListPageLayout: Shared.defaultListPageLayout,
  },
}
```

#### 3. 构建项目

```bash
# 开发模式（带热更新）
npm run dev

# 或构建生产版本
npm run build
```

#### 4. 检查构建输出

查看 `public/` 目录是否生成了文件，如果为空或没有生成，说明构建失败。

#### 5. 查看构建日志

运行 `npm run build` 时查看是否有错误信息。

---

## 问题：双链悬浮预览不显示

### 可能原因

1. **`enablePopovers` 未启用**
   - 确保 `quartz.config.ts` 中 `enablePopovers: true`

2. **Obsidian 插件配置不正确**
   - 确保 `Plugin.ObsidianFlavoredMarkdown()` 配置正确

3. **链接格式不正确**
   - 确保使用正确的 wikilink 格式：`[[文件名]]`

### 解决步骤

#### 1. 检查配置

确保 `quartz.config.ts` 中：

```typescript
configuration: {
  enablePopovers: true,  // 必须启用
  // ...
},
```

#### 2. 检查 Obsidian 插件

确保 `Plugin.ObsidianFlavoredMarkdown()` 配置正确：

```typescript
Plugin.ObsidianFlavoredMarkdown({ 
  enableInHtml: true,
  wikilinks: true,      // 启用 wikilinks
  // ...
}),
```

#### 3. 检查链接格式

在 Markdown 文件中使用正确的格式：

```markdown
[[文件名]]                    // ✅ 正确
[[文件名|显示文本]]            // ✅ 正确
[文本](./文件名.md)            // ✅ 正确

[[文件名]]                    // ❌ 如果文件不存在，可能无法预览
```

#### 4. 重新构建

```bash
npm run build
```

#### 5. 清除缓存

```bash
# 删除构建缓存
rm -rf .quartz-cache/
rm -rf public/

# 重新构建
npm run build
```

---

## 常见错误排查

### 错误：找不到模块 "quartz/config"

**原因**：依赖未安装

**解决**：
```bash
npm install
```

### 错误：找不到模块 "./quartz.layout"

**原因**：布局文件路径错误或文件不存在

**解决**：
1. 确保 `quartz.layout.ts` 文件存在
2. 检查导入路径是否正确

### 错误：构建失败

**原因**：配置文件语法错误或依赖问题

**解决**：
1. 检查 `quartz.config.ts` 语法
2. 检查 `quartz.layout.ts` 语法
3. 查看详细错误信息：`npm run build -- --verbose`

### 问题：页面显示但功能不工作

**原因**：可能是浏览器缓存问题

**解决**：
1. 清除浏览器缓存
2. 硬刷新（Ctrl/Cmd + Shift + R）
3. 检查控制台是否有 JavaScript 错误

---

## 验证配置

### 检查清单

- [ ] 依赖已安装（`npm install`）
- [ ] `quartz.config.ts` 配置正确
- [ ] `quartz.layout.ts` 配置正确
- [ ] `enablePopovers: true` 已设置
- [ ] `Plugin.ObsidianFlavoredMarkdown()` 配置正确
- [ ] `Plugin.Search()` 已添加到 emitters
- [ ] 布局配置已导入到 `quartz.config.ts`
- [ ] 构建成功（`npm run build`）
- [ ] 浏览器控制台无错误

### 测试步骤

1. **启动开发服务器**：
   ```bash
   npm run dev
   ```

2. **访问网站**：
   打开 `http://localhost:8080`

3. **检查左侧边栏**：
   - 应该看到搜索框
   - 应该看到文件目录浏览器
   - 应该看到其他组件

4. **测试搜索**：
   - 点击搜索框
   - 输入关键词
   - 应该看到搜索结果

5. **测试双链预览**：
   - 鼠标悬停在 wikilink 上（如 `[[文件名]]`）
   - 应该看到预览窗口

---

## 如果问题仍然存在

1. **查看 Quartz 官方文档**：
   - https://quartz.jzhao.xyz/

2. **检查 GitHub Issues**：
   - https://github.com/jackyzha0/quartz/issues

3. **查看示例配置**：
   - https://github.com/jackyzha0/quartz/tree/v4

4. **重新初始化项目**：
   ```bash
   # 备份当前配置
   cp quartz.config.ts quartz.config.ts.bak
   cp quartz.layout.ts quartz.layout.ts.bak
   
   # 重新初始化（可选）
   npx quartz create
   ```

---

**最后更新**：2025

