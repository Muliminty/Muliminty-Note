# 诊断和修复：目录和双链预览不显示

## 问题描述

部署后网站可以正常访问，但是：
- ❌ 左侧边栏没有显示搜索框和目录浏览器
- ❌ 双链悬浮预览功能不工作

## 快速诊断步骤

### 1. 检查配置文件是否存在

```bash
# 在项目根目录执行
ls -la quartz.config.ts quartz.layout.ts
```

应该看到两个文件都存在。

### 2. 检查配置是否正确

打开 `quartz.config.ts`，确保有以下内容：

```typescript
import * as Shared from "./quartz.layout"

const config: QuartzConfig = {
  // ...
  layout: {
    sharedPageComponents: Shared.sharedPageComponents,
    defaultContentPageLayout: Shared.defaultContentPageLayout,
    defaultListPageLayout: Shared.defaultListPageLayout,
  },
}
```

### 3. 本地测试

```bash
# 1. 安装依赖
npm install

# 2. 清理缓存
rm -rf .quartz-cache/ public/

# 3. 构建
npm run build

# 4. 启动开发服务器
npm run dev
```

访问 `http://localhost:8080`，检查：
- 左侧边栏是否显示搜索框和目录
- 鼠标悬停在双链上是否有预览

### 4. 如果本地测试正常

**检查 GitHub Actions 构建日志**：

1. 进入 GitHub 仓库的 **Actions** 标签页
2. 查看最新的构建日志
3. 检查是否有错误信息

**可能的问题**：
- 构建时 `quartz.layout.ts` 文件未正确加载
- 依赖未正确安装
- 构建缓存问题

### 5. 如果本地测试也不正常

**检查配置语法**：

```bash
# 检查 TypeScript 语法
npx tsc --noEmit quartz.config.ts quartz.layout.ts
```

**常见错误**：
- 导入路径错误
- 类型错误
- 语法错误

## 修复方案

### 方案一：确保文件已提交

```bash
# 检查文件是否在 Git 中
git status

# 如果文件未提交，添加并提交
git add quartz.config.ts quartz.layout.ts
git commit -m "Fix layout configuration"
git push origin master
```

### 方案二：清理并重新构建

```bash
# 1. 清理缓存和构建输出
rm -rf .quartz-cache/ public/ node_modules/ package-lock.json

# 2. 重新安装依赖
npm install

# 3. 重新构建
npm run build

# 4. 提交更改
git add .
git commit -m "Clean and rebuild"
git push origin master
```

### 方案三：检查 GitHub Actions 配置

确保 `.github/workflows/deploy.yml` 中：

```yaml
- name: Build Quartz site
  run: npm run build
```

### 方案四：简化配置测试

如果上述方案都不行，尝试简化配置：

1. **简化 `quartz.layout.ts`**：

```typescript
import { PageLayout, SharedLayout } from "quartz/cfg"
import * as Component from "quartz/components"

const left: Component.ComponentId[] = [
  Component.PageTitle(),
  Component.Search(),
  Component.Explorer(),
]

const right: Component.ComponentId[] = [
  Component.TableOfContents(),
]

export const sharedPageComponents: SharedLayout = {
  left,
  right,
  header: [],
  footer: [],
}

export const defaultContentPageLayout: PageLayout = {
  beforeBody: [],
  left: [],
  right: [],
}

export const defaultListPageLayout: PageLayout = defaultContentPageLayout
```

2. **重新构建并测试**

## 验证步骤

修复后，按以下步骤验证：

1. **本地验证**：
   ```bash
   npm run build
   npm run dev
   ```
   访问 `http://localhost:8080`，检查功能是否正常

2. **提交并部署**：
   ```bash
   git add .
   git commit -m "Fix layout and popovers"
   git push origin master
   ```

3. **等待部署完成**（约 3-5 分钟）

4. **访问网站并检查**：
   - 左侧边栏是否显示搜索框和目录
   - 鼠标悬停在双链上是否有预览

## 如果问题仍然存在

1. **查看浏览器控制台**：
   - 打开浏览器开发者工具（F12）
   - 查看 Console 标签是否有错误
   - 查看 Network 标签，检查资源是否加载成功

2. **查看 Quartz 官方文档**：
   - https://quartz.jzhao.xyz/configuration
   - https://quartz.jzhao.xyz/plugins

3. **检查 GitHub Issues**：
   - https://github.com/jackyzha0/quartz/issues
   - 搜索类似的问题

4. **提交 Issue**：
   - 如果问题仍然存在，可以在 GitHub 上提交 Issue，附上：
     - 配置文件内容
     - 构建日志
     - 浏览器控制台错误信息

