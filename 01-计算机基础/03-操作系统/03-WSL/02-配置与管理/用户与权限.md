# WSL ç”¨æˆ·ä¸æƒé™ç®¡ç†

> WSL ä¸­çš„ç”¨æˆ·ç®¡ç†ã€sudo é…ç½®å’Œæ–‡ä»¶æƒé™

---

## ğŸ“‹ ç›®å½•

- [ç”¨æˆ·ç®¡ç†](#ç”¨æˆ·ç®¡ç†)
- [sudo é…ç½®](#sudo-é…ç½®)
- [æ–‡ä»¶æƒé™](#æ–‡ä»¶æƒé™)
- [ç”¨æˆ·ç»„ç®¡ç†](#ç”¨æˆ·ç»„ç®¡ç†)
- [é»˜è®¤ç”¨æˆ·è®¾ç½®](#é»˜è®¤ç”¨æˆ·è®¾ç½®)

---

## ç”¨æˆ·ç®¡ç†

### æŸ¥çœ‹å½“å‰ç”¨æˆ·

```bash
# æŸ¥çœ‹å½“å‰ç™»å½•ç”¨æˆ·
whoami

# æŸ¥çœ‹ç”¨æˆ· ID å’Œç»„ ID
id

# æŸ¥çœ‹ç”¨æˆ·è¯¦ç»†ä¿¡æ¯
id username
```

### åˆ›å»ºæ–°ç”¨æˆ·

```bash
# åˆ›å»ºæ–°ç”¨æˆ·
sudo adduser newuser

# åˆ›å»ºç”¨æˆ·ï¼ˆä¸åˆ›å»ºä¸»ç›®å½•ï¼‰
sudo useradd newuser

# åˆ›å»ºç”¨æˆ·å¹¶æŒ‡å®šä¸»ç›®å½•
sudo useradd -m -d /home/newuser newuser

# åˆ›å»ºç”¨æˆ·å¹¶æŒ‡å®š shell
sudo useradd -m -s /bin/bash newuser
```

### è®¾ç½®ç”¨æˆ·å¯†ç 

```bash
# è®¾ç½®å½“å‰ç”¨æˆ·å¯†ç 
passwd

# è®¾ç½®æŒ‡å®šç”¨æˆ·å¯†ç ï¼ˆéœ€è¦ root æƒé™ï¼‰
sudo passwd username
```

### åˆ é™¤ç”¨æˆ·

```bash
# åˆ é™¤ç”¨æˆ·ï¼ˆä¿ç•™ä¸»ç›®å½•ï¼‰
sudo userdel username

# åˆ é™¤ç”¨æˆ·åŠå…¶ä¸»ç›®å½•
sudo userdel -r username
```

### åˆ‡æ¢ç”¨æˆ·

```bash
# åˆ‡æ¢åˆ°å…¶ä»–ç”¨æˆ·
su username

# åˆ‡æ¢åˆ° root ç”¨æˆ·
su -
# æˆ–
sudo su -

# ä»¥å…¶ä»–ç”¨æˆ·èº«ä»½æ‰§è¡Œå‘½ä»¤
sudo -u username command
```

---

## sudo é…ç½®

### ä»€ä¹ˆæ˜¯ sudo

`sudo`ï¼ˆSuper User Doï¼‰å…è®¸æˆæƒç”¨æˆ·ä»¥å…¶ä»–ç”¨æˆ·ï¼ˆé€šå¸¸æ˜¯ rootï¼‰çš„èº«ä»½æ‰§è¡Œå‘½ä»¤ã€‚

### é…ç½® sudo æƒé™

#### å°†ç”¨æˆ·æ·»åŠ åˆ° sudo ç»„

```bash
# å°†ç”¨æˆ·æ·»åŠ åˆ° sudo ç»„ï¼ˆUbuntu/Debianï¼‰
sudo usermod -aG sudo username

# å°†ç”¨æˆ·æ·»åŠ åˆ° wheel ç»„ï¼ˆCentOS/RHELï¼‰
sudo usermod -aG wheel username
```

#### ç¼–è¾‘ sudoers æ–‡ä»¶

```bash
# ä½¿ç”¨ visudoï¼ˆæ¨èï¼Œä¼šæ£€æŸ¥è¯­æ³•ï¼‰
sudo visudo

# ç›´æ¥ç¼–è¾‘ï¼ˆä¸æ¨èï¼‰
sudo nano /etc/sudoers
```

### sudoers é…ç½®ç¤ºä¾‹

```bash
# å…è®¸ç”¨æˆ·æ— å¯†ç æ‰§è¡Œæ‰€æœ‰å‘½ä»¤
username ALL=(ALL) NOPASSWD: ALL

# å…è®¸ç”¨æˆ·æ‰§è¡Œç‰¹å®šå‘½ä»¤
username ALL=(ALL) NOPASSWD: /usr/bin/apt, /usr/bin/apt-get

# å…è®¸ç”¨æˆ·ç»„æ‰§è¡Œæ‰€æœ‰å‘½ä»¤
%sudo ALL=(ALL) ALL

# å…è®¸ç”¨æˆ·åœ¨ç‰¹å®šä¸»æœºä¸Šæ‰§è¡Œå‘½ä»¤
username HOSTNAME=(ALL) ALL
```

### å¸¸ç”¨ sudo é€‰é¡¹

```bash
# ä»¥ root èº«ä»½æ‰§è¡Œå‘½ä»¤
sudo command

# ä»¥æŒ‡å®šç”¨æˆ·èº«ä»½æ‰§è¡Œå‘½ä»¤
sudo -u username command

# æ‰§è¡Œå‘½ä»¤å¹¶ä¿æŒç¯å¢ƒå˜é‡
sudo -E command

# åˆ‡æ¢åˆ° root shell
sudo -i
sudo -s

# æŸ¥çœ‹ sudo æƒé™
sudo -l
```

### é…ç½® sudo è¶…æ—¶

```bash
# ç¼–è¾‘ sudoers æ–‡ä»¶
sudo visudo

# è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
Defaults timestamp_timeout=30

# ç¦ç”¨è¶…æ—¶ï¼ˆæ¯æ¬¡éƒ½éœ€è¦è¾“å…¥å¯†ç ï¼‰
Defaults timestamp_timeout=0

# è®¾ç½®è¶…æ—¶ä¸ºæ°¸ä¹…ï¼ˆä¸æ¨èï¼‰
Defaults timestamp_timeout=-1
```

---

## æ–‡ä»¶æƒé™

### æŸ¥çœ‹æ–‡ä»¶æƒé™

```bash
# è¯¦ç»†åˆ—è¡¨æ˜¾ç¤ºæƒé™
ls -l file.txt

# æ˜¾ç¤ºç›®å½•æƒé™
ls -ld directory

# é€’å½’æ˜¾ç¤ºæƒé™
ls -lR directory
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
-rwxr-xr-x 1 username group 1234 Jan 1 12:00 file.txt
drwxr-xr-x 2 username group 4096 Jan 1 12:00 directory
```

æƒé™è¯´æ˜ï¼š
- ç¬¬ 1 ä½ï¼šæ–‡ä»¶ç±»å‹ï¼ˆ`-` æ™®é€šæ–‡ä»¶ï¼Œ`d` ç›®å½•ï¼Œ`l` é“¾æ¥ï¼‰
- ç¬¬ 2-4 ä½ï¼šæ‰€æœ‰è€…æƒé™ï¼ˆrwxï¼‰
- ç¬¬ 5-7 ä½ï¼šç»„æƒé™ï¼ˆrwxï¼‰
- ç¬¬ 8-10 ä½ï¼šå…¶ä»–ç”¨æˆ·æƒé™ï¼ˆrwxï¼‰

### æƒé™ç¬¦å·

- `r`ï¼ˆreadï¼‰ï¼šè¯»æƒé™ï¼ˆ4ï¼‰
- `w`ï¼ˆwriteï¼‰ï¼šå†™æƒé™ï¼ˆ2ï¼‰
- `x`ï¼ˆexecuteï¼‰ï¼šæ‰§è¡Œæƒé™ï¼ˆ1ï¼‰

### ä¿®æ”¹æ–‡ä»¶æƒé™

#### ä½¿ç”¨ chmodï¼ˆç¬¦å·æ¨¡å¼ï¼‰

```bash
# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x script.sh

# ç§»é™¤å†™æƒé™
chmod -w file.txt

# è®¾ç½®æ‰€æœ‰è€…è¯»å†™ï¼Œç»„å’Œå…¶ä»–åªè¯»
chmod u=rw,go=r file.txt

# é€’å½’è®¾ç½®ç›®å½•æƒé™
chmod -R 755 directory
```

#### ä½¿ç”¨ chmodï¼ˆæ•°å­—æ¨¡å¼ï¼‰

```bash
# 755ï¼šæ‰€æœ‰è€…è¯»å†™æ‰§è¡Œï¼Œç»„å’Œå…¶ä»–è¯»æ‰§è¡Œ
chmod 755 script.sh

# 644ï¼šæ‰€æœ‰è€…è¯»å†™ï¼Œç»„å’Œå…¶ä»–åªè¯»
chmod 644 file.txt

# 600ï¼šæ‰€æœ‰è€…è¯»å†™ï¼Œç»„å’Œå…¶ä»–æ— æƒé™
chmod 600 private_file.txt

# 777ï¼šæ‰€æœ‰ç”¨æˆ·å®Œå…¨æƒé™ï¼ˆä¸æ¨èï¼‰
chmod 777 file.txt

# é€’å½’è®¾ç½®
chmod -R 755 directory
```

#### å¸¸ç”¨æƒé™ç»„åˆ

| æƒé™ | æ•°å­— | è¯´æ˜ |
|------|------|------|
| rwx------ | 700 | ä»…æ‰€æœ‰è€…å¯è¯»å†™æ‰§è¡Œ |
| rw-r--r-- | 644 | æ‰€æœ‰è€…è¯»å†™ï¼Œå…¶ä»–åªè¯» |
| rwxr-xr-x | 755 | æ‰€æœ‰è€…å®Œå…¨æƒé™ï¼Œå…¶ä»–è¯»æ‰§è¡Œ |
| rwxrwxrwx | 777 | æ‰€æœ‰ç”¨æˆ·å®Œå…¨æƒé™ï¼ˆä¸å®‰å…¨ï¼‰ |

### ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…

```bash
# ä¿®æ”¹æ‰€æœ‰è€…
sudo chown username file.txt

# ä¿®æ”¹æ‰€æœ‰è€…å’Œç»„
sudo chown username:group file.txt

# é€’å½’ä¿®æ”¹
sudo chown -R username:group directory
```

### ä¿®æ”¹æ–‡ä»¶ç»„

```bash
# ä¿®æ”¹ç»„
sudo chgrp groupname file.txt

# é€’å½’ä¿®æ”¹
sudo chgrp -R groupname directory
```

### é»˜è®¤æƒé™ï¼ˆumaskï¼‰

```bash
# æŸ¥çœ‹å½“å‰ umask
umask

# è®¾ç½® umask
umask 022  # é»˜è®¤æƒé™ 755ï¼ˆç›®å½•ï¼‰æˆ– 644ï¼ˆæ–‡ä»¶ï¼‰
umask 002  # é»˜è®¤æƒé™ 775ï¼ˆç›®å½•ï¼‰æˆ– 664ï¼ˆæ–‡ä»¶ï¼‰

# æ°¸ä¹…è®¾ç½®ï¼ˆæ·»åŠ åˆ° ~/.bashrcï¼‰
echo 'umask 022' >> ~/.bashrc
```

---

## ç”¨æˆ·ç»„ç®¡ç†

### æŸ¥çœ‹ç”¨æˆ·ç»„

```bash
# æŸ¥çœ‹å½“å‰ç”¨æˆ·æ‰€å±ç»„
groups

# æŸ¥çœ‹æŒ‡å®šç”¨æˆ·æ‰€å±ç»„
groups username

# æŸ¥çœ‹æ‰€æœ‰ç»„
cat /etc/group

# æŸ¥çœ‹ç»„ä¿¡æ¯
getent group groupname
```

### åˆ›å»ºç”¨æˆ·ç»„

```bash
# åˆ›å»ºæ–°ç»„
sudo groupadd newgroup

# åˆ›å»ºç³»ç»Ÿç»„
sudo groupadd -r systemgroup
```

### åˆ é™¤ç”¨æˆ·ç»„

```bash
# åˆ é™¤ç»„
sudo groupdel groupname
```

### å°†ç”¨æˆ·æ·»åŠ åˆ°ç»„

```bash
# å°†ç”¨æˆ·æ·»åŠ åˆ°ç»„
sudo usermod -aG groupname username

# å°†ç”¨æˆ·æ·»åŠ åˆ°å¤šä¸ªç»„
sudo usermod -aG group1,group2,group3 username
```

### ä»ç»„ä¸­ç§»é™¤ç”¨æˆ·

```bash
# ä»ç»„ä¸­ç§»é™¤ç”¨æˆ·ï¼ˆéœ€è¦ç¼–è¾‘ /etc/group æˆ–ä½¿ç”¨ gpasswdï¼‰
sudo gpasswd -d username groupname
```

---

## é»˜è®¤ç”¨æˆ·è®¾ç½®

### æŸ¥çœ‹é»˜è®¤ç”¨æˆ·

```bash
# åœ¨ WSL ä¸­æŸ¥çœ‹é»˜è®¤ç”¨æˆ·é…ç½®
cat /etc/wsl.conf | grep default
```

### è®¾ç½®é»˜è®¤ç”¨æˆ·ï¼ˆæ–¹æ³•ä¸€ï¼šwsl.confï¼‰

```bash
# ç¼–è¾‘ wsl.conf
sudo nano /etc/wsl.conf

# æ·»åŠ æˆ–ä¿®æ”¹
[user]
default = username
```

ç„¶åé‡å¯ WSLï¼š
```powershell
wsl --shutdown
wsl
```

### è®¾ç½®é»˜è®¤ç”¨æˆ·ï¼ˆæ–¹æ³•äºŒï¼šå‘è¡Œç‰ˆé…ç½®å·¥å…·ï¼‰

```powershell
# Ubuntu
ubuntu config --default-user username

# Ubuntu 22.04
ubuntu2204 config --default-user username

# Debian
debian config --default-user username
```

### è®¾ç½®é»˜è®¤ç”¨æˆ·ï¼ˆæ–¹æ³•ä¸‰ï¼šæ³¨å†Œè¡¨ï¼‰

```powershell
# æŸ¥çœ‹æ³¨å†Œè¡¨é¡¹
reg query "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Lxss" /s

# ä¿®æ”¹ DefaultUidï¼ˆéœ€è¦æ‰¾åˆ°å¯¹åº”å‘è¡Œç‰ˆçš„ GUIDï¼‰
```

---

## ç‰¹æ®Šæƒé™

### SetUIDï¼ˆSUIDï¼‰

```bash
# è®¾ç½® SUIDï¼ˆä»¥æ–‡ä»¶æ‰€æœ‰è€…èº«ä»½æ‰§è¡Œï¼‰
sudo chmod u+s file
sudo chmod 4755 file

# æŸ¥çœ‹ SUID æ–‡ä»¶
find /usr -perm -4000
```

### SetGIDï¼ˆSGIDï¼‰

```bash
# è®¾ç½® SGIDï¼ˆä»¥æ–‡ä»¶ç»„èº«ä»½æ‰§è¡Œï¼‰
sudo chmod g+s file
sudo chmod 2755 file

# ç›®å½• SGIDï¼ˆæ–°æ–‡ä»¶ç»§æ‰¿ç»„ï¼‰
sudo chmod g+s directory
```

### Sticky Bit

```bash
# è®¾ç½® Sticky Bitï¼ˆåªæœ‰æ‰€æœ‰è€…å¯ä»¥åˆ é™¤ï¼‰
sudo chmod +t directory
sudo chmod 1755 directory

# æŸ¥çœ‹ Sticky Bit ç›®å½•
find /tmp -perm -1000
```

---

## å®‰å…¨æœ€ä½³å®è·µ

### 1. æœ€å°æƒé™åŸåˆ™

- åªæˆäºˆå¿…è¦çš„æƒé™
- é¿å…ä½¿ç”¨ 777 æƒé™
- å®šæœŸå®¡æŸ¥æ–‡ä»¶æƒé™

### 2. ç”¨æˆ·ç®¡ç†

- ä¸ºä¸åŒç”¨é€”åˆ›å»ºä¸åŒç”¨æˆ·
- ç¦ç”¨ä¸éœ€è¦çš„ç”¨æˆ·è´¦æˆ·
- å®šæœŸå®¡æŸ¥ç”¨æˆ·åˆ—è¡¨

### 3. sudo é…ç½®

- é™åˆ¶ sudo æƒé™èŒƒå›´
- ä½¿ç”¨ NOPASSWD è¦è°¨æ…
- å®šæœŸå®¡æŸ¥ sudoers é…ç½®

### 4. æ–‡ä»¶æƒé™æ£€æŸ¥

```bash
# æŸ¥æ‰¾æƒé™è¿‡å®½çš„æ–‡ä»¶
find /home -perm -007  # å…¶ä»–ç”¨æˆ·æœ‰å†™æƒé™
find /home -perm -002  # å…¶ä»–ç”¨æˆ·æœ‰å†™æƒé™

# æŸ¥æ‰¾ SUID/SGID æ–‡ä»¶
find /usr -perm -4000  # SUID
find /usr -perm -2000  # SGID
```

---

## ğŸ“š å‚è€ƒèµ„æº

- [Linux ç”¨æˆ·å’Œç»„ç®¡ç†](https://www.linux.org/docs/man8/useradd.html)
- [sudo é…ç½®æ–‡æ¡£](https://www.sudo.ws/docs/)
- [æ–‡ä»¶æƒé™è¯¦è§£](https://www.linux.org/docs/man1/chmod.html)

---

[[!MOC-WSL|è¿”å› WSL çŸ¥è¯†ä½“ç³»]]

#WSL #ç”¨æˆ·ç®¡ç† #æƒé™ç®¡ç† #sudo
