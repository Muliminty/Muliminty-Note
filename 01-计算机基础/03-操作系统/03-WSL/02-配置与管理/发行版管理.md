# WSL å‘è¡Œç‰ˆç®¡ç†

> å®‰è£…ã€ç®¡ç†ã€åˆ‡æ¢å’Œåˆ é™¤å¤šä¸ª Linux å‘è¡Œç‰ˆ

---

## ğŸ“‹ ç›®å½•

- [æŸ¥çœ‹å‘è¡Œç‰ˆ](#æŸ¥çœ‹å‘è¡Œç‰ˆ)
- [å®‰è£…å‘è¡Œç‰ˆ](#å®‰è£…å‘è¡Œç‰ˆ)
- [åˆ‡æ¢å‘è¡Œç‰ˆ](#åˆ‡æ¢å‘è¡Œç‰ˆ)
- [å¯¼å‡ºä¸å¯¼å…¥](#å¯¼å‡ºä¸å¯¼å…¥)
- [åˆ é™¤å‘è¡Œç‰ˆ](#åˆ é™¤å‘è¡Œç‰ˆ)
- [æ›´æ–°å‘è¡Œç‰ˆ](#æ›´æ–°å‘è¡Œç‰ˆ)

---

## æŸ¥çœ‹å‘è¡Œç‰ˆ

### åˆ—å‡ºå·²å®‰è£…çš„å‘è¡Œç‰ˆ

```powershell
# æŸ¥çœ‹æ‰€æœ‰å·²å®‰è£…çš„å‘è¡Œç‰ˆ
wsl --list
# æˆ–ç®€å†™
wsl -l

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼ˆåŒ…æ‹¬ç‰ˆæœ¬å’ŒçŠ¶æ€ï¼‰
wsl --list --verbose
# æˆ–ç®€å†™
wsl -l -v
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
  NAME            STATE           VERSION
* Ubuntu-22.04    Running         2
  Debian          Stopped         2
  Ubuntu-20.04    Stopped         1
```

- `*` è¡¨ç¤ºé»˜è®¤å‘è¡Œç‰ˆ
- `STATE` æ˜¾ç¤ºè¿è¡ŒçŠ¶æ€ï¼ˆRunning/Stoppedï¼‰
- `VERSION` æ˜¾ç¤º WSL ç‰ˆæœ¬ï¼ˆ1 æˆ– 2ï¼‰

### æŸ¥çœ‹å¯ç”¨çš„å‘è¡Œç‰ˆ

```powershell
# æŸ¥çœ‹ Microsoft Store ä¸­å¯ç”¨çš„å‘è¡Œç‰ˆ
wsl --list --online
# æˆ–ç®€å†™
wsl -l -o
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
ä»¥ä¸‹æ˜¯å¯å®‰è£…çš„æœ‰æ•ˆåˆ†å‘çš„åˆ—è¡¨ã€‚
ä½¿ç”¨ 'wsl --install -d <Distro>' å®‰è£…ã€‚

NAME            FRIENDLY NAME
Ubuntu          Ubuntu
Debian          Debian GNU/Linux
kali-linux      Kali Linux Rolling
openSUSE-42     openSUSE Leap 42
SLES-12         SUSE Linux Enterprise Server v12
Ubuntu-16.04    Ubuntu 16.04 LTS
Ubuntu-18.04    Ubuntu 18.04 LTS
Ubuntu-20.04    Ubuntu 20.04 LTS
Ubuntu-22.04    Ubuntu 22.04 LTS
```

---

## å®‰è£…å‘è¡Œç‰ˆ

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ wsl å‘½ä»¤

```powershell
# å®‰è£…æŒ‡å®šå‘è¡Œç‰ˆ
wsl --install -d Ubuntu-22.04
wsl --install -d Debian
wsl --install -d kali-linux

# å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ Ubuntu
wsl --install -d Ubuntu
```

### æ–¹æ³•äºŒï¼šä» Microsoft Store å®‰è£…

1. æ‰“å¼€ Microsoft Store
2. æœç´¢ Linux å‘è¡Œç‰ˆåç§°ï¼ˆå¦‚ "Ubuntu"ã€"Debian"ï¼‰
3. ç‚¹å‡»"è·å–"æˆ–"å®‰è£…"
4. å®‰è£…å®Œæˆåï¼Œä»å¼€å§‹èœå•å¯åŠ¨

### æ–¹æ³•ä¸‰ï¼šå¯¼å…¥è‡ªå®šä¹‰å‘è¡Œç‰ˆ

```powershell
# ä» tar æ–‡ä»¶å¯¼å…¥
wsl --import <DistroName> <InstallLocation> <TarFile>

# ç¤ºä¾‹
wsl --import MyUbuntu C:\WSL\MyUbuntu ubuntu-22.04.tar
```

### å®‰è£…åˆ°è‡ªå®šä¹‰ä½ç½®

```powershell
# æŒ‡å®šå®‰è£…ä½ç½®
wsl --import Ubuntu-22.04 D:\WSL\Ubuntu-22.04 ubuntu-22.04.tar
```

**æ³¨æ„**ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œä» Microsoft Store å®‰è£…çš„å‘è¡Œç‰ˆä¼šå®‰è£…åˆ° `%LOCALAPPDATA%\Packages\` ç›®å½•ã€‚

---

## åˆ‡æ¢å‘è¡Œç‰ˆ

### è®¾ç½®é»˜è®¤å‘è¡Œç‰ˆ

```powershell
# è®¾ç½®é»˜è®¤å‘è¡Œç‰ˆ
wsl --set-default Ubuntu-22.04
wsl --set-default Debian
```

### å¯åŠ¨æŒ‡å®šå‘è¡Œç‰ˆ

```powershell
# å¯åŠ¨æŒ‡å®šå‘è¡Œç‰ˆ
wsl -d Ubuntu-22.04
wsl -d Debian

# æˆ–ä½¿ç”¨å®Œæ•´å‘½ä»¤
wsl --distribution Ubuntu-22.04
```

### åœ¨æŒ‡å®šå‘è¡Œç‰ˆä¸­æ‰§è¡Œå‘½ä»¤

```powershell
# ä¸è¿›å…¥äº¤äº’å¼ shellï¼Œç›´æ¥æ‰§è¡Œå‘½ä»¤
wsl -d Ubuntu-22.04 ls -la
wsl -d Debian -- uname -a

# æ‰§è¡Œå¤šä¸ªå‘½ä»¤
wsl -d Ubuntu-22.04 -- bash -c "cd /home && ls -la"
```

### åˆ‡æ¢ WSL ç‰ˆæœ¬

```powershell
# å°†å‘è¡Œç‰ˆè®¾ç½®ä¸º WSL 2
wsl --set-version Ubuntu-22.04 2

# å°†å‘è¡Œç‰ˆè®¾ç½®ä¸º WSL 1
wsl --set-version Ubuntu-20.04 1

# è®¾ç½®é»˜è®¤ WSL ç‰ˆæœ¬
wsl --set-default-version 2
```

**æ³¨æ„**ï¼šè½¬æ¢å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´ï¼Œå–å†³äºå‘è¡Œç‰ˆå¤§å°ã€‚

---

## å¯¼å‡ºä¸å¯¼å…¥

### å¯¼å‡ºå‘è¡Œç‰ˆ

```powershell
# å¯¼å‡ºå‘è¡Œç‰ˆä¸º tar æ–‡ä»¶
wsl --export Ubuntu-22.04 D:\Backup\ubuntu-22.04-backup.tar

# å¯¼å‡ºæ—¶æŒ‡å®šå‹ç¼©ï¼ˆå¦‚æœæ”¯æŒï¼‰
wsl --export Ubuntu-22.04 D:\Backup\ubuntu-22.04-backup.tar --compress
```

**ç”¨é€”**ï¼š
- å¤‡ä»½å‘è¡Œç‰ˆ
- è¿ç§»åˆ°å…¶ä»–è®¡ç®—æœº
- åˆ›å»ºè‡ªå®šä¹‰å‘è¡Œç‰ˆé•œåƒ

### å¯¼å…¥å‘è¡Œç‰ˆ

```powershell
# ä» tar æ–‡ä»¶å¯¼å…¥
wsl --import Ubuntu-22.04-Restored D:\WSL\Ubuntu-22.04-Restored D:\Backup\ubuntu-22.04-backup.tar

# æŒ‡å®š WSL ç‰ˆæœ¬
wsl --import Ubuntu-22.04-Restored D:\WSL\Ubuntu-22.04-Restored D:\Backup\ubuntu-22.04-backup.tar --version 2
```

### è¿ç§»å‘è¡Œç‰ˆä½ç½®

```powershell
# 1. å¯¼å‡ºå‘è¡Œç‰ˆ
wsl --export Ubuntu-22.04 D:\Temp\ubuntu-22.04.tar

# 2. æ³¨é”€åŸå‘è¡Œç‰ˆ
wsl --unregister Ubuntu-22.04

# 3. å¯¼å…¥åˆ°æ–°ä½ç½®
wsl --import Ubuntu-22.04 D:\WSL\Ubuntu-22.04 D:\Temp\ubuntu-22.04.tar

# 4. è®¾ç½®é»˜è®¤ç”¨æˆ·ï¼ˆå¦‚æœéœ€è¦ï¼‰
ubuntu-22.04 config --default-user username
```

---

## åˆ é™¤å‘è¡Œç‰ˆ

### æ³¨é”€å‘è¡Œç‰ˆ

```powershell
# æ³¨é”€å‘è¡Œç‰ˆï¼ˆåˆ é™¤ä½†ä¿ç•™æ•°æ®æ–‡ä»¶ï¼‰
wsl --unregister Ubuntu-22.04

# æ³¨é”€æ‰€æœ‰å‘è¡Œç‰ˆï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
wsl --unregister *
```

**æ³¨æ„**ï¼š
- æ­¤æ“ä½œä¼šåˆ é™¤å‘è¡Œç‰ˆï¼Œä½†ä¸ä¼šåˆ é™¤è™šæ‹Ÿç¡¬ç›˜æ–‡ä»¶ï¼ˆ.vhdxï¼‰
- è™šæ‹Ÿç¡¬ç›˜æ–‡ä»¶é€šå¸¸ä½äº `%LOCALAPPDATA%\Packages\` æˆ–è‡ªå®šä¹‰ä½ç½®

### å®Œå…¨åˆ é™¤å‘è¡Œç‰ˆ

```powershell
# 1. æ³¨é”€å‘è¡Œç‰ˆ
wsl --unregister Ubuntu-22.04

# 2. æ‰‹åŠ¨åˆ é™¤è™šæ‹Ÿç¡¬ç›˜æ–‡ä»¶
# ä½ç½®é€šå¸¸åœ¨ï¼š
# %LOCALAPPDATA%\Packages\CanonicalGroupLimited.Ubuntu22.04LTS_*\LocalState\
# æˆ–è‡ªå®šä¹‰å®‰è£…ä½ç½®
```

### ä» Microsoft Store å¸è½½

1. æ‰“å¼€ Microsoft Store
2. ç‚¹å‡»å³ä¸Šè§’"..." â†’ "æˆ‘çš„åº“"
3. æ‰¾åˆ°è¦å¸è½½çš„å‘è¡Œç‰ˆ
4. ç‚¹å‡»"å¸è½½"

---

## æ›´æ–°å‘è¡Œç‰ˆ

### æ›´æ–° WSL

```powershell
# æ›´æ–° WSL
wsl --update

# æ£€æŸ¥æ›´æ–°çŠ¶æ€
wsl --status
```

### æ›´æ–° Linux å‘è¡Œç‰ˆ

```bash
# åœ¨ WSL ä¸­æ›´æ–° Ubuntu/Debian
sudo apt update
sudo apt upgrade

# æ›´æ–°æ‰€æœ‰åŒ…ï¼ˆåŒ…æ‹¬ç³»ç»ŸåŒ…ï¼‰
sudo apt full-upgrade

# æ¸…ç†ä¸éœ€è¦çš„åŒ…
sudo apt autoremove
sudo apt autoclean
```

### æ›´æ–°å‘è¡Œç‰ˆåˆ°æ–°ç‰ˆæœ¬

```powershell
# å¯¹äºä» Microsoft Store å®‰è£…çš„å‘è¡Œç‰ˆ
# é€šå¸¸ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œæˆ–é€šè¿‡ Store æ‰‹åŠ¨æ›´æ–°

# å¯¹äºè‡ªå®šä¹‰å¯¼å…¥çš„å‘è¡Œç‰ˆ
# éœ€è¦æ‰‹åŠ¨å¯¼å‡ºã€ä¸‹è½½æ–°ç‰ˆæœ¬ã€é‡æ–°å¯¼å…¥
```

---

## å‘è¡Œç‰ˆçŠ¶æ€ç®¡ç†

### å¯åŠ¨å‘è¡Œç‰ˆ

```powershell
# å¯åŠ¨é»˜è®¤å‘è¡Œç‰ˆ
wsl

# å¯åŠ¨æŒ‡å®šå‘è¡Œç‰ˆ
wsl -d Ubuntu-22.04
```

### åœæ­¢å‘è¡Œç‰ˆ

```powershell
# åœæ­¢æŒ‡å®šå‘è¡Œç‰ˆ
wsl --terminate Ubuntu-22.04

# åœæ­¢æ‰€æœ‰å‘è¡Œç‰ˆ
wsl --shutdown
```

### æŸ¥çœ‹è¿è¡ŒçŠ¶æ€

```powershell
# æŸ¥çœ‹æ‰€æœ‰å‘è¡Œç‰ˆçŠ¶æ€
wsl --list --verbose
```

---

## æœ€ä½³å®è·µ

### 1. ä½¿ç”¨å¤šä¸ªå‘è¡Œç‰ˆ

- **å¼€å‘ç¯å¢ƒ**ï¼šä½¿ç”¨ Ubuntu LTSï¼ˆç¨³å®šï¼‰
- **æµ‹è¯•ç¯å¢ƒ**ï¼šä½¿ç”¨ Debian æˆ–è¾ƒæ–°ç‰ˆæœ¬çš„ Ubuntu
- **å®‰å…¨æµ‹è¯•**ï¼šä½¿ç”¨ Kali Linux

### 2. å¤‡ä»½ç­–ç•¥

```powershell
# å®šæœŸå¯¼å‡ºé‡è¦å‘è¡Œç‰ˆ
wsl --export Ubuntu-22.04 D:\Backup\ubuntu-22.04-$(Get-Date -Format "yyyyMMdd").tar
```

### 3. ç£ç›˜ç©ºé—´ç®¡ç†

```powershell
# æŸ¥çœ‹å‘è¡Œç‰ˆå¤§å°
# è™šæ‹Ÿç¡¬ç›˜æ–‡ä»¶ä½ç½®ï¼š
# %LOCALAPPDATA%\Packages\*\LocalState\ext4.vhdx

# å‹ç¼©è™šæ‹Ÿç¡¬ç›˜ï¼ˆåœ¨ PowerShell ä¸­ï¼‰
wsl --shutdown
Optimize-VHD -Path "C:\Users\YourUsername\AppData\Local\Packages\*\LocalState\ext4.vhdx" -Mode Full
```

### 4. æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨ WSL 2 ä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½
- å°†å‘è¡Œç‰ˆå®‰è£…åœ¨ SSD ä¸Š
- å®šæœŸæ¸…ç†ä¸éœ€è¦çš„åŒ…å’Œæ–‡ä»¶

---

## ğŸ“š å‚è€ƒèµ„æº

- [WSL å‘è¡Œç‰ˆç®¡ç†æ–‡æ¡£](https://learn.microsoft.com/zh-cn/windows/wsl/install-manual)
- [WSL å‘½ä»¤å‚è€ƒ](https://learn.microsoft.com/zh-cn/windows/wsl/basic-commands)

---

[[!MOC-WSL|è¿”å› WSL çŸ¥è¯†ä½“ç³»]]

#WSL #å‘è¡Œç‰ˆç®¡ç† #Linuxå‘è¡Œç‰ˆ
