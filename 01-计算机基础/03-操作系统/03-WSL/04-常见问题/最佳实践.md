# WSL æœ€ä½³å®è·µ

> WSL æ€§èƒ½ä¼˜åŒ–ã€å®‰å…¨å»ºè®®å’Œå·¥ä½œæµå»ºè®®

---

## ğŸ“‹ ç›®å½•

- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
- [å®‰å…¨å»ºè®®](#å®‰å…¨å»ºè®®)
- [å·¥ä½œæµå»ºè®®](#å·¥ä½œæµå»ºè®®)
- [å¼€å‘ç¯å¢ƒé…ç½®](#å¼€å‘ç¯å¢ƒé…ç½®)
- [å¤‡ä»½ä¸æ¢å¤](#å¤‡ä»½ä¸æ¢å¤)

---

## æ€§èƒ½ä¼˜åŒ–

### 1. ä½¿ç”¨ WSL 2

**æ¨è**ï¼šå§‹ç»ˆä½¿ç”¨ WSL 2 è€Œä¸æ˜¯ WSL 1

```powershell
# æ£€æŸ¥å½“å‰ç‰ˆæœ¬
wsl --list --verbose

# è½¬æ¢ä¸º WSL 2
wsl --set-version Ubuntu-22.04 2

# è®¾ç½®é»˜è®¤ç‰ˆæœ¬
wsl --set-default-version 2
```

**ä¼˜åŠ¿**ï¼š
- å®Œæ•´çš„ Linux å†…æ ¸
- æ›´å¥½çš„æ–‡ä»¶ç³»ç»Ÿæ€§èƒ½
- æ›´å¥½çš„ Docker æ”¯æŒ
- æ›´å¥½çš„ç³»ç»Ÿè°ƒç”¨å…¼å®¹æ€§

### 2. åˆç†é…ç½®èµ„æº

#### .wslconfig é…ç½®

```ini
[wsl2]
# æ ¹æ®ç³»ç»Ÿå†…å­˜è°ƒæ•´ï¼ˆå»ºè®® 4-8GBï¼‰
memory=8GB

# æ ¹æ® CPU æ ¸å¿ƒæ•°è°ƒæ•´ï¼ˆå»ºè®® 2-4 æ ¸ï¼‰
processors=4

# äº¤æ¢ç©ºé—´ï¼ˆå»ºè®®ä¸ºå†…å­˜çš„ 25-50%ï¼‰
swap=2GB

# äº¤æ¢æ–‡ä»¶ä½ç½®
swapFile=C:\\Users\\YourUsername\\AppData\\Local\\Temp\\swap.vhdx

# å¯ç”¨æœ¬åœ°ä¸»æœºè½¬å‘
localhostForwarding=true
```

**å»ºè®®**ï¼š
- å†…å­˜ï¼šç³»ç»Ÿæ€»å†…å­˜çš„ 50%ï¼Œä½†ä¸è¶…è¿‡ 8GB
- CPUï¼šç³»ç»Ÿæ ¸å¿ƒæ•°çš„ 50-75%
- äº¤æ¢ç©ºé—´ï¼šå†…å­˜çš„ 25-50%

### 3. æ–‡ä»¶ç³»ç»Ÿä½ç½®

#### æ¨èï¼šLinux æ–‡ä»¶ç³»ç»Ÿ

```bash
# æ¨èï¼šé¡¹ç›®æ–‡ä»¶åœ¨ Linux æ–‡ä»¶ç³»ç»Ÿä¸­
~/projects/myapp
/home/username/projects/myapp
```

**ä¼˜åŠ¿**ï¼š
- æ›´å¥½çš„æ–‡ä»¶ç³»ç»Ÿæ€§èƒ½ï¼ˆext4ï¼‰
- å®Œæ•´çš„ Linux æ–‡ä»¶æƒé™æ”¯æŒ
- æ›´å¥½çš„ç¬¦å·é“¾æ¥æ”¯æŒ
- æ›´å¿«çš„æ–‡ä»¶æ“ä½œ

#### ä¸æ¨èï¼šWindows æ–‡ä»¶ç³»ç»Ÿ

```bash
# ä¸æ¨èï¼šé¡¹ç›®æ–‡ä»¶åœ¨ Windows æ–‡ä»¶ç³»ç»Ÿä¸­
/mnt/c/Users/Username/projects/myapp
```

**åŠ£åŠ¿**ï¼š
- è¾ƒæ…¢çš„æ–‡ä»¶ç³»ç»Ÿæ€§èƒ½ï¼ˆé€šè¿‡ 9p åè®®ï¼‰
- æ–‡ä»¶æƒé™æ”¯æŒæœ‰é™
- ç¬¦å·é“¾æ¥æ”¯æŒæœ‰é™

#### æ··åˆä½¿ç”¨ç­–ç•¥

```bash
# ä½¿ç”¨ç¬¦å·é“¾æ¥è¿æ¥ Windows å’Œ Linux æ–‡ä»¶ç³»ç»Ÿ
ln -s /mnt/c/Users/Username/Documents ~/Documents
ln -s /mnt/c/Users/Username/Downloads ~/Downloads

# é¡¹ç›®æ–‡ä»¶æ”¾åœ¨ Linux æ–‡ä»¶ç³»ç»Ÿ
~/projects/myapp
```

### 4. ä¼˜åŒ–æŒ‚è½½é€‰é¡¹

#### /etc/wsl.conf é…ç½®

```ini
[automount]
enabled = true
root = /mnt/
options = "metadata,umask=22,fmask=11"
crossDistro = false
```

**é€‰é¡¹è¯´æ˜**ï¼š
- `metadata`ï¼šå¯ç”¨æ–‡ä»¶å…ƒæ•°æ®æ”¯æŒ
- `umask=22`ï¼šç›®å½•æƒé™ 755
- `fmask=11`ï¼šæ–‡ä»¶æƒé™ 644

### 5. å®šæœŸæ¸…ç†

```bash
# æ¸…ç† apt ç¼“å­˜
sudo apt clean
sudo apt autoremove

# æ¸…ç† Dockerï¼ˆå¦‚æœä½¿ç”¨ï¼‰
docker system prune -a

# æ¸…ç†æ—¥å¿—
sudo journalctl --vacuum-time=7d

# æŸ¥æ‰¾å¤§æ–‡ä»¶
du -h --max-depth=1 ~ | sort -h
```

### 6. ä½¿ç”¨ SSD

**å»ºè®®**ï¼šå°† WSL å®‰è£…åœ¨ SSD ä¸Šä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½

```powershell
# è¿ç§» WSL åˆ°å…¶ä»–é©±åŠ¨å™¨
wsl --export Ubuntu-22.04 D:\WSL\backup.tar
wsl --unregister Ubuntu-22.04
wsl --import Ubuntu-22.04 D:\WSL\Ubuntu-22.04 D:\WSL\backup.tar
```

---

## å®‰å…¨å»ºè®®

### 1. ç”¨æˆ·æƒé™

#### ä½¿ç”¨é root ç”¨æˆ·

```bash
# åˆ›å»ºä¸“ç”¨ç”¨æˆ·
sudo adduser devuser
sudo usermod -aG sudo devuser

# è®¾ç½®é»˜è®¤ç”¨æˆ·
sudo nano /etc/wsl.conf
# æ·»åŠ ï¼š
[user]
default = devuser
```

#### é…ç½® sudo

```bash
# ç¼–è¾‘ sudoers
sudo visudo

# é™åˆ¶ sudo æƒé™ï¼ˆè€Œä¸æ˜¯ NOPASSWD: ALLï¼‰
devuser ALL=(ALL) /usr/bin/apt, /usr/bin/apt-get
```

### 2. é˜²ç«å¢™é…ç½®

#### Windows é˜²ç«å¢™

```powershell
# åªå…è®¸å¿…è¦çš„ç«¯å£
New-NetFirewallRule -DisplayName "WSL Port 3000" `
    -Direction Inbound `
    -LocalPort 3000 `
    -Protocol TCP `
    -Action Allow
```

#### Linux é˜²ç«å¢™ï¼ˆå¦‚æœéœ€è¦ï¼‰

```bash
# å®‰è£… ufw
sudo apt install ufw

# é…ç½®è§„åˆ™
sudo ufw allow 22/tcp
sudo ufw enable
```

### 3. SSH é…ç½®

#### ç¦ç”¨å¯†ç è®¤è¯

```bash
# ç¼–è¾‘ SSH é…ç½®
sudo nano /etc/ssh/sshd_config

# è®¾ç½®ï¼š
PasswordAuthentication no
PubkeyAuthentication yes
```

#### ä½¿ç”¨å¯†é’¥è®¤è¯

```bash
# ç”Ÿæˆ SSH å¯†é’¥
ssh-keygen -t ed25519 -C "your.email@example.com"

# æ·»åŠ å…¬é’¥åˆ°æœåŠ¡å™¨
ssh-copy-id user@server
```

### 4. å®šæœŸæ›´æ–°

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update
sudo apt upgrade

# æ›´æ–° WSL
wsl --update
```

### 5. æ•æ„Ÿä¿¡æ¯ç®¡ç†

```bash
# ä½¿ç”¨ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼ˆä¸è¦æäº¤åˆ° Gitï¼‰
echo '.env' >> .gitignore

# ä½¿ç”¨å¯†é’¥ç®¡ç†å·¥å…·
# ä¾‹å¦‚ï¼špassã€gopassã€1Password CLI
```

---

## å·¥ä½œæµå»ºè®®

### 1. é¡¹ç›®ç»„ç»‡

#### æ¨èé¡¹ç›®ç»“æ„

```
~/projects/
â”œâ”€â”€ frontend/
â”‚   â””â”€â”€ myapp/
â”œâ”€â”€ backend/
â”‚   â””â”€â”€ api/
â””â”€â”€ scripts/
    â””â”€â”€ utils/
```

#### ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶

```bash
# åˆå§‹åŒ– Git ä»“åº“
cd ~/projects/myapp
git init
git remote add origin https://github.com/username/repo.git
```

### 2. å¼€å‘å·¥å…·é…ç½®

#### VS Code é›†æˆ

```bash
# åœ¨ WSL ä¸­æ‰“å¼€é¡¹ç›®
code ~/projects/myapp

# VS Code ä¼šè‡ªåŠ¨ä½¿ç”¨ WSL ä¸­çš„ï¼š
# - Node.jsã€Pythonã€Go ç­‰è¿è¡Œæ—¶
# - Git
# - ç»ˆç«¯
# - æ‰©å±•
```

#### ç»ˆç«¯é…ç½®

```bash
# ä½¿ç”¨ zsh å’Œ Oh My Zsh
sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"

# é…ç½® .zshrc
nano ~/.zshrc
```

### 3. ç¯å¢ƒç®¡ç†

#### ä½¿ç”¨ç‰ˆæœ¬ç®¡ç†å·¥å…·

```bash
# Node.js: nvm
nvm install 18
nvm use 18

# Python: pyenv
pyenv install 3.11.0
pyenv global 3.11.0

# Go: g
g install 1.21.0
g use 1.21.0
```

#### ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ

```bash
# Python è™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate

# Node.js: ä½¿ç”¨é¡¹ç›®æœ¬åœ° node_modules
npm install
```

### 4. æ„å»ºå’Œéƒ¨ç½²

#### ä½¿ç”¨ Docker

```bash
# å¼€å‘ç¯å¢ƒ
docker compose -f docker-compose.dev.yml up

# ç”Ÿäº§ç¯å¢ƒ
docker compose up -d
```

#### ä½¿ç”¨ CI/CD

```yaml
# .github/workflows/ci.yml
name: CI
on: [push]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - run: npm test
```

### 5. æ–‡æ¡£å’Œç¬”è®°

```bash
# åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ Markdown
# README.md
# docs/
#   - setup.md
#   - api.md
```

---

## å¼€å‘ç¯å¢ƒé…ç½®

### 1. åŸºç¡€å·¥å…·

```bash
# å®‰è£…åŸºç¡€å·¥å…·
sudo apt install -y \
    build-essential \
    curl \
    wget \
    git \
    vim \
    nano \
    tree \
    htop \
    jq \
    unzip \
    zip
```

### 2. Shell é…ç½®

#### .bashrc æˆ– .zshrc

```bash
# å¸¸ç”¨åˆ«å
alias ll='ls -alF'
alias la='ls -A'
alias l='ls -CF'
alias ..='cd ..'
alias ...='cd ../..'

# ç¯å¢ƒå˜é‡
export EDITOR='code --wait'
export PATH="$HOME/.local/bin:$PATH"
```

### 3. Git é…ç½®

```bash
# å…¨å±€é…ç½®
git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"
git config --global core.editor "code --wait"
git config --global init.defaultBranch main

# SSH å¯†é’¥
ssh-keygen -t ed25519 -C "your.email@example.com"
```

### 4. å¼€å‘å·¥å…·

#### Node.js å¼€å‘

```bash
# ä½¿ç”¨ nvm
nvm install --lts
nvm use --lts

# å…¨å±€å·¥å…·
npm install -g yarn pnpm typescript
```

#### Python å¼€å‘

```bash
# ä½¿ç”¨ pyenv
pyenv install 3.11.0
pyenv global 3.11.0

# è™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate
```

### 5. æ•°æ®åº“

```bash
# ä½¿ç”¨ Docker è¿è¡Œæ•°æ®åº“
docker run -d \
  --name postgres \
  -e POSTGRES_PASSWORD=password \
  -p 5432:5432 \
  postgres:15

# æˆ–ä½¿ç”¨æœ¬åœ°å®‰è£…
sudo apt install postgresql
```

---

## å¤‡ä»½ä¸æ¢å¤

### 1. å®šæœŸå¤‡ä»½

#### å¯¼å‡ºå‘è¡Œç‰ˆ

```powershell
# å®šæœŸå¯¼å‡ºï¼ˆä¾‹å¦‚ï¼šæ¯å‘¨ï¼‰
wsl --export Ubuntu-22.04 D:\Backup\ubuntu-22.04-$(Get-Date -Format "yyyyMMdd").tar
```

#### å¤‡ä»½é¡¹ç›®æ–‡ä»¶

```bash
# ä½¿ç”¨ tar å‹ç¼©
tar -czf ~/backup/projects-$(date +%Y%m%d).tar.gz ~/projects

# å¤åˆ¶åˆ° Windows
cp ~/backup/projects-*.tar.gz /mnt/c/Users/Username/Backup/
```

### 2. é…ç½®æ–‡ä»¶å¤‡ä»½

```bash
# å¤‡ä»½é…ç½®æ–‡ä»¶
cp ~/.bashrc ~/.bashrc.backup
cp ~/.zshrc ~/.zshrc.backup
cp ~/.gitconfig ~/.gitconfig.backup

# ä½¿ç”¨ Git ç®¡ç†é…ç½®æ–‡ä»¶
git init ~/.dotfiles
cd ~/.dotfiles
git add .
git commit -m "Backup config files"
```

### 3. æ¢å¤ç­–ç•¥

#### æ¢å¤å‘è¡Œç‰ˆ

```powershell
# ä»å¤‡ä»½æ¢å¤
wsl --import Ubuntu-22.04-Restored D:\WSL\Ubuntu-22.04-Restored D:\Backup\ubuntu-22.04-backup.tar
```

#### æ¢å¤é¡¹ç›®æ–‡ä»¶

```bash
# è§£å‹å¤‡ä»½
tar -xzf backup/projects-20240101.tar.gz -C ~/
```

### 4. è‡ªåŠ¨åŒ–å¤‡ä»½

#### ä½¿ç”¨è„šæœ¬

```powershell
# backup-wsl.ps1
$date = Get-Date -Format "yyyyMMdd"
$backupPath = "D:\Backup\WSL"

# å¯¼å‡ºå‘è¡Œç‰ˆ
wsl --export Ubuntu-22.04 "$backupPath\ubuntu-22.04-$date.tar"

# æ¸…ç†æ—§å¤‡ä»½ï¼ˆä¿ç•™æœ€è¿‘ 7 å¤©ï¼‰
Get-ChildItem "$backupPath\*.tar" | Where-Object {
    $_.LastWriteTime -lt (Get-Date).AddDays(-7)
} | Remove-Item
```

#### ä½¿ç”¨ä»»åŠ¡è®¡åˆ’ç¨‹åº

1. æ‰“å¼€ä»»åŠ¡è®¡åˆ’ç¨‹åº
2. åˆ›å»ºåŸºæœ¬ä»»åŠ¡
3. è®¾ç½®è§¦å‘å™¨ï¼ˆä¾‹å¦‚ï¼šæ¯å‘¨æ—¥ï¼‰
4. è®¾ç½®æ“ä½œï¼šè¿è¡Œ `backup-wsl.ps1`

---

## æ€§èƒ½ç›‘æ§

### 1. èµ„æºç›‘æ§

```bash
# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop
# æˆ–
top

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h
du -h --max-depth=1 ~ | sort -h

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h
```

### 2. æ€§èƒ½æµ‹è¯•

```bash
# æ–‡ä»¶ç³»ç»Ÿæ€§èƒ½æµ‹è¯•
time for i in {1..1000}; do touch test$i; done
time for i in {1..1000}; do rm test$i; done
```

### 3. æ—¥å¿—åˆ†æ

```bash
# æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—
journalctl -xe

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
journalctl -u service_name
```

---

## ğŸ“š å‚è€ƒèµ„æº

- [WSL å®˜æ–¹æ–‡æ¡£](https://learn.microsoft.com/zh-cn/windows/wsl/)
- [WSL æ€§èƒ½ä¼˜åŒ–](https://learn.microsoft.com/zh-cn/windows/wsl/compare-versions)
- [WSL æœ€ä½³å®è·µ](https://learn.microsoft.com/zh-cn/windows/wsl/filesystems)

---

[[!MOC-WSL|è¿”å› WSL çŸ¥è¯†ä½“ç³»]]

#WSL #æœ€ä½³å®è·µ #æ€§èƒ½ä¼˜åŒ– #å®‰å…¨
