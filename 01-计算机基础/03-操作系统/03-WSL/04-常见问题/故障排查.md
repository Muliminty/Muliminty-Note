# WSL æ•…éšœæ’æŸ¥

> WSL å¸¸è§é”™è¯¯ã€æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

---

## ğŸ“‹ ç›®å½•

- [å®‰è£…é—®é¢˜](#å®‰è£…é—®é¢˜)
- [å¯åŠ¨é—®é¢˜](#å¯åŠ¨é—®é¢˜)
- [ç½‘ç»œé—®é¢˜](#ç½‘ç»œé—®é¢˜)
- [æ€§èƒ½é—®é¢˜](#æ€§èƒ½é—®é¢˜)
- [æ–‡ä»¶ç³»ç»Ÿé—®é¢˜](#æ–‡ä»¶ç³»ç»Ÿé—®é¢˜)
- [æƒé™é—®é¢˜](#æƒé™é—®é¢˜)
- [Docker ç›¸å…³é—®é¢˜](#docker-ç›¸å…³é—®é¢˜)

---

## å®‰è£…é—®é¢˜

### é—®é¢˜ 1ï¼šWSL 2 å®‰è£…å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
WSL 2 requires an update to its kernel component
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **ä¸‹è½½å¹¶å®‰è£… Linux å†…æ ¸æ›´æ–°åŒ…**
   - è®¿é—® [WSL 2 Linux å†…æ ¸æ›´æ–°åŒ…](https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi)
   - ä¸‹è½½å¹¶å®‰è£…æ›´æ–°åŒ…

2. **ç¡®ä¿å¯ç”¨è™šæ‹ŸåŒ–åŠŸèƒ½**
   ```powershell
   # æ£€æŸ¥è™šæ‹ŸåŒ–æ˜¯å¦å¯ç”¨
   systeminfo | findstr /C:"Hyper-V"
   
   # å¦‚æœæœªå¯ç”¨ï¼Œéœ€è¦åœ¨ BIOS ä¸­å¯ç”¨è™šæ‹ŸåŒ–
   ```

3. **å¯ç”¨è™šæ‹Ÿæœºå¹³å°åŠŸèƒ½**
   ```powershell
   # ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ
   dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart
   Restart-Computer
   ```

### é—®é¢˜ 2ï¼šå‘è¡Œç‰ˆå®‰è£…å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Error: 0x80070003
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **æ£€æŸ¥ç£ç›˜ç©ºé—´**
   ```powershell
   # æ£€æŸ¥ C: ç›˜ç©ºé—´
   Get-PSDrive C
   ```

2. **æ¸…ç†ä¸´æ—¶æ–‡ä»¶**
   ```powershell
   # æ¸…ç† WSL ä¸´æ—¶æ–‡ä»¶
   wsl --shutdown
   # åˆ é™¤ä¸´æ—¶æ–‡ä»¶
   Remove-Item $env:TEMP\wsl* -Recurse -Force
   ```

3. **é‡æ–°å®‰è£…å‘è¡Œç‰ˆ**
   ```powershell
   # æ³¨é”€å‘è¡Œç‰ˆ
   wsl --unregister Ubuntu-22.04
   # é‡æ–°å®‰è£…
   wsl --install -d Ubuntu-22.04
   ```

### é—®é¢˜ 3ï¼šæ— æ³•ä» Microsoft Store å®‰è£…

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **ä½¿ç”¨å‘½ä»¤è¡Œå®‰è£…**
   ```powershell
   wsl --install -d Ubuntu-22.04
   ```

2. **æ‰‹åŠ¨ä¸‹è½½å¹¶å®‰è£…**
   - ä» [Microsoft Store ç½‘é¡µç‰ˆ](https://www.microsoft.com/store/apps) ä¸‹è½½
   - æˆ–ä½¿ç”¨ `winget`ï¼š
     ```powershell
     winget install Ubuntu.2204.LTS
     ```

---

## å¯åŠ¨é—®é¢˜

### é—®é¢˜ 1ï¼šå‘è¡Œç‰ˆæ— æ³•å¯åŠ¨

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Error code: WslRegisterDistribution failed with error: 0x8007019e
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **æ£€æŸ¥ WSL åŠŸèƒ½æ˜¯å¦å¯ç”¨**
   ```powershell
   # å¯ç”¨ WSL åŠŸèƒ½
   dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
   dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart
   Restart-Computer
   ```

2. **æ£€æŸ¥å‘è¡Œç‰ˆçŠ¶æ€**
   ```powershell
   wsl --list --verbose
   ```

3. **é‡ç½®å‘è¡Œç‰ˆ**
   ```powershell
   wsl --unregister Ubuntu-22.04
   wsl --install -d Ubuntu-22.04
   ```

### é—®é¢˜ 2ï¼šå¯åŠ¨æ—¶å¡ä½

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **å¼ºåˆ¶å…³é—­ WSL**
   ```powershell
   wsl --shutdown
   ```

2. **æ£€æŸ¥è¿›ç¨‹**
   ```powershell
   # æŸ¥çœ‹ WSL ç›¸å…³è¿›ç¨‹
   Get-Process | Where-Object {$_.ProcessName -like "*wsl*"}
   ```

3. **é‡å¯ WSL æœåŠ¡**
   ```powershell
   # é‡å¯ LxssManager æœåŠ¡
   Restart-Service LxssManager
   ```

### é—®é¢˜ 3ï¼šå¯åŠ¨åç«‹å³é€€å‡º

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **æ£€æŸ¥é»˜è®¤ç”¨æˆ·**
   ```bash
   # åœ¨ Windows ä¸­æ£€æŸ¥
   ubuntu config --default-user
   ```

2. **é‡ç½®é»˜è®¤ç”¨æˆ·**
   ```powershell
   ubuntu config --default-user root
   wsl -d Ubuntu-22.04
   # åœ¨ WSL ä¸­ä¿®å¤ç”¨æˆ·
   ```

3. **æ£€æŸ¥ç”¨æˆ·ä¸»ç›®å½•**
   ```bash
   # åœ¨ WSL ä¸­ï¼ˆä»¥ root èº«ä»½ï¼‰
   ls -la /home
   # å¦‚æœç”¨æˆ·ç›®å½•æŸåï¼Œé‡æ–°åˆ›å»º
   ```

---

## ç½‘ç»œé—®é¢˜

### é—®é¢˜ 1ï¼šæ— æ³•è®¿é—®äº’è”ç½‘

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **æ£€æŸ¥ç½‘ç»œè¿æ¥**
   ```bash
   # æµ‹è¯•ç½‘ç»œ
   ping 8.8.8.8
   ping google.com
   ```

2. **æ£€æŸ¥ DNS é…ç½®**
   ```bash
   cat /etc/resolv.conf
   # å¦‚æœè¢«è¦†ç›–ï¼Œç¦ç”¨è‡ªåŠ¨ç”Ÿæˆ
   sudo nano /etc/wsl.conf
   # æ·»åŠ ï¼š
   [network]
   generateResolvConf = false
   ```

3. **æ‰‹åŠ¨é…ç½® DNS**
   ```bash
   sudo nano /etc/resolv.conf
   # æ·»åŠ ï¼š
   nameserver 8.8.8.8
   nameserver 8.8.4.4
   ```

4. **é‡å¯ WSL**
   ```powershell
   wsl --shutdown
   wsl
   ```

### é—®é¢˜ 2ï¼šç«¯å£æ— æ³•è®¿é—®

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **æ£€æŸ¥ç«¯å£è½¬å‘**
   ```powershell
   netsh interface portproxy show all
   ```

2. **é…ç½®ç«¯å£è½¬å‘**
   ```powershell
   $wslIp = (wsl hostname -I).Trim()
   netsh interface portproxy add v4tov4 listenport=3000 listenaddress=0.0.0.0 connectport=3000 connectaddress=$wslIp
   ```

3. **æ£€æŸ¥é˜²ç«å¢™**
   ```powershell
   # å…è®¸ç«¯å£
   New-NetFirewallRule -DisplayName "WSL Port 3000" -Direction Inbound -LocalPort 3000 -Protocol TCP -Action Allow
   ```

### é—®é¢˜ 3ï¼šDNS è§£æå¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **æ£€æŸ¥ /etc/resolv.conf**
   ```bash
   cat /etc/resolv.conf
   ```

2. **ç¦ç”¨è‡ªåŠ¨ç”Ÿæˆ**
   ```bash
   sudo nano /etc/wsl.conf
   # æ·»åŠ ï¼š
   [network]
   generateResolvConf = false
   ```

3. **æ‰‹åŠ¨é…ç½® DNS**
   ```bash
   sudo nano /etc/resolv.conf
   nameserver 8.8.8.8
   nameserver 8.8.4.4
   ```

---

## æ€§èƒ½é—®é¢˜

### é—®é¢˜ 1ï¼šWSL è¿è¡Œç¼“æ…¢

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **ç¡®ä¿ä½¿ç”¨ WSL 2**
   ```powershell
   wsl --list --verbose
   # å¦‚æœæ˜¾ç¤ºç‰ˆæœ¬ 1ï¼Œè½¬æ¢ä¸º WSL 2
   wsl --set-version Ubuntu-22.04 2
   ```

2. **å¢åŠ èµ„æºåˆ†é…**
   ```ini
   # åœ¨ .wslconfig ä¸­
   [wsl2]
   memory=8GB
   processors=4
   ```

3. **ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿä½ç½®**
   ```bash
   # å°†é¡¹ç›®æ”¾åœ¨ Linux æ–‡ä»¶ç³»ç»Ÿä¸­
   # æ¨èï¼š~/projects
   # ä¸æ¨èï¼š/mnt/c/Users/...
   ```

### é—®é¢˜ 2ï¼šæ–‡ä»¶æ“ä½œç¼“æ…¢

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **ä½¿ç”¨ Linux æ–‡ä»¶ç³»ç»Ÿ**
   - é¿å…åœ¨ `/mnt/c/` ä¸‹è¿›è¡Œå¤§é‡æ–‡ä»¶æ“ä½œ
   - å°†é¡¹ç›®æ–‡ä»¶æ”¾åœ¨ `~/` ç›®å½•ä¸‹

2. **ä¼˜åŒ–æŒ‚è½½é€‰é¡¹**
   ```ini
   # åœ¨ /etc/wsl.conf ä¸­
   [automount]
   options = "metadata,umask=22,fmask=11"
   ```

3. **ä½¿ç”¨ç¬¦å·é“¾æ¥**
   ```bash
   # åˆ›å»ºç¬¦å·é“¾æ¥
   ln -s /mnt/c/Users/Username/Documents ~/Documents
   ```

### é—®é¢˜ 3ï¼šå†…å­˜ä¸è¶³

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **å¢åŠ å†…å­˜åˆ†é…**
   ```ini
   # åœ¨ .wslconfig ä¸­
   [wsl2]
   memory=8GB
   swap=4GB
   ```

2. **æ£€æŸ¥å†…å­˜ä½¿ç”¨**
   ```bash
   free -h
   top
   ```

3. **æ¸…ç†å†…å­˜**
   ```bash
   # æ¸…ç†ç¼“å­˜
   sudo apt clean
   sudo apt autoremove
   ```

---

## æ–‡ä»¶ç³»ç»Ÿé—®é¢˜

### é—®é¢˜ 1ï¼šæ–‡ä»¶æƒé™æ˜¾ç¤ºä¸º 777

**åŸå› **ï¼šWindows æ–‡ä»¶ç³»ç»Ÿä¸æ”¯æŒ Linux æ–‡ä»¶æƒé™

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **é…ç½®æŒ‚è½½é€‰é¡¹**
   ```ini
   # åœ¨ /etc/wsl.conf ä¸­
   [automount]
   options = "metadata,umask=22,fmask=11"
   ```

2. **å°†æ–‡ä»¶å¤åˆ¶åˆ° Linux æ–‡ä»¶ç³»ç»Ÿ**
   ```bash
   cp /mnt/c/file.txt ~/file.txt
   chmod 644 ~/file.txt
   ```

### é—®é¢˜ 2ï¼šæ— æ³•åˆ é™¤æ–‡ä»¶

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **æ£€æŸ¥æ–‡ä»¶æƒé™**
   ```bash
   ls -l file.txt
   ```

2. **ä¿®æ”¹æƒé™**
   ```bash
   chmod 755 file.txt
   # æˆ–
   sudo chmod 755 file.txt
   ```

3. **å¼ºåˆ¶åˆ é™¤**
   ```bash
   sudo rm -f file.txt
   ```

### é—®é¢˜ 3ï¼šç¬¦å·é“¾æ¥ä¸å·¥ä½œ

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **æ£€æŸ¥ç¬¦å·é“¾æ¥**
   ```bash
   ls -l link_name
   ```

2. **åˆ›å»ºç»å¯¹è·¯å¾„ç¬¦å·é“¾æ¥**
   ```bash
   ln -s /absolute/path/to/target link_name
   ```

3. **åœ¨ Windows ä¸­åˆ›å»ºç¬¦å·é“¾æ¥**
   ```powershell
   # éœ€è¦ç®¡ç†å‘˜æƒé™
   New-Item -ItemType SymbolicLink -Path "link" -Target "target"
   ```

---

## æƒé™é—®é¢˜

### é—®é¢˜ 1ï¼šPermission denied

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **æ£€æŸ¥æ–‡ä»¶æƒé™**
   ```bash
   ls -l file.txt
   ```

2. **ä¿®æ”¹æƒé™**
   ```bash
   chmod +x script.sh
   # æˆ–
   sudo chmod +x script.sh
   ```

3. **ä½¿ç”¨ sudo**
   ```bash
   sudo command
   ```

### é—®é¢˜ 2ï¼šæ— æ³•å†™å…¥æ–‡ä»¶

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **æ£€æŸ¥ç›®å½•æƒé™**
   ```bash
   ls -ld directory
   ```

2. **ä¿®æ”¹ç›®å½•æƒé™**
   ```bash
   chmod 755 directory
   # æˆ–
   sudo chmod 755 directory
   ```

3. **ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…**
   ```bash
   sudo chown username:username file.txt
   ```

### é—®é¢˜ 3ï¼šsudo éœ€è¦å¯†ç 

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **é…ç½®æ— å¯†ç  sudo**
   ```bash
   sudo visudo
   # æ·»åŠ ï¼š
   username ALL=(ALL) NOPASSWD: ALL
   ```

2. **å°†ç”¨æˆ·æ·»åŠ åˆ° sudo ç»„**
   ```bash
   sudo usermod -aG sudo username
   ```

---

## Docker ç›¸å…³é—®é¢˜

### é—®é¢˜ 1ï¼šDocker å‘½ä»¤æœªæ‰¾åˆ°

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **æ£€æŸ¥ Docker Desktop æ˜¯å¦è¿è¡Œ**
   - æŸ¥çœ‹ä»»åŠ¡æ  Docker å›¾æ ‡

2. **å¯ç”¨ WSL é›†æˆ**
   - Docker Desktop â†’ Settings â†’ Resources â†’ WSL Integration
   - å¯ç”¨ "Enable integration with my default WSL distro"

3. **é‡å¯ WSL**
   ```powershell
   wsl --shutdown
   wsl
   ```

### é—®é¢˜ 2ï¼šæ— æ³•è¿æ¥åˆ° Docker daemon

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **é‡å¯ Docker Desktop**
   - å³é”®ä»»åŠ¡æ  Docker å›¾æ ‡ â†’ Restart

2. **æ£€æŸ¥ Docker æœåŠ¡**
   ```bash
   # åœ¨ WSL ä¸­
   docker ps
   ```

3. **é‡å¯ WSL**
   ```powershell
   wsl --shutdown
   wsl
   ```

### é—®é¢˜ 3ï¼šDocker å®¹å™¨æ— æ³•è®¿é—®ç½‘ç»œ

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **æ£€æŸ¥ Docker ç½‘ç»œ**
   ```bash
   docker network ls
   ```

2. **é‡å¯ Docker Desktop**

3. **æ£€æŸ¥é˜²ç«å¢™è§„åˆ™**
   ```powershell
   Get-NetFirewallRule | Where-Object DisplayName -like "*Docker*"
   ```

---

## é€šç”¨æ•…éšœæ’æŸ¥æ­¥éª¤

### 1. æ£€æŸ¥ WSL çŠ¶æ€

```powershell
# æŸ¥çœ‹æ‰€æœ‰å‘è¡Œç‰ˆçŠ¶æ€
wsl --list --verbose

# æŸ¥çœ‹ WSL ç‰ˆæœ¬
wsl --version

# æŸ¥çœ‹ WSL çŠ¶æ€
wsl --status
```

### 2. é‡å¯ WSL

```powershell
# å…³é—­æ‰€æœ‰ WSL å®ä¾‹
wsl --shutdown

# é‡æ–°å¯åŠ¨
wsl
```

### 3. æ£€æŸ¥æ—¥å¿—

```powershell
# æŸ¥çœ‹ Windows äº‹ä»¶æ—¥å¿—
Get-WinEvent -LogName System | Where-Object {$_.ProviderName -like "*WSL*"}

# åœ¨ WSL ä¸­æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—
journalctl -xe
```

### 4. æ›´æ–° WSL

```powershell
# æ›´æ–° WSL
wsl --update

# æ£€æŸ¥æ›´æ–°
wsl --status
```

### 5. é‡ç½®å‘è¡Œç‰ˆ

```powershell
# å¯¼å‡ºå‘è¡Œç‰ˆ
wsl --export Ubuntu-22.04 backup.tar

# æ³¨é”€å‘è¡Œç‰ˆ
wsl --unregister Ubuntu-22.04

# é‡æ–°å¯¼å…¥
wsl --import Ubuntu-22.04 C:\WSL\Ubuntu-22.04 backup.tar
```

---

## è·å–å¸®åŠ©

### å®˜æ–¹èµ„æº

- [WSL å®˜æ–¹æ–‡æ¡£](https://learn.microsoft.com/zh-cn/windows/wsl/)
- [WSL GitHub Issues](https://github.com/microsoft/WSL/issues)
- [WSL ç¤¾åŒº](https://github.com/microsoft/WSL/discussions)

### è¯Šæ–­ä¿¡æ¯

```powershell
# æ”¶é›†è¯Šæ–­ä¿¡æ¯
wsl --status
wsl --list --verbose
systeminfo | findstr /C:"System Type"
```

---

## ğŸ“š å‚è€ƒèµ„æº

- [WSL æ•…éšœæ’æŸ¥æŒ‡å—](https://learn.microsoft.com/zh-cn/windows/wsl/troubleshooting)
- [WSL GitHub Issues](https://github.com/microsoft/WSL/issues)

---

[[!MOC-WSL|è¿”å› WSL çŸ¥è¯†ä½“ç³»]]

#WSL #æ•…éšœæ’æŸ¥ #é—®é¢˜è§£å†³
