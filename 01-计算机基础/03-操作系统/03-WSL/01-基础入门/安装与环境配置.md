# WSL 安装与环境配置

> WSL 在不同 Windows 版本上的安装方法和环境配置

---

## 📋 目录

- [系统要求](#系统要求)
- [WSL 1 vs WSL 2](#wsl-1-vs-wsl-2)
- [安装方法](#安装方法)
- [安装验证](#安装验证)
- [常见问题](#常见问题)

---

## 系统要求

### Windows 10
- **版本要求**：Windows 10 版本 1903 或更高版本（内部版本 18362 或更高）
- **架构**：64 位系统
- **功能**：需要启用"适用于 Linux 的 Windows 子系统"和"虚拟机平台"功能

### Windows 11
- **版本要求**：Windows 11 所有版本
- **架构**：64 位系统
- **功能**：自动启用所需功能

### WSL 2 额外要求
- **虚拟化支持**：需要支持虚拟化的 CPU（大多数现代 CPU 都支持）
- **Hyper-V**：Windows 10 版本 1903+ 或 Windows 11 需要启用虚拟机平台功能

---

## WSL 1 vs WSL 2

### WSL 1
- **架构**：翻译层架构，将 Linux 系统调用转换为 Windows 系统调用
- **性能**：文件系统性能较慢，特别是大量小文件操作
- **兼容性**：更好的 Windows 文件系统互操作性
- **网络**：与 Windows 共享网络堆栈
- **启动速度**：启动速度较快

### WSL 2
- **架构**：基于虚拟化技术，运行在轻量级虚拟机中
- **性能**：完整的 Linux 内核，文件系统性能显著提升
- **兼容性**：更好的 Linux 应用兼容性
- **网络**：独立的网络堆栈，需要端口转发
- **启动速度**：启动速度稍慢，但性能更好

### 选择建议
- **推荐使用 WSL 2**：除非有特殊需求（如需要访问 Windows 文件系统性能要求高）
- **WSL 1 适用场景**：
  - 需要频繁访问 Windows 文件系统中的文件
  - 对启动速度要求极高
  - 需要与 Windows 网络服务深度集成

---

## 安装方法

### 方法一：使用 wsl 命令（推荐）

这是最简单快捷的安装方法，适用于 Windows 10 版本 2004 及更高版本。

```powershell
# 以管理员身份运行 PowerShell 或命令提示符

# 安装 WSL 和默认的 Ubuntu 发行版
wsl --install

# 或者只安装 WSL，不安装发行版
wsl --install --no-distribution

# 安装完成后，重启计算机
```

**注意**：`wsl --install` 命令会自动：
- 启用所需的 Windows 功能
- 下载并安装最新的 Linux 内核
- 将 WSL 2 设置为默认版本
- 下载并安装 Ubuntu（如果没有指定其他发行版）

### 方法二：手动启用功能

适用于 Windows 10 早期版本或需要更多控制的情况。

#### 1. 启用 Windows 功能

```powershell
# 以管理员身份运行 PowerShell

# 启用"适用于 Linux 的 Windows 子系统"
dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart

# 启用"虚拟机平台"（WSL 2 需要）
dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart

# 重启计算机
Restart-Computer
```

#### 2. 下载并安装 Linux 内核更新包

访问 [WSL 2 Linux 内核更新包](https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi) 下载并安装。

#### 3. 将 WSL 2 设置为默认版本

```powershell
# 重启后，以管理员身份运行
wsl --set-default-version 2
```

#### 4. 安装 Linux 发行版

**从 Microsoft Store 安装**（推荐）：
- 打开 Microsoft Store
- 搜索并安装所需的 Linux 发行版（如 Ubuntu、Debian、openSUSE 等）

**使用命令行安装**：
```powershell
# 查看可用的发行版
wsl --list --online

# 安装指定发行版
wsl --install -d Ubuntu
wsl --install -d Debian
wsl --install -d openSUSE-Leap-15-3
```

### 方法三：使用 Microsoft Store

1. 打开 Microsoft Store
2. 搜索 "WSL" 或具体的 Linux 发行版名称
3. 选择并安装（如 Ubuntu、Debian、Kali Linux 等）
4. 首次启动时会提示创建用户账户

---

## 安装验证

### 检查 WSL 版本

```powershell
# 查看 WSL 版本信息
wsl --version

# 查看已安装的发行版及其版本
wsl --list --verbose
# 或简写
wsl -l -v
```

输出示例：
```
  NAME            STATE           VERSION
* Ubuntu-22.04    Running         2
  Debian          Stopped         2
```

### 测试基本功能

```bash
# 在 WSL 中运行
wsl

# 或直接运行 Linux 命令
wsl ls -la
wsl pwd
wsl uname -a
```

### 验证 Linux 内核版本

```bash
# 在 WSL 中运行
uname -r

# WSL 2 应该显示类似：5.15.90.1-microsoft-standard-WSL2
```

---

## 常见问题

### 1. WSL 2 安装失败

**问题**：`WSL 2 requires an update to its kernel component`

**解决方案**：
1. 下载并安装 [WSL 2 Linux 内核更新包](https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi)
2. 确保已启用"虚拟机平台"功能
3. 重启计算机

### 2. 虚拟化未启用

**问题**：`This virtual machine cannot be started because virtualization is not enabled`

**解决方案**：
1. 进入 BIOS/UEFI 设置
2. 启用虚拟化功能（Intel VT-x 或 AMD-V）
3. 在 Windows 功能中启用"Hyper-V"或"虚拟机平台"

### 3. 发行版启动失败

**问题**：发行版安装后无法启动

**解决方案**：
```powershell
# 检查发行版状态
wsl --list --verbose

# 如果状态为 Stopped，尝试启动
wsl -d Ubuntu-22.04

# 如果仍然失败，可能需要重置发行版
wsl --unregister Ubuntu-22.04
wsl --install -d Ubuntu-22.04
```

### 4. 更新 WSL

```powershell
# 更新 WSL
wsl --update

# 检查更新状态
wsl --status
```

### 5. 设置默认发行版

```powershell
# 查看所有发行版
wsl --list

# 设置默认发行版
wsl --set-default Ubuntu-22.04
```

---

## 📚 参考资源

- [WSL 官方安装文档](https://learn.microsoft.com/zh-cn/windows/wsl/install)
- [WSL 2 发行说明](https://github.com/microsoft/WSL/releases)
- [WSL GitHub 仓库](https://github.com/microsoft/WSL)

---

[[!MOC-WSL|返回 WSL 知识体系]]

#WSL #安装 #环境配置 #Windows
