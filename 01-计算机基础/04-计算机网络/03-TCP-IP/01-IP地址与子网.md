# IP 地址与子网（IP Address and Subnet）

> IP 地址是网络设备的唯一标识符，子网划分用于优化网络管理和提高安全性。

---

## 什么是 IP 地址

IP 地址（Internet Protocol Address）是分配给网络设备的唯一标识符，用于在网络中定位和路由数据包。

### IP 地址的作用

- **唯一标识**：在网络中唯一标识一台设备
- **路由寻址**：用于数据包的路由选择
- **网络划分**：用于划分网络和子网

---

## IPv4 地址

### IPv4 地址格式

IPv4 地址是 32 位二进制数，通常用点分十进制表示。

**格式**：`xxx.xxx.xxx.xxx`（每个 xxx 是 0-255 的十进制数）

**示例**：
```
192.168.1.1
10.0.0.1
172.16.0.1
```

**二进制表示**：
```
192.168.1.1 = 11000000.10101000.00000001.00000001
```

---

## IPv4 地址分类

### 传统分类（已废弃）

| 类别 | 范围 | 网络位 | 主机位 | 用途 |
|------|------|--------|--------|------|
| A 类 | 1.0.0.0 - 126.255.255.255 | 8 位 | 24 位 | 大型网络 |
| B 类 | 128.0.0.0 - 191.255.255.255 | 16 位 | 16 位 | 中型网络 |
| C 类 | 192.0.0.0 - 223.255.255.255 | 24 位 | 8 位 | 小型网络 |
| D 类 | 224.0.0.0 - 239.255.255.255 | - | - | 组播 |
| E 类 | 240.0.0.0 - 255.255.255.255 | - | - | 保留 |

**特殊地址**：
- **127.0.0.1**：本地回环地址（localhost）
- **0.0.0.0**：所有网络
- **255.255.255.255**：广播地址

---

### 私有地址（RFC 1918）

私有地址用于内网，不会在互联网上路由。

| 范围 | 说明 |
|------|------|
| 10.0.0.0 - 10.255.255.255 | A 类私有地址 |
| 172.16.0.0 - 172.31.255.255 | B 类私有地址 |
| 192.168.0.0 - 192.168.255.255 | C 类私有地址 |

---

## 子网掩码（Subnet Mask）

### 什么是子网掩码

子网掩码用于区分 IP 地址中的网络部分和主机部分。

**格式**：与 IP 地址相同，用点分十进制表示

**示例**：
```
IP 地址：192.168.1.1
子网掩码：255.255.255.0
```

**二进制表示**：
```
IP 地址：  11000000.10101000.00000001.00000001
子网掩码： 11111111.11111111.11111111.00000000
           └─────────网络部分────────┘└─主机部分─┘
```

---

### 子网掩码的作用

1. **网络划分**：将大网络划分为小网络
2. **路由选择**：路由器根据网络部分进行路由
3. **广播域控制**：限制广播范围

---

## CIDR 表示法

CIDR（Classless Inter-Domain Routing，无类别域间路由）是更灵活的地址表示方法。

### CIDR 格式

**格式**：`IP地址/前缀长度`

**示例**：
```
192.168.1.0/24
10.0.0.0/8
172.16.0.0/16
```

**说明**：
- `/24` 表示前 24 位是网络部分
- `/8` 表示前 8 位是网络部分
- `/16` 表示前 16 位是网络部分

### CIDR 与子网掩码对应

| CIDR | 子网掩码 | 网络位 | 主机位 | 可用主机数 |
|------|---------|--------|--------|-----------|
| /8 | 255.0.0.0 | 8 | 24 | 16,777,214 |
| /16 | 255.255.0.0 | 16 | 16 | 65,534 |
| /24 | 255.255.255.0 | 24 | 8 | 254 |
| /25 | 255.255.255.128 | 25 | 7 | 126 |
| /26 | 255.255.255.192 | 26 | 6 | 62 |
| /27 | 255.255.255.224 | 27 | 5 | 30 |
| /28 | 255.255.255.240 | 28 | 4 | 14 |
| /30 | 255.255.255.252 | 30 | 2 | 2（用于点对点） |

---

## 子网划分

### 子网划分的目的

- **提高安全性**：隔离不同部门
- **优化性能**：减少广播流量
- **灵活管理**：根据需求分配地址

### 子网划分示例

**原始网络**：192.168.1.0/24（254 个可用主机）

**划分为 4 个子网**：

| 子网 | 网络地址 | 广播地址 | 可用主机范围 | 可用主机数 |
|------|---------|---------|-------------|-----------|
| 子网1 | 192.168.1.0 | 192.168.1.63 | 192.168.1.1 - 192.168.1.62 | 62 |
| 子网2 | 192.168.1.64 | 192.168.1.127 | 192.168.1.65 - 192.168.1.126 | 62 |
| 子网3 | 192.168.1.128 | 192.168.1.191 | 192.168.1.129 - 192.168.1.190 | 62 |
| 子网4 | 192.168.1.192 | 192.168.1.255 | 192.168.1.193 - 192.168.1.254 | 62 |

**子网掩码**：255.255.255.192（/26）

---

## 网络地址和广播地址

### 网络地址

**定义**：子网的第一个地址，表示网络本身

**特点**：主机部分全为 0

**示例**：
```
192.168.1.0/24 的网络地址是 192.168.1.0
```

### 广播地址

**定义**：子网的最后一个地址，用于广播

**特点**：主机部分全为 1

**示例**：
```
192.168.1.0/24 的广播地址是 192.168.1.255
```

### 可用主机地址

**范围**：网络地址 + 1 到 广播地址 - 1

**示例**：
```
192.168.1.0/24 的可用主机地址是 192.168.1.1 - 192.168.1.254
```

---

## IPv6 地址

### IPv6 地址格式

IPv6 地址是 128 位，用冒号分隔的十六进制表示。

**格式**：`xxxx:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx`

**示例**：
```
2001:0db8:85a3:0000:0000:8a2e:0370:7334
2001:db8:85a3::8a2e:370:7334  (简化形式，:: 表示连续的 0)
```

### IPv6 特点

- **地址空间大**：2^128 个地址
- **简化头部**：更高效的路由
- **内置安全**：IPsec 支持
- **自动配置**：无状态地址自动配置

---

## NAT（网络地址转换）

### 什么是 NAT

NAT（Network Address Translation）将私有 IP 地址转换为公有 IP 地址。

### NAT 的作用

- **节省公网 IP**：多个内网设备共享一个公网 IP
- **提高安全性**：隐藏内网结构
- **灵活性**：内网 IP 可以随意分配

### NAT 类型

1. **静态 NAT**：一对一映射
2. **动态 NAT**：多对多映射
3. **PAT（Port Address Translation）**：多对一映射，使用端口区分

---

## 实际应用

### 查看 IP 地址

```bash
# Linux/Mac
ifconfig
# 或
ip addr

# Windows
ipconfig
```

### 配置 IP 地址

```bash
# Linux
sudo ip addr add 192.168.1.100/24 dev eth0

# 或使用 netplan（Ubuntu）
sudo nano /etc/netplan/01-netcfg.yaml
```

### 测试网络连通性

```bash
# ping 测试
ping 192.168.1.1

# 查看路由表
route -n
# 或
ip route
```

---

## 常见问题

### 1. 如何计算子网掩码？

根据需要的子网数量或主机数量计算：
- **子网数量**：2^n（n 是借用的主机位数）
- **主机数量**：2^m - 2（m 是剩余的主机位数，减 2 是网络地址和广播地址）

### 2. /24 和 /26 的区别？

- **/24**：256 个地址，254 个可用主机
- **/26**：64 个地址，62 个可用主机

### 3. 为什么需要子网划分？

- 提高网络安全性
- 减少广播流量
- 灵活管理网络资源

---

## 总结

IP 地址与子网要点：
- **IPv4 地址**：32 位，点分十进制表示
- **子网掩码**：区分网络部分和主机部分
- **CIDR 表示法**：更灵活的地址表示方法
- **子网划分**：将大网络划分为小网络
- **NAT**：私有地址与公有地址转换

理解 IP 地址和子网是网络配置和故障排查的基础。

---

**相关链接**：
- [02-路由与转发](./02-路由与转发.md) — 路由原理
- [03-TCP 协议](./03-TCP协议.md) — TCP 协议详解

---

#IP地址 #子网 #CIDR #网络基础

