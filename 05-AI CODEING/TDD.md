# AI 时代如何结合 TDD 写出好代码

这段视频主要围绕“AI 时代如何结合 TDD（测试驱动开发）写出好代码”展开，以下是对内容的整理和格式优化。

## 背景
作者曾因 AI 生成的代码不符合需求，且面对陌生框架代码难以修改，从而发现真正的工程师在使用 AI 时会结合 TDD，以兼顾效率与代码可控性。

## TDD 概念与优缺点

### 概念
TDD（测试驱动开发）强调在实现功能前先写测试。

### 优点
- 倒逼工程师明确要实现的功能
- 减少实现时的错误

### 缺点
- 费时费力
- 对有 deadlines 的项目来说过于奢侈，因此曾不受欢迎

## AI 时代 TDD 的价值
在 AI 时代，TDD 的缺点不再是问题，而优点愈发突出。因为 AI 常误解需求，TDD 能帮助我们把控 AI 生成的代码。

## 结合 TDD 与 AI 开发的步骤

### 1. 明确需求
- **这一步不能交给 AI**，需自己将需求整理成文档
- 可采用“given - when - then”的思考方式：
  - **Given**：给定什么条件
  - **When**：发生什么动作
  - **Then**：期望什么结果
- 示例（登录验证功能）：
  - Given：数据库里有用户 Alice
  - When：她输入密码
  - Then：返回登录成功

### 2. 让 AI 先写测试
- 将模糊的自然语言需求翻译成精确的测试代码
- 通过检查测试代码判断 AI 对需求的理解是否正确

### 3. 让 AI 实现功能并验证
- AI 按测试用例实现功能
- 运行测试，若不通过则让 AI 修改代码，直到测试通过

## 核心价值与展望
通过这一过程，能得到有测试保障、可维护的代码。工程师的核心价值在于：
- **做什么**（需求定义）
- **为什么做**（架构设计）

而非“怎么做”（技术细节）。AI 是来解放工程师的：
- 就像高级语言解放了汇编开发
- AI 解放了对 API 记忆的负担

## 方案评估

### 优势分析
1. **需求明确化**：TDD 强制需求具象化为测试用例，减少 AI 误解的概率
2. **质量保障**：测试覆盖确保 AI 生成的代码符合预期行为
3. **可维护性**：测试套件作为文档，便于后续修改和重构
4. **工程师定位**：将工程师从技术细节中解放，专注于架构和需求设计

### 适用场景
- **复杂业务逻辑**：需求模糊或易误解的场景
- **团队协作**：需要统一理解的需求澄清
- **长期维护项目**：测试作为代码质量的长期保障
- **AI 辅助开发**：特别是代码生成质量不稳定的早期阶段

### 潜在挑战
1. **测试编写成本**：即使由 AI 编写，也需要人工审查测试逻辑
2. **测试覆盖度**：AI 可能遗漏边界条件或异常场景
3. **重构阻力**：测试可能过于具体，导致重构时测试也需要同步更新
4. **学习曲线**：团队需要掌握 TDD 思维模式和 AI 提示工程技巧

### 实践建议
1. **渐进采用**：从关键模块开始试点，逐步推广
2. **测试分层**：
   - 单元测试：AI 生成 + 人工审查
   - 集成测试：人工主导，验证模块间交互
   - E2E 测试：验证用户价值
3. **提示工程优化**：
   - 提供清晰的需求描述模板
   - 包含业务上下文和约束条件
   - 要求 AI 解释测试设计思路
4. **工具链整合**：
   - 将 AI 生成的测试纳入 CI/CD 流水线
   - 建立测试覆盖率监控
   - 设置测试失败时的 AI 自动修复流程

### 长期视角
该方案的价值不仅在于当前的开发效率提升，更在于：
- **知识沉淀**：测试用例成为团队共享的业务理解
- **质量文化**：建立以测试为质量门槛的开发习惯
- **AI 协作模式**：定义人机协作的标准流程，减少随机性

### 风险提示
- 过度依赖 AI 生成的测试可能导致“测试幻觉”——测试通过但业务逻辑错误
- 需要建立人工审查机制，特别是对于核心业务逻辑
- 测试代码本身也需要维护，可能成为技术债务的来源
