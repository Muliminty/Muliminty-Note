# æœåŠ¡å™¨å¤šé¡¹ç›®éƒ¨ç½²è§„èŒƒ

> ä¸€ä¸ªæœåŠ¡å™¨éƒ¨ç½²å¤šä¸ªé¡¹ç›®çš„å®Œæ•´è§„èŒƒï¼ŒåŒ…æ‹¬ç«¯å£è§„åˆ’ã€Docker å®¹å™¨é…ç½®ã€Nginx åå‘ä»£ç†é…ç½®ç­‰ã€‚
> 
> **é€‚ç”¨åœºæ™¯**ï¼šè…¾è®¯äº‘ Ubuntu æœåŠ¡å™¨ï¼Œä½¿ç”¨ Docker å’Œ Nginx éƒ¨ç½²å¤šä¸ªå‰åç«¯é¡¹ç›®
> 
> **æ¶‰åŠæŠ€æœ¯**ï¼šDockerã€Docker Composeã€Nginxã€ç«¯å£ç®¡ç†ã€åå‘ä»£ç†

---

## ğŸ“š ç›®å½•

- [1. ç«¯å£è§„åˆ’è§„èŒƒ](#1-ç«¯å£è§„åˆ’è§„èŒƒ)
- [2. Docker å®¹å™¨ç«¯å£æ˜ å°„](#2-docker-å®¹å™¨ç«¯å£æ˜ å°„)
- [3. Nginx åå‘ä»£ç†é…ç½®](#3-nginx-åå‘ä»£ç†é…ç½®)
- [4. é¡¹ç›®éƒ¨ç½²ç¤ºä¾‹](#4-é¡¹ç›®éƒ¨ç½²ç¤ºä¾‹)
- [5. è…¾è®¯äº‘ Ubuntu ç‰¹æ®Šé…ç½®](#5-è…¾è®¯äº‘-ubuntu-ç‰¹æ®Šé…ç½®)
- [6. æœ€ä½³å®è·µ](#6-æœ€ä½³å®è·µ)

---

## 1. ç«¯å£è§„åˆ’è§„èŒƒ

### 1.1 ç«¯å£åˆ†é…åŸåˆ™

**ç«¯å£åˆ†ç±»**ï¼š

1. **ç³»ç»ŸæœåŠ¡ç«¯å£**ï¼ˆ1-1023ï¼‰ï¼šç³»ç»Ÿä¿ç•™ï¼Œç¦æ­¢ä½¿ç”¨
2. **åå‘ä»£ç†ç«¯å£**ï¼ˆ80, 443ï¼‰ï¼šNginx ç›‘å¬ç«¯å£ï¼Œå¯¹å¤–æš´éœ²
3. **å‰ç«¯æœåŠ¡ç«¯å£**ï¼ˆ3000-3999ï¼‰ï¼šå‰ç«¯åº”ç”¨å®¹å™¨å†…éƒ¨ç«¯å£
4. **åç«¯æœåŠ¡ç«¯å£**ï¼ˆ4000-4999ï¼‰ï¼šåç«¯ API æœåŠ¡å®¹å™¨å†…éƒ¨ç«¯å£
5. **æ•°æ®åº“ç«¯å£**ï¼ˆ5000-5999ï¼‰ï¼šæ•°æ®åº“æœåŠ¡ç«¯å£ï¼ˆå¦‚ MySQL 3306, Redis 6379ï¼‰
6. **å…¶ä»–æœåŠ¡ç«¯å£**ï¼ˆ6000-9999ï¼‰ï¼šå…¶ä»–æœåŠ¡ï¼ˆå¦‚ WebSocketã€SSH éš§é“ç­‰ï¼‰

### 1.2 ç«¯å£åˆ†é…è¡¨

| ç«¯å£èŒƒå›´ | ç”¨é€” | è¯´æ˜ |
|---------|------|------|
| 80 | Nginx HTTP | å¯¹å¤–æš´éœ²ï¼Œæ‰€æœ‰ HTTP è¯·æ±‚å…¥å£ |
| 443 | Nginx HTTPS | å¯¹å¤–æš´éœ²ï¼Œæ‰€æœ‰ HTTPS è¯·æ±‚å…¥å£ |
| 3000-3099 | å‰ç«¯é¡¹ç›® 1-10 | å‰ç«¯åº”ç”¨å®¹å™¨ç«¯å£ |
| 3100-3199 | å‰ç«¯é¡¹ç›® 11-20 | å‰ç«¯åº”ç”¨å®¹å™¨ç«¯å£ï¼ˆé¢„ç•™ï¼‰ |
| 4000-4099 | åç«¯é¡¹ç›® 1-10 | åç«¯ API æœåŠ¡å®¹å™¨ç«¯å£ |
| 4100-4199 | åç«¯é¡¹ç›® 11-20 | åç«¯ API æœåŠ¡å®¹å™¨ç«¯å£ï¼ˆé¢„ç•™ï¼‰ |
| 5000-5099 | æ•°æ®åº“æœåŠ¡ | MySQLã€PostgreSQLã€MongoDB ç­‰ |
| 6000-6999 | å…¶ä»–æœåŠ¡ | WebSocketã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰ |
| 7000-7999 | å¼€å‘è°ƒè¯• | ä¸´æ—¶å¼€å‘ç«¯å£ |

### 1.3 é¡¹ç›®ç«¯å£åˆ†é…ç¤ºä¾‹

**é¡¹ç›® Aï¼ˆå…¨æ ˆé¡¹ç›®ï¼‰**ï¼š
- å‰ç«¯å®¹å™¨ç«¯å£ï¼š`3001`
- åç«¯å®¹å™¨ç«¯å£ï¼š`4001`
- æ•°æ®åº“ç«¯å£ï¼š`3306`ï¼ˆMySQLï¼‰

**é¡¹ç›® Bï¼ˆå…¨æ ˆé¡¹ç›®ï¼‰**ï¼š
- å‰ç«¯å®¹å™¨ç«¯å£ï¼š`3002`
- åç«¯å®¹å™¨ç«¯å£ï¼š`4002`
- æ•°æ®åº“ç«¯å£ï¼š`3307`ï¼ˆMySQLï¼‰

**é¡¹ç›® Cï¼ˆçº¯å‰ç«¯é¡¹ç›®ï¼‰**ï¼š
- å‰ç«¯å®¹å™¨ç«¯å£ï¼š`3003`
- æ— åç«¯æœåŠ¡

**é¡¹ç›® Dï¼ˆçº¯åç«¯é¡¹ç›®ï¼‰**ï¼š
- åç«¯å®¹å™¨ç«¯å£ï¼š`4003`
- æ— å‰ç«¯æœåŠ¡

---

## 2. Docker å®¹å™¨ç«¯å£æ˜ å°„

### 2.1 ç«¯å£æ˜ å°„è§„åˆ™

**æ ¼å¼**ï¼š`-p å®¿ä¸»æœºç«¯å£:å®¹å™¨å†…éƒ¨ç«¯å£`

**åŸåˆ™**ï¼š
- å®¿ä¸»æœºç«¯å£ = å®¹å™¨å†…éƒ¨ç«¯å£ï¼ˆä¿æŒä¸€è‡´ï¼Œä¾¿äºç®¡ç†ï¼‰
- å®¹å™¨å†…éƒ¨ç«¯å£ä½¿ç”¨è§„åˆ’å¥½çš„ç«¯å£èŒƒå›´
- é¿å…ç«¯å£å†²çª

### 2.2 Docker Compose é…ç½®ç¤ºä¾‹

```yaml
# docker-compose.yml
version: '3.8'

services:
  # é¡¹ç›® A - å‰ç«¯
  project-a-frontend:
    image: project-a-frontend:latest
    container_name: project-a-frontend
    ports:
      - "3001:3001"  # å®¿ä¸»æœº:å®¹å™¨
    environment:
      - NODE_ENV=production
      - API_URL=http://project-a-backend:4001
    networks:
      - project-a-network
    restart: unless-stopped

  # é¡¹ç›® A - åç«¯
  project-a-backend:
    image: project-a-backend:latest
    container_name: project-a-backend
    ports:
      - "4001:4001"  # å®¿ä¸»æœº:å®¹å™¨
    environment:
      - NODE_ENV=production
      - DB_HOST=project-a-db
      - DB_PORT=3306
    networks:
      - project-a-network
    depends_on:
      - project-a-db
    restart: unless-stopped

  # é¡¹ç›® A - æ•°æ®åº“
  project-a-db:
    image: mysql:8.0
    container_name: project-a-db
    ports:
      - "3306:3306"  # å¯é€‰ï¼šå¦‚æœéœ€è¦å¤–éƒ¨è®¿é—®
    environment:
      - MYSQL_ROOT_PASSWORD=root_password
      - MYSQL_DATABASE=project_a
    volumes:
      - project-a-db-data:/var/lib/mysql
    networks:
      - project-a-network
    restart: unless-stopped

  # é¡¹ç›® B - å‰ç«¯
  project-b-frontend:
    image: project-b-frontend:latest
    container_name: project-b-frontend
    ports:
      - "3002:3002"
    environment:
      - NODE_ENV=production
      - API_URL=http://project-b-backend:4002
    networks:
      - project-b-network
    restart: unless-stopped

  # é¡¹ç›® B - åç«¯
  project-b-backend:
    image: project-b-backend:latest
    container_name: project-b-backend
    ports:
      - "4002:4002"
    environment:
      - NODE_ENV=production
      - DB_HOST=project-b-db
      - DB_PORT=3306
    networks:
      - project-b-network
    depends_on:
      - project-b-db
    restart: unless-stopped

  # é¡¹ç›® B - æ•°æ®åº“
  project-b-db:
    image: mysql:8.0
    container_name: project-b-db
    ports:
      - "3307:3306"  # å®¿ä¸»æœºä½¿ç”¨ 3307ï¼Œå®¹å™¨å†…ä»æ˜¯ 3306
    environment:
      - MYSQL_ROOT_PASSWORD=root_password
      - MYSQL_DATABASE=project_b
    volumes:
      - project-b-db-data:/var/lib/mysql
    networks:
      - project-b-network
    restart: unless-stopped

volumes:
  project-a-db-data:
  project-b-db-data:

networks:
  project-a-network:
    driver: bridge
  project-b-network:
    driver: bridge
```

### 2.3 ç‹¬ç«‹ Docker è¿è¡Œç¤ºä¾‹

```bash
# é¡¹ç›® A å‰ç«¯
docker run -d \
  --name project-a-frontend \
  -p 3001:3001 \
  -e NODE_ENV=production \
  -e API_URL=http://localhost:4001 \
  project-a-frontend:latest

# é¡¹ç›® A åç«¯
docker run -d \
  --name project-a-backend \
  -p 4001:4001 \
  -e NODE_ENV=production \
  -e DB_HOST=project-a-db \
  project-a-backend:latest

# é¡¹ç›® B å‰ç«¯
docker run -d \
  --name project-b-frontend \
  -p 3002:3002 \
  -e NODE_ENV=production \
  -e API_URL=http://localhost:4002 \
  project-b-frontend:latest

# é¡¹ç›® B åç«¯
docker run -d \
  --name project-b-backend \
  -p 4002:4002 \
  -e NODE_ENV=production \
  -e DB_HOST=project-b-db \
  project-b-backend:latest
```

---

## 3. Nginx åå‘ä»£ç†é…ç½®

### 3.1 Nginx ä¸»é…ç½®æ–‡ä»¶

```nginx
# /etc/nginx/nginx.conf
user www-data;
worker_processes auto;
pid /run/nginx.pid;

events {
    worker_connections 768;
}

http {
    # åŸºç¡€é…ç½®
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;
    server_tokens off;

    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    # æ—¥å¿—é…ç½®
    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;

    # Gzip å‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    # åŒ…å«ç«™ç‚¹é…ç½®
    include /etc/nginx/conf.d/*.conf;
    include /etc/nginx/sites-enabled/*;
}
```

### 3.2 æ–¹å¼ä¸€ï¼šé€šè¿‡åŸŸååŒºåˆ†ï¼ˆæ¨èï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šæœ‰å¤šä¸ªåŸŸåæˆ–å­åŸŸå

```nginx
# /etc/nginx/sites-available/project-a
server {
    listen 80;
    listen [::]:80;
    server_name project-a.example.com www.project-a.example.com;

    # å‰ç«¯ä»£ç†
    location / {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    # åç«¯ API ä»£ç†
    location /api {
        proxy_pass http://localhost:4001;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# /etc/nginx/sites-available/project-b
server {
    listen 80;
    listen [::]:80;
    server_name project-b.example.com www.project-b.example.com;

    location / {
        proxy_pass http://localhost:3002;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    location /api {
        proxy_pass http://localhost:4002;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

**å¯ç”¨é…ç½®**ï¼š
```bash
# åˆ›å»ºè½¯é“¾æ¥å¯ç”¨é…ç½®
sudo ln -s /etc/nginx/sites-available/project-a /etc/nginx/sites-enabled/
sudo ln -s /etc/nginx/sites-available/project-b /etc/nginx/sites-enabled/

# éªŒè¯é…ç½®
sudo nginx -t

# é‡è½½é…ç½®
sudo systemctl reload nginx
```

### 3.3 æ–¹å¼äºŒï¼šé€šè¿‡è·¯å¾„åŒºåˆ†ï¼ˆæ— åŸŸåæ—¶ä½¿ç”¨ï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šåªæœ‰ä¸€ä¸ª IP åœ°å€ï¼Œæ²¡æœ‰åŸŸå

```nginx
# /etc/nginx/sites-available/multi-projects
server {
    listen 80 default_server;
    listen [::]:80 default_server;
    server_name _;

    # é¡¹ç›® A - å‰ç«¯
    location /project-a {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        
        # é‡å†™è·¯å¾„ï¼ˆå¦‚æœå‰ç«¯éœ€è¦ï¼‰
        rewrite ^/project-a/(.*)$ /$1 break;
    }

    # é¡¹ç›® A - åç«¯ API
    location /project-a/api {
        proxy_pass http://localhost:4001;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # é‡å†™è·¯å¾„ï¼Œå»æ‰ /project-a å‰ç¼€
        rewrite ^/project-a/api/(.*)$ /api/$1 break;
    }

    # é¡¹ç›® B - å‰ç«¯
    location /project-b {
        proxy_pass http://localhost:3002;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        
        rewrite ^/project-b/(.*)$ /$1 break;
    }

    # é¡¹ç›® B - åç«¯ API
    location /project-b/api {
        proxy_pass http://localhost:4002;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        rewrite ^/project-b/api/(.*)$ /api/$1 break;
    }

    # é»˜è®¤æ ¹è·¯å¾„
    location / {
        root /var/www/html;
        index index.html;
        try_files $uri $uri/ =404;
    }
}
```

**æ³¨æ„**ï¼šä½¿ç”¨è·¯å¾„åŒºåˆ†æ—¶ï¼Œå‰ç«¯é¡¹ç›®éœ€è¦é…ç½® `base` è·¯å¾„ï¼ˆè§ä¸‹æ–¹å‰ç«¯é…ç½®ï¼‰

### 3.4 æ–¹å¼ä¸‰ï¼šé€šè¿‡ç«¯å£åŒºåˆ†ï¼ˆä¸æ¨èï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šä¸´æ—¶æµ‹è¯•ï¼Œä¸æ¨èç”Ÿäº§ç¯å¢ƒ

```nginx
# é¡¹ç›® A - 8080 ç«¯å£
server {
    listen 8080;
    server_name _;

    location / {
        proxy_pass http://localhost:3001;
        # ... å…¶ä»–é…ç½®
    }

    location /api {
        proxy_pass http://localhost:4001;
        # ... å…¶ä»–é…ç½®
    }
}

# é¡¹ç›® B - 8081 ç«¯å£
server {
    listen 8081;
    server_name _;

    location / {
        proxy_pass http://localhost:3002;
        # ... å…¶ä»–é…ç½®
    }

    location /api {
        proxy_pass http://localhost:4002;
        # ... å…¶ä»–é…ç½®
    }
}
```

**ç¼ºç‚¹**ï¼š
- éœ€è¦å¼€æ”¾å¤šä¸ªç«¯å£
- é˜²ç«å¢™é…ç½®å¤æ‚
- ç”¨æˆ·ä½“éªŒå·®ï¼ˆéœ€è¦è®°ä½ç«¯å£å·ï¼‰

---

## 4. é¡¹ç›®éƒ¨ç½²ç¤ºä¾‹

### 4.1 é¡¹ç›® Aï¼šå…¨æ ˆé¡¹ç›®ï¼ˆReact + Node.jsï¼‰

#### 4.1.1 å‰ç«¯ Dockerfile

```dockerfile
# project-a-frontend/Dockerfile
FROM node:18-alpine AS builder

WORKDIR /app

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY package*.json ./
RUN npm ci

# å¤åˆ¶æºä»£ç 
COPY . .

# æ„å»º
RUN npm run build

# ç”Ÿäº§ç¯å¢ƒé•œåƒ
FROM nginx:alpine

# å¤åˆ¶æ„å»ºäº§ç‰©
COPY --from=builder /app/dist /usr/share/nginx/html

# å¤åˆ¶ Nginx é…ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰
# COPY nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 3001

CMD ["nginx", "-g", "daemon off;"]
```

#### 4.1.2 åç«¯ Dockerfile

```dockerfile
# project-a-backend/Dockerfile
FROM node:18-alpine

WORKDIR /app

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY package*.json ./
RUN npm ci --only=production

# å¤åˆ¶æºä»£ç 
COPY . .

EXPOSE 4001

CMD ["node", "server.js"]
```

#### 4.1.3 Docker Compose é…ç½®

```yaml
# project-a/docker-compose.yml
version: '3.8'

services:
  frontend:
    build: ./frontend
    container_name: project-a-frontend
    ports:
      - "3001:80"  # Nginx é»˜è®¤ 80ï¼Œæ˜ å°„åˆ°å®¿ä¸»æœº 3001
    environment:
      - NODE_ENV=production
    networks:
      - project-a-network
    restart: unless-stopped

  backend:
    build: ./backend
    container_name: project-a-backend
    ports:
      - "4001:4001"
    environment:
      - NODE_ENV=production
      - DB_HOST=db
      - DB_PORT=3306
      - DB_NAME=project_a
      - DB_USER=root
      - DB_PASSWORD=root_password
    networks:
      - project-a-network
    depends_on:
      - db
    restart: unless-stopped

  db:
    image: mysql:8.0
    container_name: project-a-db
    ports:
      - "3306:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=root_password
      - MYSQL_DATABASE=project_a
    volumes:
      - project-a-db-data:/var/lib/mysql
    networks:
      - project-a-network
    restart: unless-stopped

volumes:
  project-a-db-data:

networks:
  project-a-network:
    driver: bridge
```

#### 4.1.4 å‰ç«¯é…ç½®ï¼ˆè·¯å¾„éƒ¨ç½²æ—¶ï¼‰

**Vite é¡¹ç›®** (`vite.config.js`)ï¼š
```javascript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  base: '/project-a/',  // å¦‚æœä½¿ç”¨è·¯å¾„éƒ¨ç½²
  build: {
    outDir: 'dist',
  }
})
```

**Create React App** (`package.json`)ï¼š
```json
{
  "homepage": "/project-a"
}
```

**React Router** (`App.jsx`)ï¼š
```javascript
import { BrowserRouter } from 'react-router-dom'

function App() {
  return (
    <BrowserRouter basename="/project-a">
      {/* è·¯ç”±é…ç½® */}
    </BrowserRouter>
  )
}
```

### 4.2 é¡¹ç›® Bï¼šçº¯å‰ç«¯é¡¹ç›®ï¼ˆVue 3ï¼‰

#### 4.2.1 Dockerfile

```dockerfile
# project-b/Dockerfile
FROM node:18-alpine AS builder

WORKDIR /app

COPY package*.json ./
RUN npm ci

COPY . .
RUN npm run build

FROM nginx:alpine

COPY --from=builder /app/dist /usr/share/nginx/html

EXPOSE 3002

CMD ["nginx", "-g", "daemon off;"]
```

#### 4.2.2 Docker Compose é…ç½®

```yaml
# project-b/docker-compose.yml
version: '3.8'

services:
  frontend:
    build: .
    container_name: project-b-frontend
    ports:
      - "3002:80"
    restart: unless-stopped
```

### 4.3 é¡¹ç›® Cï¼šçº¯åç«¯é¡¹ç›®ï¼ˆExpress APIï¼‰

#### 4.3.1 Dockerfile

```dockerfile
# project-c/Dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY . .

EXPOSE 4003

CMD ["node", "index.js"]
```

#### 4.3.2 Docker Compose é…ç½®

```yaml
# project-c/docker-compose.yml
version: '3.8'

services:
  backend:
    build: .
    container_name: project-c-backend
    ports:
      - "4003:4003"
    environment:
      - NODE_ENV=production
    restart: unless-stopped
```

---

## 5. è…¾è®¯äº‘ Ubuntu ç‰¹æ®Šé…ç½®

### 5.1 é˜²ç«å¢™é…ç½®ï¼ˆUFWï¼‰

```bash
# å®‰è£… UFWï¼ˆå¦‚æœæœªå®‰è£…ï¼‰
sudo apt update
sudo apt install ufw -y

# å…è®¸ SSHï¼ˆé‡è¦ï¼šå…ˆå…è®¸ SSHï¼Œé¿å…è¢«é”åœ¨å¤–é¢ï¼‰
sudo ufw allow 22/tcp

# å…è®¸ HTTP å’Œ HTTPS
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# å¦‚æœéœ€è¦ç›´æ¥è®¿é—®å®¹å™¨ç«¯å£ï¼ˆä¸æ¨èï¼Œåº”é€šè¿‡ Nginxï¼‰
# sudo ufw allow 3001/tcp
# sudo ufw allow 4001/tcp

# å¯ç”¨é˜²ç«å¢™
sudo ufw enable

# æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€
sudo ufw status
```

### 5.2 è…¾è®¯äº‘å®‰å…¨ç»„é…ç½®

**åœ¨è…¾è®¯äº‘æ§åˆ¶å°é…ç½®**ï¼š

1. ç™»å½•è…¾è®¯äº‘æ§åˆ¶å°
2. è¿›å…¥ã€Œäº‘æœåŠ¡å™¨ã€->ã€Œå®‰å…¨ç»„ã€
3. é€‰æ‹©å¯¹åº”çš„å®‰å…¨ç»„è§„åˆ™
4. æ·»åŠ å…¥ç«™è§„åˆ™ï¼š
   - **HTTP**ï¼šç«¯å£ `80`ï¼Œåè®® `TCP`ï¼Œæ¥æº `0.0.0.0/0`
   - **HTTPS**ï¼šç«¯å£ `443`ï¼Œåè®® `TCP`ï¼Œæ¥æº `0.0.0.0/0`
   - **SSH**ï¼šç«¯å£ `22`ï¼Œåè®® `TCP`ï¼Œæ¥æº `ä½ çš„IP`ï¼ˆå»ºè®®é™åˆ¶æ¥æºï¼‰

**æ³¨æ„**ï¼š
- ä¸è¦å¼€æ”¾å®¹å™¨å†…éƒ¨ç«¯å£ï¼ˆ3001, 4001 ç­‰ï¼‰åˆ°å…¬ç½‘
- æ‰€æœ‰å¤–éƒ¨è¯·æ±‚åº”é€šè¿‡ Nginxï¼ˆ80/443 ç«¯å£ï¼‰è¿›å…¥
- å®¹å™¨ç«¯å£åªåœ¨æœåŠ¡å™¨å†…éƒ¨è®¿é—®

### 5.3 ç³»ç»Ÿèµ„æºç›‘æ§

```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
sudo netstat -tlnp | grep LISTEN
# æˆ–ä½¿ç”¨
sudo ss -tlnp

# æŸ¥çœ‹ Docker å®¹å™¨çŠ¶æ€
docker ps

# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
docker stats

# æŸ¥çœ‹ Nginx çŠ¶æ€
sudo systemctl status nginx

# æŸ¥çœ‹ Nginx æ—¥å¿—
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log
```

### 5.4 è‡ªåŠ¨å¯åŠ¨é…ç½®

```bash
# Docker æœåŠ¡è‡ªåŠ¨å¯åŠ¨ï¼ˆé»˜è®¤å·²å¯ç”¨ï¼‰
sudo systemctl enable docker

# Nginx æœåŠ¡è‡ªåŠ¨å¯åŠ¨
sudo systemctl enable nginx

# ä½¿ç”¨ Docker Compose æ—¶ï¼Œå®¹å™¨ restart ç­–ç•¥å·²é…ç½®
# restart: unless-stopped ä¼šåœ¨ç³»ç»Ÿé‡å¯åè‡ªåŠ¨å¯åŠ¨å®¹å™¨
```

---

## 6. æœ€ä½³å®è·µ

### 6.1 ç«¯å£ç®¡ç†

1. **ç»Ÿä¸€ç«¯å£è§„åˆ’**ï¼šå»ºç«‹ç«¯å£åˆ†é…è¡¨ï¼Œè®°å½•æ¯ä¸ªé¡¹ç›®çš„ç«¯å£ä½¿ç”¨æƒ…å†µ
2. **é¿å…ç«¯å£å†²çª**ï¼šéƒ¨ç½²å‰æ£€æŸ¥ç«¯å£å ç”¨æƒ…å†µ
3. **é¢„ç•™ç«¯å£èŒƒå›´**ï¼šä¸ºæœªæ¥é¡¹ç›®é¢„ç•™ç«¯å£èŒƒå›´
4. **æ–‡æ¡£è®°å½•**ï¼šåœ¨é¡¹ç›® README ä¸­è®°å½•ç«¯å£é…ç½®

### 6.2 Docker å®¹å™¨ç®¡ç†

1. **ä½¿ç”¨ Docker Compose**ï¼šç»Ÿä¸€ç®¡ç†å¤šå®¹å™¨åº”ç”¨
2. **ç½‘ç»œéš”ç¦»**ï¼šä¸åŒé¡¹ç›®ä½¿ç”¨ä¸åŒçš„ Docker ç½‘ç»œ
3. **æ•°æ®æŒä¹…åŒ–**ï¼šä½¿ç”¨ Docker volumes å­˜å‚¨æ•°æ®åº“æ•°æ®
4. **èµ„æºé™åˆ¶**ï¼šä¸ºå®¹å™¨è®¾ç½® CPU å’Œå†…å­˜é™åˆ¶

```yaml
# èµ„æºé™åˆ¶ç¤ºä¾‹
services:
  backend:
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 1G
        reservations:
          cpus: '0.5'
          memory: 512M
```

### 6.3 Nginx é…ç½®ä¼˜åŒ–

1. **ä½¿ç”¨åŸŸååŒºåˆ†**ï¼šä¼˜å…ˆä½¿ç”¨åŸŸåæ–¹å¼ï¼Œç”¨æˆ·ä½“éªŒæœ€å¥½
2. **é…ç½®ç¼“å­˜**ï¼šä¸ºé™æ€èµ„æºé…ç½®ç¼“å­˜
3. **å¯ç”¨ HTTPS**ï¼šä½¿ç”¨ Let's Encrypt å…è´¹è¯ä¹¦
4. **æ—¥å¿—ç®¡ç†**ï¼šå®šæœŸæ¸…ç†æ—¥å¿—æ–‡ä»¶ï¼Œé¿å…ç£ç›˜å æ»¡

```nginx
# é™æ€èµ„æºç¼“å­˜é…ç½®
location ~* \.(jpg|jpeg|png|gif|ico|css|js|svg|woff|woff2)$ {
    expires 30d;
    add_header Cache-Control "public, immutable";
}
```

### 6.4 å®‰å…¨å»ºè®®

1. **æœ€å°æƒé™åŸåˆ™**ï¼šå®¹å™¨å†…ä½¿ç”¨é root ç”¨æˆ·è¿è¡Œ
2. **ç¯å¢ƒå˜é‡ç®¡ç†**ï¼šæ•æ„Ÿä¿¡æ¯ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œä¸è¦ç¡¬ç¼–ç 
3. **å®šæœŸæ›´æ–°**ï¼šå®šæœŸæ›´æ–° Docker é•œåƒå’Œç³»ç»ŸåŒ…
4. **å¤‡ä»½ç­–ç•¥**ï¼šå®šæœŸå¤‡ä»½æ•°æ®åº“å’Œé‡è¦æ•°æ®

### 6.5 ç›‘æ§ä¸æ—¥å¿—

1. **å®¹å™¨æ—¥å¿—**ï¼šä½¿ç”¨ `docker logs` æŸ¥çœ‹å®¹å™¨æ—¥å¿—
2. **Nginx æ—¥å¿—**ï¼šå®šæœŸæ£€æŸ¥ Nginx è®¿é—®æ—¥å¿—å’Œé”™è¯¯æ—¥å¿—
3. **ç³»ç»Ÿç›‘æ§**ï¼šä½¿ç”¨ `htop`ã€`docker stats` ç›‘æ§èµ„æºä½¿ç”¨
4. **å‘Šè­¦æœºåˆ¶**ï¼šé…ç½®å¼‚å¸¸å‘Šè­¦ï¼ˆå¯é€‰ï¼‰

### 6.6 éƒ¨ç½²æµç¨‹

1. **æ„å»ºé•œåƒ**ï¼šåœ¨æœ¬åœ°æˆ– CI/CD ä¸­æ„å»º Docker é•œåƒ
2. **æ¨é€é•œåƒ**ï¼šæ¨é€åˆ° Docker Hub æˆ–ç§æœ‰ä»“åº“
3. **æœåŠ¡å™¨æ‹‰å–**ï¼šåœ¨æœåŠ¡å™¨ä¸Šæ‹‰å–æœ€æ–°é•œåƒ
4. **æ›´æ–°å®¹å™¨**ï¼šä½¿ç”¨ `docker-compose up -d` æ›´æ–°å®¹å™¨
5. **éªŒè¯éƒ¨ç½²**ï¼šæ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
6. **å›æ»šå‡†å¤‡**ï¼šä¿ç•™æ—§ç‰ˆæœ¬é•œåƒï¼Œä¾¿äºå¿«é€Ÿå›æ»š

```bash
# éƒ¨ç½²è„šæœ¬ç¤ºä¾‹
#!/bin/bash

# æ‹‰å–æœ€æ–°é•œåƒ
docker-compose pull

# åœæ­¢æ—§å®¹å™¨
docker-compose down

# å¯åŠ¨æ–°å®¹å™¨
docker-compose up -d

# æ¸…ç†æ—§é•œåƒ
docker image prune -f

# éªŒè¯æœåŠ¡
sleep 5
curl -f http://localhost:3001 || exit 1
```

---

## ğŸ“‹ ç«¯å£åˆ†é…è¡¨æ¨¡æ¿

åˆ›å»º `ports-allocation.md` æ–‡ä»¶è®°å½•ç«¯å£ä½¿ç”¨æƒ…å†µï¼š

```markdown
# æœåŠ¡å™¨ç«¯å£åˆ†é…è¡¨

## ç³»ç»ŸæœåŠ¡
- 22: SSH
- 80: Nginx HTTP
- 443: Nginx HTTPS

## é¡¹ç›® A
- 3001: å‰ç«¯å®¹å™¨
- 4001: åç«¯å®¹å™¨
- 3306: MySQL æ•°æ®åº“

## é¡¹ç›® B
- 3002: å‰ç«¯å®¹å™¨
- 4002: åç«¯å®¹å™¨
- 3307: MySQL æ•°æ®åº“

## é¡¹ç›® C
- 3003: å‰ç«¯å®¹å™¨

## é¡¹ç›® D
- 4003: åç«¯å®¹å™¨

## é¢„ç•™ç«¯å£
- 3004-3099: å‰ç«¯é¡¹ç›®é¢„ç•™
- 4004-4099: åç«¯é¡¹ç›®é¢„ç•™
```

---

## ğŸ”— ç›¸å…³é“¾æ¥

### å‰ç½®çŸ¥è¯†
- [Docker æ ¸å¿ƒæ¦‚å¿µ](../03-æœåŠ¡ç«¯/04-éƒ¨ç½²ä¸è¿ç»´/å®¹å™¨åŒ–/Docker/01-åŸºç¡€å…¥é—¨/æ ¸å¿ƒæ¦‚å¿µ.md) â€” Docker åŸºç¡€
- [Nginx å¤šé¡¹ç›®é…ç½®](../03-æœåŠ¡ç«¯/02-WebæœåŠ¡å™¨/nginx/å¤šé¡¹ç›®é…ç½®ä¸éƒ¨ç½²å®è·µ.md) â€” Nginx é…ç½®
- [Docker Compose](../03-æœåŠ¡ç«¯/04-éƒ¨ç½²ä¸è¿ç»´/å®¹å™¨åŒ–/Docker/05-Docker-Compose/å¤šæœåŠ¡ç¼–æ’å®è·µ.md) â€” å¤šæœåŠ¡ç¼–æ’

### è¿›é˜¶å­¦ä¹ 
- [è…¾è®¯äº‘éƒ¨ç½²](../03-æœåŠ¡ç«¯/04-éƒ¨ç½²ä¸è¿ç»´/äº‘å¹³å°éƒ¨ç½²/è…¾è®¯äº‘éƒ¨ç½².md) â€” äº‘å¹³å°éƒ¨ç½²å®è·µ
- [React å­è·¯å¾„éƒ¨ç½²](../03-æœåŠ¡ç«¯/02-WebæœåŠ¡å™¨/nginx/React-é¡¹ç›®å­è·¯å¾„éƒ¨ç½²è§£å†³æ–¹æ¡ˆ.md) â€” å‰ç«¯å­è·¯å¾„éƒ¨ç½²

---

**æœ€åæ›´æ–°**ï¼š2026-01-28  
**ç»´æŠ¤è§„èŒƒ**ï¼šæ¯æ¬¡æ–°å¢é¡¹ç›®æ—¶ï¼Œæ›´æ–°ç«¯å£åˆ†é…è¡¨å’Œ Nginx é…ç½®

---

#éƒ¨ç½² #Docker #Nginx #åå‘ä»£ç† #å¤šé¡¹ç›®éƒ¨ç½² #ç«¯å£ç®¡ç† #è…¾è®¯äº‘ #Ubuntu