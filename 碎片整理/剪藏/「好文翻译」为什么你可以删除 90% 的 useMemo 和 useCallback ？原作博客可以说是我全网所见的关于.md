
[ã€Œå¥½æ–‡ç¿»è¯‘ã€ä¸ºä»€ä¹ˆä½ å¯ä»¥åˆ é™¤ 90% çš„ useMemo å’Œ useCallback ï¼ŸåŸä½œåšå®¢å¯ä»¥è¯´æ˜¯æˆ‘å…¨ç½‘æ‰€è§çš„å…³äº - æ˜é‡‘](https://juejin.cn/post/7251802404877893689)

## è¯‘è€…å‰è¨€

ä¹‹å‰å‘äº†ä¸€æ¡æ˜é‡‘æ²¸ç‚¹ï¼š

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/02a12444e43949f38fe9d3587801e52d~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

ä¸‹é¢æœ‰åŒå­¦åæ§½çº¯è‹±æ–‡ï¼Œæˆ‘é‚æœ‰äº†ç¿»è¯‘çš„æƒ³æ³•ã€‚ç¿»è¯‘å·²å¾—åˆ°åŸä½œè€…å…è®¸ï¼ŒåŸæ–‡åœ°å€è§ä¸‹ã€‚ä½œè€…åšå®¢ä¸­è¿˜æœ‰è®¸å¤šå¥½æ–‡ç« ï¼Œè‹±æ–‡è¿˜è¡Œçš„è¯»è€…å¯ä»¥å»çœ‹çœ‹ï¼Œå¯ä»¥è¯´æ˜¯æˆ‘å…¨ç½‘æ‰€è§çš„å…³äº React æ€§èƒ½ä¼˜åŒ–æ–¹é¢æœ€å¥½çš„æ–‡ç« ï¼ˆè¯„è®ºåŒºä¹Ÿææœ‰è¥å…»ï¼Œä¸è¦é”™è¿‡ï¼‰ã€‚å¦‚æœè‹±æ–‡ä¸å¥½ï¼Œä¹Ÿæ²¡å…³ç³»ï¼Œå¦‚æœæœ¬æ–‡å—æ¬¢è¿ï¼Œæˆ‘åé¢ä¹Ÿä¼šè€ƒè™‘ç»§ç»­ç¿»è¯‘ä¸‹å»ã€‚

[www.developerway.com/posts/how-tâ€¦](https://link.juejin.cn/?target=https%3A%2F%2Fwww.developerway.com%2Fposts%2Fhow-to-use-memo-use-callback "https://www.developerway.com/posts/how-to-use-memo-use-callback")

ä½œè€…æ˜¯ï¼šNadia Makarevich

## ä¸å¤šåºŸè¯ï¼Œæ­£æ–‡å¼€å§‹

å¦‚<mark style="background: #CACFD9A6;">æœä½ ä¸æ˜¯ä¸€ä¸ª </mark>React çº¯æ–°æ‰‹ï¼Œé‚£ä¹ˆä½ å¤§æ¦‚å¯¹ `useMemo` å’Œ `useCallback` å·²ç»æ¯”è¾ƒç†Ÿæ‚‰äº†ã€‚å¦‚æœä½ åœ¨è´Ÿè´£å¼€å‘æˆ–ç»´æŠ¤ä¸€ä¸ªä¸­ç­‰è§„æ¨¡æˆ–å¤§è§„æ¨¡çš„åº”ç”¨ï¼Œä½ æœ‰å¯èƒ½å°†ä½ çš„åº”ç”¨ç¨‹åºçš„æŸäº›éƒ¨åˆ†åæ§½ä¸º "éš¾ä»¥ç†è§£çš„ `useMemo` å’Œ `useCallbacks` é“¾æ¡ï¼Œæ— æ³•é˜…è¯»å’Œè°ƒè¯•"ã€‚

è¿™äº› hooks ä¼¼ä¹æœ‰ä¸€ç§ä¸å—æ§åˆ¶è‡ªè¡Œæ‰©æ•£çš„é­”åŠ›ï¼Œç›´åˆ°å®ƒä»¬å®Œå…¨æ§åˆ¶ä½ çš„ä»“åº“ã€‚ä½ ä¼šå‘ç°ï¼Œä½ è‡ªå·±ï¼Œä»¥åŠä½ èº«è¾¹çš„åŒäº‹ï¼Œéƒ½æ­£åœ¨å››é¢å…«æ–¹å­œå­œä¸å€¦åœ°å†™ä¸‹å®ƒä»¬ã€‚

ä½ çŸ¥é“ä»¤äººæ‚²ä¼¤çš„ä¸€ç‚¹æ˜¯ä»€ä¹ˆå—ï¼Ÿè¿™äº›éƒ½æ˜¯**å®Œå®Œå…¨å…¨çš„æ— ç”¨åŠŸ**ã€‚ä½ å½“ä¸‹å°±å¯ä»¥åˆ é™¤ä½ ä»£ç ä¸­è‡³å°‘ 90% çš„ `useMemo` å’Œ `useCallback` ï¼Œä¸æ­¤åŒæ—¶ä½ çš„åº”ç”¨è·‘èµ·æ¥å®Œå…¨ OKï¼Œç”šè‡³è¿˜æ¯”åŸæ¥å¿«äº†é‚£ä¹ˆä¸€ä¸¢ä¸¢ã€‚ä¸è¦è¯¯ä¼šæˆ‘çš„æ„æ€ï¼Œæˆ‘ä¸æ˜¯è¯´ `useMemo` å’Œ `useCallback` å®Œå…¨æ²¡ç”¨ã€‚åªæ˜¯ä»–ä»¬çš„ç”¨é€”åªè¢«é™åˆ¶åœ¨å°‘æ•°éå¸¸ç‰¹æ®Šå¹¶ä¸”ç¡®å®šçš„åœºæ™¯ä¸‹ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¤§éƒ¨åˆ†æ—¶é—´é‡Œæˆ‘ä»¬éƒ½åœ¨æ¯«æ— æ„ä¹‰åœ°æŠŠä¸šåŠ¡ä»£ç åŒ…è£¹åœ¨å®ƒä»¬é‡Œé¢ã€‚

è¿™å°±æ˜¯æˆ‘ä»Šå¤©è¦è¯´çš„ï¼šå¼€å‘è€…ä¼šçŠ¯å“ªäº›å’Œ `useMemo` ä¸ `useCallback` æœ‰å…³çš„é”™è¯¯ï¼Ÿè¿™ä¸¤ä¸ª hooks çš„çœŸå®ç›®çš„æ˜¯ä»€ä¹ˆï¼Œå¹¶ä¸”æˆ‘ä»¬è¯¥å¦‚ä½•æ°å½“åœ°ä½¿ç”¨å®ƒä»¬ã€‚

æœ‰ä¸¤ä¸ªä¸»è¦åŸå› å¯¼è‡´äº†è¿™ä¸¤ä¸ª hooks æ¶å¿ƒåœ°å‘å››é¢å…«æ–¹æ‰©æ•£ï¼š

- ç¼“å­˜ï¼ˆmemorizeï¼‰ propsï¼Œä»è€Œé˜²æ­¢ç»„ä»¶é‡æ¸²æŸ“(re-render)
- ç¼“å­˜æŸäº›å€¼ï¼Œä»è€Œé¿å…åœ¨æ¯æ¬¡é‡æ¸²æŸ“æ—¶æ‰§è¡Œå¼€é”€æ˜‚è´µçš„è®¡ç®—ä»»åŠ¡

æˆ‘ä»¬å°†åœ¨ä¸‹é¢çš„æ–‡ç« é‡Œä»”ç»†å®¡è§†è¿™ä¸¤ä¸ªåŸå› ï¼Œä½†ç¬¬ä¸€ç‚¹æ˜¯ï¼š`useMemo` å’Œ `useCallback` çš„ç›®çš„åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ

## æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦ useMemo å’Œ useCallback ï¼Ÿ

ç­”æ¡ˆå¾ˆç®€å•ï¼šåœ¨æ¯æ¬¡**é‡æ¸²æŸ“ä¹‹é—´**ç¼“å­˜æ•°æ®ã€‚å¦‚æœä¸€ä¸ªå€¼æˆ–å‡½æ•°è¢«åŒ…è£¹åœ¨è¿™ä¸¤ä¸ª hooks ä¸­ï¼Œreact å°±ä¼šåœ¨é¦–æ¬¡æ¸²æŸ“æ—¶ç¼“å­˜è¿™ä¸ªå€¼æˆ–å‡½æ•°ã€‚åœ¨æ¥ä¸‹æ¥çš„æ¯æ¬¡é‡æ¸²æŸ“æ—¶ï¼Œéƒ½ä¼šè¿”å›è¿™ä¸ªç¼“å­˜çš„å€¼ã€‚å¦‚æœä¸ä½¿ç”¨å®ƒä»¬ï¼Œæ‰€æœ‰éåŸå§‹ç±»å‹çš„å€¼ï¼Œå¦‚ `array`ã€`object`ï¼Œæˆ– `function`ï¼Œéƒ½ä¼šåœ¨æ¯ä¸€æ¬¡é‡æ¸²æŸ“æ—¶è¢«å½»åº•é‡æ–°åˆ›å»ºã€‚

å¦‚æœä½ éœ€è¦åœ¨æ¯æ¬¡é‡æ¸²æŸ“æ—¶æ¯”è¾ƒè¿™äº›å€¼ï¼Œé‚£ä¹ˆç¼“å­˜å®ƒä»¬æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚è¿™å…¶å®å’Œæ™®é€šçš„ javascript æ²¡ä»€ä¹ˆåŒºåˆ«ï¼š

```
const a = { "test": 1 };
const b = { "test": 1'};
console.log(a === b); // å€¼ä¸º false
const c = a; // "c" ä»…ä»…æ˜¯ "a" çš„å¼•ç”¨
console.log(a === c); // å€¼ä¸º true
```

æˆ–è€…ï¼Œæ›´æ¥è¿‘äºæˆ‘ä»¬çš„å…¸å‹ React åº”ç”¨çš„è¯ï¼Œä¾‹å­æ˜¯è¿™æ ·çš„ï¼š

```
const Component = () => {  
  const a = { test: 1 };
  useEffect(() => {    
    // "a" å°†ä¼šåœ¨æ¯æ¬¡é‡æ¸²æŸ“æ—¶è¢«æ¯”è¾ƒ
  }, [a]);
  // ä½ å‰©ä¸‹çš„ä»£ç 
};
```

`a` æ˜¯ `useEffect` hook çš„ä¾èµ–é¡¹ã€‚åœ¨ `Component` çš„æ¯æ¬¡é‡æ¸²æŸ“æ—¶ï¼Œ `React` éƒ½ä¼šæŠŠå®ƒä¸çš„å€¼ä¸ä¸Šæ¬¡æ¸²æŸ“æ—¶çš„å€¼åšæ¯”è¾ƒ. `a` æ˜¯ä¸€ä¸ªåœ¨ `Component` å†…éƒ¨å®šä¹‰çš„ `object`ï¼Œè¿™æ„å‘³ç€åœ¨æ¯æ¬¡é‡æ¸²æŸ“æ—¶ï¼Œ`a` éƒ½ä¼šè¢«å®Œå®Œå…¨å…¨åœ°é‡æ–°åˆ›å»º(re-create)ã€‚å› æ­¤ï¼Œæ¯”è¾ƒâ€é‡æ¸²æŸ“ä¹‹å‰çš„ `a`â€œ å’Œ â€é‡æ¸²æŸ“ä¹‹åçš„ `a`â€œï¼Œç»“æœéƒ½ä¼šæ˜¯ `false`ï¼Œæ‰€ä»¥è¢« `useEffect` åŒ…è£¹çš„å‡½æ•°ä¹Ÿå°†ä¼šåœ¨æ¯æ¬¡é‡æ¸²æŸ“çš„è¿‡ç¨‹ä¸­è§¦å‘è°ƒç”¨ã€‚

ä¸ºäº†é¿å…ä»¥ä¸Šç»“æœï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ `a` åŒ…è£¹åœ¨ `useMemo`Â ä¸­ï¼š

```
const Component = () => {
  // åœ¨æ¯æ¬¡é‡æ¸²æŸ“ä¹‹é—´ä¿å­˜ a
  const a = useMemo(() => ({ test: 1 }), []);

  useEffect(() => {
    // åªæœ‰å½“ a çš„å€¼çœŸå®å‘ç”Ÿæ”¹å˜æ—¶æ‰ä¼šè§¦å‘
  }, [a]);
  // ä½ å‰©ä¸‹çš„ä»£ç 
};
```

ç°åœ¨ `useEffect` ä¸­çš„æ–¹æ³•åªæœ‰åœ¨ `a` å€¼ç¡®å®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™æ‰ä¼šè§¦å‘ï¼ˆä¸è¿‡åœ¨æœ¬ä¾‹ä¸­è¿™ä¸ä¼šå‘ç”Ÿï¼‰ã€‚

`useCallback` ä¹Ÿæ˜¯åŒæ ·çš„é“ç†ï¼Œåªä¸è¿‡å®ƒå¯¹äºç¼“å­˜å‡½æ•°æ›´æœ‰ç”¨ï¼š

```
const Component = () => {
  // åœ¨æ¯æ¬¡é‡æ¸²æŸ“ä¹‹é—´ä¿å­˜ onClick æ–¹æ³•
  const fetch = useCallback(() => {
    console.log('fetch some data here');  
  }, []);
  useEffect(() => {    
    // åªæœ‰å½“ fetch çš„å€¼çœŸçš„å‘ç”Ÿè¯¥è¡¨çš„æ—¶å€™æ‰ä¼šè§¦å‘
    fetch();  
  }, [fetch]);
  // ä½ å‰©ä¸‹çš„ä»£ç 
};
```

åœ¨è¿™é‡Œï¼Œéœ€è¦è®°ä½çš„æœ€é‡è¦çš„ä¸€ä»¶äº‹æ˜¯ï¼Œ`useMemo` å’Œ `useCallback` åªæœ‰åœ¨**é‡æ¸²æŸ“çš„è¿‡ç¨‹ä¸­**æ‰æœ‰ç”¨ã€‚åœ¨åˆå§‹æ¸²æŸ“è¿‡ç¨‹ä¸­ï¼Œå®ƒä»¬ä¸ä»…æ˜¯æ— ç”¨çš„ï¼Œç”šè‡³æ˜¯æœ‰å®³çš„ï¼šå®ƒä»¬ä¼šè®© React åšå¾ˆå¤šé¢å¤–çš„å·¥ä½œã€‚è¿™æ„å‘³ç€ä½ çš„åº”ç”¨åœ¨åˆå§‹æ¸²æŸ“è¿‡ç¨‹ä¸­ä¼š**ç¨ç¨æ›´æ…¢**ä¸€äº›ã€‚å¹¶ä¸”ï¼Œå¦‚æœä½ çš„åº”ç”¨æœ‰æ•°ç™¾ä¸ªè¿™äº› hooks åˆ†å¸ƒåœ¨å„å¤„ï¼Œé‚£ä¹ˆè¿™äº›è½»å¾®çš„å½±å“åˆå§‹æ¸²æŸ“çš„ä½œç”¨å°±å¯ä»¥è¢«è§‚å¯Ÿåˆ°ã€‚

## ç¼“å­˜ props ä»¥é¿å…é‡æ¸²æŸ“

æ—¢ç„¶æˆ‘ä»¬å·²ç»çŸ¥é“äº†è¿™ä¿© hooks çš„ä½œç”¨ï¼Œè®©æˆ‘ä»¬è€ƒå¯Ÿä¸€ä¸‹å®ƒä»¬ã€‚å…¶ä¸­æœ€é‡è¦çš„ä¸€ç‚¹ï¼Œä¹Ÿæ˜¯æœ€å¸¸è¢«ç”¨åˆ°çš„ä¸€ç‚¹ï¼Œå°±æ˜¯ç¼“å­˜ props ä»¥é¿å…é‡æ¸²æŸ“ã€‚å¦‚æœä½ çš„åº”ç”¨ä¸­ä¹Ÿå­˜åœ¨ç±»ä¼¼ä¸‹é¢çš„ä»£ç ç‰‡æ®µï¼Œè¯·ç»™æˆ‘å¹ä¸ªå£å“¨ï¼š

1. æŠŠ onClick åŒ…è£¹åœ¨ useCallback ä¸­ä»¥é¿å…é‡æ¸²æŸ“
    
    ```
    const Component = () => {
      const onClick = useCallback(
        () => {    /* do something */  }, []
      );
      return (
        <>
          <button onClick={onClick}>Click me</button>
         ... // å…¶ä»–ç»„ä»¶  
        </>  
      );
    };
    ```
    
2. æŠŠ onClick åŒ…è£¹åœ¨ useCallback ä¸­ä»¥é¿å…é‡æ¸²æŸ“
    
    ```
    const Item = ({ item, onClick, value }) => <button onClick={onClick}>
      {item.name}</button>;
    const Component = ({ data }) => {
      const value = { a: someStateValue };
      const onClick = useCallback(() => {    /* do something on click */  }, []);
      return (
        <>
          {data.map((d) => (
            <Item item={d} onClick={onClick} value={value} />
          ))}
        </>
      );
    };
    ```
    
3. æŠŠ value åŒ…è£¹åœ¨ useMemo ä¸­ï¼Œå› ä¸ºå®ƒæ˜¯è¢«ç¼“å­˜çš„ onClick çš„ä¾èµ–ï¼š
    
    ```
    const Item = ({ item, onClick }) => <button onClick={onClick}>
      {item.name}
    </button>;
    const Component = ({ data }) => {
      const value = useMemo(() => ({ a: someStateValue }), [someStateValue]);
      const onClick = useCallback(() => {    console.log(value);  }, [value]);
      return (
        <>
          {data.map((d) => (<Item item={d} onClick={onClick} />))}
        </>
      );
    };
    ```
    

ä»¥ä¸Šæ˜¯å¦å°±æ˜¯ä½ æ›¾ç»å¹²è¿‡çš„ï¼Œæˆ–è€…è§åˆ«äººå¹²è¿‡çš„äº‹å„¿ï¼Ÿä½ æ˜¯å¦åŒæ„ hook è§£å†³äº†ä½ æƒ³è®©å®ƒä»¬è§£å†³çš„é—®é¢˜ï¼Ÿå¦‚æœä½ çš„ç­”æ¡ˆæ˜¯ yesï¼Œé‚£ä¹ˆæ­å–œäº†ï¼Œ`useMemo` å’Œ `useCallback` åŠ«æŒäº†ä½ ï¼Œå¹¶ä¸”æ¯«æ— å¿…è¦åœ°æ§åˆ¶äº†ä½ çš„ç”Ÿæ´»ã€‚åœ¨ä»¥ä¸Šæ‰€æœ‰çš„ä¾‹å­é‡Œï¼Œè¿™ä¸¤ä¸ª hooks éƒ½**æ¯«æ— ä½œç”¨ã€‚**å®ƒä»¬è®©ä»£ç å˜å¾—å¤æ‚ï¼Œæ‹–æ…¢äº†åˆå§‹æ¸²æŸ“ï¼Œå´æ²¡æœ‰é˜»æ­¢ä»»ä½•äº‹æƒ…ï¼ˆæŒ‡é‡æ¸²æŸ“ï¼‰ã€‚

å¦‚æœæƒ³è¦çŸ¥é“ä¸ºä»€ä¹ˆï¼Œæˆ‘ä»¬éœ€è¦è®°ä½ä¸€ä»¶æœ‰å…³ React å¦‚ä½•å·¥ä½œçš„æœ€é‡è¦çš„äº‹ï¼šä¸ºä»€ä¹ˆä¸€ä¸ªç»„ä»¶ä¼šé‡æ¸²æŸ“å®ƒè‡ªå·±ã€‚

## ä¸ºä»€ä¹ˆä¸€ä¸ªç»„ä»¶ä¼šé‡æ¸²æŸ“å®ƒè‡ªå·±ï¼Ÿ

â€œå½“ state æˆ–è€… prop å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œç»„ä»¶å°±ä¼šé‡æ¸²æŸ“è‡ªå·±â€ï¼Œè¿™æ˜¯ä¸€ä¸ªæœ‰å…³ React çš„å…±è¯†ã€‚ç”šè‡³ [React å®˜æ–¹æ–‡æ¡£](https://link.juejin.cn/?target=https%3A%2F%2Flegacy.reactjs.org%2Fdocs%2Freact-component.html%23updating "https://legacy.reactjs.org/docs/react-component.html#updating")ä¹Ÿæåˆ°äº†è¿™ä¸€ç‚¹ã€‚æˆ‘è®¤ä¸ºè¿™ä¸€ç”³æ˜å¾—å‡ºäº†ä¸€ä¸ªé”™è¯¯çš„æ¨è®ºï¼šâ€œå¦‚æœ prop æ²¡æœ‰å˜åŒ–ï¼ˆæ¯”å¦‚ï¼Œè¢«ç¼“å­˜äº†ï¼‰ï¼Œé‚£ç»„ä»¶å°±ä¸ä¼šé‡æ¸²æŸ“ã€‚â€ï¼ˆè¯‘è€…æ³¨ï¼šä»¥ä¸Šæ¨è®ºæ˜¯ä¸€ä¸ªå…¸å‹çš„é€»è¾‘é”™è¯¯ï¼ŒA æ˜¯ B çš„å……åˆ†æ¡ä»¶ï¼Œå¹¶ä¸æ„å‘³ç€ !A æ˜¯ !B çš„å……åˆ†æ¡ä»¶ã€‚ï¼‰

ä¸Šé¢è¿™å¥è¯ä¹‹æ‰€ä»¥æ˜¯é”™è¯¯çš„ï¼Œå°±æ˜¯å› ä¸ºè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„åŸå› ä¼šå¯¼è‡´ç»„ä»¶é‡æ¸²æŸ“ï¼š**å½“ç»„ä»¶çš„çˆ¶ç»„ä»¶é‡æ¸²æŸ“ï¼**

æˆ–è€…è¯´ï¼Œå¦‚æœæˆ‘ä»¬ä»ç›¸åçš„è§’åº¦è€ƒè™‘ï¼šå½“ä¸€ä¸ªç»„ä»¶é‡æ¸²æŸ“å®ƒè‡ªå·±çš„æ—¶å€™ï¼Œå®ƒä¹Ÿä¼šåŒæ—¶é‡æ¸²æŸ“å®ƒçš„ childrenã€‚çœ‹ä¸€ä¸‹ä¸‹é¢çš„ä»£ç ç¤ºä¾‹ï¼š

```
const App = () => {
  const [state, setState] = useState(1);
  return (
    <div className="App">
      <button onClick={() => setState(state + 1)}>
        click to re-render {state}
      </button>
      <br />
      <Page />
    </div>
  );
};
```

`App` ç»„ä»¶æœ‰ä¸€äº› stateï¼Œä¹Ÿæœ‰ä¸€äº› childrenï¼ŒåŒ…æ‹¬ `Page` ç»„ä»¶ã€‚æ‰“ä¸è¿‡ button è¢«ç‚¹å‡»çš„æ—¶å€™ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼ŸState ä¼šå˜åŒ–ï¼Œå®ƒä¼šå¯¼è‡´ App çš„é‡æ¸²æŸ“ï¼Œå¹¶ä¸”ä¼šè§¦å‘å®ƒé‡æ¸²æŸ“å®ƒæ‰€æœ‰çš„ childrenï¼ŒåŒ…æ‹¬ `Page` ç»„ä»¶ã€‚åœ¨è¿™è¿‡ç¨‹ä¸­ `Page` ç»„ä»¶ç”šè‡³æ²¡æœ‰ propsï¼

ç°åœ¨ï¼Œåœ¨ `Page` ç»„ä»¶ä¸­ï¼Œå¦‚æœæˆ‘ä»¬å­˜åœ¨ä¸€ä¸ªè¿™æ ·çš„ childrenï¼š

```
const Page = () => <Item />;
```

å®ƒå®Œå…¨æ˜¯ç©ºçš„ï¼Œæ—¢æ²¡æœ‰ stateï¼Œä¹Ÿæ²¡æœ‰ propsã€‚ä½†æ˜¯å½“ App é‡æ¸²æŸ“çš„æ—¶å€™ï¼Œ Page ç»„ä»¶ä¾æ—§ä¼šé‡æ¸²æŸ“ï¼Œå¹¶è¿åŒé‡æ¸²æŸ“å®ƒå†…éƒ¨çš„ Item ç»„ä»¶ã€‚App ç»„ä»¶çš„ state å˜åŒ–è§¦å‘äº†åº”ç”¨å†…çš„ä¸€æ•´ä¸ªé‡æ¸²æŸ“é“¾æ¡ã€‚å¯ä»¥åœ¨è¿™ä¸ª codesandbox ä¸­çœ‹åˆ°[å®Œæ•´ç¤ºä¾‹](https://link.juejin.cn/?target=https%3A%2F%2Fcodesandbox.io%2Fs%2Fparent-children-re-renders-gihtcw%3Ffile%3D%2Fsrc%2FApp.tsx "https://codesandbox.io/s/parent-children-re-renders-gihtcw?file=/src/App.tsx")ã€‚

å”¯ä¸€å»æ‰“æ–­è¿™é“¾æ¡çš„åŠæ³•ï¼Œæ˜¯å»ç¼“å­˜ç»„ä»¶å†…çš„å­ç»„ä»¶ã€‚æˆ‘ä»¬èƒ½å¤Ÿç”¨ `useMemo` åšåˆ°è¿™äº›ï¼Œæ›´å¥½çš„æ–¹æ³•åˆ™æ˜¯ä½¿ç”¨ [React.memo](https://link.juejin.cn/?target=https%3A%2F%2Flegacy.reactjs.org%2Fdocs%2Freact-api.html%23reactmemo "https://legacy.reactjs.org/docs/react-api.html#reactmemo") å·¥å…·å‡½æ•°ã€‚åªæœ‰å½“ç»„ä»¶è¢«åŒ…è£¹åœ¨å…¶ä»¥å†…æ—¶ï¼ŒReact æ‰ä¼šåœ¨é‡æ¸²æŸ“ä¹‹å‰å…ˆåœä¸‹æ¥æ£€æŸ¥ä¸€ä¸‹ props æ˜¯å¦äº§ç”Ÿäº†å˜åŒ–ã€‚

è¿™æ ·ç¼“å­˜ä¸€ä¸ªç»„ä»¶ï¼š

```
const Page = () => <Item />;
const PageMemoized = React.memo(Page);
```

åœ¨ä¸€ä¸ªåŒ…å« state çš„ App ä¸­ä½¿ç”¨å®ƒï¼š

```
const App = () => {
  const [state, setState] = useState(1);
  return (
    ... // same code as before
    <PageMemoized />
  );
};
```

åœ¨ä»¥ä¸Šï¼Œå¹¶ä¸”**åªæœ‰**åœ¨ä»¥ä¸Šåœºæ™¯ä¸­ï¼Œprops æ˜¯å¦è¢«ç¼“å­˜æ‰æ˜¯é‡è¦çš„ã€‚

è®©æˆ‘ä»¬æƒ³è±¡ `Page` ç»„ä»¶å­˜åœ¨ä¸€ä¸ª `onClick` propï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªå‡½æ•°ã€‚å¦‚æœæˆ‘åœ¨ä¸ç¼“å­˜è¿™ä¸ªå‡½æ•°çš„æƒ…å†µä¸‹ï¼ŒæŠŠå®ƒä¼ é€’ç»™ `Page`ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ

```
const App = () => {
  const [state, setState] = useState(1);
  const onClick = () => {
    console.log('Do something on click');
  };
  return (
    // ä¸ç®¡ onClick æœ‰æ²¡æœ‰ç¼“å­˜ï¼Œpage éƒ½ä¼šé‡æ¸²æŸ“
    <Page onClick={onClick} />
  );
};
```

`App` ä¼šé‡æ¸²æŸ“ï¼ŒReact ä¼šåœ¨ App çš„ children ä¸­æ‰¾åˆ° `Page` ç»„ä»¶ï¼Œå¹¶ä¸”é‡æ¸²æŸ“å®ƒã€‚`onClick` æ˜¯å¦åŒ…è£¹åœ¨ `useCallback` ä¸­å¹¶ä¸é‡è¦ã€‚

é‚£ä¹ˆå¦‚æœæˆ‘ä»¬æŠŠ `Page` ç»„ä»¶ç¼“å­˜èµ·æ¥äº†å‘¢ï¼Ÿ

```
const PageMemoized = React.memo(Page);
const App = () => {
  const [state, setState] = useState(1);
  const onClick = () => {
    console.log('Do something on click');
  };
  return (
    // å› ä¸º onClick æ²¡æœ‰ç¼“å­˜ï¼ŒPageMemoized ã€Œå°†ä¼šã€é‡æ¸²æŸ“
    <PageMemoized onClick={onClick} />
  );
};
```

`App` ä¼šé‡æ¸²æŸ“ï¼ŒReact ä¼šåœ¨å®ƒçš„ children ä¸­å‘ç°Â `PageMemoized` ç»„ä»¶ï¼Œå¹¶æ„è¯†åˆ°å®ƒè¢« `React.memo` æ–¹æ³•åŒ…è£¹ï¼Œè¿™ä¼šæ‰“æ–­é‡æ¸²æŸ“é“¾æ¡ï¼ŒReact ä¼šäº‹å…ˆæ£€æŸ¥è¿™ä¸ªç»„ä»¶çš„ props æ˜¯å¦æœ‰å˜åŒ–ã€‚åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæ—¢ç„¶ `onClick` æ˜¯ä¸€ä¸ªæœªè¢«ç¼“å­˜çš„å‡½æ•°ï¼Œprops æ¯”è¾ƒçš„ç»“æœå°±ä¼šæ˜¯ `false`ï¼Œé‚£ä¹ˆÂ `PageMemoized` ç»„ä»¶å°±ä¼šé‡æ¸²æŸ“å®ƒè‡ªå·±ã€‚

æœ€åï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ useCallback çš„åº”ç”¨ï¼š

```
const PageMemoized = React.memo(Page);
const App = () => {
  const [state, setState] = useState(1);
  const onClick = useCallback(
    () => { console.log('Do something on click');  }, 
    []
  );
  return (
    // PageMemoized å› ä¸º onClick è¢«ç¼“å­˜äº†ï¼Œå°†ã€Œä¸ä¼šã€é‡æ¸²æŸ“
    <PageMemoized onClick={onClick} />
  );
};
```

ç°åœ¨ï¼Œå½“ React æ£€æŸ¥Â `PageMemoized` çš„ props æœ‰æ— å˜åŒ–æ—¶ï¼Œ`onClick` å°†ä¼šä¿æŒä¸å˜ï¼Œåªæœ‰åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒÂ `PageMemoized` æ‰ä¸ä¼šé‡æ¸²æŸ“ã€‚

å¦‚æœæˆ‘ç»™Â PageMemoized ç»„ä»¶å¢åŠ å¦ä¸€ä¸ªéç¼“å­˜çš„å€¼ï¼Œå°†ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿå°±åƒä¸‹é¢çš„åœºæ™¯ï¼š

```
const PageMemoized = React.memo(Page);
const App = () => {
  const [state, setState] = useState(1);
  const onClick = useCallback(
    () => { console.log('Do something on click'); },
    []
  );
  return (
    // å› ä¸º value æ²¡æœ‰è¢«ç¼“å­˜ï¼Œpage ã€Œå°†ä¼šã€é‡æ¸²æŸ“
    <PageMemoized onClick={onClick} value={[1, 2, 3]} />
  );
};
```

React åœä¸‹æ¥æ£€æŸ¥Â `PageMemoized` ç»„ä»¶çš„ props æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œ`onClick` ç¡®å®æ²¡å˜åŒ–ï¼Œä½†æ˜¯ `value` å˜åŒ–äº†ï¼Œé‚£ä¹ˆÂ `PageMemoized`Â è¿˜æ˜¯ä¼šé‡æ¸²æŸ“ï¼å¯ä»¥åœ¨[è¿™é‡Œ](https://link.juejin.cn/?target=https%3A%2F%2Fcodesandbox.io%2Fs%2Feverything-memoized-8oltqg%3Ffile%3D%2Fsrc%2FApp.tsx "https://codesandbox.io/s/everything-memoized-8oltqg?file=/src/App.tsx")çœ‹å®Œæ•´ç¤ºä¾‹ï¼Œè¯•ä¸€ä¸‹åˆ é™¤ç¼“å­˜ï¼Œçœ‹çœ‹ç»„ä»¶é‡Œçš„æ¯æ ·ä¸œè¥¿æ˜¯å¦‚ä½•é‡æ¸²æŸ“çš„ã€‚

æ€è€ƒä¸€ä¸‹ä»¥ä¸Šç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼Œåªæœ‰åœ¨å”¯ä¸€çš„ä¸€ç§åœºæ™¯ä¸‹ï¼Œç¼“å­˜ props æ‰æ˜¯æœ‰æ„ä¹‰çš„ï¼š**å½“ç»„ä»¶çš„æ¯ä¸€ä¸ª propï¼Œä»¥åŠç»„ä»¶æœ¬èº«è¢«ç¼“å­˜çš„æ—¶å€™**ã€‚

å¦‚æœç»„ä»¶ä»£ç é‡Œæœ‰ä»¥ä¸‹æƒ…å½¢ï¼Œæˆ‘ä»¬å¯ä»¥æ¯«æ— å¿ƒç†è´Ÿæ‹…åœ°åˆ æ‰ `useMemo` å’Œ `useCallback`ï¼š

- å®ƒä»¬è¢«ä½œä¸º attributes ï¼Œç›´æ¥åœ°æˆ–ä½œä¸ºä¾èµ–æ ‘çš„ä¸Šå±‚ï¼Œè¢«ä¼ é€’åˆ°æŸä¸ª DOM ä¸Š
- å®ƒä»¬è¢«ä½œä¸º propsï¼Œç›´æ¥åœ°æˆ–ä½œä¸ºä¾èµ–æ ‘çš„ä¸Šå±‚ï¼Œè¢«ä¼ é€’åˆ°æŸä¸ªæœªè¢«ç¼“å­˜çš„ç»„ä»¶ä¸Š
- å®ƒä»¬è¢«ä½œä¸º propsï¼Œç›´æ¥åœ°æˆ–ä½œä¸ºä¾èµ–æ ‘çš„ä¸Šå±‚ï¼Œè¢«ä¼ é€’åˆ°æŸä¸ªç»„ä»¶ä¸Šï¼Œè€Œé‚£ä¸ªç»„ä»¶è‡³å°‘æœ‰ä¸€ä¸ª prop æœªè¢«ç¼“å­˜

**ä½†ä¸ºå•¥ä¸ä¿®å¤ç¼“å­˜ï¼ˆæŒ‡ç»™ç»„ä»¶ã€åŠç»„ä»¶æ‰€æœ‰çš„ prop åŠ ä¸Šç¼“å­˜ï¼‰ï¼Œè€Œæ˜¯è¦åˆ æ‰å®ƒä»¬å‘¢ï¼Ÿ**é‚£æ˜¯å› ä¸ºï¼šå¦‚æœä½ å› ä¸ºç»„ä»¶çš„é‡æ¸²æŸ“è€Œå‡ºç°äº†æŸäº›æ€§èƒ½é—®é¢˜ï¼Œä½ è‚¯å®šå·²ç»æ³¨æ„åˆ°ï¼Œå¹¶ä¸”ä¿®å¤æ‰å®ƒä»¬äº†ï¼Œå¯¹å§ï¼Ÿï¼ˆè¯‘è€…æ³¨ï¼šå³ç»™æ‰€æœ‰çš„ prop å’Œç»„ä»¶æœ¬èº«åŠ ä¸Šäº†ç¼“å­˜ï¼Œä¸æ˜¯ä»¥ä¸Šåˆ—å‡ºçš„ä¸‰æƒ…å†µä¹‹ä¸€äº†ï¼‰ã€‚ ğŸ˜‰å‰©ä¸‹çš„æ—¢ç„¶æ²¡æœ‰æ€§èƒ½é—®é¢˜ï¼Œå°±ä¹Ÿæ²¡å¿…è¦å» fix ä»£ç å•¦ï¼ˆç›´æ¥åˆ äº†æ›´å¥½ï¼‰ã€‚åˆ é™¤æ— ç”¨çš„ `useMemo` å’Œ `useCallback` å°†ä¼šç®€åŒ–ä½ çš„ä»£ç ï¼Œå¹¶ä¸”åœ¨åˆæ¬¡æ¸²æŸ“æ—¶ç¨ç¨æé€Ÿï¼ŒåŒæ—¶ä¸ä¼šå¯¹ç°æœ‰çš„é‡æ¸²æŸ“æ€§èƒ½äº§ç”Ÿä»»ä½•è´Ÿé¢å½±å“ã€‚

## åœ¨æ¯æ¬¡é‡æ¸²æŸ“æ—¶é¿å…å¼€é”€å·¨å¤§çš„è¿ç®—

å°±åƒä¸Šæ–‡ä»¥åŠ [React å®˜æ–¹æ–‡æ¡£](https://link.juejin.cn/?target=https%3A%2F%2Flegacy.reactjs.org%2Fdocs%2Fhooks-reference.html%23usememo "https://legacy.reactjs.org/docs/hooks-reference.html#usememo")æåˆ°çš„ï¼Œ`useMemo` æœ€ä¸»è¦çš„ä½œç”¨ï¼Œå°±æ˜¯åœ¨æ¯æ¬¡çš„æ¸²æŸ“è¿‡ç¨‹ä¸­é¿å…å¼€é”€å·¨å¤§çš„è¿ç®—ã€‚åœ¨å™è¿°ä¸­ï¼Œå¹¶æ²¡æœ‰æåˆ°ä»€ä¹ˆç®—æ˜¯â€œå¼€é”€å·¨å¤§â€çš„è¿ç®—ã€‚ç»“æœå°±æ˜¯ï¼Œå¼€å‘è€…å¾€å¾€åœ¨ render æ–¹æ³•ä¸­æ»¥ç”¨ `useMemo`ã€‚åˆ›å»ºä¸€ä¸ªæ–°æ—¥æœŸå¯¹è±¡ï¼Ÿfilerã€æˆ– map ã€æˆ– sort ä¸€ä¸ªæ•°ç»„ï¼Ÿåˆ›å»ºä¸€ä¸ªæ™®é€š object å¯¹è±¡ï¼Ÿéƒ½ç”¨ `useMemo` åŒ…è£¹ä¸€ä¸‹å§ï¼

å¥½å§ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ç»„æ•°å­—ã€‚è€ƒè™‘æˆ‘ä»¬æœ‰ä¸€ä¸ªå›½å®¶åˆ—è¡¨ï¼ˆå¤§æ¦‚æœ‰ 250 ä¸ªå…ƒç´ ï¼‰ï¼Œå¹¶ä¸”æˆ‘ä»¬å¸Œæœ›åœ¨é¡µé¢ä¸Šå±•ç¤ºå®ƒä»¬ï¼Œå¹¶ä¸”å…è®¸ç”¨æˆ·å»æ‰§è¡Œæ’åºæ“ä½œã€‚

```
const List = ({ countries }) => {
  // sorting list of countries here
  const sortedCountries = orderBy(countries, 'name', sort);
  return (
    <>
      {
        sortedCountries.map((country) => (
          <Item country={country} key={country.id} />
        ))
      }
    </>
  );
};
```

é—®é¢˜æ˜¯ï¼šç»™ 250 ä¸ªå…ƒç´ æ’åºå±äºå¼€é”€å·¨å¤§çš„æ“ä½œä¹ˆï¼Ÿæ„Ÿè§‰å¥½åƒæ˜¯ï¼Œä½†åˆ°åº•æ˜¯ä¸æ˜¯å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥å°†å®ƒç”¨ `useMemo` åŒ…è£¹ä»¥é¿å…åœ¨é‡æ¸²æŸ“ä¸­é‡æ–°è®¡ç®—ä¸€éï¼Œæ˜¯å—ï¼Ÿå…¶å®ï¼Œè¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆæ˜¯å¾ˆå®¹æ˜“åº¦é‡çš„ï¼Œä½¿ç”¨æˆ‘ä»¬å¸¸ç”¨çš„ performance api å°±è¡Œäº†ã€‚

```
const List = ({ countries }) => {
  const before = performance.now();
  const sortedCountries = orderBy(countries, 'name', sort);
  // this is the number we're after
  const after = performance.now() - before;
  return (    // same  )
};
```

æœ€ç»ˆç»“æœå¦‚ä½•å‘¢ï¼Ÿå¦‚æœä¸ç¼“å­˜çš„è¯ï¼Œåœ¨è®¾ç½® 6å€ CPU å‡é€Ÿçš„æƒ…å†µä¸‹ï¼ˆè¯‘è€…æ³¨ï¼šChrome å¼€å‘è€…å·¥å…·æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œå…è®¸å¼€å‘è€…æ¨¡æ‹Ÿåœ¨ä½æ€§èƒ½ PC ä¸Šçš„è®¿é—®ä½“éªŒï¼‰ï¼Œç»™ 250 ä¸ªå…ƒç´ æ’åºè€—æ—¶**å°‘äº 2 æ¯«ç§’ã€‚**ä½œä¸ºæ¯”è¾ƒï¼Œæ¸²æŸ“è¿™ä¸ªåˆ—è¡¨â€”â€”ä»…ä»…æ˜¯åŸç”Ÿçš„æŒ‰é’®ä¸Šå¸¦æ–‡å­—â€”â€”å°±æ¶ˆè€—äº† 20 æ¯«ç§’ã€‚å¤šåå€å•Šï¼è¯·çœ‹[å®Œæ•´ç¤ºä¾‹](https://link.juejin.cn/?target=https%3A%2F%2Fcodesandbox.io%2Fs%2Fmeasure-without-memo-tnhggk%3Ffile%3D%2Fsrc%2Fpage.tsx "https://codesandbox.io/s/measure-without-memo-tnhggk?file=/src/page.tsx")ã€‚

åœ¨å®é™…åœºæ™¯ä¸­ï¼Œæ•°ç»„å¾€å¾€æ¯”ç¤ºä¾‹ä¸­çš„æ›´å°ï¼ŒåŒæ—¶æ¸²æŸ“çš„å†…å®¹æ¯”ç¤ºä¾‹ä¸­çš„æ›´å¤æ‚ï¼Œå› æ­¤æ›´æ…¢ã€‚æ‰€ä»¥æ€»çš„æ¥è¯´ã€Œè®¡ç®—ã€ä¸ã€Œæ¸²æŸ“ã€ä¹‹é—´çš„è€—æ—¶å¾€å¾€è¶…è¿‡ 10 å€ã€‚

ä¸å…¶è¯´ç¼“å­˜æ•°ç»„æ“ä½œï¼Œæˆ‘ä»¬æ›´åº”è¯¥ç¼“å­˜çš„æ˜¯å®é™…ä¸Šæ˜¯æœ€è€—æ—¶çš„è®¡ç®—â€”â€”é‡æ¸²æŸ“å¹¶æ›´æ–°ç»„ä»¶ã€‚åƒä¸‹é¢è¿™æ ·ï¼š

```
const List = ({ countries }) => {
  const content = useMemo(() => {
    const sortedCountries = orderBy(countries, 'name', sort);
    return sortedCountries.map((country) =>
      <Item country={country} key={country.id} />
    );
  }, [countries, sort]);
  return content;
};
```

ä»¥ä¸Š `useMemo` æŠŠå¤§çº¦ 20ms çš„é‡æ¸²æŸ“æ—¶é—´ï¼Œå‡å°‘äº†ä¸åˆ° 2msï¼ˆä¹Ÿå°±æ˜¯ 18ms å·¦å³ï¼‰ã€‚

è€ƒè™‘ä»¥ä¸Šäº‹å®ï¼Œæˆ‘æƒ³è¯´çš„å…³äºç¼“å­˜â€å¼€é”€å·¨å¤§â€œæ“ä½œçš„ä¸€æ¡å‡†åˆ™å°±æ˜¯ï¼šé™¤éä½ çœŸçš„è¦æç±»ä¼¼å¤§æ•°é˜¶ä¹˜ï¼Œç–¯ç‹‚é€’å½’ï¼Œå¤§ç´ æ•°åˆ†è§£è¿™æ ·çš„æ“ä½œï¼Œå¦åˆ™å°±åœ¨çº¯ javascript æ“ä½œä¸­æŠŠ `useMemo` åˆ æ‰å§ã€‚é‡æ¸²æŸ“å…ƒç´ æ‰æ˜¯ä½ çš„ç“¶é¢ˆã€‚è¯·åªåœ¨æ¸²æŸ“æ ‘çš„é‡è¦éƒ¨åˆ†ä½¿ç”¨ `useMemo`ã€‚

é—®é¢˜åˆæ¥äº†ï¼Œ**é‚£ä¸ºå•¥ä¸€å®šè¦åˆ æ‰å®ƒä»¬å‘¢**ï¼ŸæŠŠæ‰€æœ‰ä¸œè¥¿ç¼“å­˜èµ·æ¥ä¸æ˜¯æ›´å¥½å—ï¼Ÿå“ªæ€•åªè®©é‡æ¸²æŸ“é€Ÿåº¦æå‡äº† 2msï¼Œè¿™é‡Œæå‡ 2msï¼Œé‚£é‡Œæå‡ 2msï¼Œç´¯åŠ èµ·æ¥å°±å¾ˆå¯è§‚äº†å‘€ã€‚æ¢ä¸ªè§’åº¦çœ‹ï¼Œå¦‚æœå®Œå…¨ä¸å†™ `useMemo`ï¼Œé‚£ä¹ˆåº”ç”¨å°±ä¼šåœ¨è¿™é‡Œæ…¢ 2msï¼Œåœ¨é‚£é‡Œåˆæ…¢ 2msï¼Œå¾ˆå¿«æˆ‘ä»¬çš„åº”ç”¨å°±ä¼šæ¯”å®ƒä»¬åŸæœ¬èƒ½è¾¾åˆ°çš„ç¨‹åº¦æ…¢çš„å¤šäº†ã€‚

å¬èµ·æ¥å¾ˆæœ‰é“ç† ï¼Œå¹¶ä¸”ï¼Œå¦‚æœä¸æ˜¯è€ƒè™‘åˆ°å¦ä¸€ç‚¹çš„è¯ï¼Œä»¥ä¸Šæ¨è®ºç¡®å® 100% è¯´å¾—é€šã€‚è¿™ä¸€ç‚¹ä¾¿æ˜¯ï¼šç¼“å­˜å¹¶ä¸æ˜¯æ¯«æ— å¼€é”€çš„ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨ `useMemo`ï¼Œåœ¨åˆå§‹æ¸²æŸ“è¿‡ç¨‹ä¸­ React å°±éœ€è¦ç¼“å­˜å…¶å€¼äº†â€”â€”è¿™å½“ç„¶ä¹Ÿäº§ç”Ÿè€—æ—¶ã€‚æ²¡é”™ï¼Œè¿™è€—æ—¶å¾ˆå¾®å°ï¼Œåœ¨æˆ‘ä»¬çš„åº”ç”¨ä¸­ï¼Œç¼“å­˜ä¸Šè¿°æåˆ°è¿‡çš„æ’åºå›½å®¶åˆ—è¡¨è€—æ—¶ä¸è¶…è¿‡ 1msã€‚ä½†æ˜¯ï¼**è¿™æ‰ä¼šäº§ç”Ÿè´§çœŸä»·å®çš„å åŠ æ•ˆåº”**ï¼åœ¨åˆå§‹æ¸²æŸ“è®©ä½ çš„åº”ç”¨ç¬¬ä¸€æ¬¡å‘ˆç°åœ¨å±å¹•å‰çš„è¿‡ç¨‹ä¸­ï¼Œå½“å‰é¡µé¢çš„**æ¯ä¸€ä¸ª**å…ƒç´ éƒ½ä¼šç»å†è¿™ä¸€è¿‡ç¨‹ï¼Œè¿™å°†å¯¼è‡´ 10~20 msï¼Œæˆ–æ›´ç³Ÿç³•çš„ï¼Œæ¥è¿‘ 100ms çš„ä¸å¿…è¦çš„å»¶æ—¶ã€‚

ä¸åˆå§‹æ¸²æŸ“ç›¸æ¯”ï¼Œé‡æ¸²æŸ“ä»…ä»…åœ¨é¡µé¢æŸäº›éƒ¨åˆ†æ”¹å˜æ—¶å‘ç”Ÿã€‚åœ¨ä¸€ä¸ªæ¶æ„åˆç†çš„åº”ç”¨ä¸­ï¼Œåªæœ‰è¿™äº›ç‰¹å®šåŒºåŸŸçš„ç»„ä»¶æ‰ä¼šé‡æ¸²æŸ“ï¼Œè€Œéæ•´ä¸ªåº”ç”¨ï¼ˆé¡µé¢ï¼‰ã€‚é‚£ä¹ˆåœ¨ä¸€æ¬¡å¯»å¸¸çš„é‡æ¸²æŸ“ä¸­ï¼Œæ€»çš„â€œè®¡ç®—â€çš„æ¶ˆè€—å’Œæˆ‘ä»¬ä¸Šé¢æåˆ°çš„ä¾‹å­ï¼ˆè¯‘è€…æ³¨ï¼šæŒ‡ 250 ä¸ªå…ƒç´ çš„æ’åºåˆ—è¡¨ï¼‰ç›¸æ¯”ï¼Œä¼šé«˜å‡ºå¤šå°‘å‘¢ï¼Ÿ2~3 å€ï¼Ÿï¼Œå°±å‡è®¾æœ‰ 5 å€å¥½äº†ï¼Œé‚£ä¹Ÿä»…ä»…æ˜¯èŠ‚çœäº† 10ms çš„æ¸²æŸ“æ—¶é—´ï¼Œè¿™ä¹ˆçŸ­çš„æ—¶é—´é—´éš”æˆ‘ä»¬çš„è‚‰çœ¼æ˜¯æ— æ³•å¯Ÿè§‰çš„ï¼Œå¹¶ä¸”åœ¨åå€çš„æ¸²æŸ“æ—¶é—´ä¸‹ï¼Œè¿™ 10 ms ä¹Ÿç¡®å®å¾ˆä¸èµ·çœ¼ã€‚å¯ä½œä¸ºä»£ä»·çš„æ˜¯ï¼Œå®ƒç¡®å®æ‹–æ…¢äº†æ¯æ¬¡éƒ½ä¼šå‘ç”Ÿçš„åˆå§‹æ¸²æŸ“è¿‡ç¨‹ğŸ˜”ã€‚

ï¼ˆè¯‘è€…æ€»ç»“ï¼šå‚ä¸åˆå§‹æ¸²æŸ“çš„æ˜¯æ•´ä¸ªé¡µé¢ç›¸å…³çš„ç»„ä»¶ï¼Œå‚ä¸é‡æ¸²æŸ“çš„åªæ˜¯å±€éƒ¨çš„ç»„ä»¶ï¼Œä¸¤è€…ä¸æ˜¯ä¸€ä¸ªæ•°é‡çº§ã€‚å‚ä¸åˆå§‹æ¸²æŸ“çš„å¤§é‡ç»„ä»¶ï¼Œè¢« `useMemo` å’Œ `useCallbak`Â æ‹–æ…¢æ‰€äº§ç”Ÿçš„å åŠ æ˜æ˜¾ï¼Œè¿œè¿œæ¯”å‚ä¸é‡æ¸²æŸ“çš„å°‘é‡ç»„ä»¶ï¼Œè¢«Â `useMemo` å’Œ `useCallbak`æ‰€ä¼˜åŒ–æ‰€äº§ç”Ÿçš„å åŠ æ•ˆåº”æ¥çš„æ˜æ˜¾ï¼ä¹Ÿå°±æ˜¯è¯´ï¼Œèµ„ä¸æŠµå€ºï¼Œè¿™ç¬”ä¼˜åŒ–åˆ’ä¸æ¥ã€‚ï¼‰

## ä»Šå¤©è¯´å¾—å¤Ÿå¤šçš„äº†

ä¸Šé¢ç¡®å®ä¼ è¾¾äº†ä¸å°‘ä¿¡æ¯ï¼Œå¸Œæœ›ä½ èƒ½è§‰å¾—æœ‰ç”¨ï¼Œå¹¶ç«‹é©¬çƒ­æƒ…æ¾æ¹ƒåœ°å›è¿‡å¤´æ¥ review ä½ çš„ä»£ç ï¼Œä» `useMemo` å’Œ `useCallback` çš„æŸç¼šä¸­è§£è„±å‡ºæ¥ã€‚ä¸‹é¢æ˜¯ä¸€äº›ç®€çŸ­çš„æ€»ç»“ï¼š

- `useCallback` å’Œ `useMemo` ä»…ä»…åœ¨åç»­æ¸²æŸ“ï¼ˆä¹Ÿå°±æ˜¯é‡æ¸²æŸ“ï¼‰ä¸­èµ·ä½œç”¨ï¼Œåœ¨åˆå§‹æ¸²æŸ“ä¸­å®ƒä»¬åè€Œæ˜¯æœ‰å®³çš„
- `useCallback` å’Œ `useMemo` ä½œç”¨äº `props` å¹¶ä¸èƒ½é¿å…ç»„ä»¶é‡æ¸²æŸ“ã€‚åªæœ‰å½“æ¯ä¸€ä¸ª `prop` éƒ½è¢«ç¼“å­˜ï¼Œä¸”ç»„ä»¶æœ¬èº«ä¹Ÿè¢«ç¼“å­˜çš„æƒ…å†µä¸‹ï¼Œé‡æ¸²æŸ“æ‰èƒ½è¢«é¿å…ã€‚åªè¦æœ‰ä¸€ä¸ç‚¹ç–å¿½ï¼Œé‚£ä¹ˆä½ åšçš„ä¸€åˆ‡åŠªåŠ›å°±æ‰“æ°´æ¼‚äº†ã€‚æ‰€ä»¥è¯´ï¼Œç®€å•ç‚¹ï¼ŒæŠŠå®ƒä»¬éƒ½åˆ äº†å§ã€‚
- æŠŠåŒ…è£¹äº†â€œçº¯ js æ“ä½œâ€œçš„ `useMemo` ä¹Ÿéƒ½åˆ äº†å§ã€‚ä¸ç»„ä»¶æœ¬èº«çš„æ¸²æŸ“ç›¸æ¯”ï¼Œå®ƒç¼“å­˜æ•°æ®å¸¦æ¥çš„è€—æ—¶å‡å°‘æ˜¯å¾®ä¸è¶³é“çš„ï¼Œå¹¶ä¸”ä¼šåœ¨åˆå§‹æ¸²æŸ“æ—¶æ¶ˆè€—é¢å¤–çš„å†…å­˜ï¼Œé€ æˆå¯ä»¥è¢«è§‚å¯Ÿåˆ°çš„å»¶è¿Ÿã€‚

æœ€åçš„å°æç¤ºï¼šè€ƒè™‘åˆ° `useMemo` å’Œ `useCallbak` æ˜¯å¦‚æ­¤å¤æ‚ä¸”è„†å¼±ï¼Œä½ åº”è¯¥æŠŠå®ƒä»¬ä½œä¸ºä½ æ€§èƒ½ä¼˜åŒ–è®¡åˆ’ä¸­æœ€åæ‰è€ƒè™‘çš„ä¸€ç‚¹ã€‚è¯•è¯•å…¶ä»–ä¼˜åŒ–æŠ€å·§å§ï¼Œçœ‹ä¸€ä¸‹æˆ‘çš„å…¶å®ƒæ–‡ç« ï¼Œå®ƒä»¬æåˆ°äº†è¿™äº›æŠ€å·§ï¼ˆè¯‘è€…æ³¨ï¼šè‹¥æ–‡ç« ç‚¹èµè¿‡ç™¾ï¼Œè€ƒè™‘å†ç¿»è¯‘ä¸€ç¯‡ï¼‰

- [How to write performant React code: rules, patterns, do's and don'ts](https://link.juejin.cn/?target=https%3A%2F%2Fwww.developerway.com%2Fposts%2Fhow-to-write-performant-react-code "https://www.developerway.com/posts/how-to-write-performant-react-code")
- [Why custom react hooks could destroy your app performance](https://link.juejin.cn/?target=https%3A%2F%2Fwww.developerway.com%2Fposts%2Fwhy-custom-react-hooks-could-destroy-your-app-performance "https://www.developerway.com/posts/why-custom-react-hooks-could-destroy-your-app-performance")
- [How to write performant React apps with Context](https://link.juejin.cn/?target=https%3A%2F%2Fwww.developerway.com%2Fposts%2Fhow-to-write-performant-react-apps-with-context "https://www.developerway.com/posts/how-to-write-performant-react-apps-with-context")
- [React key attribute: best practices for performant lists](https://link.juejin.cn/?target=https%3A%2F%2Fwww.developerway.com%2Fposts%2Freact-key-attribute "https://www.developerway.com/posts/react-key-attribute")
- [React components composition: how to get it right](https://link.juejin.cn/?target=https%3A%2F%2Fwww.developerway.com%2Fposts%2Fcomponents-composition-how-to-get-it-right "https://www.developerway.com/posts/components-composition-how-to-get-it-right").

å½“ç„¶ï¼Œä¸è¨€è€Œå–»çš„æ˜¯ï¼Œæµ‹é‡ä¼˜å…ˆï¼ï¼ˆæ²¡æœ‰æ•°æ®å°±æ²¡æœ‰å‘è¨€æƒï¼‰

å¸Œæœ›ä»Šå¤©æ˜¯ä½ åœ¨ `useMemo` å’Œ `useCallbak` åœ°ç‹±ä¸­è‹¦è‹¦æŒ£æ‰çš„æœ€åä¸€å¤©ï¼âœŒğŸ¼